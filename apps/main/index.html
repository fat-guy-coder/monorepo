<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Three.js äº¤äº’å¼æ˜Ÿç³»çŸ¥è¯†å›¾è°±</title>
  <script src="https://cdn.jsdelivr.net/npm/vue@3.2.31/dist/vue.global.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background: linear-gradient(135deg, #0b0b2b, #1a1a40, #0f0f29);
      color: #e0e0ff;
      min-height: 100vh;
      overflow: hidden;
      position: relative;
    }
    
    .header {
      text-align: center;
      padding: 20px;
      position: relative;
      z-index: 10;
    }
    
    .header h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45aaf2);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 0 15px rgba(100, 200, 255, 0.2);
    }
    
    .header p {
      font-size: 1.1rem;
      max-width: 700px;
      margin: 0 auto;
      color: #a0a0e0;
      line-height: 1.6;
    }
    
    .container {
      display: flex;
      height: calc(100vh - 160px);
      position: relative;
    }
    
    #galaxy-canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
    }
    
    .ui-panel {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(10, 15, 30, 0.7);
      border: 1px solid rgba(100, 150, 255, 0.3);
      border-radius: 15px;
      padding: 15px 25px;
      backdrop-filter: blur(10px);
      z-index: 20;
      display: flex;
      gap: 15px;
      box-shadow: 0 5px 25px rgba(0, 0, 0, 0.5);
    }
    
    .control-btn {
      background: linear-gradient(135deg, #45aaf2, #4ecdc4);
      color: white;
      border: none;
      border-radius: 50px;
      padding: 10px 20px;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(69, 170, 242, 0.4);
    }
    
    .control-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(69, 170, 242, 0.6);
    }
    
    .control-btn:disabled {
      background: linear-gradient(135deg, #555, #777);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .back-btn {
      background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
      box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
    }
    
    .back-btn:hover {
      box-shadow: 0 6px 20px rgba(255, 107, 107, 0.6);
    }
    
    .info-panel {
      position: absolute;
      top: 100px;
      right: 20px;
      width: 300px;
      background: rgba(10, 15, 30, 0.8);
      border: 1px solid rgba(100, 150, 255, 0.3);
      border-radius: 15px;
      padding: 20px;
      z-index: 20;
      backdrop-filter: blur(10px);
      box-shadow: 0 5px 25px rgba(0, 0, 0, 0.5);
    }
    
    .info-panel h2 {
      color: #45aaf2;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(100, 150, 255, 0.3);
    }
    
    .info-panel p {
      margin-bottom: 15px;
      line-height: 1.6;
      color: #c0c0ff;
    }
    
    .info-panel ul {
      padding-left: 20px;
      margin-bottom: 15px;
    }
    
    .info-panel li {
      margin-bottom: 8px;
      color: #c0c0ff;
    }
    
    .current-path {
      position: absolute;
      top: 20px;
      left: 20px;
      background: rgba(10, 15, 30, 0.7);
      border: 1px solid rgba(100, 150, 255, 0.3);
      border-radius: 15px;
      padding: 15px 20px;
      backdrop-filter: blur(10px);
      z-index: 20;
      max-width: 400px;
      box-shadow: 0 5px 25px rgba(0, 0, 0, 0.5);
    }
    
    .current-path h3 {
      color: #4ecdc4;
      margin-bottom: 10px;
    }
    
    .path-text {
      font-size: 1.1rem;
      color: #a0a0e0;
    }
    
    .loading {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 20, 0.8);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 100;
    }
    
    .spinner {
      width: 60px;
      height: 60px;
      border: 5px solid rgba(69, 170, 242, 0.3);
      border-top: 5px solid #45aaf2;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .loading-text {
      font-size: 1.2rem;
      color: #e0e0ff;
    }
    
    .notification {
      position: absolute;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(10, 15, 30, 0.9);
      border: 1px solid rgba(100, 150, 255, 0.5);
      border-radius: 10px;
      padding: 15px 30px;
      backdrop-filter: blur(10px);
      z-index: 20;
      box-shadow: 0 5px 25px rgba(0, 0, 0, 0.5);
      animation: fadeInOut 3s ease-in-out;
    }
    
    @keyframes fadeInOut {
      0% { opacity: 0; transform: translate(-50%, 20px); }
      20% { opacity: 1; transform: translate(-50%, 0); }
      80% { opacity: 1; transform: translate(-50%, 0); }
      100% { opacity: 0; transform: translate(-50%, 20px); }
    }
    
    .planet-info {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(10, 15, 30, 0.95);
      border: 1px solid rgba(100, 150, 255, 0.5);
      border-radius: 15px;
      padding: 30px;
      backdrop-filter: blur(10px);
      z-index: 50;
      width: 80%;
      max-width: 500px;
      box-shadow: 0 10px 50px rgba(0, 0, 0, 0.7);
      text-align: center;
    }
    
    .planet-info h3 {
      color: #4ecdc4;
      margin-bottom: 20px;
      font-size: 1.8rem;
    }
    
    .planet-info p {
      color: #c0c0ff;
      margin-bottom: 25px;
      line-height: 1.6;
    }
    
    .close-btn {
      background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
      color: white;
      border: none;
      border-radius: 50px;
      padding: 10px 30px;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
    }
    
    .close-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(255, 107, 107, 0.6);
    }
    
    .stars {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
    }
    
    .star {
      position: absolute;
      background-color: white;
      border-radius: 50%;
      animation: twinkle var(--duration, 5s) infinite ease-in-out;
    }
    
    @keyframes twinkle {
      0% { opacity: 0.2; }
      50% { opacity: 1; }
      100% { opacity: 0.2; }
    }
    
    @media (max-width: 768px) {
      .header h1 {
        font-size: 2rem;
      }
      
      .info-panel {
        width: 250px;
        top: 80px;
        right: 10px;
        padding: 15px;
      }
      
      .current-path {
        max-width: 300px;
        padding: 10px 15px;
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="header">
      <h1>çŸ¥è¯†æ˜Ÿç³»æ¢ç´¢è€…</h1>
      <p>å°†å¤æ‚çš„çŸ¥è¯†ä½“ç³»è½¬åŒ–ä¸ºç›´è§‚çš„3Dæ˜Ÿç³»å›¾ï¼Œç‚¹å‡»æ’æ˜Ÿè¿›å…¥çŸ¥è¯†æ˜Ÿç³»ï¼Œç‚¹å‡»è¡Œæ˜ŸæŸ¥çœ‹è¯¦æƒ…</p>
    </div>
    
    <div class="container">
      <div class="stars" ref="starsContainer"></div>
      <div class="loading" v-if="loading">
        <div class="spinner"></div>
        <div class="loading-text">æ­£åœ¨æ„å»ºçŸ¥è¯†æ˜Ÿç³»...</div>
      </div>
      
      <div class="current-path" v-if="currentPath.length > 0">
        <h3>å½“å‰ä½ç½®</h3>
        <div class="path-text">{{ currentPath.join(' > ') }}</div>
      </div>
      
      <div class="info-panel">
        <h2>æ¢ç´¢æŒ‡å—</h2>
        <p>è¿™æ˜¯ä¸€ä¸ªäº¤äº’å¼çš„3DçŸ¥è¯†æ˜Ÿç³»å¯è§†åŒ–å·¥å…·ï¼š</p>
        <ul>
          <li>âœ¨ <strong>é»„è‰²æ’æ˜Ÿ</strong>ï¼šä»£è¡¨çŸ¥è¯†åˆ†ç±»ï¼Œå¯ç‚¹å‡»è¿›å…¥</li>
          <li>ğŸ”µ <strong>è“è‰²è¡Œæ˜Ÿ</strong>ï¼šä»£è¡¨å…·ä½“çŸ¥è¯†ç‚¹ï¼Œå¯ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…</li>
          <li>ğŸª <strong>è½¨é“è¡Œæ˜Ÿ</strong>ï¼šå›´ç»•æ’æ˜Ÿæ—‹è½¬çš„çŸ¥è¯†ç‚¹</li>
          <li>ğŸš€ <strong>é£è¡ŒåŠ¨ç”»</strong>ï¼šæ–°æ˜Ÿç³»èŠ‚ç‚¹ä¼šä»è¿œå¤„é£æ¥</li>
        </ul>
        <p>ä½¿ç”¨é¼ æ ‡å¯ä»¥æ—‹è½¬ã€ç¼©æ”¾å’Œå¹³ç§»è§†è§’ï¼Œæ¢ç´¢æ•´ä¸ªçŸ¥è¯†å®‡å®™ï¼</p>
      </div>
      
      <canvas id="galaxy-canvas" ref="canvas"></canvas>
      
      <div class="ui-panel">
        <button class="control-btn back-btn" @click="goBack" :disabled="history.length === 0">è¿”å›ä¸Šçº§æ˜Ÿç³»</button>
        <button class="control-btn" @click="resetView">é‡ç½®è§†è§’</button>
      </div>
      
      <div v-if="showNotification" class="notification">
        {{ notificationMessage }}
      </div>
      
      <div v-if="selectedPlanet" class="planet-info">
        <h3>{{ selectedPlanet.label }}</h3>
        <p>åç§°ï¼š{{ selectedPlanet.name }}</p>
        <p>è·¯å¾„ï¼š{{ selectedPlanet.path.join(' > ') }}</p>
        <button class="close-btn" @click="selectedPlanet = null">å…³é—­è¯¦æƒ…</button>
      </div>
    </div>
  </div>

  <script>
    const { createApp, ref, onMounted, reactive } = Vue;
    
    // ç¤ºä¾‹çŸ¥è¯†æ˜Ÿç³»æ•°æ®
    const knowledgeData = [
      {
        "label": "ğŸ¯ åŸºç¡€æ ¸å¿ƒèƒ½åŠ› â­â­â­",
        "name": "CoreSkills",
        "children": [
          {
            "label": "ğŸŒ HTML & CSS â­â­â­",
            "name": "HTML_CSS",
            "children": [
              {
                "label": "ğŸ“„ HTML â­â­â­",
                "name": "HTML",
                "children": [
                  {
                    "label": "â“ ä»€ä¹ˆæ˜¯HTML â­â­â­",
                    "name": "WhatIsHtml"
                  },
                  {
                    "label": "ğŸ·ï¸ å¸¸ç”¨æ ‡ç­¾ â­â­â­",
                    "name": "CommonUseTags"
                  },
                  {
                    "label": "ğŸ“‹ DOCTYPE â­â­â­",
                    "name": "DOCTYPE"
                  },
                  {
                    "label": "ğŸ“ Metaä¸Title â­â­â­",
                    "name": "MetaAndTitle"
                  }
                ]
              },
              {
                "label": "ğŸ“‹ HTML(5)çŸ¥è¯†ç‚¹ â­â­â­",
                "name": "HtmlKnowledgepPoints"
              },
              {
                "label": "ğŸ“‹ CSSçŸ¥è¯†ç‚¹ â­â­â­",
                "name": "CssKnowledgepPoints"
              }
            ]
          },
          {
            "label": "ğŸ“œ JavaScript â­â­â­",
            "name": "JavaScript",
            "children": [
              {
                "label": "ğŸ“š åŸºç¡€ â­â­â­",
                "name": "Basics",
                "children": [
                  {
                    "label": "â“ ä»€ä¹ˆæ˜¯JS â­â­â­",
                    "name": "WhatIsJS"
                  },
                  {
                    "label": "ğŸ” JSçš„åŠ è½½æ–¹å¼å…·ä½“å¯¹æ¯” â­â­â­",
                    "name": "JSLoad"
                  },
                  {
                    "label": "ğŸ“¦ å˜é‡ï¼švarã€letã€const â­â­â­",
                    "name": "Variables"
                  }
                ]
              }
            ]
          }
        ]
      },
      {
        "label": "âŒ¨ï¸ ç¼–è¾‘å™¨å¿«æ·é”® â­â­â­",
        "name": "Shortcuts",
        "children": [
          {
            "label": "âŒ¨ï¸ cursor(windows)å¿«æ·é”® â­â­â­",
            "name": "CursorShortcuts"
          },
          {
            "label": "âŒ¨ï¸ cursor(mac)å¿«æ·é”® â­â­â­",
            "name": "CursorShortcutsMac"
          }
        ]
      }
    ];
    
    createApp({
      setup() {
        const canvas = ref(null);
        const starsContainer = ref(null);
        const loading = ref(true);
        const showNotification = ref(false);
        const notificationMessage = ref('');
        const selectedPlanet = ref(null);
        const currentPath = ref([]);
        
        // åœºæ™¯å¯¼èˆªå†å²
        const history = ref([]);
        
        // Three.js å˜é‡
        let scene, camera, renderer, controls;
        let starGroup = new THREE.Group();
        let currentLevel = null;
        let animationId = null;
        let raycaster = new THREE.Raycaster();
        let mouse = new THREE.Vector2();
        
        // åˆ›å»ºæ˜Ÿç©ºèƒŒæ™¯
        const createStars = () => {
          const container = starsContainer.value;
          const starCount = 500;
          
          for (let i = 0; i < starCount; i++) {
            const star = document.createElement('div');
            star.classList.add('star');
            
            // éšæœºä½ç½®å’Œå¤§å°
            const size = Math.random() * 3 + 1;
            const posX = Math.random() * 100;
            const posY = Math.random() * 100;
            
            star.style.width = `${size}px`;
            star.style.height = `${size}px`;
            star.style.left = `${posX}%`;
            star.style.top = `${posY}%`;
            
            // éšæœºåŠ¨ç”»æŒç»­æ—¶é—´
            const duration = Math.random() * 10 + 5;
            star.style.setProperty('--duration', `${duration}s`);
            
            container.appendChild(star);
          }
        };
        
        // æ˜¾ç¤ºé€šçŸ¥
        const showNotificationMsg = (message) => {
          notificationMessage.value = message;
          showNotification.value = true;
          
          setTimeout(() => {
            showNotification.value = false;
          }, 3000);
        };
        
        // åˆå§‹åŒ–Three.jsåœºæ™¯
        const initScene = () => {
          // åˆ›å»ºåœºæ™¯
          scene = new THREE.Scene();
          scene.background = new THREE.Color(0x05051a);
          
          // æ·»åŠ æ˜Ÿäº‘èƒŒæ™¯æ•ˆæœ
          const starGeometry = new THREE.BufferGeometry();
          const starMaterial = new THREE.PointsMaterial({
            color: 0xffffff,
            size: 0.1,
            transparent: true,
            opacity: 0.8
          });
          
          const starVertices = [];
          for (let i = 0; i < 10000; i++) {
            const x = (Math.random() - 0.5) * 2000;
            const y = (Math.random() - 0.5) * 2000;
            const z = (Math.random() - 0.5) * 2000;
            starVertices.push(x, y, z);
          }
          
          starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
          const stars = new THREE.Points(starGeometry, starMaterial);
          scene.add(stars);
          
          // åˆ›å»ºç›¸æœº
          camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 2000);
          camera.position.z = 50;
          
          // åˆ›å»ºæ¸²æŸ“å™¨
          renderer = new THREE.WebGLRenderer({
            canvas: canvas.value,
            antialias: true,
            alpha: true
          });
          renderer.setSize(window.innerWidth, window.innerHeight);
          renderer.setPixelRatio(window.devicePixelRatio);
          
          // æ·»åŠ è½¨é“æ§åˆ¶å™¨
          controls = new THREE.OrbitControls(camera, renderer.domElement);
          controls.enableDamping = true;
          controls.dampingFactor = 0.05;
          
          // æ·»åŠ ç¯å¢ƒå…‰
          const ambientLight = new THREE.AmbientLight(0x333333);
          scene.add(ambientLight);
          
          // æ·»åŠ æ–¹å‘å…‰
          const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
          directionalLight.position.set(5, 5, 5);
          scene.add(directionalLight);
          
          // æ·»åŠ ç‚¹å…‰æº
          const pointLight = new THREE.PointLight(0x4ecdc4, 1, 100);
          pointLight.position.set(10, 10, 10);
          scene.add(pointLight);
          
          scene.add(starGroup);
          
          // æ„å»ºåˆå§‹æ˜Ÿç³»
          buildGalaxy(knowledgeData);
          
          // å¼€å§‹åŠ¨ç”»å¾ªç¯
          animate();
          
          // æ¨¡æ‹ŸåŠ è½½å®Œæˆ
          setTimeout(() => {
            loading.value = false;
            showNotificationMsg('çŸ¥è¯†æ˜Ÿç³»æ„å»ºå®Œæˆï¼å¼€å§‹æ¢ç´¢å§ï¼');
          }, 2000);
        };
        
        // æ„å»ºæ˜Ÿç³»
        const buildGalaxy = (data, parentPos = new THREE.Vector3(0, 0, 0)) => {
          // æ¸…é™¤ç°æœ‰æ˜Ÿç³»
          while(starGroup.children.length > 0) { 
            starGroup.remove(starGroup.children[0]); 
          }
          
          // æ›´æ–°å½“å‰è·¯å¾„
          if (currentPath.value.length === 0) {
            currentPath.value = ['çŸ¥è¯†æ˜Ÿç³»'];
          }
          
          // åˆ›å»ºä¸­å¤®æ’æ˜Ÿ
          if (data.length > 1) {
            createCentralStar(parentPos);
          }
          
          // ä¸ºæ¯ä¸ªçŸ¥è¯†èŠ‚ç‚¹åˆ›å»ºæ˜Ÿçƒ
          data.forEach((item, index) => {
            const angle = (index / data.length) * Math.PI * 2;
            const distance = 15 + Math.random() * 5;
            const x = Math.cos(angle) * distance;
            const y = Math.sin(angle) * distance;
            const z = (Math.random() - 0.5) * 5;
            
            const position = new THREE.Vector3(x, y, z);
            
            // åˆ›å»ºæ˜Ÿçƒ
            const planet = createPlanet(item, position);
            
            // æ·»åŠ åŠ¨ç”»æ•ˆæœ - ä»è¿œå¤„é£æ¥
            const startPos = new THREE.Vector3(
              position.x * 5,
              position.y * 5,
              position.z * 5
            );
            
            planet.position.copy(startPos);
            
            // åŠ¨ç”»åˆ°ç›®æ ‡ä½ç½®
            animatePlanet(planet, position, index * 200);
            
            starGroup.add(planet);
          });
        };
        
        // åˆ›å»ºä¸­å¤®æ’æ˜Ÿ
        const createCentralStar = (position) => {
          const geometry = new THREE.SphereGeometry(3, 32, 32);
          const material = new THREE.MeshPhongMaterial({
            color: 0xffd700,
            emissive: 0xffcc00,
            shininess: 100
          });
          
          const star = new THREE.Mesh(geometry, material);
          star.position.copy(position);
          
          // æ·»åŠ å…‰æ™•æ•ˆæœ
          const glowGeometry = new THREE.SphereGeometry(3.5, 32, 32);
          const glowMaterial = new THREE.MeshBasicMaterial({
            color: 0xffcc00,
            transparent: true,
            opacity: 0.3
          });
          
          const glow = new THREE.Mesh(glowGeometry, glowMaterial);
          star.add(glow);
          
          starGroup.add(star);
          
          // æ·»åŠ æ—‹è½¬åŠ¨ç”»
          const animateStar = () => {
            star.rotation.y += 0.005;
            glow.rotation.y += 0.003;
          };
          
          // å°†åŠ¨ç”»å‡½æ•°å­˜å‚¨åˆ°starå¯¹è±¡ä¸­
          star.userData.animate = animateStar;
          
          return star;
        };
        
        // åˆ›å»ºçŸ¥è¯†æ˜Ÿçƒ
        const createPlanet = (item, position) => {
          // æ ¹æ®æ˜¯å¦æœ‰å­èŠ‚ç‚¹å†³å®šæ˜¯æ’æ˜Ÿè¿˜æ˜¯è¡Œæ˜Ÿ
          const isStar = item.children && item.children.length > 0;
          const size = isStar ? 1.5 : 1.0;
          
          // åˆ›å»ºçƒä½“
          const geometry = new THREE.SphereGeometry(size, 32, 32);
          const material = new THREE.MeshPhongMaterial({
            color: isStar ? 0x45aaf2 : 0x4ecdc4,
            emissive: isStar ? 0x1e90ff : 0x00ced1,
            shininess: 50
          });
          
          const planet = new THREE.Mesh(geometry, material);
          planet.position.copy(position);
          
          // æ·»åŠ å…‰æ™•æ•ˆæœ
          if (isStar) {
            const glowGeometry = new THREE.SphereGeometry(size + 0.3, 32, 32);
            const glowMaterial = new THREE.MeshBasicMaterial({
              color: 0x1e90ff,
              transparent: true,
              opacity: 0.3
            });
            
            const glow = new THREE.Mesh(glowGeometry, glowMaterial);
            planet.add(glow);
          }
          
          // å­˜å‚¨çŸ¥è¯†æ•°æ®
          planet.userData = {
            label: item.label,
            name: item.name,
            children: item.children,
            path: [...currentPath.value, item.label],
            isStar: isStar
          };
          
          // æ·»åŠ æ–‡å­—æ ‡ç­¾
          const canvas = document.createElement('canvas');
          const context = canvas.getContext('2d');
          canvas.width = 256;
          canvas.height = 128;
          
          context.fillStyle = 'rgba(0, 0, 0, 0.7)';
          context.fillRect(0, 0, canvas.width, canvas.height);
          
          context.font = 'bold 20px Arial';
          context.fillStyle = '#ffffff';
          context.textAlign = 'center';
          context.textBaseline = 'middle';
          
          // å¤„ç†æ¢è¡Œ
          const words = item.label.split(' ');
          let line = '';
          let lineHeight = 30;
          let y = 30;
          
          for (let i = 0; i < words.length; i++) {
            const testLine = line + words[i] + ' ';
            const metrics = context.measureText(testLine);
            
            if (metrics.width > canvas.width - 20 && i > 0) {
              context.fillText(line, canvas.width / 2, y);
              line = words[i] + ' ';
              y += lineHeight;
            } else {
              line = testLine;
            }
          }
          context.fillText(line, canvas.width / 2, y);
          
          const texture = new THREE.CanvasTexture(canvas);
          const spriteMaterial = new THREE.SpriteMaterial({ 
            map: texture,
            transparent: true
          });
          
          const sprite = new THREE.Sprite(spriteMaterial);
          sprite.scale.set(8, 4, 1);
          sprite.position.y = size + 2;
          planet.add(sprite);
          
          // æ·»åŠ ç‚¹å‡»äº‹ä»¶
          planet.userData.onClick = () => {
            if (planet.userData.isStar && planet.userData.children) {
              // è¿›å…¥å­æ˜Ÿç³»
              history.value.push({
                data: knowledgeData,
                path: [...currentPath.value]
              });
              
              currentPath.value = [...planet.userData.path];
              buildGalaxy(planet.userData.children, planet.position);
              showNotificationMsg(`è¿›å…¥æ˜Ÿç³»: ${item.label}`);
            } else {
              // æ˜¾ç¤ºè¡Œæ˜Ÿè¯¦æƒ…
              selectedPlanet.value = planet.userData;
              showNotificationMsg(`æŸ¥çœ‹çŸ¥è¯†ç‚¹: ${item.label}`);
            }
          };
          
          return planet;
        };
        
        // æ˜Ÿçƒé£è¡ŒåŠ¨ç”»
        const animatePlanet = (planet, targetPosition, delay) => {
          const startPosition = planet.position.clone();
          const startTime = Date.now() + delay;
          
          const animate = () => {
            const elapsed = Date.now() - startTime;
            if (elapsed < 0) {
              requestAnimationFrame(animate);
              return;
            }
            
            const progress = Math.min(elapsed / 1500, 1);
            const easeProgress = 1 - Math.pow(1 - progress, 3);
            
            planet.position.lerpVectors(startPosition, targetPosition, easeProgress);
            
            if (progress < 1) {
              requestAnimationFrame(animate);
            }
          };
          
          animate();
        };
        
        // è¿”å›ä¸Šä¸€çº§
        const goBack = () => {
          if (history.value.length > 0) {
            const prevState = history.value.pop();
            knowledgeData = prevState.data;
            currentPath.value = prevState.path;
            buildGalaxy(knowledgeData);
            showNotificationMsg('è¿”å›ä¸Šä¸€çº§æ˜Ÿç³»');
          }
        };
        
        // é‡ç½®è§†è§’
        const resetView = () => {
          if (controls) {
            controls.reset();
          }
        };
        
        // åŠ¨ç”»å¾ªç¯
        const animate = () => {
          animationId = requestAnimationFrame(animate);
          
          // æ›´æ–°æ§åˆ¶å™¨
          if (controls) controls.update();
          
          // æ›´æ–°æ˜Ÿçƒæ—‹è½¬
          starGroup.children.forEach(child => {
            if (child.userData && child.userData.animate) {
              child.userData.animate();
            } else {
              // è¡Œæ˜Ÿè‡ªè½¬
              child.rotation.y += 0.01;
            }
          });
          
          // æ¸²æŸ“åœºæ™¯
          if (renderer && scene && camera) {
            renderer.render(scene, camera);
          }
        };
        
        // ç‚¹å‡»äº‹ä»¶å¤„ç†
        const handleClick = (event) => {
          if (!renderer || !camera) return;
          
          // è®¡ç®—é¼ æ ‡åœ¨å½’ä¸€åŒ–è®¾å¤‡åæ ‡ä¸­çš„ä½ç½®
          mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
          mouse.y = - (event.clientY / window.innerHeight) * 2 + 1;
          
          // æ›´æ–°å°„çº¿
          raycaster.setFromCamera(mouse, camera);
          
          // è®¡ç®—ä¸æ˜Ÿçƒçš„äº¤ç‚¹
          const intersects = raycaster.intersectObjects(starGroup.children, true);
          
          if (intersects.length > 0) {
            // æ‰¾åˆ°è¢«ç‚¹å‡»çš„å¯¹è±¡
            let clickedObject = intersects[0].object;
            
            // å¦‚æœç‚¹å‡»çš„æ˜¯æ ‡ç­¾ï¼Œåˆ™æ‰¾åˆ°å…¶çˆ¶çº§æ˜Ÿçƒ
            while (clickedObject && clickedObject.parent !== starGroup) {
              clickedObject = clickedObject.parent;
            }
            
            // è°ƒç”¨ç‚¹å‡»å¤„ç†å‡½æ•°
            if (clickedObject.userData && clickedObject.userData.onClick) {
              clickedObject.userData.onClick();
            }
          }
        };
        
        // çª—å£å¤§å°è°ƒæ•´å¤„ç†
        const handleResize = () => {
          if (camera && renderer) {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
          }
        };
        
        onMounted(() => {
          // åˆ›å»ºæ˜Ÿç©ºèƒŒæ™¯
          createStars();
          
          // åˆå§‹åŒ–åœºæ™¯
          initScene();
          
          // æ·»åŠ äº‹ä»¶ç›‘å¬
          window.addEventListener('resize', handleResize);
          canvas.value.addEventListener('click', handleClick);
        });
        
        return {
          canvas,
          starsContainer,
          loading,
          showNotification,
          notificationMessage,
          selectedPlanet,
          currentPath,
          history,
          goBack,
          resetView
        };
      }
    }).mount('#app');
  </script>
</body>
</html>