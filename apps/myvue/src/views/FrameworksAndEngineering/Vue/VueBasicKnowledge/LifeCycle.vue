<template>
  <div class="lifecycle-container">
    <header class="header">
      <h1>Vue ç”Ÿå‘½å‘¨æœŸåŸºç¡€ä»‹ç»</h1>
      <p>ç†è§£ç»„ä»¶ä»åˆ›å»ºåˆ°é”€æ¯çš„å®Œæ•´è¿‡ç¨‹</p>
    </header>

    <div class="content">
      <div class="lifecycle-flow">
        <div class="creation-phase">
          <h2>åˆ›å»ºé˜¶æ®µ</h2>
          <div class="hook-card" v-for="hook in creationHooks" :key="hook.name" :class="hook.name">
            <div class="hook-order">{{ hook.order }}</div>
            <div class="hook-info">
              <h3>{{ hook.name }}</h3>
              <p>{{ hook.description }}</p>
              <div class="hook-usage">
                <strong>é€‚åˆæ“ä½œï¼š</strong>
                <ul>
                  <li v-for="(usage, idx) in hook.usages" :key="idx">{{ usage }}</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        <div class="update-phase">
          <h2>æ›´æ–°é˜¶æ®µ</h2>
          <div class="hook-card" v-for="hook in updateHooks" :key="hook.name" :class="hook.name">
            <div class="hook-order">{{ hook.order }}</div>
            <div class="hook-info">
              <h3>{{ hook.name }}</h3>
              <p>{{ hook.description }}</p>
              <div class="hook-usage">
                <strong>é€‚åˆæ“ä½œï¼š</strong>
                <ul>
                  <li v-for="(usage, idx) in hook.usages" :key="idx">{{ usage }}</li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <div class="destruction-phase">
          <h2>é”€æ¯é˜¶æ®µ</h2>
          <div class="hook-card" v-for="hook in destructionHooks" :key="hook.name" :class="hook.name">
            <div class="hook-order">{{ hook.order }}</div>
            <div class="hook-info">
              <h3>{{ hook.name }}</h3>
              <p>{{ hook.description }}</p>
              <div class="hook-usage">
                <strong>é€‚åˆæ“ä½œï¼š</strong>
                <ul>
                  <li v-for="(usage, idx) in hook.usages" :key="idx">{{ usage }}</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="code-section">
        <h2>ç”Ÿå‘½å‘¨æœŸé’©å­ä½¿ç”¨ç¤ºä¾‹</h2>
        <div class="code-block">
          <pre><code>import {
  onBeforeMount,
  onMounted,
  onBeforeUpdate,
  onUpdated,
  onBeforeUnmount,
  onUnmounted,
  onErrorCaptured
} from 'vue';

export default {
  setup() {
    // åˆ›å»ºé˜¶æ®µ
    onBeforeMount(() => {
      console.log('ç»„ä»¶æŒ‚è½½å‰');
      // æ­¤æ—¶DOMå°šæœªåˆ›å»ºï¼Œä¸å¯è®¿é—®DOMå…ƒç´ 
    });

    onMounted(() => {
      console.log('ç»„ä»¶å·²æŒ‚è½½');
      // å¯è®¿é—®DOMå…ƒç´ ï¼Œé€‚åˆå‘èµ·APIè¯·æ±‚
      fetchData();
    });

    // æ›´æ–°é˜¶æ®µ
    onBeforeUpdate(() => {
      console.log('ç»„ä»¶æ›´æ–°å‰');
      // æ•°æ®å˜åŒ–åï¼ŒDOMæ›´æ–°å‰
    });

    onUpdated(() => {
      console.log('ç»„ä»¶å·²æ›´æ–°');
      // DOMæ›´æ–°åï¼Œå¯æ‰§è¡Œä¾èµ–DOMçš„æ“ä½œ
    });

    // é”€æ¯é˜¶æ®µ
    onBeforeUnmount(() => {
      console.log('ç»„ä»¶å¸è½½å‰');
      // æ¸…ç†å®šæ—¶å™¨ã€å–æ¶ˆäº‹ä»¶ç›‘å¬ç­‰
      clearInterval(timer);
    });

    onUnmounted(() => {
      console.log('ç»„ä»¶å·²å¸è½½');
      // æ‰§è¡Œæœ€ç»ˆæ¸…ç†å·¥ä½œ
    });

    // é”™è¯¯æ•è·
    onErrorCaptured((err, instance, info) => {
      console.error('æ•è·åˆ°é”™è¯¯:', err);
      // å¯åœ¨æ­¤è®°å½•é”™è¯¯æˆ–æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
      return false; // é˜»æ­¢é”™è¯¯ç»§ç»­å‘ä¸Šä¼ æ’­
    });

    return {
      // å“åº”å¼æ•°æ®å’Œæ–¹æ³•
    };
  }
};</code></pre>
        </div>
      </div>

      <div class="best-practices">
        <h2>ç”Ÿå‘½å‘¨æœŸæœ€ä½³å®è·µ</h2>
        <div class="practices-grid">
          <div class="practice-card">
            <div class="icon">ğŸš«</div>
            <h3>é¿å…åœ¨ beforeMount ä¸­æ“ä½œ DOM</h3>
            <p>æ­¤æ—¶ DOM å°šæœªåˆ›å»ºï¼Œä»»ä½• DOM æ“ä½œéƒ½å°†æ— æ•ˆ</p>
          </div>
          <div class="practice-card">
            <div class="icon">â±ï¸</div>
            <h3>åœ¨ mounted ä¸­å‘èµ·å¼‚æ­¥è¯·æ±‚</h3>
            <p>ç¡®ä¿ç»„ä»¶å·²æŒ‚è½½ä¸”å¯ä»¥è®¿é—® DOM å…ƒç´ </p>
          </div>
          <div class="practice-card">
            <div class="icon">ğŸ§¹</div>
            <h3>åœ¨ beforeUnmount ä¸­æ¸…ç†èµ„æº</h3>
            <p>æ¸…é™¤å®šæ—¶å™¨ã€å–æ¶ˆäº‹ä»¶ç›‘å¬ã€æ–­å¼€è¿æ¥ç­‰</p>
          </div>
          <div class="practice-card">
            <div class="icon">ğŸ</div>
            <h3>ä½¿ç”¨ errorCaptured å¤„ç†é”™è¯¯</h3>
            <p>æ•è·å­ç»„ä»¶é”™è¯¯å¹¶è¿›è¡Œç»Ÿä¸€å¤„ç†</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script lang="ts" setup>
// ç”Ÿå‘½å‘¨æœŸé’©å­æ•°æ®
const creationHooks = [
  {
    name: "setup()",
    order: "1",
    description: "Composition API çš„å…¥å£ç‚¹ï¼Œç»„ä»¶åˆå§‹åŒ–æ—¶æœ€å…ˆæ‰§è¡Œ",
    usages: [
      "å®šä¹‰å“åº”å¼æ•°æ® (ref, reactive)",
      "å®šä¹‰è®¡ç®—å±æ€§ (computed)",
      "å®šä¹‰æ–¹æ³• (functions)",
      "å¼•å…¥å…¶ä»–ç»„ä»¶æˆ–æ’ä»¶"
    ]
  },
  {
    name: "onBeforeMount",
    order: "2",
    description: "ç»„ä»¶æŒ‚è½½åˆ° DOM ä¹‹å‰è°ƒç”¨ï¼Œæ­¤æ—¶æ¨¡æ¿å·²ç¼–è¯‘ä½†å°šæœªæ¸²æŸ“",
    usages: [
      "åˆå§‹åŒ–éå“åº”å¼æ•°æ®",
      "è®¿é—®æœåŠ¡ç«¯æ¸²æŸ“ä¸Šä¸‹æ–‡ (SSR)",
      "æ‰§è¡Œä¸ä¾èµ– DOM çš„åˆå§‹åŒ–æ“ä½œ"
    ]
  },
  {
    name: "onMounted",
    order: "3",
    description: "ç»„ä»¶æŒ‚è½½åˆ° DOM åè°ƒç”¨ï¼Œæ­¤æ—¶å¯ä»¥è®¿é—® DOM å…ƒç´ ",
    usages: [
      "å‘èµ· API è¯·æ±‚è·å–æ•°æ®",
      "æ“ä½œ DOM å…ƒç´ ",
      "åˆå§‹åŒ–ç¬¬ä¸‰æ–¹åº“ (å¦‚åœ°å›¾ã€å›¾è¡¨)",
      "è®¾ç½®å®šæ—¶å™¨æˆ–äº‹ä»¶ç›‘å¬å™¨"
    ]
  }
];

const updateHooks = [
  {
    name: "onBeforeUpdate",
    order: "4",
    description: "å“åº”å¼æ•°æ®å˜åŒ–åï¼ŒDOM é‡æ–°æ¸²æŸ“å‰è°ƒç”¨",
    usages: [
      "è·å–æ›´æ–°å‰çš„ DOM çŠ¶æ€",
      "åœ¨æ›´æ–°å‰æ‰§è¡Œä¸€äº›é€»è¾‘",
      "è®¿é—®æ›´æ–°å‰çš„ç»„ä»¶çŠ¶æ€"
    ]
  },
  {
    name: "onUpdated",
    order: "5",
    description: "DOM é‡æ–°æ¸²æŸ“åè°ƒç”¨ï¼Œæ­¤æ—¶ DOM å·²æ›´æ–°",
    usages: [
      "æ‰§è¡Œä¾èµ–æ›´æ–°å DOM çš„æ“ä½œ",
      "æ‰‹åŠ¨æ›´æ–°é Vue ç®¡ç†çš„ DOM å…ƒç´ ",
      "æ ¹æ®æ–° DOM çŠ¶æ€æ‰§è¡Œæ“ä½œ"
    ]
  }
];

const destructionHooks = [
  {
    name: "onBeforeUnmount",
    order: "6",
    description: "ç»„ä»¶å¸è½½ä¹‹å‰è°ƒç”¨ï¼Œæ­¤æ—¶ç»„ä»¶å®ä¾‹ä»ç„¶å¯ç”¨",
    usages: [
      "æ¸…é™¤å®šæ—¶å™¨ (setTimeout, setInterval)",
      "å–æ¶ˆäº‹ä»¶ç›‘å¬ (removeEventListener)",
      "æ¸…ç†è‡ªå®šä¹‰äº‹ä»¶",
      "æ–­å¼€ WebSocket è¿æ¥"
    ]
  },
  {
    name: "onUnmounted",
    order: "7",
    description: "ç»„ä»¶å¸è½½åè°ƒç”¨ï¼Œæ‰€æœ‰æŒ‡ä»¤å’Œäº‹ä»¶ç›‘å¬å™¨éƒ½è¢«ç§»é™¤",
    usages: [
      "æ‰§è¡Œæœ€ç»ˆæ¸…ç†å·¥ä½œ",
      "é‡Šæ”¾é Vue ç®¡ç†çš„èµ„æº",
      "è®°å½•ç»„ä»¶å¸è½½æ—¥å¿—"
    ]
  },
  {
    name: "onErrorCaptured",
    order: "*",
    description: "æ•è·æ¥è‡ªåä»£ç»„ä»¶çš„é”™è¯¯æ—¶è°ƒç”¨",
    usages: [
      "è®°å½•é”™è¯¯ä¿¡æ¯åˆ°æ—¥å¿—ç³»ç»Ÿ",
      "æ˜¾ç¤ºç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º",
      "å‘é”™è¯¯ç›‘æ§æœåŠ¡æŠ¥å‘Š"
    ]
  }
];
</script>

<style lang="less" scoped>
.lifecycle-container {
  max-width: 1000px;
  margin: 0 auto;
  padding: 2rem 1rem;
  font-family: 'Segoe UI', system-ui, sans-serif;
  color: #2c3e50;
  line-height: 1.6;
}

.header {
  text-align: center;
  margin-bottom: 2.5rem;

  h1 {
    font-size: 2.4rem;
    margin-bottom: 0.5rem;
    color: #34495e;
    font-weight: 700;
  }

  p {
    font-size: 1.1rem;
    color: #7f8c8d;
    margin-top: 0;
  }
}

.content {
  background: white;
  border-radius: 12px;
  box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
  padding: 2rem;
}

.lifecycle-flow {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1.5rem;
  margin-bottom: 2.5rem;

  @media (max-width: 900px) {
    grid-template-columns: 1fr;
  }
}

.creation-phase,
.update-phase,
.destruction-phase {
  h2 {
    font-size: 1.6rem;
    margin-bottom: 1.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid #f0f4f8;
    color: #3498db;
    text-align: center;
  }
}

.hook-card {
  display: flex;
  background: #f8fafc;
  border-radius: 10px;
  padding: 1.2rem;
  margin-bottom: 1.2rem;
  transition: all 0.3s ease;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.03);

  &:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 15px rgba(0, 0, 0, 0.08);
  }

  // ä¸åŒç”Ÿå‘½å‘¨æœŸé˜¶æ®µçš„è¾¹æ¡†é¢œè‰²
  &.setup {
    border-left: 4px solid #4f46e5;
  }

  &.onBeforeMount {
    border-left: 4px solid #3b82f6;
  }

  &.onMounted {
    border-left: 4px solid #10b981;
  }

  &.onBeforeUpdate {
    border-left: 4px solid #f59e0b;
  }

  &.onUpdated {
    border-left: 4px solid #f97316;
  }

  &.onBeforeUnmount {
    border-left: 4px solid #ef4444;
  }

  &.onUnmounted {
    border-left: 4px solid #8b5cf6;
  }

  &.onErrorCaptured {
    border-left: 4px solid #6b7280;
  }
}

.hook-order {
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #e0e7ff;
  border-radius: 50%;
  font-weight: bold;
  font-size: 1.2rem;
  color: #4f46e5;
  margin-right: 1rem;
  flex-shrink: 0;
}

.hook-info {
  flex: 1;

  h3 {
    margin-top: 0;
    margin-bottom: 0.8rem;
    color: #1e293b;
    font-size: 1.25rem;
  }

  p {
    margin-bottom: 0.8rem;
    color: #475569;
  }
}

.hook-usage {
  background: #f1f5f9;
  border-radius: 8px;
  padding: 0.8rem;

  strong {
    color: #334155;
  }

  ul {
    padding-left: 1.2rem;
    margin: 0.5rem 0 0;
  }

  li {
    margin-bottom: 0.3rem;
    font-size: 0.92rem;
    color: #475569;
  }
}

.code-section {
  margin-bottom: 2.5rem;

  h2 {
    font-size: 1.6rem;
    margin-bottom: 1.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid #f0f4f8;
    color: #3498db;
  }
}

.code-block {
  background: #2d2d2d;
  color: #f8f8f2;
  border-radius: 10px;
  padding: 1.5rem;
  overflow-x: auto;

  pre {
    margin: 0;
    font-family: 'Fira Code', 'Consolas', monospace;
    font-size: 0.95rem;
    line-height: 1.5;
  }
}

.best-practices {
  h2 {
    font-size: 1.6rem;
    margin-bottom: 1.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid #f0f4f8;
    color: #3498db;
  }
}

.practices-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1.5rem;
}

.practice-card {
  background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
  border-radius: 10px;
  padding: 1.5rem;
  text-align: center;
  transition: all 0.3s ease;

  &:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08);
  }

  .icon {
    font-size: 2.5rem;
    margin-bottom: 1rem;
  }

  h3 {
    font-size: 1.25rem;
    margin: 0 0 0.8rem;
    color: #1e40af;
  }

  p {
    margin: 0;
    color: #4b5563;
    line-height: 1.5;
    font-size: 0.95rem;
  }
}

@media (max-width: 768px) {
  .header h1 {
    font-size: 2rem;
  }

  .content {
    padding: 1.5rem;
  }
}
</style>
