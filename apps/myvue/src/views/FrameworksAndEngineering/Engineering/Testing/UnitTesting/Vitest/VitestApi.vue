<template>
  <div class="container">
    <header class="header">
      <h1 class="title">Vitest æµ‹è¯•æ¡†æ¶ä½¿ç”¨æŒ‡å—</h1>
      <p class="subtitle">åŸºäºViteçš„æé€Ÿå•å…ƒæµ‹è¯•è§£å†³æ–¹æ¡ˆ</p>
    </header>

    <main class="main-content">
      <!-- åŸºæœ¬ä»‹ç» -->
      <section class="section">
        <h2 class="section-title">ä»€ä¹ˆæ˜¯Vitestï¼Ÿ</h2>
        <div class="section-content">
          <p>
            Vitestæ˜¯ä¸€ä¸ªåŸºäºViteçš„å•å…ƒæµ‹è¯•æ¡†æ¶ï¼Œç”±Vueå›¢é˜Ÿæ ¸å¿ƒæˆå‘˜å¼€å‘ï¼Œä¸“ä¸ºViteé¡¹ç›®è®¾è®¡ã€‚
            å®ƒæä¾›äº†ä¸Jestå…¼å®¹çš„APIï¼ŒåŒæ—¶åˆ©ç”¨Viteçš„æé€ŸHMRèƒ½åŠ›ï¼Œå®ç°äº†æ›´å¿«çš„æµ‹è¯•é€Ÿåº¦å’Œæ›´å¥½çš„å¼€å‘ä½“éªŒã€‚
          </p>
          <div class="feature-list">
            <div class="feature-item">âš¡ï¸ åŸºäºViteï¼Œå¯åŠ¨å’Œçƒ­æ›´æ–°é€Ÿåº¦æå¿«</div>
            <div class="feature-item">ğŸ”„ ä¸Jest APIé«˜åº¦å…¼å®¹ï¼Œæ˜“äºè¿ç§»</div>
            <div class="feature-item">ğŸ”§ é›¶é…ç½®æ”¯æŒTypeScriptã€JSX</div>
            <div class="feature-item">ğŸ“¦ å†…ç½®æ–­è¨€ã€æ¨¡æ‹Ÿå’Œè¦†ç›–ç‡æŠ¥å‘Š</div>
            <div class="feature-item">ğŸ”— ä¸Viteç”Ÿæ€ç³»ç»Ÿæ— ç¼é›†æˆ</div>
            <div class="feature-item">ğŸ­ æ”¯æŒå¤šçº¿ç¨‹æµ‹è¯•ï¼Œæå‡æ‰§è¡Œæ•ˆç‡</div>
          </div>
        </div>
      </section>

      <!-- å®‰è£…ä¸é…ç½® -->
      <section class="section">
        <h2 class="section-title">å®‰è£…ä¸åŸºæœ¬é…ç½®</h2>
        <div class="section-content">
          <div class="installation-steps">
            <div class="step">
              <h3>1. å®‰è£…Vitest</h3>
              <div class="code-example">
                <pre><code># ä½¿ç”¨npm
npm install --save-dev vitest

# ä½¿ç”¨yarn
yarn add --dev vitest

# ä½¿ç”¨pnpm
pnpm add -D vitest</code></pre>
              </div>
              <p class="note">å¯¹äºVueé¡¹ç›®ï¼Œå»ºè®®åŒæ—¶å®‰è£…@vuedx/test-utilsæˆ–@vue/test-utils</p>
            </div>

            <div class="step">
              <h3>2. é…ç½®Vitest</h3>
              <p>å¯ä»¥åœ¨vite.config.tsä¸­æ·»åŠ é…ç½®ï¼š</p>
              <div class="code-example">
                <pre><code>// vite.config.ts
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'

export default defineConfig({
  plugins: [vue()],
  test: {
    // å¯ç”¨ç±»ä¼¼Jestçš„å…¨å±€æµ‹è¯•API
    globals: true,
    // æ¨¡æ‹Ÿæµè§ˆå™¨ç¯å¢ƒ
    environment: 'jsdom',
    // æµ‹è¯•æ–‡ä»¶åŒ¹é…æ¨¡å¼
    include: ['**/*.{test,spec}.{js,mjs,cjs,ts,mts,cts,jsx,tsx}'],
    // ä»£ç è¦†ç›–ç‡é…ç½®
    coverage: {
      reporter: ['text', 'json', 'html']
    }
  }
})</code></pre>
              </div>
            </div>

            <div class="step">
              <h3>3. æ·»åŠ æµ‹è¯•è„šæœ¬</h3>
              <p>åœ¨package.jsonä¸­æ·»åŠ ï¼š</p>
              <div class="code-example">
                <pre><code>"scripts": {
  "test": "vitest",
  "test:watch": "vitest watch",
  "test:run": "vitest run",
  "test:coverage": "vitest run --coverage"
}</code></pre>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- åŸºæœ¬ç”¨æ³• -->
      <section class="section">
        <h2 class="section-title">åŸºæœ¬ç”¨æ³•</h2>
        <div class="section-content">
          <p>Vitestæµ‹è¯•æ–‡ä»¶é€šå¸¸å‘½åä¸º*.test.tsã€*.spec.tsï¼Œæˆ–æ”¾åœ¨__tests__ç›®å½•ä¸‹ã€‚</p>

          <div class="example-card">
            <h3>ç®€å•æµ‹è¯•ç¤ºä¾‹</h3>
            <p>åˆ›å»ºmath.tsæ–‡ä»¶ï¼š</p>
            <div class="code-example">
              <pre><code>// math.ts
export function sum(a: number, b: number): number {
  return a + b;
}

export function multiply(a: number, b: number): number {
  return a * b;
}</code></pre>
            </div>

            <p>åˆ›å»ºå¯¹åº”çš„æµ‹è¯•æ–‡ä»¶math.test.tsï¼š</p>
            <div class="code-example">
              <pre><code>// math.test.ts
import { sum, multiply } from './math';
import { describe, it, expect } from 'vitest';

// æµ‹è¯•å¥—ä»¶
describe('math functions', () => {
  // å•ä¸ªæµ‹è¯•ç”¨ä¾‹
  it('should return sum of two numbers', () => {
    expect(sum(1, 2)).toBe(3);
    expect(sum(-1, 1)).toBe(0);
  });

  it('should return product of two numbers', () => {
    expect(multiply(2, 3)).toBe(6);
    expect(multiply(0, 5)).toBe(0);
  });
});</code></pre>
            </div>

            <p>è¿è¡Œæµ‹è¯•ï¼š</p>
            <div class="code-example">
              <pre><code># è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage</code></pre>
            </div>
          </div>
        </div>
      </section>

      <!-- æ ¸å¿ƒAPI -->
      <section class="section">
        <h2 class="section-title">æ ¸å¿ƒAPIä¸æ–­è¨€æ–¹æ³•</h2>
        <div class="section-content">
          <div class="api-grid">
            <!-- æµ‹è¯•ç»“æ„API -->
            <div class="api-card">
              <h3>æµ‹è¯•ç»“æ„</h3>
              <div class="api-item">
                <code>describe(name, fn)</code>
                <p>å®šä¹‰æµ‹è¯•å¥—ä»¶ï¼Œç”¨äºåˆ†ç»„ç›¸å…³æµ‹è¯•</p>
              </div>
              <div class="api-item">
                <code>it(name, fn, timeout)</code>
                <p>å®šä¹‰å•ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œåˆ«åtest()</p>
              </div>
              <div class="api-item">
                <code>beforeAll(fn, timeout)</code>
                <p>åœ¨æ‰€æœ‰æµ‹è¯•å¼€å§‹å‰æ‰§è¡Œä¸€æ¬¡</p>
              </div>
              <div class="api-item">
                <code>afterAll(fn, timeout)</code>
                <p>åœ¨æ‰€æœ‰æµ‹è¯•å®Œæˆåæ‰§è¡Œä¸€æ¬¡</p>
              </div>
              <div class="api-item">
                <code>beforeEach(fn, timeout)</code>
                <p>æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹å¼€å§‹å‰æ‰§è¡Œ</p>
              </div>
              <div class="api-item">
                <code>afterEach(fn, timeout)</code>
                <p>æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹å®Œæˆåæ‰§è¡Œ</p>
              </div>
            </div>

            <!-- å¸¸ç”¨æ–­è¨€ -->
            <div class="api-card">
              <h3>å¸¸ç”¨æ–­è¨€</h3>
              <div class="api-item">
                <code>expect(value)</code>
                <p>åˆ›å»ºä¸€ä¸ªæ–­è¨€å¯¹è±¡ï¼Œç”¨äºæµ‹è¯•å€¼</p>
              </div>
              <div class="api-item">
                <code>toBe(value)</code>
                <p>ä½¿ç”¨===æ¯”è¾ƒå€¼ï¼Œé€‚ç”¨äºåŸºæœ¬ç±»å‹</p>
              </div>
              <div class="api-item">
                <code>toEqual(value)</code>
                <p>é€’å½’æ¯”è¾ƒå¯¹è±¡çš„æ¯ä¸ªå±æ€§ï¼Œé€‚ç”¨äºå¯¹è±¡</p>
              </div>
              <div class="api-item">
                <code>toBeTruthy()</code>
                <p>æµ‹è¯•å€¼æ˜¯å¦ä¸ºçœŸï¼ˆéç©ºã€é0ç­‰ï¼‰</p>
              </div>
              <div class="api-item">
                <code>toBeFalsy()</code>
                <p>æµ‹è¯•å€¼æ˜¯å¦ä¸ºå‡ï¼ˆnullã€0ã€''ç­‰ï¼‰</p>
              </div>
              <div class="api-item">
                <code>toBeNull()</code>
                <p>æµ‹è¯•å€¼æ˜¯å¦ä¸ºnull</p>
              </div>
            </div>

            <!-- æ›´å¤šæ–­è¨€ -->
            <div class="api-card">
              <h3>æ‰©å±•æ–­è¨€</h3>
              <div class="api-item">
                <code>toBeGreaterThan(number)</code>
                <p>æµ‹è¯•å€¼æ˜¯å¦å¤§äºæŒ‡å®šæ•°å­—</p>
              </div>
              <div class="api-item">
                <code>toBeLessThan(number)</code>
                <p>æµ‹è¯•å€¼æ˜¯å¦å°äºæŒ‡å®šæ•°å­—</p>
              </div>
              <div class="api-item">
                <code>toContain(item)</code>
                <p>æµ‹è¯•æ•°ç»„æ˜¯å¦åŒ…å«æŒ‡å®šå…ƒç´ </p>
              </div>
              <div class="api-item">
                <code>toMatch(regexp)</code>
                <p>æµ‹è¯•å­—ç¬¦ä¸²æ˜¯å¦åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼</p>
              </div>
              <div class="api-item">
                <code>toThrow(error)</code>
                <p>æµ‹è¯•å‡½æ•°æ˜¯å¦æŠ›å‡ºæŒ‡å®šé”™è¯¯</p>
              </div>
              <div class="api-item">
                <code>not</code>
                <p>å¦å®šåç»­æ–­è¨€ï¼Œå¦‚expect(a).not.toBe(b)</p>
              </div>
            </div>

            <!-- å¼‚æ­¥æµ‹è¯• -->
            <div class="api-card">
              <h3>å¼‚æ­¥æµ‹è¯•</h3>
              <div class="api-item">
                <code>async/await</code>
                <p>ä½¿ç”¨å¼‚æ­¥å‡½æ•°å¤„ç†å¼‚æ­¥æµ‹è¯•</p>
              </div>
              <div class="api-item">
                <code>resolves</code>
                <p>æµ‹è¯•Promiseæ˜¯å¦æˆåŠŸè§£æ</p>
              </div>
              <div class="api-item">
                <code>rejects</code>
                <p>æµ‹è¯•Promiseæ˜¯å¦æ‹’ç»</p>
              </div>
              <div class="code-snippet">
                <code>// å¼‚æ­¥æµ‹è¯•ç¤ºä¾‹
it('fetches data correctly', async () => {
  const fetchData = () => Promise.resolve({ id: 1 });
  await expect(fetchData()).resolves.toEqual({ id: 1 });
});</code>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- æ¨¡æ‹ŸåŠŸèƒ½ -->
      <section class="section">
        <h2 class="section-title">æ¨¡æ‹ŸåŠŸèƒ½(Mocking)</h2>
        <div class="section-content">
          <p>Vitestæä¾›å¼ºå¤§çš„æ¨¡æ‹ŸåŠŸèƒ½ï¼Œæ”¯æŒæ¨¡æ‹Ÿå‡½æ•°ã€æ¨¡å—å’Œæ—¶é—´ç­‰ï¼Œè¯­æ³•ä¸Jestç±»ä¼¼ä½†æ€§èƒ½æ›´å¥½ã€‚</p>

          <div class="example-card">
            <h3>æ¨¡æ‹Ÿå‡½æ•°</h3>
            <div class="code-example">
              <pre><code>import { it, expect, vi } from 'vitest';

it('tests mock functions', () => {
  // åˆ›å»ºæ¨¡æ‹Ÿå‡½æ•°
  const mockFn = vi.fn((a, b) => a + b);

  // è°ƒç”¨æ¨¡æ‹Ÿå‡½æ•°
  mockFn(2, 3);

  // æ–­è¨€å‡½æ•°è¢«è°ƒç”¨
  expect(mockFn).toHaveBeenCalled();
  // æ–­è¨€è°ƒç”¨æ¬¡æ•°
  expect(mockFn).toHaveBeenCalledTimes(1);
  // æ–­è¨€è°ƒç”¨å‚æ•°
  expect(mockFn).toHaveBeenCalledWith(2, 3);
  // æ–­è¨€è¿”å›å€¼
  expect(mockFn(2, 3)).toBe(5);
});</code></pre>
            </div>
          </div>

          <div class="example-card">
            <h3>æ¨¡æ‹Ÿæ¨¡å—</h3>
            <div class="code-example">
              <pre><code>import { it, expect, vi } from 'vitest';
import { getUser } from './api';

// æ¨¡æ‹Ÿaxiosæ¨¡å—
vi.mock('axios', () => ({
  default: {
    get: vi.fn()
  }
}));

import axios from 'axios';

it('fetches user data', async () => {
  // è®¾ç½®æ¨¡æ‹Ÿè¿”å›å€¼
  axios.get.mockResolvedValue({
    data: { id: 1, name: 'John Doe' }
  });

  const user = await getUser(1);

  expect(axios.get).toHaveBeenCalledWith('/users/1');
  expect(user).toEqual({ id: 1, name: 'John Doe' });
});</code></pre>
            </div>
          </div>

          <div class="example-card">
            <h3>æ¨¡æ‹Ÿæ—¶é—´</h3>
            <div class="code-example">
              <pre><code>import { it, expect, vi, beforeEach, afterEach } from 'vitest';

it('tests timer function', () => {
  vi.useFakeTimers();

  const callback = vi.fn();
  setTimeout(callback, 1000);

  // å¿«è¿›æ—¶é—´
  vi.advanceTimersByTime(1000);

  expect(callback).toHaveBeenCalled();

  vi.useRealTimers();
});</code></pre>
            </div>
          </div>
        </div>
      </section>

      <!-- å¿«ç…§æµ‹è¯• -->
      <section class="section">
        <h2 class="section-title">å¿«ç…§æµ‹è¯•</h2>
        <div class="section-content">
          <p>å¿«ç…§æµ‹è¯•ç”¨äºç¡®ä¿UIç»„ä»¶æˆ–æ•°æ®ç»“æ„ä¸ä¼šæ„å¤–æ›´æ”¹ï¼ŒVitestä¼šå°†ç»“æœä¸å­˜å‚¨çš„å¿«ç…§è¿›è¡Œæ¯”è¾ƒã€‚</p>

          <div class="example-card">
            <div class="code-example">
              <pre><code>// ç»„ä»¶å¿«ç…§æµ‹è¯•ç¤ºä¾‹
import { it, expect } from 'vitest';
import { mount } from '@vue/test-utils';
import Button from './Button.vue';

it('renders button correctly', () => {
  const wrapper = mount(Button, {
    props: { label: 'Click me' }
  });

  // åˆ›å»ºæˆ–æ¯”è¾ƒå¿«ç…§
  expect(wrapper.html()).toMatchSnapshot();
});</code></pre>
            </div>
            <p class="note">
              å½“ç»„ä»¶é¢„æœŸæ›´æ”¹æ—¶ï¼Œä½¿ç”¨<code>vitest run --updateSnapshot</code>æ›´æ–°å¿«ç…§ã€‚
            </p>
          </div>
        </div>
      </section>

      <!-- ä¸Jestçš„åŒºåˆ« -->
      <section class="section">
        <h2 class="section-title">Vitestä¸Jestçš„ä¸»è¦åŒºåˆ«</h2>
        <div class="section-content">
          <div class="comparison-table">
            <div class="comparison-item">
              <strong>å¯åŠ¨é€Ÿåº¦</strong>ï¼šViteståŸºäºViteï¼Œå¯åŠ¨é€Ÿåº¦æ¯”Jestå¿«2-10å€
            </div>
            <div class="comparison-item">
              <strong>çƒ­æ›´æ–°</strong>ï¼šVitestæ”¯æŒæµ‹è¯•çƒ­æ›´æ–°ï¼Œä¿®æ”¹æµ‹è¯•åæ— éœ€é‡æ–°å¯åŠ¨
            </div>
            <div class="comparison-item">
              <strong>é…ç½®</strong>ï¼šVitestå¯ä¸Viteé…ç½®åˆå¹¶ï¼Œå‡å°‘é…ç½®é‡å¤
            </div>
            <div class="comparison-item">
              <strong>ç±»å‹æ”¯æŒ</strong>ï¼šåŸç”Ÿæ”¯æŒTypeScriptï¼Œæ— éœ€é¢å¤–é…ç½®
            </div>
            <div class="comparison-item">
              <strong>ç”Ÿæ€ç³»ç»Ÿ</strong>ï¼šJestç”Ÿæ€æ›´æˆç†Ÿï¼Œä½†Vitestæ­£åœ¨å¿«é€Ÿå¢é•¿
            </div>
            <div class="comparison-item">
              <strong>å¤šçº¿ç¨‹</strong>ï¼šä¸¤è€…éƒ½æ”¯æŒï¼Œä½†Vitestçš„å®ç°æ›´é«˜æ•ˆ
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer class="footer">
      <p>Vitestä½¿ç”¨æŒ‡å— &copy; {{ new Date().getFullYear() }}</p>
    </footer>
  </div>
</template>

<script setup lang="ts">
// ç»„ä»¶é€»è¾‘éƒ¨åˆ†ï¼Œå½“å‰ä¸ºé™æ€å±•ç¤º
</script>

<style scoped lang="less">
.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
  background-color: #f9fafb;
  color: #334155;
  font-family: 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
  line-height: 1.7;
}

.header {
  text-align: center;
  margin-bottom: 30px;
  padding-bottom: 15px;
  border-bottom: 1px solid #e2e8f0;

  .title {
    color: #1e293b;
    margin: 0 0 10px 0;
    font-size: 1.8rem;
  }

  .subtitle {
    color: #64748b;
    margin: 0;
    font-size: 1.1rem;
    font-weight: 400;
  }
}

.main-content {
  .section {
    margin-bottom: 40px;

    .section-title {
      color: #1e293b;
      border-bottom: 2px solid #dbeafe;
      padding-bottom: 8px;
      margin-top: 0;
      margin-bottom: 20px;
      font-size: 1.4rem;
    }

    .section-content {
      background-color: #fff;
      padding: 25px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    }
  }

  .code-example {
    background-color: #f8fafc;
    border-radius: 6px;
    margin: 15px 0;
    overflow-x: auto;
    border: 1px solid #e2e8f0;

    pre {
      margin: 0;
      padding: 15px;

      code {
        font-family: 'Fira Code', monospace;
        font-size: 0.9rem;
        color: #0f172a;
      }
    }
  }

  .code-snippet {
    background-color: #f8fafc;
    border-radius: 4px;
    padding: 10px;
    margin: 10px 0;
    font-family: 'Fira Code', monospace;
    font-size: 0.85rem;
    border: 1px solid #e2e8f0;
    overflow-x: auto;
  }

  .feature-list {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin: 20px 0;

    .feature-item {
      background-color: #f0fdf4;
      border: 1px solid #dcfce7;
      border-radius: 4px;
      padding: 8px 12px;
      font-size: 0.9rem;
      color: #15803d;
    }
  }

  .installation-steps {
    .step {
      margin-bottom: 25px;

      &:last-child {
        margin-bottom: 0;
      }

      h3 {
        margin-top: 0;
        color: #1e293b;
        margin-bottom: 10px;
        font-size: 1.1rem;
      }
    }
  }

  .example-card {
    background-color: #f8fafc;
    border-radius: 6px;
    padding: 20px;
    margin-bottom: 20px;
    border: 1px solid #e2e8f0;

    h3 {
      margin-top: 0;
      color: #1e293b;
      margin-bottom: 15px;
      font-size: 1.1rem;
    }

    &:last-child {
      margin-bottom: 0;
    }
  }

  .api-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
  }

  .api-card {
    background-color: #f8fafc;
    border-radius: 6px;
    padding: 20px;
    border: 1px solid #e2e8f0;

    h3 {
      margin-top: 0;
      color: #1e293b;
      margin-bottom: 15px;
      font-size: 1.1rem;
      padding-bottom: 8px;
      border-bottom: 1px dashed #e2e8f0;
    }

    .api-item {
      margin-bottom: 15px;

      &:last-child {
        margin-bottom: 0;
      }

      code {
        display: block;
        background-color: #eff6ff;
        color: #1e40af;
        padding: 5px 8px;
        border-radius: 3px;
        margin-bottom: 5px;
        font-family: 'Fira Code', monospace;
        font-size: 0.9rem;
      }

      p {
        margin: 0;
        font-size: 0.95rem;
      }
    }
  }

  .comparison-table {
    margin-top: 15px;

    .comparison-item {
      padding: 12px 15px;
      border-bottom: 1px solid #e2e8f0;

      &:last-child {
        border-bottom: none;
      }

      strong {
        color: #1e293b;
        margin-right: 8px;
      }
    }
  }

  .note {
    color: #64748b;
    font-size: 0.95rem;
    margin-top: 10px;
    padding: 8px 12px;
    background-color: #f1f5f9;
    border-radius: 4px;
  }
}

footer.footer {
  margin-top: 50px;
  padding-top: 20px;
  border-top: 1px solid #e2e8f0;
  text-align: center;
  color: #94a3b8;
  font-size: 0.9rem;
}

@media (max-width: 768px) {
  .container {
    padding: 15px;
  }

  .api-grid {
    grid-template-columns: 1fr;
  }

  .header .title {
    font-size: 1.5rem;
  }
}
</style>
