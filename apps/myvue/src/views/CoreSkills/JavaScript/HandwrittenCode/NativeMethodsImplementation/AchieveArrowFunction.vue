<template>
  <div class="arrow-function-container">
    <header class="guide-header">
      <h1>JavaScript ç®­å¤´å‡½æ•°å®ç°æŒ‡å—</h1>
      <p>æ·±å…¥ç†è§£ç®­å¤´å‡½æ•°çš„åŸç†ä¸å®ç°æ–¹å¼</p>
    </header>

    <div class="content-wrapper">
      <!-- å¯¼èˆª -->
      <nav class="navigation">
        <ul>
          <li v-for="section in sections" :key="section.id" @click="scrollToSection(section.id)">
            {{ section.title }}
          </li>
        </ul>
      </nav>

      <!-- å†…å®¹åŒºåŸŸ -->
      <div class="content">
        <!-- ä»‹ç»éƒ¨åˆ† -->
        <section id="introduction" class="guide-section">
          <h2>ä»€ä¹ˆæ˜¯ç®­å¤´å‡½æ•°ï¼Ÿ</h2>
          <div class="intro-content">
            <div class="intro-card">
              <div class="intro-icon">â¡ï¸</div>
              <h3>ES6 æ–°ç‰¹æ€§</h3>
              <p>ç®­å¤´å‡½æ•°æ˜¯ ES6 å¼•å…¥çš„ä¸€ç§æ›´ç®€æ´çš„å‡½æ•°è¯­æ³•</p>
            </div>
            <div class="intro-card">
              <div class="intro-icon">ğŸ”—</div>
              <h3>è¯æ³•ä½œç”¨åŸŸ</h3>
              <p>ç»§æ‰¿å¤–å±‚ä½œç”¨åŸŸçš„ this å€¼</p>
            </div>
            <div class="intro-card">
              <div class="intro-icon">ğŸš«</div>
              <h3>æ— è‡ªèº«ç»‘å®š</h3>
              <p>æ²¡æœ‰è‡ªå·±çš„ thisã€argumentsã€super æˆ– new.target</p>
            </div>
          </div>
        </section>

        <!-- æ ¸å¿ƒç‰¹æ€§ -->
        <section id="features" class="guide-section">
          <h2>ç®­å¤´å‡½æ•°çš„æ ¸å¿ƒç‰¹æ€§</h2>

          <div class="features-grid">
            <div class="feature-card">
              <h3>1. ç»‘å®šå¤–å±‚ä½œç”¨åŸŸçš„ this</h3>
              <p>ç®­å¤´å‡½æ•°ä¸åˆ›å»ºè‡ªå·±çš„ this ä¸Šä¸‹æ–‡ï¼Œè€Œæ˜¯ç»§æ‰¿å®šä¹‰æ—¶çš„å¤–å±‚ä½œç”¨åŸŸ</p>
              <div class="comparison">
                <div class="comparison-item">
                  <h4>æ™®é€šå‡½æ•°</h4>
                  <pre class="code-block">
const obj = {
  value: 42,
  getValue: function() {
    return this.value;
  }
};</pre
                  >
                </div>
                <div class="comparison-item">
                  <h4>ç®­å¤´å‡½æ•°</h4>
                  <pre class="code-block">
const obj = {
  value: 42,
  getValue: () => this.value;
};</pre
                  >
                </div>
              </div>
            </div>

            <div class="feature-card">
              <h3>2. ç®€æ´çš„è¯­æ³•</h3>
              <p>ç®­å¤´å‡½æ•°æä¾›æ›´ç®€æ´çš„è¯­æ³•å½¢å¼ï¼Œå°¤å…¶åœ¨å¤„ç†ç®€å•æ“ä½œæ—¶</p>
              <div class="comparison">
                <div class="comparison-item">
                  <h4>æ™®é€šå‡½æ•°</h4>
                  <pre class="code-block">
const add = function(a, b) {
  return a + b;
};</pre
                  >
                </div>
                <div class="comparison-item">
                  <h4>ç®­å¤´å‡½æ•°</h4>
                  <pre class="code-block">const add = (a, b) => a + b;</pre>
                </div>
              </div>
            </div>

            <div class="feature-card">
              <h3>3. éšå¼è¿”å›å€¼</h3>
              <p>å½“å‡½æ•°ä½“ä¸ºå•è¡¨è¾¾å¼æ—¶ï¼Œå¯çœç•¥å¤§æ‹¬å·å¹¶è‡ªåŠ¨è¿”å›ç»“æœ</p>
              <div class="comparison">
                <div class="comparison-item">
                  <h4>æ™®é€šå‡½æ•°</h4>
                  <pre class="code-block">
const double = function(n) {
  return n * 2;
};</pre
                  >
                </div>
                <div class="comparison-item">
                  <h4>ç®­å¤´å‡½æ•°</h4>
                  <pre class="code-block">const double = n => n * 2;</pre>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- å®ç°åŸç† -->
        <section id="implementation" class="guide-section">
          <h2>ç®­å¤´å‡½æ•°çš„å®ç°åŸç†</h2>

          <div class="implementation-content">
            <div class="implementation-step">
              <div class="step-number">1</div>
              <div class="step-content">
                <h3>ç»‘å®šå¤–å±‚ä½œç”¨åŸŸçš„ this</h3>
                <p>
                  ç®­å¤´å‡½æ•°çš„æ ¸å¿ƒç‰¹æ€§æ˜¯ç»§æ‰¿å®šä¹‰æ—¶çš„å¤–å±‚ä½œç”¨åŸŸçš„
                  thisã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡é—­åŒ…æ¥æ¨¡æ‹Ÿè¿™ä¸€è¡Œä¸ºï¼š
                </p>
                <pre class="code-block">
function createArrowFunction(fn, context) {
  // ä½¿ç”¨é—­åŒ…ä¿å­˜å®šä¹‰æ—¶çš„ this å€¼
  return function(...args) {
    // ä½¿ç”¨ä¿å­˜çš„ context ä½œä¸º this
    return fn.apply(context, args);
  };
}</pre
                >
              </div>
            </div>

            <div class="implementation-step">
              <div class="step-number">2</div>
              <div class="step-content">
                <h3>å¤„ç†éšå¼è¿”å›å€¼</h3>
                <p>å½“å‡½æ•°ä½“ä¸ºå•è¡¨è¾¾å¼æ—¶ï¼Œç®­å¤´å‡½æ•°ä¼šè‡ªåŠ¨è¿”å›ç»“æœï¼š</p>
                <pre class="code-block">
function createArrowFunction(fn, context) {
  return function(...args) {
    // æ£€æŸ¥å‡½æ•°ä½“æ˜¯å¦æ˜¯å•è¡¨è¾¾å¼
    const result = fn.apply(context, args);

    // å¦‚æœæ˜¯å•è¡¨è¾¾å¼å‡½æ•°ï¼Œè‡ªåŠ¨è¿”å›ç»“æœ
    return result;
  };
}</pre
                >
              </div>
            </div>

            <div class="implementation-step">
              <div class="step-number">3</div>
              <div class="step-content">
                <h3>å®Œæ•´å®ç°ä»£ç </h3>
                <p>ç»“åˆä¸Šè¿°ä¸¤ä¸ªæ ¸å¿ƒç‰¹æ€§ï¼Œä¸‹é¢æ˜¯ç®­å¤´å‡½æ•°çš„å®Œæ•´å®ç°ï¼š</p>
                <pre class="code-block">
function createArrowFunction(fn, context) {
  // ä¿å­˜å®šä¹‰æ—¶çš„ this å€¼
  const outerThis = context || this;

  // è¿”å›æ¨¡æ‹Ÿçš„ç®­å¤´å‡½æ•°
  return function(...args) {
    // ä¿å­˜å½“å‰ä½œç”¨åŸŸçš„ this
    const currentThis = this;

    // ä¸´æ—¶æ›´æ”¹ this ä¸ºå¤–å±‚ä½œç”¨åŸŸçš„ this
    try {
      // ä½¿ç”¨é—­åŒ…ä¸­ä¿å­˜çš„ outerThis ä½œä¸º this
      return fn.apply(outerThis, args);
    } finally {
      // æ¢å¤å½“å‰ä½œç”¨åŸŸçš„ this
      this = currentThis;
    }
  };
}

// ä½¿ç”¨ç¤ºä¾‹
const obj = {
  value: 42,
  getValue: createArrowFunction(function() {
    return this.value;
  })
};

console.log(obj.getValue()); // è¾“å‡º 42</pre
                >
              </div>
            </div>
          </div>
        </section>

        <!-- ä½¿ç”¨åœºæ™¯ -->
        <section id="use-cases" class="guide-section">
          <h2>ç®­å¤´å‡½æ•°çš„é€‚ç”¨åœºæ™¯</h2>

          <div class="scenario-grid">
            <div class="scenario-card">
              <div class="scenario-icon">ğŸ”„</div>
              <h3>å›è°ƒå‡½æ•°</h3>
              <p>åœ¨å›è°ƒå‡½æ•°ä¸­ä¿æŒå¤–å±‚ this çš„å¼•ç”¨</p>
              <pre class="code-block">
// ä¼ ç»Ÿæ–¹å¼
const self = this;
button.addEventListener('click', function() {
  self.handleClick();
});

// ç®­å¤´å‡½æ•°
button.addEventListener('click', () => {
  this.handleClick();
});</pre
              >
            </div>

            <div class="scenario-card">
              <div class="scenario-icon">ğŸ“Š</div>
              <h3>æ•°ç»„æ–¹æ³•</h3>
              <p>ç®€åŒ– mapã€filterã€reduce ç­‰æ•°ç»„æ–¹æ³•</p>
              <pre class="code-block">
// ä¼ ç»Ÿæ–¹å¼
const doubled = numbers.map(function(n) {
  return n * 2;
});

// ç®­å¤´å‡½æ•°
const doubled = numbers.map(n => n * 2);</pre
              >
            </div>

            <div class="scenario-card">
              <div class="scenario-icon">â±ï¸</div>
              <h3>å®šæ—¶å™¨</h3>
              <p>åœ¨ setTimeout å’Œ setInterval ä¸­ä¿æŒ this ç»‘å®š</p>
              <pre class="code-block">
// ä¼ ç»Ÿæ–¹å¼
const self = this;
setTimeout(function() {
  self.update();
}, 1000);

// ç®­å¤´å‡½æ•°
setTimeout(() => {
  this.update();
}, 1000);</pre
              >
            </div>
          </div>
        </section>

        <!-- é™åˆ¶ä¸æ³¨æ„äº‹é¡¹ -->
        <section id="limitations" class="guide-section">
          <h2>ç®­å¤´å‡½æ•°çš„é™åˆ¶ä¸æ³¨æ„äº‹é¡¹</h2>

          <div class="limitation-grid">
            <div class="limitation-card">
              <h3>ğŸš« ä¸èƒ½ç”¨ä½œæ„é€ å‡½æ•°</h3>
              <p>ç®­å¤´å‡½æ•°æ²¡æœ‰ prototype å±æ€§ï¼Œä¸èƒ½ä½¿ç”¨ new å…³é”®å­—è°ƒç”¨</p>
              <pre class="code-block">
const Foo = () => {};
const bar = new Foo(); // æŠ¥é”™: Foo is not a constructor</pre
              >
            </div>

            <div class="limitation-card">
              <h3>ğŸš« æ²¡æœ‰ arguments å¯¹è±¡</h3>
              <p>ç®­å¤´å‡½æ•°å†…éƒ¨æ— æ³•è®¿é—® arguments å¯¹è±¡</p>
              <pre class="code-block">
const sum = () => {
  console.log(arguments); // æŠ¥é”™: arguments is not defined
};</pre
              >
            </div>

            <div class="limitation-card">
              <h3>ğŸš« ä¸èƒ½æ”¹å˜ this ç»‘å®š</h3>
              <p>callã€apply å’Œ bind æ–¹æ³•æ— æ³•æ”¹å˜ç®­å¤´å‡½æ•°çš„ this ç»‘å®š</p>
              <pre class="code-block">
const obj = { value: 42 };
const getValue = () => this.value;

console.log(getValue.call(obj)); // è¾“å‡º undefined
console.log(getValue.apply(obj)); // è¾“å‡º undefined
console.log(getValue.bind(obj)()); // è¾“å‡º undefined</pre
              >
            </div>

            <div class="limitation-card">
              <h3>ğŸš« ä¸é€‚åˆå¯¹è±¡æ–¹æ³•</h3>
              <p>åœ¨å¯¹è±¡æ–¹æ³•ä¸­ä½¿ç”¨ç®­å¤´å‡½æ•°ä¼šå¯¼è‡´ this æŒ‡å‘é—®é¢˜</p>
              <pre class="code-block">
const obj = {
  value: 42,
  getValue: () => this.value
};

console.log(obj.getValue()); // è¾“å‡º undefined (æœŸæœ›42)</pre
              >
            </div>
          </div>
        </section>

        <!-- æ€»ç»“ -->
        <section id="conclusion" class="guide-section">
          <h2>æ€»ç»“</h2>

          <div class="conclusion-content">
            <div class="pros-cons">
              <div class="pros">
                <h3>âœ… ç®­å¤´å‡½æ•°çš„ä¼˜ç‚¹</h3>
                <ul>
                  <li>æ›´ç®€æ´çš„è¯­æ³•ï¼Œå‡å°‘æ ·æ¿ä»£ç </li>
                  <li>è‡ªåŠ¨ç»‘å®šå¤–å±‚ä½œç”¨åŸŸçš„ this</li>
                  <li>éšå¼è¿”å›ç®€åŒ–å•è¡¨è¾¾å¼å‡½æ•°</li>
                  <li>é¿å…ä¼ ç»Ÿå‡½æ•°ä¸­çš„ this ç»‘å®šé—®é¢˜</li>
                </ul>
              </div>

              <div class="cons">
                <h3>âš ï¸ ç®­å¤´å‡½æ•°çš„ç¼ºç‚¹</h3>
                <ul>
                  <li>ä¸èƒ½ç”¨ä½œæ„é€ å‡½æ•°</li>
                  <li>æ²¡æœ‰è‡ªå·±çš„ arguments å¯¹è±¡</li>
                  <li>æ— æ³•é€šè¿‡ call/apply/bind æ”¹å˜ this</li>
                  <li>ä¸é€‚åˆä½œä¸ºå¯¹è±¡æ–¹æ³•</li>
                </ul>
              </div>
            </div>

            <div class="final-recommendation">
              <h3>æœ€ä½³å®è·µå»ºè®®</h3>
              <p>
                ç®­å¤´å‡½æ•°æœ€é€‚åˆç”¨äºéœ€è¦ä¿æŒ this ç»‘å®šçš„åœºæ™¯ï¼Œå¦‚å›è°ƒå‡½æ•°ã€æ•°ç»„æ–¹æ³•å’Œå®šæ—¶å™¨å¤„ç†ã€‚
                å¯¹äºéœ€è¦åŠ¨æ€ this ç»‘å®šæˆ–ä½œä¸ºæ„é€ å‡½æ•°çš„æƒ…å†µï¼Œåº”ä½¿ç”¨ä¼ ç»Ÿå‡½æ•°ã€‚
                ç†è§£ç®­å¤´å‡½æ•°çš„å®ç°åŸç†æœ‰åŠ©äºé¿å…å¸¸è§çš„ this ç»‘å®šé—®é¢˜ã€‚
              </p>
            </div>
          </div>
        </section>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue'

// å¯¼èˆªéƒ¨åˆ†
const sections = ref([
  { id: 'introduction', title: 'ä»‹ç»' },
  { id: 'features', title: 'æ ¸å¿ƒç‰¹æ€§' },
  { id: 'implementation', title: 'å®ç°åŸç†' },
  { id: 'use-cases', title: 'ä½¿ç”¨åœºæ™¯' },
  { id: 'limitations', title: 'é™åˆ¶ä¸æ³¨æ„' },
  { id: 'conclusion', title: 'æ€»ç»“' },
])

// æ»šåŠ¨åˆ°æŒ‡å®šéƒ¨åˆ†
const scrollToSection = (id: string) => {
  const element = document.getElementById(id)
  if (element) {
    element.scrollIntoView({ behavior: 'smooth' })
  }
}
</script>

<style scoped lang="less">
@primary-color: #4a7bf7;
@secondary-color: #6c5ce7;
@text-color: #2d3436;
@light-bg: #f8f9fa;
@border-color: #e0e0e0;
@card-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
@code-bg: #f5f7fa;
@code-border: #e0e0e0;
@pros-color: #2ecc71;
@cons-color: #e74c3c;

.arrow-function-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  color: @text-color;
  background-color: #fff;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
  border-radius: 8px;
}

.guide-header {
  text-align: center;
  margin-bottom: 2.5rem;
  padding-bottom: 1.5rem;
  border-bottom: 1px solid @border-color;

  h1 {
    color: @primary-color;
    font-size: 2.5rem;
    margin-bottom: 0.5rem;
  }

  p {
    font-size: 1.1rem;
    color: lighten(@text-color, 20%);
  }
}

.content-wrapper {
  display: flex;
  gap: 2rem;
}

.navigation {
  flex: 0 0 200px;
  position: sticky;
  top: 2rem;
  height: fit-content;
  background: @light-bg;
  border-radius: 8px;
  padding: 1.5rem;
  box-shadow: @card-shadow;

  ul {
    list-style: none;
    padding: 0;
    margin: 0;

    li {
      padding: 0.8rem 1rem;
      margin-bottom: 0.5rem;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;

      &:hover {
        background: lighten(@primary-color, 40%);
        color: @primary-color;
      }

      &:active {
        transform: translateY(1px);
      }
    }
  }
}

.content {
  flex: 1;
}

.guide-section {
  margin-bottom: 3rem;
  padding: 1.5rem 2rem;
  background: @light-bg;
  border-radius: 8px;
  box-shadow: @card-shadow;

  h2 {
    color: @secondary-color;
    font-size: 1.8rem;
    margin-top: 0;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid lighten(@secondary-color, 40%);
  }
}

.intro-content {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 1.5rem;
  margin-top: 1.5rem;
}

.intro-card {
  background: white;
  border-radius: 8px;
  padding: 1.5rem;
  text-align: center;
  box-shadow: @card-shadow;
  transition: transform 0.3s ease;

  &:hover {
    transform: translateY(-5px);
  }

  .intro-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
  }

  h3 {
    margin: 0.5rem 0 1rem;
    color: @primary-color;
  }
}

.features-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 1.5rem;
  margin-top: 1.5rem;
}

.feature-card {
  background: white;
  border-radius: 8px;
  padding: 1.5rem;
  box-shadow: @card-shadow;

  h3 {
    margin-top: 0;
    color: @primary-color;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
}

.comparison {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
  margin-top: 1rem;

  .comparison-item {
    background: @code-bg;
    border-radius: 6px;
    padding: 1rem;

    h4 {
      margin-top: 0;
      font-size: 1rem;
      color: #666;
    }
  }
}

.code-block {
  display: block;
  background: @code-bg;
  color: @text-color;
  border-radius: 6px;
  padding: 1.2rem;
  font-family: 'Fira Code', 'Consolas', monospace;
  font-size: 0.95rem;
  overflow-x: auto;
  margin: 1rem 0 0;
  line-height: 1.5;
  border: 1px solid @code-border;
  border-left: 3px solid @primary-color;
}

.implementation-content {
  margin-top: 1.5rem;
}

.implementation-step {
  display: flex;
  gap: 1.5rem;
  margin-bottom: 2rem;
  background: white;
  border-radius: 8px;
  padding: 1.5rem;
  box-shadow: @card-shadow;

  .step-number {
    flex: 0 0 40px;
    height: 40px;
    background: @primary-color;
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    font-weight: bold;
  }

  .step-content {
    flex: 1;

    h3 {
      margin-top: 0;
      color: @primary-color;
    }
  }
}

.scenario-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 1.5rem;
  margin-top: 1.5rem;
}

.scenario-card {
  background: white;
  border-radius: 8px;
  padding: 1.5rem;
  box-shadow: @card-shadow;
  transition: transform 0.3s ease;

  &:hover {
    transform: translateY(-5px);
  }

  .scenario-icon {
    font-size: 2.5rem;
    margin-bottom: 1rem;
  }

  h3 {
    margin: 0.5rem 0;
    color: @primary-color;
  }
}

.limitation-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 1.5rem;
  margin-top: 1.5rem;
}

.limitation-card {
  background: white;
  border-radius: 8px;
  padding: 1.5rem;
  box-shadow: @card-shadow;
  border-top: 3px solid @cons-color;

  h3 {
    margin-top: 0;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
}

.conclusion-content {
  .pros-cons {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
    margin-bottom: 2rem;

    .pros,
    .cons {
      background: white;
      border-radius: 8px;
      padding: 1.5rem;
      box-shadow: @card-shadow;
    }

    .pros {
      border-top: 3px solid @pros-color;
    }

    .cons {
      border-top: 3px solid @cons-color;
    }

    h3 {
      margin-top: 0;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    ul {
      padding-left: 1.5rem;

      li {
        margin-bottom: 0.8rem;
      }
    }
  }

  .final-recommendation {
    background: lighten(@primary-color, 48%);
    border-radius: 8px;
    padding: 1.5rem;
    border-left: 4px solid @primary-color;

    h3 {
      margin-top: 0;
      color: @primary-color;
    }

    p {
      line-height: 1.6;
    }
  }
}

@media (max-width: 768px) {
  .content-wrapper {
    flex-direction: column;
  }

  .navigation {
    position: static;
    margin-bottom: 1.5rem;
  }

  .comparison {
    grid-template-columns: 1fr;
  }

  .pros-cons {
    grid-template-columns: 1fr !important;
  }
}
</style>
