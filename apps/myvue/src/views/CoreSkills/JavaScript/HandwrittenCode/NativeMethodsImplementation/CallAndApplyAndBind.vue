<template>
  <div class="function-container">
    <!-- æ ‡é¢˜ -->
    <header class="header">
      <h1 class="title">JSæ ¸å¿ƒæ–¹æ³•å®ç°åŸç†</h1>
      <p class="subtitle">call/apply/bind ä¸‰å…„å¼Ÿå®ç°è§£æ</p>
    </header>

    <!-- å®ç°æ€è·¯ä»‹ç» -->
    <section class="method-grid">
      <h2 class="section-title">å®ç°æ€è·¯è§£æ</h2>

      <div class="concept-cards">
        <div class="concept-card">
          <h3>æ ¸å¿ƒåŸç†</h3>
          <p><b>åˆ©ç”¨å¯¹è±¡çš„æ–¹æ³•è°ƒç”¨ä¼šå°†thisæŒ‡å‘è¯¥å¯¹è±¡çš„ç‰¹æ€§,é€šè¿‡åœ¨ç›®æ ‡å¯¹è±¡ä¸Šä¸´æ—¶æ·»åŠ æ–¹æ³•å¹¶è°ƒç”¨æ¥æ”¹å˜thisæŒ‡å‘ã€‚</b></p>
        </div>

        <div class="concept-card">
          <h3>åŸºæœ¬æ­¥éª¤</h3>
          <ul>
            <li>å°†å‡½æ•°ä½œä¸ºç›®æ ‡å¯¹è±¡çš„ä¸´æ—¶å±æ€§</li>
            <li>æ‰§è¡Œè¯¥ä¸´æ—¶æ–¹æ³•å¹¶ä¼ å…¥å‚æ•°</li>
            <li>åˆ é™¤ä¸´æ—¶å±æ€§</li>
            <li>è¿”å›æ‰§è¡Œç»“æœ</li>
          </ul>
        </div>

        <div class="concept-card">
          <h3>ä¸‰è€…åŒºåˆ«</h3>
          <ul>
            <li>call: å‚æ•°åˆ—è¡¨å½¢å¼ä¼ å…¥</li>
            <li>apply: æ•°ç»„å½¢å¼ä¼ å…¥å‚æ•°</li>
            <li>bind: è¿”å›ç»‘å®šthisçš„æ–°å‡½æ•°</li>
          </ul>
        </div>
      </div>

      <div class="implementation-notes">
        <h3>ğŸ“ å®ç°è¦ç‚¹</h3>
        <ul>
          <li>ä½¿ç”¨Symbolä½œä¸ºä¸´æ—¶å±æ€§é”®,é¿å…å±æ€§åå†²çª</li>
          <li>å¤„ç†contextä¸ºnull/undefinedçš„æƒ…å†µ,é»˜è®¤ç»‘å®šåˆ°å…¨å±€å¯¹è±¡</li>
          <li>bindéœ€è¦è€ƒè™‘newè°ƒç”¨çš„æƒ…å†µ,ä¿ç•™åŸå‹é“¾</li>
        </ul>
      </div>
    </section>

    <!-- æ–¹æ³•å¯¹æ¯”è¡¨æ ¼ -->
    <div class="method-grid">
      <!-- call å®ç° -->
      <div class="method-card">
        <h2 class="method-title">call æ–¹æ³•å®ç°</h2>
        <div class="comparison">
          <div class="native">
            <h3>åŸç”Ÿç”¨æ³•</h3>
            <pre class="code">fn.call(context, arg1, arg2)</pre>
          </div>
          <div class="custom">
            <h3>è‡ªå®šä¹‰å®ç°</h3>
            <pre class="code">function myCall(context, ...args) {
  context = context || globalThis
  const key = Symbol('tempKey')
  context[key] = this
  const result = context[key](...args)
  delete context[key]
  return result
}</pre>
          </div>
        </div>
      </div>

      <!-- apply å®ç° -->
      <div class="method-card">
        <h2 class="method-title">apply æ–¹æ³•å®ç°</h2>
        <div class="comparison">
          <div class="native">
            <h3>åŸç”Ÿç”¨æ³•</h3>
            <pre class="code">fn.apply(context, [arg1, arg2])</pre>
          </div>
          <div class="custom">
            <h3>è‡ªå®šä¹‰å®ç°</h3>
            <pre class="code">function myApply(context, argsArray) {
  context = context || globalThis
  const key = Symbol('tempKey')
  context[key] = this
  const result = context[key](...argsArray)
  delete context[key]
  return result
}</pre>
          </div>
        </div>
      </div>

      <!-- bind å®ç° -->
      <div class="method-card">
        <h2 class="method-title">bind æ–¹æ³•å®ç°</h2>
        <div class="comparison">
          <div class="native">
            <h3>åŸç”Ÿç”¨æ³•</h3>
            <pre class="code">const boundFn = fn.bind(context, arg1)</pre>
          </div>
          <div class="custom">
            <h3>è‡ªå®šä¹‰å®ç°</h3>
            <pre class="code">function myBind(context, ...bindArgs) {
  const self = this
  return function(...args) {
    return self.apply(context, bindArgs.concat(args))
  }
}</pre>
          </div>
        </div>
      </div>
    </div>

    <!-- å®ç°åŸç†è¯´æ˜ -->
    <div class="principle-section">
      <h2 class="section-title">æ ¸å¿ƒå®ç°åŸç†</h2>
      <div class="principle-grid">
        <div class="principle-card" v-for="(item, index) in principles" :key="index">
          <div class="step">{{ index + 1 }}</div>
          <h3>{{ item.title }}</h3>
          <p>{{ item.description }}</p>
        </div>
      </div>
    </div>

    <!-- ä»£ç æ³¨é‡Šè¯´æ˜ -->
    <div class="annotation-section">
      <h2 class="section-title">å…³é”®ä»£ç æ³¨é‡Š</h2>
      <pre class="annotated-code">function myCall(context, ...args) {
  // 1. å¤„ç†ä¸Šä¸‹æ–‡è¾¹ç•Œæƒ…å†µ
  context = context || globalThis

  // 2. åˆ›å»ºå”¯ä¸€ä¸´æ—¶å±æ€§é¿å…æ±¡æŸ“
  const key = Symbol('tempKey')

  // 3. å°†å½“å‰å‡½æ•°ç»‘å®šåˆ°ä¸Šä¸‹æ–‡
  context[key] = this

  // 4. æ‰§è¡Œå‡½æ•°å¹¶ä¿å­˜ç»“æœ
  const result = context[key](...args)

  // 5. æ¸…ç†ä¸´æ—¶å±æ€§
  delete context[key]

  // 6. è¿”å›æ‰§è¡Œç»“æœ
  return result
}</pre>
    </div>
  </div>
</template>

<script setup lang="ts">
const principles = [
  {
    title: "ä¸Šä¸‹æ–‡ç»‘å®š",
    description: "é€šè¿‡å°†å‡½æ•°èµ‹å€¼ç»™ä¸Šä¸‹æ–‡å¯¹è±¡çš„ä¸´æ—¶å±æ€§æ¥å®ç°thisç»‘å®š"
  },
  {
    title: "å‚æ•°å¤„ç†",
    description: "ä½¿ç”¨å‰©ä½™å‚æ•°å’Œå±•å¼€è¿ç®—ç¬¦å¤„ç†ä¸åŒä¼ å‚æ–¹å¼"
  },
  {
    title: "å†…å­˜ç®¡ç†",
    description: "ä½¿ç”¨Symbolä½œä¸ºå±æ€§é”®åé¿å…å‘½åå†²çªï¼Œæ‰§è¡Œåç«‹å³åˆ é™¤"
  },
  {
    title: "å‡½æ•°æŸ¯é‡ŒåŒ–",
    description: "bindé€šè¿‡é—­åŒ…ä¿å­˜ç»‘å®šå‚æ•°å®ç°æŸ¯é‡ŒåŒ–æ•ˆæœ"
  }
] as const;
</script>

<style lang="less">
@primary-color: #2c3e50;
@secondary-color: #3498db;
@accent-color: #e74c3c;
@bg-color: #f8f9fa;

.function-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
  font-family: 'Fira Code', monospace;

  .header {
    text-align: center;
    margin-bottom: 3rem;

    .title {
      font-size: 2.5rem;
      color: @primary-color;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
    }

    .subtitle {
      color: lighten(@primary-color, 20%);
      font-size: 1.2rem;
    }
  }

  .method-grid {
    display: grid;
    gap: 2rem;
    margin-bottom: 3rem;

    .method-card {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      transition: transform 0.3s;

      &:hover {
        transform: translateY(-5px);
      }

      .method-title {
        color: @secondary-color;
        border-left: 4px solid @secondary-color;
        padding-left: 1rem;
        margin-bottom: 1.5rem;
      }

      .comparison {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;

        .native,
        .custom {
          pre.code {
            background: lighten(@primary-color, 70%);
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
          }
        }

        .custom pre {
          position: relative;

          &::before {
            content: 'â­ å®ç°è¦ç‚¹';
            position: absolute;
            top: -12px;
            left: 10px;
            background: white;
            padding: 0 5px;
            color: @accent-color;
            font-size: 0.8em;
          }
        }
      }
    }
  }

  .principle-section {
    background: @bg-color;
    padding: 2rem;
    border-radius: 12px;
    margin: 2rem 0;

    .principle-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;

      .principle-card {
        background: white;
        padding: 1.5rem;
        border-radius: 8px;
        position: relative;

        .step {
          position: absolute;
          top: -15px;
          left: -15px;
          width: 30px;
          height: 30px;
          background: @secondary-color;
          color: white;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: bold;
        }
      }
    }
  }

  .annotation-section {
    pre.annotated-code {
      background: #282c34;
      color: #abb2bf;
      padding: 1.5rem;
      border-radius: 8px;
      position: relative;
      counter-reset: line;

      &::before {
        content: '// æ³¨é‡Šè§£æ';
        position: absolute;
        top: -18px;
        left: 10px;
        background: #282c34;
        padding: 0 5px;
        color: #e06c75;
      }

      // æ¨¡æ‹Ÿä»£ç è¡Œå·
      span {
        display: block;

        &::before {
          content: counter(line);
          counter-increment: line;
          margin-right: 1em;
          color: #5c6370;
        }
      }
    }
  }
}
</style>
