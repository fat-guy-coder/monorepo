<template>
  <div class="generator-container">
    <h1 class="main-title">ES6 Generator è¯¦è§£</h1>

    <div class="section">
      <h2 class="section-title">ä»€ä¹ˆæ˜¯ Generatorï¼Ÿ</h2>
      <p class="section-content">
        Generatorï¼ˆç”Ÿæˆå™¨ï¼‰æ˜¯ ES6 å¼•å…¥çš„ä¸€ç§ç‰¹æ®Šå‡½æ•°ï¼Œå¯ä»¥æ§åˆ¶å‡½æ•°çš„æ‰§è¡Œæµç¨‹ï¼Œå®ç°æš‚åœå’Œæ¢å¤æ‰§è¡Œçš„åŠŸèƒ½ã€‚
        ç”Ÿæˆå™¨å‡½æ•°ä½¿ç”¨ <code>function*</code> è¯­æ³•å®šä¹‰ï¼Œå†…éƒ¨ä½¿ç”¨ <code>yield</code> å…³é”®å­—æš‚åœå‡½æ•°æ‰§è¡Œã€‚
      </p>
      <div class="highlight-box">
        <div class="highlight-title">æ ¸å¿ƒç‰¹æ€§ï¼š</div>
        <ul>
          <li>å¯æš‚åœå’Œæ¢å¤çš„å‡½æ•°æ‰§è¡Œ</li>
          <li>åŒå‘æ•°æ®ä¼ é€’ï¼ˆå‡½æ•°å†…å¤–ï¼‰</li>
          <li>ä¸è¿­ä»£å™¨åè®®ç´§å¯†é›†æˆ</li>
          <li>ç®€åŒ–å¼‚æ­¥ç¼–ç¨‹çš„è§£å†³æ–¹æ¡ˆ</li>
        </ul>
      </div>
    </div>

    <div class="section">
      <h2 class="section-title">å®ç°åŸç†</h2>
      <p class="section-content">
        Generator çš„å®ç°åŸºäºè¿­ä»£å™¨åè®®å’Œåç¨‹ï¼ˆCoroutineï¼‰æ¦‚å¿µï¼š
      </p>

      <div class="principle-card">
        <div class="principle-header">1. è¿­ä»£å™¨åè®®</div>
        <div class="principle-content">
          ç”Ÿæˆå™¨å‡½æ•°è¿”å›ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å®ç°äº† <code>next()</code> æ–¹æ³•ã€‚
          æ¯æ¬¡è°ƒç”¨ <code>next()</code> éƒ½ä¼šæ‰§è¡Œåˆ°ä¸‹ä¸€ä¸ª <code>yield</code> æˆ–å‡½æ•°ç»“æŸã€‚
        </div>
      </div>

      <div class="principle-card">
        <div class="principle-header">2. åç¨‹æœºåˆ¶</div>
        <div class="principle-content">
          Generator å®ç°äº†è½»é‡çº§åç¨‹ï¼Œåœ¨å‡½æ•°æ‰§è¡Œä¸­å¯ä»¥æš‚åœå¹¶å°†æ§åˆ¶æƒäº¤è¿˜ç»™è°ƒç”¨è€…ï¼Œç¨åå¯ä»¥ä»æš‚åœç‚¹æ¢å¤æ‰§è¡Œã€‚
          JavaScript å¼•æ“åœ¨å†…éƒ¨ç»´æŠ¤ç”Ÿæˆå™¨çš„æ‰§è¡Œä¸Šä¸‹æ–‡å’ŒçŠ¶æ€ã€‚
        </div>
      </div>

      <div class="principle-card">
        <div class="principle-header">3. çŠ¶æ€æœºå®ç°</div>
        <div class="principle-content">
          ç”Ÿæˆå™¨å‡½æ•°è¢«ç¼–è¯‘ä¸ºä¸€ä¸ªçŠ¶æ€æœºï¼Œæ¯ä¸ª <code>yield</code> å¯¹åº”ä¸€ä¸ªçŠ¶æ€èŠ‚ç‚¹ã€‚
          å¼•æ“é€šè¿‡ <code>next()</code> è°ƒç”¨é©±åŠ¨çŠ¶æ€æœºä»ä¸€ä¸ªçŠ¶æ€åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚
        </div>
      </div>

      <div class="code-block">
        <pre><code>function* generatorExample() {
  // çŠ¶æ€ 0: èµ·ç‚¹
  console.log('Start');
  const a = yield 1; // çŠ¶æ€ 1: ç¬¬ä¸€ä¸ª yield

  // çŠ¶æ€ 2: æ¢å¤æ‰§è¡Œ
  console.log('Received:', a);
  const b = yield 2; // çŠ¶æ€ 3: ç¬¬äºŒä¸ª yield

  // çŠ¶æ€ 4: ç»“æŸ
  return a + b;
}</code></pre>
      </div>
    </div>

    <div class="section">
      <h2 class="section-title">åŸºæœ¬ç”¨æ³•</h2>
      <div class="usage-grid">
        <div class="usage-card">
          <div class="usage-header">1. å®šä¹‰ç”Ÿæˆå™¨å‡½æ•°</div>
          <div class="code-block">
            <pre><code>function* simpleGenerator() {
  yield 'First value';
  yield 'Second value';
  return 'Final value';
}</code></pre>
          </div>
        </div>

        <div class="usage-card">
          <div class="usage-header">2. åˆ›å»ºè¿­ä»£å™¨</div>
          <div class="code-block">
            <pre><code>const gen = simpleGenerator();

console.log(gen.next());
// { value: 'First value', done: false }

console.log(gen.next());
// { value: 'Second value', done: false }

console.log(gen.next());
// { value: 'Final value', done: true }</code></pre>
          </div>
        </div>

        <div class="usage-card">
          <div class="usage-header">3. åŒå‘é€šä¿¡</div>
          <div class="code-block">
            <pre><code>function* twoWayGenerator() {
  const name = yield 'What is your name?';
  const age = yield `Hello ${name}, how old are you?`;
  return `${name} is ${age} years old`;
}

const gen = twoWayGenerator();
console.log(gen.next().value); // "What is your name?"
console.log(gen.next('Alice').value); // "Hello Alice, how old are you?"
console.log(gen.next(30).value); // "Alice is 30 years old"</code></pre>
          </div>
        </div>

        <div class="usage-card">
          <div class="usage-header">4. é”™è¯¯å¤„ç†</div>
          <div class="code-block">
            <pre><code>function* errorHandling() {
  try {
    yield 'Step 1';
    throw new Error('Generator error!');
  } catch (err) {
    yield `Caught: ${err.message}`;
  }
}

const gen = errorHandling();
console.log(gen.next()); // { value: 'Step 1', done: false }
console.log(gen.throw(new Error('External error')));
// { value: 'Caught: External error', done: false }</code></pre>
          </div>
        </div>
      </div>
    </div>

    <div class="section">
      <h2 class="section-title">å®é™…åº”ç”¨åœºæ™¯</h2>
      <div class="scenario-cards">
        <div class="scenario-card">
          <div class="scenario-icon">ğŸ”„</div>
          <div class="scenario-content">
            <h3>ç®€åŒ–å¼‚æ­¥æµç¨‹æ§åˆ¶</h3>
            <p>Generator + Promise å®ç°ç±»ä¼¼ async/await çš„å¼‚æ­¥æ§åˆ¶ï¼š</p>
            <div class="code-block">
              <pre><code>function* fetchUserData() {
  try {
    const user = yield fetch('/api/user');
    const posts = yield fetch(`/api/posts/${user.id}`);
    return { user, posts };
  } catch (error) {
    console.error('Fetch failed', error);
  }
}

// æ‰§è¡Œå‡½æ•°
function runGenerator(gen) {
  const it = gen();

  function handle(result) {
    if (result.done) return result.value;
    return result.value.then(data => {
      return handle(it.next(data));
    });
  }

  return handle(it.next());
}</code></pre>
            </div>
          </div>
        </div>

        <div class="scenario-card">
          <div class="scenario-icon">â™¾ï¸</div>
          <div class="scenario-content">
            <h3>æ— é™æ•°æ®æµ</h3>
            <p>ç”Ÿæˆæ— é™åºåˆ—ï¼ŒæŒ‰éœ€è·å–å€¼ï¼š</p>
            <div class="code-block">
              <pre><code>function* idGenerator() {
  let id = 1;
  while (true) {
    yield id++;
  }
}

const userIds = idGenerator();
console.log(userIds.next().value); // 1
console.log(userIds.next().value); // 2
// å¯ä»¥æ— é™è°ƒç”¨...</code></pre>
            </div>
          </div>
        </div>

        <div class="scenario-card">
          <div class="scenario-icon">â±ï¸</div>
          <div class="scenario-content">
            <h3>å¤æ‚çŠ¶æ€æœº</h3>
            <p>å®ç°å…·æœ‰å¤šä¸ªçŠ¶æ€çš„å·¥ä½œæµï¼š</p>
            <div class="code-block">
              <pre><code>function* purchaseFlow() {
  // çŠ¶æ€1: é€‰æ‹©å•†å“
  const product = yield showProducts();

  // çŠ¶æ€2: ç¡®è®¤æ•°é‡
  const quantity = yield askQuantity(product);

  // çŠ¶æ€3: æ”¯ä»˜
  const payment = yield processPayment(product, quantity);

  // çŠ¶æ€4: å®Œæˆ
  yield completePurchase(payment);
}</code></pre>
            </div>
          </div>
        </div>

        <div class="scenario-card">
          <div class="scenario-icon">ğŸ“Š</div>
          <div class="scenario-content">
            <h3>æ•°æ®ç®¡é“å¤„ç†</h3>
            <p>æ„å»ºæ•°æ®å¤„ç†ç®¡é“ï¼š</p>
            <div class="code-block">
              <pre><code>function* dataPipeline() {
  const rawData = yield fetchData();
  const cleaned = yield cleanData(rawData);
  const transformed = yield transformData(cleaned);
  const analyzed = yield analyzeData(transformed);
  return analyzed;
}</code></pre>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="section">
      <h2 class="section-title">Generator vs Async/Await</h2>
      <div class="comparison-table">
        <table>
          <thead>
            <tr>
              <th>ç‰¹æ€§</th>
              <th>Generator</th>
              <th>Async/Await</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>è¯­æ³•</td>
              <td><code>function*</code> + <code>yield</code></td>
              <td><code>async function</code> + <code>await</code></td>
            </tr>
            <tr>
              <td>è¿”å›å€¼</td>
              <td>è¿­ä»£å™¨å¯¹è±¡</td>
              <td>Promise</td>
            </tr>
            <tr>
              <td>é”™è¯¯å¤„ç†</td>
              <td><code>try/catch</code> + <code>gen.throw()</code></td>
              <td><code>try/catch</code></td>
            </tr>
            <tr>
              <td>åŒå‘é€šä¿¡</td>
              <td>æ”¯æŒï¼ˆé€šè¿‡ <code>next(value)</code>ï¼‰</td>
              <td>ä¸æ”¯æŒ</td>
            </tr>
            <tr>
              <td>åº”ç”¨åœºæ™¯</td>
              <td>å¤æ‚æ§åˆ¶æµã€çŠ¶æ€æœºã€è‡ªå®šä¹‰è¿­ä»£å™¨</td>
              <td>å¼‚æ­¥æ“ä½œç®€åŒ–</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="footer">
      <p>ES6 Generator æ˜¯ JavaScript å¼‚æ­¥ç¼–ç¨‹å‘å±•å²ä¸Šçš„é‡è¦é‡Œç¨‹ç¢‘ï¼Œè™½ç„¶ç°åœ¨å¤§å¤šè¢« Async/Await å–ä»£ï¼Œä½†ç†è§£å…¶åŸç†æœ‰åŠ©äºæ·±å…¥æŒæ¡ JavaScript å¼‚æ­¥æ¨¡å‹ã€‚</p>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue';

// è¿™é‡Œå¯ä»¥æ·»åŠ ä¸€äº›å“åº”å¼æ•°æ®æˆ–æ–¹æ³•
const activeTab = ref('usage');
</script>

<style lang="less" scoped>
.generator-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  color: #333;
  background-color: #f8f9fa;
  line-height: 1.6;

  .main-title {
    text-align: center;
    color: #2c3e50;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid #3498db;
    font-size: 2.5rem;
  }

  .section {
    background: white;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    padding: 2rem;
    margin-bottom: 2rem;

    .section-title {
      color: #2980b9;
      border-left: 4px solid #3498db;
      padding-left: 1rem;
      margin-top: 0;
      font-size: 1.8rem;
    }

    .section-content {
      margin-bottom: 1.5rem;
      font-size: 1.1rem;
    }
  }

  .highlight-box {
    background: #e8f4fc;
    border-left: 4px solid #3498db;
    padding: 1.2rem;
    border-radius: 0 8px 8px 0;
    margin: 1.5rem 0;

    .highlight-title {
      font-weight: bold;
      margin-bottom: 0.8rem;
      color: #2c3e50;
      font-size: 1.2rem;
    }

    ul {
      padding-left: 1.5rem;
      margin: 0;

      li {
        margin-bottom: 0.5rem;
      }
    }
  }

  .principle-card {
    background: #f8f9fa;
    border: 1px solid #e1e4e8;
    border-radius: 8px;
    padding: 1.2rem;
    margin-bottom: 1.2rem;

    .principle-header {
      font-weight: bold;
      color: #2980b9;
      margin-bottom: 0.5rem;
      font-size: 1.2rem;
    }

    .principle-content {
      color: #555;
    }
  }

  .code-block {
    background: #2d2d2d;
    color: #f8f8f2;
    border-radius: 8px;
    padding: 1.2rem;
    overflow-x: auto;
    margin: 1.5rem 0;
    font-family: 'Fira Code', 'Consolas', monospace;
    font-size: 0.95rem;

    pre {
      margin: 0;
    }

    code {
      display: block;
      line-height: 1.5;
    }
  }

  .usage-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-top: 1.5rem;

    .usage-card {
      background: #f0f7ff;
      border: 1px solid #c5e1ff;
      border-radius: 8px;
      overflow: hidden;

      .usage-header {
        background: #3498db;
        color: white;
        padding: 0.8rem 1rem;
        font-weight: bold;
      }
    }
  }

  .scenario-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-top: 1.5rem;

    .scenario-card {
      background: white;
      border: 1px solid #e1e4e8;
      border-radius: 8px;
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;

      &:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
      }

      .scenario-icon {
        background: #3498db;
        color: white;
        font-size: 2rem;
        text-align: center;
        padding: 1rem;
      }

      .scenario-content {
        padding: 1.2rem;

        h3 {
          margin-top: 0;
          color: #2c3e50;
        }

        p {
          color: #555;
          margin-bottom: 1rem;
        }
      }
    }
  }

  .comparison-table {
    overflow-x: auto;
    margin-top: 1.5rem;

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;

      th,
      td {
        padding: 1rem;
        text-align: left;
        border: 1px solid #e1e4e8;
      }

      th {
        background: #3498db;
        color: white;
        font-weight: bold;
      }

      tr:nth-child(even) {
        background-color: #f8f9fa;
      }
    }
  }

  .footer {
    text-align: center;
    padding: 1.5rem;
    margin-top: 2rem;
    background: #2c3e50;
    color: white;
    border-radius: 8px;
    font-size: 1.1rem;
  }

  @media (max-width: 768px) {
    padding: 1rem;

    .main-title {
      font-size: 2rem;
    }

    .section {
      padding: 1.5rem;
    }

    .usage-grid,
    .scenario-cards {
      grid-template-columns: 1fr;
    }
  }
}
</style>
