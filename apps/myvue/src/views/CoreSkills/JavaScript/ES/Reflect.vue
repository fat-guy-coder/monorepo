<template>
  <div class="reflect-docs">
    <header class="docs-header">
      <h1>JavaScript Reflect å®Œå…¨æŒ‡å—</h1>
      <p class="subtitle">ES6 å¯¹è±¡æ“ä½œçš„ç°ä»£åŒ– API</p>
    </header>

    <Nav class="toc" position="top-right" :list="sections" />

    <div class="content-wrapper">
      <!-- åŸºç¡€ä»‹ç» -->
      <section id="overview" class="method-card">
        <h2>ğŸ” Reflect æ¦‚è¿°</h2>
        <div class="info-box">
          <h3>ä»€ä¹ˆæ˜¯ Reflectï¼Ÿ</h3>
          <p>Reflect æ˜¯ ES6 å¼•å…¥çš„ä¸€ä¸ªæ–°çš„å…¨å±€å¯¹è±¡ï¼Œå®ƒæä¾›äº†æ‹¦æˆª JavaScript æ“ä½œçš„æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•ä¸ Proxy å¤„ç†å™¨çš„æ–¹æ³•ç›¸åŒï¼Œä½† Reflect æ˜¯é™æ€æ–¹æ³•ï¼Œä¸æ˜¯æ„é€ å‡½æ•°ã€‚</p>

          <h3>è®¾è®¡ç›®çš„</h3>
          <ol>
            <li><strong>è¯­è¨€å†…éƒ¨æ–¹æ³•çš„ç»Ÿä¸€åŒ–ï¼š</strong>å°† Object å¯¹è±¡çš„ä¸€äº›æ˜æ˜¾å±äºè¯­è¨€å†…éƒ¨çš„æ–¹æ³•ï¼ˆå¦‚ Object.definePropertyï¼‰æ”¾åˆ° Reflect å¯¹è±¡ä¸Š</li>
            <li><strong>æ›´åˆç†çš„è¿”å›å€¼ï¼š</strong>ä¿®æ”¹æŸäº› Object æ–¹æ³•çš„è¿”å›ç»“æœï¼Œè®©æ“ä½œæ›´å¯é¢„æµ‹</li>
            <li><strong>å‡½æ•°å¼ç¼–ç¨‹ï¼š</strong>è®©å¯¹è±¡æ“ä½œå˜æˆå‡½æ•°å¼è°ƒç”¨ï¼Œè€Œä¸æ˜¯å‘½ä»¤å¼</li>
            <li><strong>ä¸ Proxy é…åˆï¼š</strong>ä¸º Proxy æä¾›é»˜è®¤è¡Œä¸º</li>
          </ol>
        </div>
      </section>

      <!-- æ ¸å¿ƒæ–¹æ³• -->
      <section id="methods" class="method-card">
        <h2>ğŸ¯ æ ¸å¿ƒæ–¹æ³•è¯¦è§£</h2>

        <div class="method-item">
          <h3>1. Reflect.get(target, propertyKey[, receiver])</h3>
          <p class="method-desc">è·å–å¯¹è±¡å±æ€§çš„å€¼ï¼Œç±»ä¼¼äº target[propertyKey]</p>
          <CodeBlock :code="reflectGetExample" language="js" />
          <div class="use-case">
            <h4>ğŸ’¡ ä½¿ç”¨åœºæ™¯</h4>
            <ul>
              <li>éœ€è¦å¤„ç†è®¿é—®å™¨ä¸Šä¸‹æ–‡æ—¶</li>
              <li>ä¸ Proxy é…åˆä½¿ç”¨æ—¶</li>
              <li>éœ€è¦å‡½æ•°å¼è°ƒç”¨è€Œéå±æ€§è®¿é—®æ—¶</li>
            </ul>
          </div>
        </div>

        <div class="method-item">
          <h3>2. Reflect.set(target, propertyKey, value[, receiver])</h3>
          <p class="method-desc">è®¾ç½®å¯¹è±¡å±æ€§çš„å€¼ï¼Œè¿”å›å¸ƒå°”å€¼è¡¨ç¤ºæ˜¯å¦æˆåŠŸ</p>
          <CodeBlock :code="reflectSetExample" language="js" />
          <div class="use-case warning">
            <h4>âš ï¸ é‡è¦åŒºåˆ«</h4>
            <p>ä¸ç›´æ¥èµ‹å€¼ä¸åŒï¼ŒReflect.set è¿”å›å¸ƒå°”å€¼ï¼Œå¯ä»¥çŸ¥é“æ“ä½œæ˜¯å¦æˆåŠŸ</p>
          </div>
        </div>

        <div class="method-item">
          <h3>3. Reflect.has(target, propertyKey)</h3>
          <p class="method-desc">æ£€æŸ¥å¯¹è±¡æ˜¯å¦åŒ…å«æŸä¸ªå±æ€§ï¼Œç›¸å½“äº in æ“ä½œç¬¦</p>
          <CodeBlock :code="reflectHasExample" language="js" />
        </div>

        <div class="method-item">
          <h3>4. Reflect.deleteProperty(target, propertyKey)</h3>
          <p class="method-desc">åˆ é™¤å¯¹è±¡å±æ€§ï¼Œç›¸å½“äº delete æ“ä½œç¬¦</p>
          <CodeBlock :code="reflectDeleteExample" language="js" />
        </div>

        <div class="method-item">
          <h3>5. Reflect.defineProperty(target, propertyKey, attributes)</h3>
          <p class="method-desc">å®šä¹‰å¯¹è±¡å±æ€§ï¼Œè¿”å›å¸ƒå°”å€¼è¡¨ç¤ºæ˜¯å¦æˆåŠŸ</p>
          <CodeBlock :code="reflectDefineExample" language="js" />
        </div>

        <div class="method-item">
          <h3>6. Reflect.getOwnPropertyDescriptor(target, propertyKey)</h3>
          <p class="method-desc">è·å–å¯¹è±¡å±æ€§çš„æè¿°ç¬¦</p>
          <CodeBlock :code="reflectGetDescriptorExample" language="js" />
        </div>

        <div class="method-item">
          <h3>7. Reflect.getPrototypeOf(target)</h3>
          <p class="method-desc">è·å–å¯¹è±¡çš„åŸå‹</p>
          <CodeBlock :code="reflectGetPrototypeExample" language="js" />
        </div>

        <div class="method-item">
          <h3>8. Reflect.setPrototypeOf(target, prototype)</h3>
          <p class="method-desc">è®¾ç½®å¯¹è±¡çš„åŸå‹</p>
          <CodeBlock :code="reflectSetPrototypeExample" language="js" />
        </div>

        <div class="method-item">
          <h3>9. Reflect.isExtensible(target)</h3>
          <p class="method-desc">åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯æ‰©å±•</p>
          <CodeBlock :code="reflectIsExtensibleExample" language="js" />
        </div>

        <div class="method-item">
          <h3>10. Reflect.preventExtensions(target)</h3>
          <p class="method-desc">è®©å¯¹è±¡ä¸å¯æ‰©å±•</p>
          <CodeBlock :code="reflectPreventExtensionsExample" language="js" />
        </div>

        <div class="method-item">
          <h3>11. Reflect.ownKeys(target)</h3>
          <p class="method-desc">è¿”å›å¯¹è±¡çš„æ‰€æœ‰å±æ€§é”®ï¼ˆåŒ…æ‹¬ Symbolï¼‰</p>
          <CodeBlock :code="reflectOwnKeysExample" language="js" />
        </div>

        <div class="method-item">
          <h3>12. Reflect.apply(target, thisArgument, argumentsList)</h3>
          <p class="method-desc">è°ƒç”¨å‡½æ•°ï¼Œå¹¶æŒ‡å®š this å€¼å’Œå‚æ•°åˆ—è¡¨</p>
          <CodeBlock :code="reflectApplyExample" language="js" />
        </div>

        <div class="method-item">
          <h3>13. Reflect.construct(target, argumentsList[, newTarget])</h3>
          <p class="method-desc">ä½¿ç”¨æŒ‡å®šçš„å‚æ•°åˆ—è¡¨è°ƒç”¨æ„é€ å‡½æ•°</p>
          <CodeBlock :code="reflectConstructExample" language="js" />
        </div>
      </section>

      <!-- è§£å†³çš„é—®é¢˜ -->
      <section id="problems-solved" class="method-card highlight">
        <h2>ğŸ”§ Reflect è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h2>
        <div class="problems-grid">
          <div class="problem-item">
            <h3>1. é”™è¯¯å¤„ç†æ›´ä¼˜é›…</h3>
            <CodeBlock :code="errorHandlingExample" language="js" />
            <p>ä¼ ç»Ÿæ–¹å¼éœ€è¦ try-catchï¼ŒReflect è¿”å›å¸ƒå°”å€¼</p>
          </div>

          <div class="problem-item">
            <h3>2. å‡½æ•°å¼ç¼–ç¨‹é£æ ¼</h3>
            <CodeBlock :code="functionalStyleExample" language="js" />
            <p>æ‰€æœ‰æ“ä½œéƒ½æ˜¯å‡½æ•°è°ƒç”¨ï¼Œæ›´ç¬¦åˆå‡½æ•°å¼ç¼–ç¨‹</p>
          </div>

          <div class="problem-item">
            <h3>3. ä¸ Proxy å®Œç¾é…åˆ</h3>
            <CodeBlock :code="proxyPerfectExample" language="js" />
            <p>ä¸º Proxy æä¾›é»˜è®¤è¡Œä¸ºï¼Œé¿å…é‡å¤ä»£ç </p>
          </div>

          <div class="problem-item">
            <h3>4. æ›´å¯é¢„æµ‹çš„è¿”å›å€¼</h3>
            <CodeBlock :code="predictableReturnExample" language="js" />
            <p>æ‰€æœ‰æ–¹æ³•éƒ½æœ‰æ˜ç¡®çš„è¿”å›å€¼ç±»å‹</p>
          </div>
        </div>
      </section>

      <!-- é€‚ç”¨åœºæ™¯ -->
      <section id="use-cases" class="method-card">
        <h2>ğŸ¯ é€‚ç”¨åœºæ™¯</h2>
        <div class="use-cases-grid">
          <div class="use-case-item">
            <h3>1. å…ƒç¼–ç¨‹</h3>
            <p>å½“ä½ éœ€è¦åŠ¨æ€æ“ä½œå¯¹è±¡ç»“æ„æ—¶</p>
            <CodeBlock :code="metaprogrammingExample" language="js" />
          </div>

          <div class="use-case-item">
            <h3>2. åº“å¼€å‘</h3>
            <p>å¼€å‘é€šç”¨åº“æ—¶ï¼Œéœ€è¦æ›´å®‰å…¨çš„å¯¹è±¡æ“ä½œ</p>
            <CodeBlock :code="libraryDevelopmentExample" language="js" />
          </div>

          <div class="use-case-item">
            <h3>3. è°ƒè¯•å’Œç›‘æ§</h3>
            <p>éœ€è¦ç›‘æ§å¯¹è±¡æ“ä½œæ—¶</p>
            <CodeBlock :code="debuggingExample" language="js" />
          </div>

          <div class="use-case-item">
            <h3>4. æ•°æ®éªŒè¯</h3>
            <p>éœ€è¦éªŒè¯å¯¹è±¡æ“ä½œæ˜¯å¦æˆåŠŸæ—¶</p>
            <CodeBlock :code="validationExample" language="js" />
          </div>
        </div>
      </section>

      <!-- æœ€ä½³å®è·µ -->
      <section id="best-practices" class="method-card highlight">
        <h2>ğŸŒŸ æœ€ä½³å®è·µ</h2>
        <div class="practice-grid">
          <div class="practice-item">
            <h3>ä¸ Proxy é…åˆä½¿ç”¨</h3>
            <CodeBlock :code="proxyExample" language="js" />
            <p>ä½¿ç”¨ Reflect æä¾›é»˜è®¤è¡Œä¸ºï¼Œé¿å…é‡å¤å®ç°</p>
          </div>

          <div class="practice-item">
            <h3>é”™è¯¯å¤„ç†æ¨¡å¼</h3>
            <CodeBlock :code="errorHandlingPatternExample" language="js" />
            <p>åˆ©ç”¨è¿”å›å€¼è¿›è¡Œé”™è¯¯å¤„ç†ï¼Œè€Œä¸æ˜¯ try-catch</p>
          </div>

          <div class="practice-item">
            <h3>å‡½æ•°å¼ç¼–ç¨‹</h3>
            <CodeBlock :code="functionalProgrammingExample" language="js" />
            <p>æ‰€æœ‰æ“ä½œéƒ½æ˜¯å‡½æ•°è°ƒç”¨ï¼Œä¾¿äºç»„åˆ</p>
          </div>

          <div class="practice-item">
            <h3>ç±»å‹å®‰å…¨</h3>
            <CodeBlock :code="typeSafetyExample" language="js" />
            <p>åœ¨ TypeScript ä¸­æä¾›æ›´å¥½çš„ç±»å‹æ¨æ–­</p>
          </div>
        </div>
      </section>

      <!-- å¯¹æ¯”è¡¨æ ¼ -->
      <section id="comparison" class="method-card">
        <h2>ğŸ†š ä¸ä¼ ç»Ÿæ–¹æ³•å¯¹æ¯”</h2>
        <div class="comparison-table">
          <table>
            <thead>
              <tr>
                <th>æ“ä½œ</th>
                <th>ä¼ ç»Ÿæ–¹å¼</th>
                <th>Reflect æ–¹å¼</th>
                <th>ä¼˜åŠ¿</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>å±æ€§è¯»å–</td>
                <td><code>obj.prop</code></td>
                <td><code>Reflect.get(obj, 'prop')</code></td>
                <td>æ”¯æŒ receiver ç»‘å®š</td>
              </tr>
              <tr>
                <td>å±æ€§è®¾ç½®</td>
                <td><code>obj.prop = value</code></td>
                <td><code>Reflect.set(obj, 'prop', value)</code></td>
                <td>è¿”å›æ“ä½œç»“æœ</td>
              </tr>
              <tr>
                <td>å±æ€§æ£€æŸ¥</td>
                <td><code>prop in obj</code></td>
                <td><code>Reflect.has(obj, 'prop')</code></td>
                <td>å‡½æ•°å¼è°ƒç”¨</td>
              </tr>
              <tr>
                <td>å±æ€§åˆ é™¤</td>
                <td><code>delete obj.prop</code></td>
                <td><code>Reflect.deleteProperty(obj, 'prop')</code></td>
                <td>è¿”å›æ“ä½œç»“æœ</td>
              </tr>
              <tr>
                <td>å±æ€§å®šä¹‰</td>
                <td><code>Object.defineProperty(obj, prop, desc)</code></td>
                <td><code>Reflect.defineProperty(obj, prop, desc)</code></td>
                <td>è¿”å›å¸ƒå°”å€¼</td>
              </tr>
              <tr>
                <td>åŸå‹è·å–</td>
                <td><code>Object.getPrototypeOf(obj)</code></td>
                <td><code>Reflect.getPrototypeOf(obj)</code></td>
                <td>æ›´ç®€æ´</td>
              </tr>
              <tr>
                <td>å‡½æ•°è°ƒç”¨</td>
                <td><code>func.apply(thisArg, args)</code></td>
                <td><code>Reflect.apply(func, thisArg, args)</code></td>
                <td>æ›´ç›´è§‚</td>
              </tr>
              <tr>
                <td>æ„é€ å‡½æ•°</td>
                <td><code>new Constructor(...args)</code></td>
                <td><code>Reflect.construct(Constructor, args)</code></td>
                <td>åŠ¨æ€æ„é€ </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- æ€§èƒ½è€ƒè™‘ -->
      <section id="performance" class="method-card">
        <h2>âš¡ æ€§èƒ½è€ƒè™‘</h2>
        <div class="performance-info">
          <div class="perf-item">
            <h3>æ€§èƒ½å½±å“</h3>
            <ul>
              <li>Reflect æ–¹æ³•æ¯”ç›´æ¥æ“ä½œç¨æ…¢ï¼Œä½†å·®å¼‚å¾ˆå°</li>
              <li>åœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹ï¼Œå¯è¯»æ€§å’Œç»´æŠ¤æ€§æ¯”æ€§èƒ½æ›´é‡è¦</li>
              <li>ä¸ Proxy é…åˆä½¿ç”¨æ—¶ï¼Œæ€§èƒ½å¼€é”€ä¸»è¦æ¥è‡ª Proxy</li>
            </ul>
          </div>
          <div class="perf-item">
            <h3>ä½•æ—¶ä½¿ç”¨</h3>
            <ul>
              <li>éœ€è¦é”™è¯¯å¤„ç†æ—¶ä¼˜å…ˆä½¿ç”¨ Reflect</li>
              <li>ä¸ Proxy é…åˆæ—¶ä½¿ç”¨ Reflect</li>
              <li>éœ€è¦å‡½æ•°å¼ç¼–ç¨‹é£æ ¼æ—¶ä½¿ç”¨ Reflect</li>
              <li>ç®€å•å±æ€§è®¿é—®æ—¶ï¼Œç›´æ¥æ“ä½œæ›´ç®€æ´</li>
            </ul>
          </div>
        </div>
      </section>
    </div>
  </div>
</template>

<script setup lang="ts">
import CodeBlock from '../Components/CodeBlock.vue'
import Nav from '@/components/ScrollNav.vue'

const sections = [
  { id: 'overview', name: 'æ¦‚è¿°' },
  { id: 'methods', name: 'æ ¸å¿ƒæ–¹æ³•' },
  { id: 'problems-solved', name: 'è§£å†³çš„é—®é¢˜' },
  { id: 'use-cases', name: 'é€‚ç”¨åœºæ™¯' },
  { id: 'best-practices', name: 'æœ€ä½³å®è·µ' },
  { id: 'comparison', name: 'æ–¹æ³•å¯¹æ¯”' },
  { id: 'performance', name: 'æ€§èƒ½è€ƒè™‘' },
]

const reflectGetExample = `
// åŸºæœ¬ç”¨æ³•
const obj = { x: 1, y: 2 };
console.log(Reflect.get(obj, 'x')); // 1

// å¤„ç†è®¿é—®å™¨
const user = {
  _name: 'John',
  get name() {
    return this._name;
  }
};
const receiver = { _name: 'Alice' };
console.log(Reflect.get(user, 'name', receiver)); // 'Alice'

// æ•°ç»„è®¿é—®
const arr = [1, 2, 3];
console.log(Reflect.get(arr, '1')); // 2
`.trim()

const reflectSetExample = `
const target = {};

// æˆåŠŸè®¾ç½®
console.log(Reflect.set(target, 'prop', 123)); // true
console.log(target.prop); // 123

// è®¾ç½®ä¸å¯å†™å±æ€§
const obj = {};
Object.defineProperty(obj, 'fixed', {
  value: 'ä¸å¯å˜',
  writable: false
});
console.log(Reflect.set(obj, 'fixed', 'æ–°å€¼')); // false
console.log(obj.fixed); // 'ä¸å¯å˜'

// æ•°ç»„è®¾ç½®
const arr = [1, 2, 3];
Reflect.set(arr, '1', 99);
console.log(arr); // [1, 99, 3]
`.trim()

const reflectHasExample = `
const obj = { x: 1, y: 2 };
const sym = Symbol('symbol');

obj[sym] = 'symbol value';

console.log(Reflect.has(obj, 'x')); // true
console.log(Reflect.has(obj, 'z')); // false
console.log(Reflect.has(obj, sym)); // true

// ç»§æ‰¿å±æ€§
const parent = { inherited: 'value' };
const child = Object.create(parent);
console.log(Reflect.has(child, 'inherited')); // true
`.trim()

const reflectDeleteExample = `
const obj = { x: 1, y: 2, z: 3 };

// æˆåŠŸåˆ é™¤
console.log(Reflect.deleteProperty(obj, 'x')); // true
console.log('x' in obj); // false

// åˆ é™¤ä¸å­˜åœ¨çš„å±æ€§
console.log(Reflect.deleteProperty(obj, 'nonexistent')); // true

// åˆ é™¤ä¸å¯é…ç½®çš„å±æ€§
Object.defineProperty(obj, 'configurable', {
  value: 'test',
  configurable: false
});
console.log(Reflect.deleteProperty(obj, 'configurable')); // false
`.trim()

const reflectDefineExample = `
const obj = {};

// æˆåŠŸå®šä¹‰
console.log(Reflect.defineProperty(obj, 'prop', {
  value: 123,
  writable: true,
  enumerable: true,
  configurable: true
})); // true

// é‡å¤å®šä¹‰ç›¸åŒå±æ€§
console.log(Reflect.defineProperty(obj, 'prop', {
  value: 456
})); // true

// å®šä¹‰ä¸å¯é…ç½®å±æ€§åå†æ¬¡ä¿®æ”¹
Object.defineProperty(obj, 'fixed', {
  value: 'original',
  configurable: false
});

console.log(Reflect.defineProperty(obj, 'fixed', {
  value: 'new value'
})); // false
`.trim()

const reflectGetDescriptorExample = `
const obj = { x: 1 };

// æ™®é€šå±æ€§
console.log(Reflect.getOwnPropertyDescriptor(obj, 'x'));
// { value: 1, writable: true, enumerable: true, configurable: true }

// è®¿é—®å™¨å±æ€§
Object.defineProperty(obj, 'y', {
  get() { return this.x * 2; },
  enumerable: true,
  configurable: true
});

console.log(Reflect.getOwnPropertyDescriptor(obj, 'y'));
// { get: [Function: get], set: undefined, enumerable: true, configurable: true }

// ä¸å­˜åœ¨çš„å±æ€§
console.log(Reflect.getOwnPropertyDescriptor(obj, 'z')); // undefined
`.trim()

const reflectGetPrototypeExample = `
const parent = { inherited: 'value' };
const child = Object.create(parent);

console.log(Reflect.getPrototypeOf(child) === parent); // true
console.log(Reflect.getPrototypeOf(parent) === Object.prototype); // true
console.log(Reflect.getPrototypeOf(Object.prototype)); // null
`.trim()

const reflectSetPrototypeExample = `
const obj = { x: 1 };
const newProto = { y: 2 };

// æˆåŠŸè®¾ç½®åŸå‹
console.log(Reflect.setPrototypeOf(obj, newProto)); // true
console.log(Reflect.getPrototypeOf(obj) === newProto); // true

// è®¾ç½®ä¸º null
console.log(Reflect.setPrototypeOf(obj, null)); // true
console.log(Reflect.getPrototypeOf(obj)); // null

// è®¾ç½®ä¸ºä¸å¯æ‰©å±•çš„å¯¹è±¡
const sealed = Object.seal({});
console.log(Reflect.setPrototypeOf(sealed, {})); // false
`.trim()

const reflectIsExtensibleExample = `
const obj = { x: 1 };

console.log(Reflect.isExtensible(obj)); // true

// é˜»æ­¢æ‰©å±•
Reflect.preventExtensions(obj);
console.log(Reflect.isExtensible(obj)); // false

// å¯†å°å¯¹è±¡
const sealed = Object.seal({});
console.log(Reflect.isExtensible(sealed)); // false

// å†»ç»“å¯¹è±¡
const frozen = Object.freeze({});
console.log(Reflect.isExtensible(frozen)); // false
`.trim()

const reflectPreventExtensionsExample = `
const obj = { x: 1 };

console.log(Reflect.isExtensible(obj)); // true
console.log(Reflect.preventExtensions(obj)); // true
console.log(Reflect.isExtensible(obj)); // false

// å°è¯•æ·»åŠ æ–°å±æ€§
obj.y = 2; // åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ä¼šæŠ›å‡ºé”™è¯¯
console.log(obj.y); // undefined (éä¸¥æ ¼æ¨¡å¼)
`.trim()

const reflectOwnKeysExample = `
const obj = {
  x: 1,
  y: 2,
  [Symbol('symbol')]: 'symbol value'
};

console.log(Reflect.ownKeys(obj));
// ['x', 'y', Symbol(symbol)]

// ç»§æ‰¿çš„å±æ€§ä¸ä¼šåŒ…å«
const parent = { inherited: 'value' };
const child = Object.create(parent);
child.own = 'own value';

console.log(Reflect.ownKeys(child)); // ['own']
`.trim()

const reflectApplyExample = `
function greet(name, age) {
  return \`Hello, I'm \${name} and I'm \${age} years old\`;
}

const args = ['Alice', 25];
const thisArg = { prefix: 'Greeting: ' };

// ä¼ ç»Ÿæ–¹å¼
console.log(greet.apply(thisArg, args));

// Reflect æ–¹å¼
console.log(Reflect.apply(greet, thisArg, args));

// åŠ¨æ€è°ƒç”¨
const funcName = 'greet';
const func = this[funcName];
if (typeof func === 'function') {
  console.log(Reflect.apply(func, thisArg, args));
}
`.trim()

const reflectConstructExample = `
class Person {
  constructor(name, age) {
    this.name = name;
    this.age = age;
  }

  introduce() {
    return \`I'm \${this.name}, \${this.age} years old\`;
  }
}

// ä¼ ç»Ÿæ–¹å¼
const person1 = new Person('Alice', 25);

// Reflect æ–¹å¼
const person2 = Reflect.construct(Person, ['Bob', 30]);

console.log(person1.introduce()); // "I'm Alice, 25 years old"
console.log(person2.introduce()); // "I'm Bob, 30 years old"

// åŠ¨æ€æ„é€ 
const className = 'Person';
const ClassConstructor = this[className];
if (typeof ClassConstructor === 'function') {
  const instance = Reflect.construct(ClassConstructor, ['Charlie', 35]);
  console.log(instance.introduce());
}
`.trim()

const errorHandlingExample = `
// ä¼ ç»Ÿæ–¹å¼ - éœ€è¦ try-catch
try {
  Object.defineProperty(obj, prop, descriptor);
  console.log('æˆåŠŸ');
} catch (e) {
  console.log('å¤±è´¥:', e.message);
}

// Reflect æ–¹å¼ - è¿”å›å¸ƒå°”å€¼
if (Reflect.defineProperty(obj, prop, descriptor)) {
  console.log('æˆåŠŸ');
} else {
  console.log('å¤±è´¥');
}
`.trim()

const functionalStyleExample = `
// ä¼ ç»Ÿæ–¹å¼ - æ··åˆäº†æ“ä½œç¬¦å’Œå‡½æ•°
const value = obj.prop;
obj.prop = newValue;
delete obj.prop;
const hasProp = 'prop' in obj;

// Reflect æ–¹å¼ - å…¨éƒ¨æ˜¯å‡½æ•°è°ƒç”¨
const value = Reflect.get(obj, 'prop');
const success = Reflect.set(obj, 'prop', newValue);
const deleted = Reflect.deleteProperty(obj, 'prop');
const hasProp = Reflect.has(obj, 'prop');
`.trim()

const proxyPerfectExample = `
const handler = {
  get(target, prop, receiver) {
    console.log(\`è®¿é—®å±æ€§: \${prop}\`);
    // ä½¿ç”¨ Reflect æä¾›é»˜è®¤è¡Œä¸º
    return Reflect.get(target, prop, receiver);
  },

  set(target, prop, value, receiver) {
    console.log(\`è®¾ç½®å±æ€§: \${prop} = \${value}\`);
    // ä½¿ç”¨ Reflect æä¾›é»˜è®¤è¡Œä¸º
    return Reflect.set(target, prop, value, receiver);
  }
};

const proxy = new Proxy({ a: 1, b: 2 }, handler);
proxy.a; // è¾“å‡º: "è®¿é—®å±æ€§: a"
proxy.c = 3; // è¾“å‡º: "è®¾ç½®å±æ€§: c = 3"
`.trim()

const predictableReturnExample = `
// Object æ–¹æ³•å¯èƒ½æŠ›å‡ºé”™è¯¯
try {
  Object.defineProperty(obj, prop, invalidDescriptor);
} catch (e) {
  // å¤„ç†é”™è¯¯
}

// Reflect æ–¹æ³•æ€»æ˜¯è¿”å›å¯é¢„æµ‹çš„å€¼
const success = Reflect.defineProperty(obj, prop, invalidDescriptor);
if (!success) {
  // å¤„ç†å¤±è´¥æƒ…å†µ
}

// æ‰€æœ‰ Reflect æ–¹æ³•éƒ½æœ‰æ˜ç¡®çš„è¿”å›ç±»å‹
Reflect.get(obj, prop); // è¿”å›å±æ€§å€¼æˆ– undefined
Reflect.set(obj, prop, value); // è¿”å› boolean
Reflect.has(obj, prop); // è¿”å› boolean
Reflect.deleteProperty(obj, prop); // è¿”å› boolean
`.trim()

const metaprogrammingExample = `
// åŠ¨æ€å±æ€§æ“ä½œ
function createDynamicObject(properties) {
  const obj = {};

  for (const [key, value] of Object.entries(properties)) {
    if (typeof value === 'function') {
      // åŠ¨æ€å®šä¹‰æ–¹æ³•
      Reflect.defineProperty(obj, key, {
        value,
        enumerable: true,
        configurable: true,
        writable: true
      });
    } else {
      // åŠ¨æ€è®¾ç½®å±æ€§
      Reflect.set(obj, key, value);
    }
  }

  return obj;
}

const dynamicObj = createDynamicObject({
  name: 'Dynamic Object',
  greet() { return \`Hello, I'm \${this.name}\`; },
  age: 25
});

console.log(dynamicObj.greet()); // "Hello, I'm Dynamic Object"
`.trim()

const libraryDevelopmentExample = `
// å®‰å…¨çš„å±æ€§è®¿é—®åº“
class SafeObject {
  constructor(obj) {
    this.target = obj;
  }

  get(prop, defaultValue = undefined) {
    if (Reflect.has(this.target, prop)) {
      return Reflect.get(this.target, prop);
    }
    return defaultValue;
  }

  set(prop, value) {
    return Reflect.set(this.target, prop, value);
  }

  has(prop) {
    return Reflect.has(this.target, prop);
  }

  delete(prop) {
    return Reflect.deleteProperty(this.target, prop);
  }
}

const safeObj = new SafeObject({ x: 1, y: 2 });
console.log(safeObj.get('x')); // 1
console.log(safeObj.get('z', 'default')); // 'default'
`.trim()

const debuggingExample = `
// å¯¹è±¡æ“ä½œç›‘æ§
function createMonitoredObject(obj) {
  const handler = {
    get(target, prop, receiver) {
      console.log(\`[GET] è®¿é—®å±æ€§: \${prop}\`);
      return Reflect.get(target, prop, receiver);
    },

    set(target, prop, value, receiver) {
      console.log(\`[SET] è®¾ç½®å±æ€§: \${prop} = \${value}\`);
      return Reflect.set(target, prop, value, receiver);
    },

    deleteProperty(target, prop) {
      console.log(\`[DELETE] åˆ é™¤å±æ€§: \${prop}\`);
      return Reflect.deleteProperty(target, prop);
    }
  };

  return new Proxy(obj, handler);
}

const monitored = createMonitoredObject({ x: 1 });
monitored.x; // [GET] è®¿é—®å±æ€§: x
monitored.y = 2; // [SET] è®¾ç½®å±æ€§: y = 2
delete monitored.x; // [DELETE] åˆ é™¤å±æ€§: x
`.trim()

const validationExample = `
// æ•°æ®éªŒè¯å™¨
class Validator {
  static validateObject(obj, schema) {
    const errors = [];

    for (const [key, rules] of Object.entries(schema)) {
      const value = Reflect.get(obj, key);

      if (!Reflect.has(obj, key) && rules.required) {
        errors.push(\`ç¼ºå°‘å¿…éœ€å±æ€§: \${key}\`);
        continue;
      }

      if (Reflect.has(obj, key)) {
        if (rules.type && typeof value !== rules.type) {
          errors.push(\`å±æ€§ \${key} ç±»å‹é”™è¯¯ï¼ŒæœŸæœ› \${rules.type}ï¼Œå®é™… \${typeof value}\`);
        }

        if (rules.validator && !rules.validator(value)) {
          errors.push(\`å±æ€§ \${key} éªŒè¯å¤±è´¥\`);
        }
      }
    }

    return {
      isValid: errors.length === 0,
      errors
    };
  }
}

const schema = {
  name: { required: true, type: 'string' },
  age: { required: true, type: 'number', validator: (val) => val >= 0 }
};

const data = { name: 'Alice', age: -5 };
const result = Validator.validateObject(data, schema);
console.log(result);
// { isValid: false, errors: ['å±æ€§ age éªŒè¯å¤±è´¥'] }
`.trim()

const proxyExample = `
const handler = {
  get(target, prop, receiver) {
    console.log(\`è®¿é—®å±æ€§: \${prop}\`);
    return Reflect.get(...arguments);
  },

  set(target, prop, value, receiver) {
    console.log(\`è®¾ç½®å±æ€§: \${prop} = \${value}\`);
    return Reflect.set(...arguments);
  },

  deleteProperty(target, prop) {
    console.log(\`åˆ é™¤å±æ€§: \${prop}\`);
    return Reflect.deleteProperty(...arguments);
  }
};

const proxy = new Proxy({ a: 1 }, handler);
proxy.a; // è¾“å‡º: "è®¿é—®å±æ€§: a"
proxy.b = 2; // è¾“å‡º: "è®¾ç½®å±æ€§: b = 2"
delete proxy.a; // è¾“å‡º: "åˆ é™¤å±æ€§: a"
`.trim()

const errorHandlingPatternExample = `
// å®‰å…¨çš„å±æ€§æ“ä½œ
function safePropertyOperation(obj, operation, ...args) {
  try {
    const result = Reflect[operation](obj, ...args);

    if (typeof result === 'boolean' && !result) {
      console.warn(\`æ“ä½œå¤±è´¥: \${operation}\`);
      return false;
    }

    return result;
  } catch (error) {
    console.error(\`æ“ä½œå¼‚å¸¸: \${operation}\`, error);
    return false;
  }
}

const obj = {};
Object.defineProperty(obj, 'readonly', {
  value: 'original',
  writable: false
});

// å®‰å…¨è®¾ç½®
const setResult = safePropertyOperation(obj, 'set', 'readonly', 'new value');
console.log(setResult); // false

// å®‰å…¨åˆ é™¤
const deleteResult = safePropertyOperation(obj, 'deleteProperty', 'readonly');
console.log(deleteResult); // false
`.trim()

const functionalProgrammingExample = `
// å‡½æ•°å¼å¯¹è±¡æ“ä½œ
const objectOps = {
  get: (obj, prop) => Reflect.get(obj, prop),
  set: (obj, prop, value) => Reflect.set(obj, prop, value),
  has: (obj, prop) => Reflect.has(obj, prop),
  delete: (obj, prop) => Reflect.deleteProperty(obj, prop),
  keys: (obj) => Reflect.ownKeys(obj)
};

// é“¾å¼æ“ä½œ
const obj = { x: 1, y: 2 };
const operations = [
  () => objectOps.set(obj, 'z', 3),
  () => objectOps.get(obj, 'x'),
  () => objectOps.has(obj, 'y'),
  () => objectOps.keys(obj)
];

const results = operations.map(op => op());
console.log(results); // [true, 1, true, ['x', 'y', 'z']]
`.trim()

const typeSafetyExample = `
// TypeScript ä¸­çš„ç±»å‹å®‰å…¨
interface User {
  name: string;
  age: number;
}

function createUser(data: Partial<User>): User {
  const user = {} as User;

  // ç±»å‹å®‰å…¨çš„å±æ€§è®¾ç½®
  if (typeof data.name === 'string') {
    Reflect.set(user, 'name', data.name);
  }

  if (typeof data.age === 'number') {
    Reflect.set(user, 'age', data.age);
  }

  return user;
}

// ç±»å‹æ£€æŸ¥
function validateUser(user: any): user is User {
  return (
    Reflect.has(user, 'name') && typeof Reflect.get(user, 'name') === 'string' &&
    Reflect.has(user, 'age') && typeof Reflect.get(user, 'age') === 'number'
  );
}

const user = createUser({ name: 'Alice', age: 25 });
console.log(validateUser(user)); // true
`.trim()
</script>

<style scoped lang="less">
.reflect-docs {
  max-width: 1000px;
  margin: 0 auto;
  padding: 1rem;
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  line-height: 1.5;
  color: #2c3e50;
  background: #f8f9fa;
  min-height: 100vh;
}

.docs-header {
  text-align: center;
  margin-bottom: 1.5rem;
  padding: 1.5rem;
  background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
  border-radius: 8px;
  color: white;
  box-shadow: 0 2px 10px rgba(79, 70, 229, 0.2);

  h1 {
    font-size: 2rem;
    font-weight: 700;
    margin: 0 0 0.25rem 0;
    color: white;
  }

  .subtitle {
    font-size: 1rem;
    opacity: 0.9;
    margin: 0;
    font-weight: 400;
  }
}

.content-wrapper {
  display: grid;
  gap: 1rem;
}

.method-card {
  background: white;
  border-radius: 8px;
  padding: 1.5rem;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  border: 1px solid #e5e7eb;
  transition: all 0.2s ease;

  &:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  }

  &.highlight {
    border: 2px solid #4f46e5;
    background: linear-gradient(135deg, #f8faff 0%, #f0f4ff 100%);
  }

  h2 {
    color: #1f2937;
    font-size: 1.5rem;
    font-weight: 600;
    margin: 0 0 1rem 0;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid #e5e7eb;
  }

  h3 {
    color: #374151;
    font-size: 1.1rem;
    font-weight: 600;
    margin: 1rem 0 0.5rem 0;
  }

  h4 {
    color: #6b7280;
    font-size: 1rem;
    font-weight: 500;
    margin: 0.75rem 0 0.25rem 0;
  }
}

.info-box {
  background: linear-gradient(135deg, #f8faff 0%, #f0f4ff 100%);
  padding: 1rem;
  border-radius: 6px;
  border-left: 3px solid #4f46e5;
  margin-bottom: 1rem;

  h3 {
    color: #1f2937;
    margin-top: 0;
    font-size: 1.1rem;
  }

  ol, ul {
    margin: 0.75rem 0;
    padding-left: 1.25rem;

    li {
      margin-bottom: 0.25rem;
      line-height: 1.5;
      font-size: 0.95rem;
    }
  }
}

.method-item {
  margin-bottom: 1.5rem;
  padding: 1rem;
  background: #f9fafb;
  border-radius: 6px;
  border: 1px solid #e5e7eb;

  &:last-child {
    margin-bottom: 0;
  }

  .method-desc {
    color: #6b7280;
    font-style: italic;
    margin-bottom: 0.75rem;
    padding: 0.5rem;
    background: #f3f4f6;
    border-radius: 4px;
    font-size: 0.9rem;
  }
}

.use-case {
  background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
  padding: 0.75rem;
  border-radius: 6px;
  margin: 0.75rem 0;
  border-left: 3px solid #f59e0b;

  &.warning {
    background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
    border-left-color: #ef4444;
  }

  ul {
    margin: 0.5rem 0;
    padding-left: 1.25rem;

    li {
      margin-bottom: 0.25rem;
      font-size: 0.9rem;
    }
  }
}

.problems-grid,
.use-cases-grid,
.practice-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 1rem;
  margin-top: 1rem;
}

.problem-item,
.use-case-item,
.practice-item {
  background: white;
  padding: 1rem;
  border-radius: 6px;
  border: 1px solid #e5e7eb;
  transition: transform 0.2s ease;

  &:hover {
    transform: translateY(-1px);
  }

  h3 {
    color: #1f2937;
    margin-top: 0;
    font-size: 1.1rem;
  }

  p {
    color: #6b7280;
    margin-bottom: 0.75rem;
    font-size: 0.9rem;
  }
}

.comparison-table {
  overflow-x: auto;
  margin-top: 1rem;
  border-radius: 6px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);

  table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    font-size: 0.85rem;

    th, td {
      padding: 0.75rem 1rem;
      text-align: left;
      border-bottom: 1px solid #e5e7eb;
    }

    th {
      background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
      color: white;
      font-weight: 600;
      position: sticky;
      top: 0;
      font-size: 0.8rem;
    }

    tr {
      transition: background-color 0.2s ease;

      &:hover {
        background: #f8faff;
      }

      &:nth-child(even) {
        background: #f9fafb;
      }
    }

    code {
      background: #f1f5f9;
      padding: 2px 4px;
      border-radius: 3px;
      font-family: 'Fira Code', 'Consolas', monospace;
      font-size: 0.8rem;
    }
  }
}

.performance-info {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 1rem;

  .perf-item {
    background: white;
    padding: 1rem;
    border-radius: 6px;
    border: 1px solid #e5e7eb;

    h3 {
      color: #1f2937;
      margin-top: 0;
      font-size: 1.1rem;
    }

    ul {
      margin: 0.5rem 0;
      padding-left: 1.25rem;

      li {
        margin-bottom: 0.25rem;
        color: #6b7280;
        font-size: 0.9rem;
      }
    }
  }
}

// å“åº”å¼è®¾è®¡
@media (max-width: 768px) {
  .reflect-docs {
    padding: 0.75rem;
  }

  .docs-header {
    padding: 1rem;

    h1 {
      font-size: 1.75rem;
    }
  }

  .method-card {
    padding: 1rem;
  }

  .problems-grid,
  .use-cases-grid,
  .practice-grid {
    grid-template-columns: 1fr;
  }

  .comparison-table {
    font-size: 0.75rem;

    th, td {
      padding: 0.5rem 0.75rem;
    }
  }
}

// ä»£ç å—æ ·å¼ä¼˜åŒ–
:deep(.code-block) {
  margin: 0.75rem 0;
  border-radius: 6px;
  overflow: hidden;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  font-size: 0.85rem;
}

// å¯¼èˆªæ ·å¼
.toc {
  position: sticky;
  z-index: 10;
  margin-bottom: 1.5rem;
  width: 200px;
}

// ç´§å‡‘çš„é—´è·
p {
  margin: 0.5rem 0;
  font-size: 0.95rem;
}

// æ›´å¥½çš„è§†è§‰å±‚æ¬¡
strong {
  color: #1f2937;
  font-weight: 600;
}

// ä»£ç é«˜äº®
code {
  background: #f1f5f9;
  padding: 2px 4px;
  border-radius: 3px;
  font-family: 'Fira Code', 'Consolas', monospace;
  font-size: 0.85rem;
  color: #dc2626;
}
</style>
