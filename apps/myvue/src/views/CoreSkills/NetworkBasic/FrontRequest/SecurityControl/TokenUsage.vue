<template>
  <div class="token-container">
    <header class="header">
      <h1>å‰ç«¯TokenåŸºæœ¬ä»‹ç»</h1>
      <p class="subtitle">ç°ä»£Webåº”ç”¨èº«ä»½éªŒè¯çš„æ ¸å¿ƒæœºåˆ¶</p>
    </header>

    <div class="content-wrapper">
      <main class="main-content">
        <section class="section">
          <h2>TokenåŸºæœ¬æ¦‚å¿µ</h2>
          <div class="concept-grid">
            <div class="concept-card">
              <div class="concept-icon">ğŸ”‘</div>
              <h3>ä»€ä¹ˆæ˜¯Token</h3>
              <p>Tokenæ˜¯æœåŠ¡å™¨ç”Ÿæˆçš„åŠ å¯†å­—ç¬¦ä¸²ï¼Œç”¨äºéªŒè¯ç”¨æˆ·èº«ä»½å’Œæƒé™ã€‚å®ƒå–ä»£äº†ä¼ ç»Ÿçš„Sessionæœºåˆ¶ï¼Œæˆä¸ºç°ä»£Webåº”ç”¨çš„æ ‡å‡†èº«ä»½éªŒè¯æ–¹å¼ã€‚</p>
            </div>
            <div class="concept-card">
              <div class="concept-icon">ğŸ”„</div>
              <h3>ä¸ºä»€ä¹ˆä½¿ç”¨Token</h3>
              <ul>
                <li>æ— çŠ¶æ€ï¼šæœåŠ¡å™¨ä¸éœ€è¦å­˜å‚¨ä¼šè¯ä¿¡æ¯</li>
                <li>è·¨åŸŸæ”¯æŒï¼šé€‚ç”¨äºå¾®æœåŠ¡å’Œåˆ†å¸ƒå¼ç³»ç»Ÿ</li>
                <li>å®‰å…¨æ€§ï¼šå‡å°‘CSRFæ”»å‡»é£é™©</li>
                <li>å¯æ‰©å±•æ€§ï¼šé€‚ç”¨äºç§»åŠ¨åº”ç”¨å’ŒAPI</li>
              </ul>
            </div>
          </div>
        </section>

        <div class="columns-container">
          <section class="section">
            <h2>Tokenæ ¸å¿ƒç»„æˆ</h2>
            <div class="composition-container">
              <div class="composition-item">
                <h3>Header</h3>
                <p>åŒ…å«ä»¤ç‰Œç±»å‹å’Œç­¾åç®—æ³•</p>
                <pre>{
  "alg": "HS256",
  "typ": "JWT"
}</pre>
              </div>
              <div class="composition-item">
                <h3>Payload</h3>
                <p>åŒ…å«å£°æ˜ï¼ˆç”¨æˆ·ä¿¡æ¯ã€æƒé™ç­‰ï¼‰</p>
                <pre>{
  "sub": "1234567890",
  "name": "John Doe",
  "admin": true,
  "exp": 1620000000
}</pre>
              </div>
              <div class="composition-item">
                <h3>Signature</h3>
                <p>ä½¿ç”¨å¯†é’¥å¯¹ç¼–ç åçš„Headerå’ŒPayloadè¿›è¡Œç­¾å</p>
                <pre>HMACSHA256(
  base64UrlEncode(header) + "." +
  base64UrlEncode(payload),
  secret
)</pre>
              </div>
            </div>
          </section>

          <section class="section">
            <h2>Tokenä½¿ç”¨æµç¨‹</h2>
            <div class="workflow">
              <div class="step">
                <div class="step-icon">1</div>
                <div class="step-content">
                  <h3>ç”¨æˆ·ç™»å½•</h3>
                  <p>å®¢æˆ·ç«¯å‘é€å‡­æ®ï¼ˆç”¨æˆ·å/å¯†ç ï¼‰åˆ°è®¤è¯æœåŠ¡å™¨</p>
                </div>
              </div>
              <div class="step">
                <div class="step-icon">2</div>
                <div class="step-content">
                  <h3>ç”ŸæˆToken</h3>
                  <p>æœåŠ¡å™¨éªŒè¯å‡­æ®ï¼Œç”ŸæˆTokenå¹¶è¿”å›ç»™å®¢æˆ·ç«¯</p>
                </div>
              </div>
              <div class="step">
                <div class="step-icon">3</div>
                <div class="step-content">
                  <h3>å­˜å‚¨Token</h3>
                  <p>å®¢æˆ·ç«¯å­˜å‚¨Tokenï¼ˆCookieã€LocalStorageç­‰ï¼‰</p>
                </div>
              </div>
              <div class="step">
                <div class="step-icon">4</div>
                <div class="step-content">
                  <h3>å‘é€è¯·æ±‚</h3>
                  <p>å®¢æˆ·ç«¯åœ¨è¯·æ±‚å¤´ä¸­åŒ…å«Tokenï¼ˆé€šå¸¸ä¸ºAuthorizationå¤´ï¼‰</p>
                </div>
              </div>
              <div class="step">
                <div class="step-icon">5</div>
                <div class="step-content">
                  <h3>éªŒè¯Token</h3>
                  <p>æœåŠ¡å™¨éªŒè¯Tokenæœ‰æ•ˆæ€§å¹¶å¤„ç†è¯·æ±‚</p>
                </div>
              </div>
            </div>
          </section>
        </div>

        <section class="section">
          <h2>å¸¸è§Tokenç±»å‹</h2>
          <div class="token-types">
            <div class="type-card">
              <div class="type-header">
                <div class="type-icon">ğŸ”</div>
                <h3>JWT (JSON Web Token)</h3>
              </div>
              <div class="type-content">
                <p>è‡ªåŒ…å«çš„JSONå¯¹è±¡ï¼ŒåŒ…å«Headerã€Payloadå’ŒSignatureä¸‰éƒ¨åˆ†</p>
                <ul>
                  <li><strong>ä¼˜ç‚¹ï¼š</strong>æ ‡å‡†åŒ–ã€è‡ªåŒ…å«ã€æ˜“äºéªŒè¯</li>
                  <li><strong>ç¼ºç‚¹ï¼š</strong>æ— æ³•æ’¤é”€ã€å¤§å°è¾ƒå¤§</li>
                </ul>
              </div>
            </div>

            <div class="type-card">
              <div class="type-header">
                <div class="type-icon">ğŸ”„</div>
                <h3>OAuth 2.0 Tokens</h3>
              </div>
              <div class="type-content">
                <p>æˆæƒæ¡†æ¶ï¼ŒåŒ…å«å¤šç§ä»¤ç‰Œç±»å‹ï¼š</p>
                <ul>
                  <li><strong>Access Tokenï¼š</strong>è®¿é—®èµ„æº</li>
                  <li><strong>Refresh Tokenï¼š</strong>è·å–æ–°Access Token</li>
                  <li><strong>ID Tokenï¼š</strong>ç”¨æˆ·èº«ä»½ä¿¡æ¯ï¼ˆOpenID Connectï¼‰</li>
                </ul>
              </div>
            </div>

            <div class="type-card">
              <div class="type-header">
                <div class="type-icon">ğŸ”’</div>
                <h3>Session Tokens</h3>
              </div>
              <div class="type-content">
                <p>ä¼ ç»Ÿä¼šè¯æ ‡è¯†ç¬¦ï¼Œé€šå¸¸å­˜å‚¨åœ¨Cookieä¸­</p>
                <ul>
                  <li><strong>ä¼˜ç‚¹ï¼š</strong>æµè§ˆå™¨è‡ªåŠ¨ç®¡ç†</li>
                  <li><strong>ç¼ºç‚¹ï¼š</strong>CSRFé£é™©ã€æœåŠ¡å™¨çŠ¶æ€</li>
                </ul>
              </div>
            </div>

            <div class="type-card">
              <div class="type-header">
                <div class="type-icon">ğŸ”‘</div>
                <h3>API Keys</h3>
              </div>
              <div class="type-content">
                <p>ç®€å•çš„é™æ€ä»¤ç‰Œï¼Œç”¨äºAPIè®¤è¯</p>
                <ul>
                  <li><strong>ä¼˜ç‚¹ï¼š</strong>ç®€å•æ˜“ç”¨</li>
                  <li><strong>ç¼ºç‚¹ï¼š</strong>å®‰å…¨æ€§ä½ã€éš¾ä»¥æ’¤é”€</li>
                </ul>
              </div>
            </div>
          </div>
        </section>
      </main>

      <aside class="sidebar">
        <div class="storage-card">
          <h3>Tokenå­˜å‚¨æ–¹å¼</h3>
          <div class="storage-option">
            <h4>HttpOnly Cookies</h4>
            <p>æœ€å®‰å…¨ï¼Œé˜²æ­¢XSSæ”»å‡»ï¼Œä½†å¯èƒ½å—CSRFæ”»å‡»</p>
          </div>
          <div class="storage-option">
            <h4>LocalStorage</h4>
            <p>æ˜“äºè®¿é—®ï¼Œä½†æ˜“å—XSSæ”»å‡»</p>
          </div>
          <div class="storage-option">
            <h4>SessionStorage</h4>
            <p>ä¼šè¯çº§å­˜å‚¨ï¼Œå…³é—­æµè§ˆå™¨åå¤±æ•ˆ</p>
          </div>
          <div class="storage-option">
            <h4>Memory</h4>
            <p>æœ€å®‰å…¨ä½†åˆ·æ–°é¡µé¢åå¤±æ•ˆ</p>
          </div>
        </div>

        <div class="security-card">
          <h3>å®‰å…¨æœ€ä½³å®è·µ</h3>
          <ul class="security-list">
            <li>ä½¿ç”¨HTTPSä¼ è¾“Token</li>
            <li>è®¾ç½®åˆç†çš„Tokenè¿‡æœŸæ—¶é—´</li>
            <li>å¯¹æ•æ„Ÿæ“ä½œä½¿ç”¨äºŒæ¬¡éªŒè¯</li>
            <li>ä½¿ç”¨Refresh Tokenè½®æ¢Access Token</li>
            <li>å®æ–½Tokenæ’¤é”€æœºåˆ¶</li>
            <li>è®¾ç½®é€‚å½“çš„CORSç­–ç•¥</li>
            <li>ä½¿ç”¨Content Security Policy (CSP)</li>
          </ul>
        </div>

        <div class="comparison-card">
          <h3>Token vs Session</h3>
          <table>
            <thead>
              <tr>
                <th>ç‰¹æ€§</th>
                <th>Token</th>
                <th>Session</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>çŠ¶æ€</td>
                <td>æ— çŠ¶æ€</td>
                <td>æœ‰çŠ¶æ€</td>
              </tr>
              <tr>
                <td>å­˜å‚¨ä½ç½®</td>
                <td>å®¢æˆ·ç«¯</td>
                <td>æœåŠ¡å™¨</td>
              </tr>
              <tr>
                <td>è·¨åŸŸæ”¯æŒ</td>
                <td>âœ… æ”¯æŒ</td>
                <td>âŒ æœ‰é™</td>
              </tr>
              <tr>
                <td>CSRFé£é™©</td>
                <td>ä½</td>
                <td>é«˜</td>
              </tr>
              <tr>
                <td>æ‰©å±•æ€§</td>
                <td>é«˜</td>
                <td>ä½</td>
              </tr>
              <tr>
                <td>ç§»åŠ¨ç«¯æ”¯æŒ</td>
                <td>âœ… ä¼˜ç§€</td>
                <td>âŒ æœ‰é™</td>
              </tr>
            </tbody>
          </table>
        </div>
      </aside>
    </div>

    <section class="section">
      <h2>Tokenä½¿ç”¨åœºæ™¯</h2>
      <div class="use-cases">
        <div class="use-case-card">
          <div class="case-icon">ğŸ‘¤</div>
          <h3>ç”¨æˆ·è®¤è¯</h3>
          <p>ç™»å½•åè·å–Tokenï¼Œç”¨äºåç»­è¯·æ±‚çš„èº«ä»½éªŒè¯</p>
        </div>
        <div class="use-case-card">
          <div class="case-icon">ğŸ”</div>
          <h3>APIè®¿é—®æ§åˆ¶</h3>
          <p>ä¿æŠ¤APIç«¯ç‚¹ï¼Œåªå…è®¸æŒæœ‰æœ‰æ•ˆTokençš„è¯·æ±‚è®¿é—®</p>
        </div>
        <div class="use-case-card">
          <div class="case-icon">ğŸ”„</div>
          <h3>å•ç‚¹ç™»å½•(SSO)</h3>
          <p>åœ¨å¤šä¸ªç›¸å…³ç³»ç»Ÿé—´å…±äº«è®¤è¯çŠ¶æ€</p>
        </div>
        <div class="use-case-card">
          <div class="case-icon">ğŸ“±</div>
          <h3>ç§»åŠ¨åº”ç”¨è®¤è¯</h3>
          <p>é€‚ç”¨äºåŸç”Ÿç§»åŠ¨åº”ç”¨ä¸åç«¯çš„é€šä¿¡</p>
        </div>
        <div class="use-case-card">
          <div class="case-icon">ğŸŒ</div>
          <h3>ç¬¬ä¸‰æ–¹æˆæƒ</h3>
          <p>OAuthæµç¨‹ä¸­æˆæƒç¬¬ä¸‰æ–¹åº”ç”¨è®¿é—®ç”¨æˆ·èµ„æº</p>
        </div>
        <div class="use-case-card">
          <div class="case-icon">ğŸ”—</div>
          <h3>æ— å¯†ç ç™»å½•</h3>
          <p>é€šè¿‡é‚®ä»¶/çŸ­ä¿¡å‘é€ä¸€æ¬¡æ€§Tokenå®ç°ç™»å½•</p>
        </div>
      </div>
    </section>

    <section class="section">
      <h2>å‰ç«¯Tokenå¤„ç†ç¤ºä¾‹</h2>
      <div class="code-examples">
        <div class="code-block">
          <h3>å­˜å‚¨Token</h3>
          <pre>// å­˜å‚¨åˆ°localStorage
localStorage.setItem('auth_token', token);

// å­˜å‚¨åˆ°cookieï¼ˆæ¨èHttpOnlyï¼‰
document.cookie = `auth_token=${token}; Secure; HttpOnly; SameSite=Strict;`;</pre>
        </div>

        <div class="code-block">
          <h3>å‘é€è¯·æ±‚</h3>
          <pre>// ä½¿ç”¨Axioså‘é€å¸¦Tokençš„è¯·æ±‚
axios.get('/api/protected', {
  headers: {
    Authorization: `Bearer ${token}`
  }
});</pre>
        </div>

        <div class="code-block">
          <h3>å¤„ç†Tokenè¿‡æœŸ</h3>
          <pre>// ä½¿ç”¨Axiosæ‹¦æˆªå™¨å¤„ç†401é”™è¯¯
axios.interceptors.response.use(
  response => response,
  error => {
    if (error.response.status === 401) {
      // åˆ·æ–°Tokenæˆ–é‡å®šå‘åˆ°ç™»å½•
      refreshTokenOrRedirect();
    }
    return Promise.reject(error);
  }
);</pre>
        </div>
      </div>
    </section>

    <footer class="footer">
      <p>Tokenæ˜¯ç°ä»£Webåº”ç”¨å®‰å…¨æ¶æ„çš„æ ¸å¿ƒç»„ä»¶ï¼Œæ­£ç¡®å®ç°Tokenæœºåˆ¶å¯ä»¥æ˜¾è‘—æå‡åº”ç”¨çš„å®‰å…¨æ€§å’Œç”¨æˆ·ä½“éªŒ</p>
    </footer>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue';

// ç¤ºä¾‹æ•°æ®
const tokenLifespans = ref([
  { type: 'Access Token', duration: '15-30åˆ†é’Ÿ', purpose: 'çŸ­æœŸèµ„æºè®¿é—®' },
  { type: 'Refresh Token', duration: '7-30å¤©', purpose: 'è·å–æ–°Access Token' },
  { type: 'ID Token', duration: 'ä¸Access Tokenç›¸åŒ', purpose: 'ä¼ é€’ç”¨æˆ·èº«ä»½ä¿¡æ¯' }
]);

const securityThreats = ref([
  { threat: 'XSSæ”»å‡»', risk: 'é«˜', prevention: 'ä½¿ç”¨HttpOnly Cookie, CSP' },
  { threat: 'CSRFæ”»å‡»', risk: 'ä¸­', prevention: 'SameSite Cookie, CSRF Token' },
  { threat: 'Tokenç›—çªƒ', risk: 'é«˜', prevention: 'HTTPS, çŸ­æœ‰æ•ˆæœŸ, Refresh Tokenè½®æ¢' },
  { threat: 'Tokené‡æ”¾', risk: 'ä¸­', prevention: 'JTIå£°æ˜, çŸ­æœŸæœ‰æ•ˆ' }
]);
</script>

<style lang="less" scoped>
@primary-color: #4285f4;
@secondary-color: #34a853;
@accent-color: #ea4335;
@warning-color: #fbbc05;
@text-color: #202124;
@light-bg: #f8f9fa;
@border-color: #dadce0;
@card-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

.token-container {
  font-family: 'Google Sans', Roboto, Arial, sans-serif;
  max-width: 1400px;
  margin: 0 auto;
  padding: 20px;
  color: @text-color;
  background-color: #fff;
  line-height: 1.6;
}

.header {
  text-align: center;
  margin-bottom: 30px;
  padding-bottom: 20px;
  border-bottom: 1px solid @border-color;

  h1 {
    color: @primary-color;
    font-size: 2.5rem;
    margin-bottom: 10px;
  }

  .subtitle {
    font-size: 1.2rem;
    color: #5f6368;
  }
}

.content-wrapper {
  display: flex;
  gap: 25px;
  margin-bottom: 30px;
}

.main-content {
  flex: 3;
}

.sidebar {
  flex: 1;
  min-width: 300px;
}

.section {
  background: @light-bg;
  border-radius: 8px;
  padding: 25px;
  margin-bottom: 25px;
  box-shadow: @card-shadow;

  h2 {
    color: @primary-color;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 2px solid fade(@primary-color, 20%);
    font-size: 1.8rem;
  }
}

.concept-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
}

.concept-card {
  background: white;
  border-radius: 8px;
  padding: 20px;
  box-shadow: @card-shadow;
  border-left: 4px solid @primary-color;

  .concept-icon {
    font-size: 2.5rem;
    margin-bottom: 15px;
  }

  h3 {
    color: @primary-color;
    margin-bottom: 15px;
    font-size: 1.4rem;
  }

  p,
  ul {
    line-height: 1.7;
  }

  ul {
    padding-left: 20px;

    li {
      margin-bottom: 8px;
    }
  }
}

.columns-container {
  display: flex;
  gap: 20px;

  &>.section {
    flex: 1;
  }
}

.composition-container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 15px;
}

.composition-item {
  background: white;
  border-radius: 8px;
  padding: 15px;
  box-shadow: @card-shadow;

  h3 {
    color: @secondary-color;
    margin-bottom: 10px;
  }

  pre {
    background: #f1f3f4;
    padding: 12px;
    border-radius: 6px;
    overflow-x: auto;
    font-size: 0.9rem;
    margin-top: 10px;
    line-height: 1.5;
  }
}

.workflow {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.step {
  display: flex;
  gap: 15px;
  align-items: flex-start;

  .step-icon {
    background: @primary-color;
    color: white;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    font-weight: bold;
    margin-top: 3px;
  }

  .step-content {
    h3 {
      color: @primary-color;
      margin-bottom: 5px;
    }

    p {
      color: #5f6368;
    }
  }
}

.token-types {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
}

.type-card {
  background: white;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: @card-shadow;

  .type-header {
    display: flex;
    align-items: center;
    padding: 15px 20px;
    background: fade(@primary-color, 8%);
    border-bottom: 1px solid @border-color;

    .type-icon {
      font-size: 1.8rem;
      margin-right: 12px;
    }

    h3 {
      color: @primary-color;
      font-size: 1.3rem;
    }
  }

  .type-content {
    padding: 20px;

    ul {
      padding-left: 20px;
      margin-top: 10px;

      li {
        margin-bottom: 8px;
        line-height: 1.5;
      }
    }
  }
}

.storage-card,
.security-card,
.comparison-card {
  background: white;
  border-radius: 8px;
  padding: 20px;
  margin-bottom: 25px;
  box-shadow: @card-shadow;

  h3 {
    color: @primary-color;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 1px solid @border-color;
  }
}

.storage-option {
  padding: 12px 0;
  border-bottom: 1px solid fade(@border-color, 50%);

  &:last-child {
    border-bottom: none;
  }

  h4 {
    color: @secondary-color;
    margin-bottom: 5px;
  }
}

.security-list {
  list-style: none;

  li {
    padding: 10px 0;
    border-bottom: 1px solid fade(@border-color, 30%);
    display: flex;
    align-items: center;

    &:before {
      content: "âœ“";
      color: @secondary-color;
      font-weight: bold;
      margin-right: 10px;
    }

    &:last-child {
      border-bottom: none;
    }
  }
}

table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.95rem;

  th,
  td {
    padding: 12px 15px;
    text-align: left;
    border-bottom: 1px solid @border-color;
  }

  th {
    background-color: fade(@primary-color, 8%);
    font-weight: 500;
  }

  tr:last-child td {
    border-bottom: none;
  }

  tr:nth-child(even) {
    background-color: #f8f9fa;
  }
}

.use-cases {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 20px;
}

.use-case-card {
  background: white;
  border-radius: 8px;
  padding: 20px;
  text-align: center;
  box-shadow: @card-shadow;
  transition: transform 0.3s ease;

  &:hover {
    transform: translateY(-5px);
  }

  .case-icon {
    font-size: 2.5rem;
    margin-bottom: 15px;
    color: @primary-color;
  }

  h3 {
    color: @primary-color;
    margin-bottom: 10px;
  }
}

.code-examples {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
}

.code-block {
  background: #2d2d2d;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: @card-shadow;

  h3 {
    background: #3d3d3d;
    color: #f8f8f2;
    padding: 12px 15px;
    font-size: 1.1rem;
    margin: 0;
  }

  pre {
    padding: 15px;
    color: #f8f8f2;
    overflow-x: auto;
    font-family: 'Fira Code', monospace;
    font-size: 0.9rem;
    line-height: 1.5;
  }
}

.footer {
  text-align: center;
  margin-top: 40px;
  padding-top: 20px;
  border-top: 1px solid @border-color;
  color: #5f6368;
  font-style: italic;
}

@media (max-width: 1100px) {
  .content-wrapper {
    flex-direction: column;
  }

  .columns-container {
    flex-direction: column;
  }
}

@media (max-width: 768px) {

  .concept-grid,
  .composition-container,
  .token-types,
  .use-cases,
  .code-examples {
    grid-template-columns: 1fr;
  }
}
</style>
