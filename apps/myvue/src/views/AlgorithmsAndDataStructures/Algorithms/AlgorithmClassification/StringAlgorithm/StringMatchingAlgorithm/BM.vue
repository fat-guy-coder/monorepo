<template>
  <div class="bm-container">
    <header class="header">
      <div class="title-container">
        <h1 class="title">Boyer-Moore å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•</h1>
        <div class="subtitle">é«˜æ•ˆçš„å­—ç¬¦ä¸²æœç´¢ç®—æ³•</div>
      </div>
      <div class="algorithm-info">
        <div class="info-item">
          <div class="info-label">æ—¶é—´å¤æ‚åº¦</div>
          <div class="info-value">O(n/m) (å¹³å‡)</div>
        </div>
        <div class="info-item">
          <div class="info-label">ç©ºé—´å¤æ‚åº¦</div>
          <div class="info-value">O(m)</div>
        </div>
        <div class="info-item">
          <div class="info-label">å‘æ˜å¹´ä»½</div>
          <div class="info-value">1977</div>
        </div>
      </div>
    </header>

    <div class="content-wrapper">
      <!-- å·¦ä¾§å†…å®¹åŒº -->
      <div class="content-left">
        <section class="card">
          <h2 class="card-title">ç®—æ³•ä»‹ç»</h2>
          <p>
            Boyer-Mooreç®—æ³•ç”±Robert S. Boyerå’ŒJ Strother
            Mooreäº1977å¹´å‘æ˜ï¼Œæ˜¯ä¸€ç§é«˜æ•ˆçš„å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•ã€‚
          </p>
          <p>
            è¯¥ç®—æ³•é‡‡ç”¨å¯å‘å¼è§„åˆ™ä»å³å‘å·¦æ¯”è¾ƒå­—ç¬¦ï¼Œå½“å‡ºç°ä¸åŒ¹é…æ—¶ï¼Œåˆ©ç”¨<b class="highlight"
              >åå­—ç¬¦è§„åˆ™</b
            >å’Œ<b class="highlight">å¥½åç¼€è§„åˆ™</b>è·³è¿‡å¤§é‡ä¸å¿…è¦çš„æ¯”è¾ƒï¼Œä»è€Œæ˜¾è‘—æé«˜åŒ¹é…æ•ˆç‡ã€‚
          </p>

          <div class="features">
            <div class="feature">
              <div class="feature-icon">ğŸš€</div>
              <div class="feature-content">
                <h3>é«˜æ•ˆæ€§</h3>
                <p>å®é™…åº”ç”¨ä¸­æ¯”å…¶ä»–ç®—æ³•æ›´å¿«</p>
              </div>
            </div>
            <div class="feature">
              <div class="feature-icon">ğŸ§ </div>
              <div class="feature-content">
                <h3>å¯å‘å¼è§„åˆ™</h3>
                <p>åˆ©ç”¨åå­—ç¬¦å’Œå¥½åç¼€è§„åˆ™</p>
              </div>
            </div>
            <div class="feature">
              <div class="feature-icon">ğŸ”</div>
              <div class="feature-content">
                <h3>é€†å‘æ¯”è¾ƒ</h3>
                <p>ä»æ¨¡å¼ä¸²å°¾éƒ¨å¼€å§‹æ¯”è¾ƒ</p>
              </div>
            </div>
          </div>
        </section>

        <section class="card">
          <h2 class="card-title">æ ¸å¿ƒè§„åˆ™</h2>
          <div class="rules">
            <div class="rule">
              <div class="rule-header">
                <div class="rule-icon">â—</div>
                <h3>åå­—ç¬¦è§„åˆ™ (Bad Character Rule)</h3>
              </div>
              <div class="rule-content">
                <p>å½“æ–‡æœ¬ä¸æ¨¡å¼ä¸²ä¸åŒ¹é…æ—¶ï¼š</p>
                <ol>
                  <li>å°†æ–‡æœ¬ä¸­å¯¼è‡´ä¸åŒ¹é…çš„å­—ç¬¦ç§°ä¸º<b>åå­—ç¬¦</b></li>
                  <li>åœ¨æ¨¡å¼ä¸²ä¸­æŸ¥æ‰¾è¯¥åå­—ç¬¦æœ€åå‡ºç°çš„ä½ç½®</li>
                  <li>å°†æ¨¡å¼ä¸²ç§»åŠ¨åˆ°ä½¿åå­—ç¬¦å¯¹é½çš„ä½ç½®</li>
                </ol>
                <div class="rule-formula">ç§»åŠ¨è·ç¦» = åå­—ç¬¦ä½ç½® - æ¨¡å¼ä¸²ä¸­è¯¥å­—ç¬¦æœ€åå‡ºç°çš„ä½ç½®</div>
              </div>
            </div>

            <div class="rule">
              <div class="rule-header">
                <div class="rule-icon">âœ…</div>
                <h3>å¥½åç¼€è§„åˆ™ (Good Suffix Rule)</h3>
              </div>
              <div class="rule-content">
                <p>å½“å‘ç°éƒ¨åˆ†åŒ¹é…çš„åç¼€æ—¶ï¼š</p>
                <ol>
                  <li>å°†åŒ¹é…çš„åç¼€ç§°ä¸º<b>å¥½åç¼€</b></li>
                  <li>åœ¨æ¨¡å¼ä¸²ä¸­æŸ¥æ‰¾è¯¥å¥½åç¼€å‡ºç°çš„å…¶ä»–ä½ç½®</li>
                  <li>å°†æ¨¡å¼ä¸²ç§»åŠ¨åˆ°ä½¿å¥½åç¼€å¯¹é½çš„ä½ç½®</li>
                </ol>
                <div class="rule-formula">ç§»åŠ¨è·ç¦» = å¥½åç¼€ä½ç½® - æ¨¡å¼ä¸²ä¸­è¯¥åç¼€æœ€åå‡ºç°çš„ä½ç½®</div>
              </div>
            </div>
          </div>
        </section>

        <section class="card">
          <h2 class="card-title">ç®—æ³•æ­¥éª¤</h2>
          <div class="steps">
            <div class="step">
              <div class="step-number">1</div>
              <div class="step-content">
                <h3>é¢„å¤„ç†</h3>
                <p>æ„å»ºåå­—ç¬¦è¡¨å’Œå¥½åç¼€è¡¨</p>
              </div>
            </div>
            <div class="step">
              <div class="step-number">2</div>
              <div class="step-content">
                <h3>å¯¹é½</h3>
                <p>å°†æ¨¡å¼ä¸²ä¸æ–‡æœ¬èµ·å§‹ä½ç½®å¯¹é½</p>
              </div>
            </div>
            <div class="step">
              <div class="step-number">3</div>
              <div class="step-content">
                <h3>æ¯”è¾ƒ</h3>
                <p>ä»å³å‘å·¦æ¯”è¾ƒå­—ç¬¦</p>
              </div>
            </div>
            <div class="step">
              <div class="step-number">4</div>
              <div class="step-content">
                <h3>åŒ¹é…åˆ¤æ–­</h3>
                <p>è‹¥å…¨éƒ¨åŒ¹é…ï¼Œè®°å½•ä½ç½®</p>
              </div>
            </div>
            <div class="step">
              <div class="step-number">5</div>
              <div class="step-content">
                <h3>å¤„ç†ä¸åŒ¹é…</h3>
                <p>æ ¹æ®è§„åˆ™è®¡ç®—ç§»åŠ¨è·ç¦»</p>
              </div>
            </div>
            <div class="step">
              <div class="step-number">6</div>
              <div class="step-content">
                <h3>ç§»åŠ¨æ¨¡å¼ä¸²</h3>
                <p>ç§»åŠ¨æ¨¡å¼ä¸²å¹¶é‡å¤è¿‡ç¨‹</p>
              </div>
            </div>
          </div>
        </section>
      </div>

      <!-- å³ä¾§æ¼”ç¤ºåŒº -->
      <div class="content-right">
        <div class="demo-card">
          <h2 class="card-title">åŠ¨æ€æ¼”ç¤º</h2>
          <div class="demo-container">
            <div class="controls">
              <div class="input-group">
                <label>æ–‡æœ¬ä¸²:</label>
                <input v-model="text" type="text" maxlength="40" />
              </div>
              <div class="input-group">
                <label>æ¨¡å¼ä¸²:</label>
                <input v-model="pattern" type="text" maxlength="15" />
              </div>
              <div class="control-buttons">
                <button @click="startAnimation" :disabled="isAnimating">â–¶ï¸ å¼€å§‹</button>
                <button @click="pauseAnimation" :disabled="!isAnimating">â¸ï¸ æš‚åœ</button>
                <button @click="resetAnimation">ğŸ”„ é‡ç½®</button>
                <div class="speed-control">
                  <label>é€Ÿåº¦:</label>
                  <input type="range" min="1" max="10" v-model="speed" />
                </div>
              </div>
            </div>

            <div class="canvas-container">
              <canvas ref="canvas" width="700" height="350"></canvas>
            </div>

            <div class="status">
              <div class="status-item">
                <span class="status-label">çŠ¶æ€:</span>
                <span :class="['status-value', statusClass]">{{ statusText }}</span>
              </div>
              <div class="status-item">
                <span class="status-label">ç§»åŠ¨æ¬¡æ•°:</span>
                <span class="status-value">{{ shiftCount }}</span>
              </div>
              <div class="status-item">
                <span class="status-label">æ¯”è¾ƒæ¬¡æ•°:</span>
                <span class="status-value">{{ compareCount }}</span>
              </div>
              <div class="status-item">
                <span class="status-label">è§„åˆ™åº”ç”¨:</span>
                <span class="status-value">{{ lastRule }}</span>
              </div>
            </div>
          </div>

          <div class="rules-explanation">
            <h3>å½“å‰è§„åˆ™åº”ç”¨</h3>
            <div class="rule-detail" v-if="currentRule === 'bad'">
              <div class="rule-title">åå­—ç¬¦è§„åˆ™:</div>
              <div class="rule-description">
                æ–‡æœ¬ä¸­çš„å­—ç¬¦ <span class="char-highlight">{{ currentBadChar }}</span> åœ¨ä½ç½®
                {{ currentPatternPos }} ä¸åŒ¹é…ï¼Œ æ¨¡å¼ä¸²ä¸­è¯¥å­—ç¬¦æœ€åå‡ºç°åœ¨ä½ç½®
                {{ badCharTable[currentBadChar] ?? -1 }}ï¼Œ ç§»åŠ¨è·ç¦» = {{ currentPatternPos }} - ({{
                  badCharTable[currentBadChar] ?? -1
                }}) = {{ currentShift }}
              </div>
            </div>
            <div class="rule-detail" v-else-if="currentRule === 'good'">
              <div class="rule-title">å¥½åç¼€è§„åˆ™:</div>
              <div class="rule-description">
                å·²åŒ¹é…åç¼€: <span class="char-highlight">{{ currentGoodSuffix }}</span
                >ï¼Œ åœ¨æ¨¡å¼ä¸²ä¸­æœ€åå‡ºç°åœ¨ä½ç½® {{ goodSuffixPos }}ï¼Œ ç§»åŠ¨è·ç¦» = {{ pattern.length }} -
                {{ goodSuffixPos }} - 1 = {{ currentShift }}
              </div>
            </div>
            <div class="rule-detail" v-else>
              <div class="rule-title">ç­‰å¾…å¼€å§‹...</div>
              <div class="rule-description">ç®—æ³•å¼€å§‹åå°†æ˜¾ç¤ºè§„åˆ™åº”ç”¨ç»†èŠ‚</div>
            </div>
          </div>
        </div>

        <div class="code-section">
          <h2 class="card-title">ç®—æ³•å®ç°</h2>
          <div class="tabs">
            <button :class="['tab', { active: activeTab === 'bm' }]" @click="activeTab = 'bm'">
              Boyer-Moore
            </button>
            <button :class="['tab', { active: activeTab === 'bad' }]" @click="activeTab = 'bad'">
              åå­—ç¬¦è¡¨
            </button>
            <button :class="['tab', { active: activeTab === 'good' }]" @click="activeTab = 'good'">
              å¥½åç¼€è¡¨
            </button>
          </div>

          <pre class="code-block" v-if="activeTab === 'bm'">
function boyerMooreSearch(text: string, pattern: string): number {
  const n = text.length;
  const m = pattern.length;

  // æ„å»ºåå­—ç¬¦è¡¨
  const badCharTable = buildBadCharTable(pattern);

  let s = 0; // æ¨¡å¼ä¸²ç›¸å¯¹äºæ–‡æœ¬çš„åç§»

  while (s <= n - m) {
    let j = m - 1;

    // ä»å³å‘å·¦æ¯”è¾ƒå­—ç¬¦
    while (j >= 0 && pattern[j] === text[s + j]) {
      j--;
    }

    // æ‰¾åˆ°åŒ¹é…
    if (j < 0) {
      return s;
    }
    // ä¸åŒ¹é…æ—¶åº”ç”¨åå­—ç¬¦è§„åˆ™
    else {
      const badChar = text[s + j];
      const badCharShift = j - (badCharTable[badChar] ?? -1);
      s += Math.max(1, badCharShift);
    }
  }

  return -1; // æœªæ‰¾åˆ°åŒ¹é…
}</pre
          >

          <pre class="code-block" v-if="activeTab === 'bad'">
// æ„å»ºåå­—ç¬¦è¡¨
function buildBadCharTable(pattern: string): Record&lt;string , number&gt; {
  const table: Record&lt;string, number&gt; = {};
  const m = pattern.length;

  for (let i = 0; i < m - 1; i++) {
    table[pattern[i]] = i;
  }

  return table;
}

// ç¤ºä¾‹: pattern = "EXAMPLE"
// table = {
//   'E': 6,
//   'X': 1,
//   'A': 2,
//   'M': 3,
//   'P': 4,
//   'L': 5
// }</pre
          >

          <pre class="code-block" v-if="activeTab === 'good'">
// æ„å»ºå¥½åç¼€è¡¨
function buildGoodSuffixTable(pattern: string): number[] {
  const m = pattern.length;
  const table = new Array(m).fill(0);

  // åç¼€æŒ‡é’ˆ
  let lastPrefix = m;

  // ä»åå‘å‰éå†
  for (let i = m - 1; i >= 0; i--) {
    if (isPrefix(pattern, i + 1)) {
      lastPrefix = i + 1;
    }
    table[i] = lastPrefix - i + m - 1;
  }

  // å¤„ç†éƒ¨åˆ†åŒ¹é…çš„æƒ…å†µ
  for (let i = 0; i < m - 1; i++) {
    const suffixLen = suffixLength(pattern, i);
    table[suffixLen] = m - 1 - i + suffixLen;
  }

  return table;
}

// åˆ¤æ–­æ˜¯å¦å‰ç¼€åŒ¹é…
function isPrefix(pattern: string, p: number): boolean {
  const m = pattern.length;
  for (let i = p, j = 0; i < m; i++, j++) {
    if (pattern[i] !== pattern[j]) {
      return false;
    }
  }
  return true;
}

// è®¡ç®—åç¼€é•¿åº¦
function suffixLength(pattern: string, p: number): number {
  let len = 0;
  const m = pattern.length;

  for (let i = p, j = m - 1; i >= 0 && pattern[i] === pattern[j]; i--, j--) {
    len += 1;
  }

  return len;
}</pre
          >
        </div>
      </div>
    </div>

    <div class="applications">
      <h2 class="section-title">å®é™…åº”ç”¨</h2>
      <div class="app-grid">
        <div class="app-card">
          <div class="app-icon">ğŸ”</div>
          <h3>æ–‡æœ¬ç¼–è¾‘å™¨</h3>
          <p>ç”¨äºå¿«é€Ÿæœç´¢æ–‡æ¡£å†…å®¹</p>
        </div>
        <div class="app-card">
          <div class="app-icon">ğŸŒ</div>
          <h3>æœç´¢å¼•æ“</h3>
          <p>é«˜æ•ˆæ£€ç´¢å…³é”®è¯</p>
        </div>
        <div class="app-card">
          <div class="app-icon">ğŸ“–</div>
          <h3>ç”Ÿç‰©ä¿¡æ¯å­¦</h3>
          <p>DNAåºåˆ—åŒ¹é…</p>
        </div>
        <div class="app-card">
          <div class="app-icon">ğŸ”</div>
          <h3>æ•°æ®å®‰å…¨</h3>
          <p>ç—…æ¯’ç‰¹å¾ç æ‰«æ</p>
        </div>
      </div>
    </div>

    <footer class="footer">
      <p>Boyer-Mooreç®—æ³•åœ¨å®é™…åº”ç”¨ä¸­é€šå¸¸æ¯”KMPç­‰ç®—æ³•æ›´å¿«ï¼Œç‰¹åˆ«åœ¨æ¨¡å¼ä¸²è¾ƒé•¿æˆ–å­—æ¯è¡¨è¾ƒå¤§æ—¶è¡¨ç°ä¼˜å¼‚</p>
    </footer>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted, watch } from 'vue'

// ç»„ä»¶çŠ¶æ€
const text = ref('HERE IS A SIMPLE EXAMPLE')
const pattern = ref('EXAMPLE')
const isAnimating = ref(false)
const speed = ref(5)
const statusText = ref('ç­‰å¾…å¼€å§‹')
const shiftCount = ref(0)
const compareCount = ref(0)
const statusClass = ref('status-waiting')
const lastRule = ref('æ— ')
const currentRule = ref('')
const currentBadChar = ref('')
const currentPatternPos = ref(0)
const currentShift = ref(0)
const currentGoodSuffix = ref('')
const goodSuffixPos = ref(0)
const activeTab = ref('bm')

// Canvaså¼•ç”¨
const canvas = ref<HTMLCanvasElement | null>(null)

// ç®—æ³•å˜é‡
let animationFrame: number | null = null
let shift = 0
let patternPos = 0
let badCharTable: Record<string, number> = {}
let animationStartTime = 0

// æ„å»ºåå­—ç¬¦è¡¨
const buildBadCharTable = (patternStr: string): Record<string, number> => {
  const table: Record<string, number> = {}
  const m = patternStr.length

  for (let i = 0; i < m - 1; i++) {
    table[patternStr[i]] = i
  }

  return table
}

// é‡ç½®åŠ¨ç”»
const resetAnimation = () => {
  if (animationFrame) {
    cancelAnimationFrame(animationFrame)
    animationFrame = null
  }

  isAnimating.value = false
  shift = 0
  patternPos = 0
  shiftCount.value = 0
  compareCount.value = 0
  statusText.value = 'ç­‰å¾…å¼€å§‹'
  statusClass.value = 'status-waiting'
  lastRule.value = 'æ— '
  currentRule.value = ''

  badCharTable = buildBadCharTable(pattern.value)
  drawCanvas()
}

// å¼€å§‹åŠ¨ç”»
const startAnimation = () => {
  if (isAnimating.value) return

  resetAnimation()
  isAnimating.value = true
  statusText.value = 'åŒ¹é…ä¸­...'
  statusClass.value = 'status-running'
  animationStartTime = performance.now()
  animateStep()
}

// æš‚åœåŠ¨ç”»
const pauseAnimation = () => {
  if (!isAnimating.value) return

  if (animationFrame) {
    cancelAnimationFrame(animationFrame)
    animationFrame = null
  }

  isAnimating.value = false
  statusText.value = 'å·²æš‚åœ'
  statusClass.value = 'status-paused'
}

// åŠ¨ç”»æ­¥éª¤
const animateStep = () => {
  if (!isAnimating.value) return

  const now = performance.now()
  const elapsed = now - animationStartTime
  const interval = 1100 - speed.value * 100 // é€Ÿåº¦æ§åˆ¶

  if (elapsed < interval) {
    animationFrame = requestAnimationFrame(animateStep)
    return
  }

  animationStartTime = now

  const n = text.value.length
  const m = pattern.value.length

  // æ£€æŸ¥è¾¹ç•Œ
  if (shift > n - m) {
    statusText.value = 'æœªæ‰¾åˆ°åŒ¹é…'
    statusClass.value = 'status-failed'
    isAnimating.value = false
    drawCanvas()
    return
  }

  // ä»å³å‘å·¦æ¯”è¾ƒ
  patternPos = m - 1
  while (patternPos >= 0 && pattern.value[patternPos] === text.value[shift + patternPos]) {
    patternPos--
    compareCount.value++
  }

  // æ‰¾åˆ°åŒ¹é…
  if (patternPos < 0) {
    statusText.value = `åŒ¹é…æˆåŠŸ! ä½ç½®: ${shift}`
    statusClass.value = 'status-success'
    isAnimating.value = false
    drawCanvas()
    return
  }

  // åº”ç”¨åå­—ç¬¦è§„åˆ™
  const badChar = text.value[shift + patternPos]
  const badCharPos = badCharTable[badChar] ?? -1
  const shiftAmount = Math.max(1, patternPos - badCharPos)

  currentRule.value = 'bad'
  currentBadChar.value = badChar
  currentPatternPos.value = patternPos
  currentShift.value = shiftAmount
  lastRule.value = 'åå­—ç¬¦è§„åˆ™'

  shift += shiftAmount
  shiftCount.value++
  compareCount.value++

  drawCanvas()

  if (isAnimating.value) {
    animationFrame = requestAnimationFrame(animateStep)
  }
}

// ç»˜åˆ¶Canvas
const drawCanvas = () => {
  if (!canvas.value) return

  const ctx = canvas.value.getContext('2d')
  if (!ctx) return

  const width = canvas.value.width
  const height = canvas.value.height
  const cellSize = 35
  const paddingX = 50
  const paddingY = 80
  const textY = paddingY
  const patternY = paddingY + 100

  // æ¸…é™¤ç”»å¸ƒ
  ctx.clearRect(0, 0, width, height)

  // ç»˜åˆ¶æ ‡é¢˜
  ctx.fillStyle = '#333'
  ctx.font = 'bold 18px Arial'
  ctx.textAlign = 'left'
  ctx.fillText('æ–‡æœ¬ä¸²:', 20, textY - 30)
  ctx.fillText('æ¨¡å¼ä¸²:', 20, patternY - 30)

  // è®¾ç½®æ–‡æœ¬æ ·å¼
  ctx.font = '16px Arial'
  ctx.textAlign = 'center'
  ctx.textBaseline = 'middle'

  // ç»˜åˆ¶æ–‡æœ¬ä¸²
  for (let i = 0; i < text.value.length; i++) {
    const x = paddingX + i * cellSize + cellSize / 2

    // ç»˜åˆ¶å•å…ƒæ ¼èƒŒæ™¯
    ctx.fillStyle = '#f5f5f5'
    ctx.fillRect(paddingX + i * cellSize, textY - cellSize / 2, cellSize, cellSize)

    // ç»˜åˆ¶å•å…ƒæ ¼è¾¹æ¡†
    ctx.strokeStyle = '#ddd'
    ctx.lineWidth = 1
    ctx.strokeRect(paddingX + i * cellSize, textY - cellSize / 2, cellSize, cellSize)

    // ç»˜åˆ¶å­—ç¬¦
    ctx.fillStyle = '#333'
    ctx.fillText(text.value[i], x, textY)

    // é«˜äº®å½“å‰æ¯”è¾ƒä½ç½®
    if (i >= shift && i < shift + pattern.value.length) {
      if (i === shift + patternPos) {
        // å½“å‰æ¯”è¾ƒå­—ç¬¦ï¼ˆåå­—ç¬¦ï¼‰
        ctx.fillStyle = 'rgba(244, 67, 54, 0.3)'
        ctx.fillRect(paddingX + i * cellSize, textY - cellSize / 2, cellSize, cellSize)

        // ç»˜åˆ¶æŒ‡é’ˆ
        ctx.fillStyle = '#f44336'
        ctx.beginPath()
        ctx.arc(x, textY + 30, 8, 0, Math.PI * 2)
        ctx.fill()
      } else if (i > shift + patternPos) {
        // å·²åŒ¹é…å­—ç¬¦
        ctx.fillStyle = 'rgba(76, 175, 80, 0.3)'
        ctx.fillRect(paddingX + i * cellSize, textY - cellSize / 2, cellSize, cellSize)
      }
    }
  }

  // ç»˜åˆ¶æ¨¡å¼ä¸²
  for (let j = 0; j < pattern.value.length; j++) {
    const x = paddingX + (shift + j) * cellSize + cellSize / 2

    // ç»˜åˆ¶å•å…ƒæ ¼èƒŒæ™¯
    ctx.fillStyle = '#e3f2fd'
    ctx.fillRect(paddingX + (shift + j) * cellSize, patternY - cellSize / 2, cellSize, cellSize)

    // ç»˜åˆ¶å•å…ƒæ ¼è¾¹æ¡†
    ctx.strokeStyle = '#bbdefb'
    ctx.lineWidth = 1
    ctx.strokeRect(paddingX + (shift + j) * cellSize, patternY - cellSize / 2, cellSize, cellSize)

    // ç»˜åˆ¶å­—ç¬¦
    ctx.fillStyle = '#1976d2'
    ctx.fillText(pattern.value[j], x, patternY)

    // é«˜äº®å½“å‰æ¯”è¾ƒä½ç½®
    if (j === patternPos) {
      // å½“å‰æ¯”è¾ƒå­—ç¬¦
      ctx.fillStyle = 'rgba(255, 152, 0, 0.3)'
      ctx.fillRect(paddingX + (shift + j) * cellSize, patternY - cellSize / 2, cellSize, cellSize)

      // ç»˜åˆ¶æŒ‡é’ˆ
      ctx.fillStyle = '#ff9800'
      ctx.beginPath()
      ctx.arc(x, patternY - 30, 8, 0, Math.PI * 2)
      ctx.fill()
    } else if (j > patternPos) {
      // å·²åŒ¹é…å­—ç¬¦
      ctx.fillStyle = 'rgba(76, 175, 80, 0.3)'
      ctx.fillRect(paddingX + (shift + j) * cellSize, patternY - cellSize / 2, cellSize, cellSize)
    }
  }

  // ç»˜åˆ¶è¿æ¥çº¿
  if (patternPos >= 0) {
    const textX = paddingX + (shift + patternPos) * cellSize + cellSize / 2
    const patternX = paddingX + (shift + patternPos) * cellSize + cellSize / 2

    ctx.beginPath()
    ctx.moveTo(textX, textY + 20)
    ctx.lineTo(patternX, patternY - 20)
    ctx.strokeStyle = '#f44336'
    ctx.lineWidth = 2
    ctx.stroke()

    // ç»˜åˆ¶æ¯”è¾ƒç»“æœ
    ctx.fillStyle = '#f44336'
    ctx.font = '14px Arial'
    ctx.fillText('ä¸åŒ¹é…', textX, (textY + patternY) / 2)
  }

  // ç»˜åˆ¶ç§»ä½æŒ‡ç¤ºå™¨
  if (shift > 0) {
    const startX = paddingX + shift * cellSize
    ctx.beginPath()
    ctx.moveTo(startX, patternY + 40)
    ctx.lineTo(startX, patternY + 60)
    ctx.lineTo(startX - 15, patternY + 50)
    ctx.closePath()
    ctx.fillStyle = '#3f51b5'
    ctx.fill()

    ctx.font = '14px Arial'
    ctx.fillStyle = '#3f51b5'
    ctx.fillText(`ç§»ä½: ${shift}`, startX - 10, patternY + 80)
  }
}

// ç›‘å¬è¾“å…¥å˜åŒ–
watch([text, pattern], resetAnimation)

// åˆå§‹åŒ–
onMounted(() => {
  badCharTable = buildBadCharTable(pattern.value)
  drawCanvas()
})
</script>

<style scoped lang="less">
@primary-color: #3f51b5;
@secondary-color: #5c6bc0;
@success-color: #4caf50;
@warning-color: #ff9800;
@error-color: #f44336;
@insert-color: #2196f3;
@delete-color: #f44336;
@replace-color: #ff9800;
@match-color: #4caf50;
@background-light: #f8f9fa;
@border-color: #e0e0e0;

.bm-container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 20px;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  color: #333;
  background-color: #fff;
  min-height: 100vh;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 30px;
  padding-bottom: 20px;
  border-bottom: 1px solid @border-color;

  .title-container {
    .title {
      color: @primary-color;
      margin: 0 0 5px;
      font-size: 2.2rem;
    }

    .subtitle {
      color: #666;
      font-size: 1.1rem;
    }
  }
}

.algorithm-info {
  display: flex;
  gap: 25px;

  .info-item {
    text-align: center;

    .info-label {
      font-size: 0.9rem;
      color: #666;
      margin-bottom: 5px;
    }

    .info-value {
      font-size: 1.1rem;
      font-weight: 600;
      color: @primary-color;
    }
  }
}

.content-wrapper {
  display: flex;
  gap: 30px;
  margin-bottom: 40px;

  @media (max-width: 1100px) {
    flex-direction: column;
  }
}

.content-left {
  flex: 1;
}

.content-right {
  flex: 1;
}

.card {
  background: @background-light;
  border-radius: 12px;
  padding: 25px;
  margin-bottom: 30px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);

  .card-title {
    color: @primary-color;
    margin-top: 0;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 2px solid #e0e0e0;
    font-size: 1.6rem;
  }
}

.features {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin-top: 25px;

  .feature {
    display: flex;
    gap: 15px;
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);

    .feature-icon {
      font-size: 2rem;
    }

    .feature-content {
      h3 {
        margin: 0 0 5px;
        font-size: 1.1rem;
        color: #333;
      }

      p {
        margin: 0;
        color: #666;
        font-size: 0.9rem;
      }
    }
  }
}

.rules {
  display: flex;
  flex-direction: column;
  gap: 25px;

  .rule {
    background: white;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);

    .rule-header {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 15px;

      .rule-icon {
        font-size: 1.8rem;
      }

      h3 {
        margin: 0;
        font-size: 1.3rem;
      }
    }

    .rule-content {
      p {
        margin: 0 0 15px;
        line-height: 1.6;
      }

      ol {
        padding-left: 20px;
        margin: 0 0 15px;

        li {
          margin-bottom: 8px;
        }
      }
    }

    .rule-formula {
      background: #f9f9f9;
      border-left: 4px solid @primary-color;
      padding: 12px 15px;
      font-family: 'Courier New', monospace;
      font-weight: 600;
      color: #333;
      border-radius: 0 4px 4px 0;
    }
  }
}

.steps {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;

  .step {
    display: flex;
    gap: 15px;
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);

    .step-number {
      width: 40px;
      height: 40px;
      background: @primary-color;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      flex-shrink: 0;
      font-size: 1.2rem;
    }

    .step-content {
      h3 {
        margin: 0 0 8px;
        font-size: 1.1rem;
        color: #333;
      }

      p {
        margin: 0;
        color: #666;
        font-size: 0.95rem;
        line-height: 1.4;
      }
    }
  }
}

.demo-card {
  background: @background-light;
  border-radius: 12px;
  padding: 25px;
  margin-bottom: 30px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
}

.demo-container {
  background: white;
  border-radius: 8px;
  padding: 20px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  margin-bottom: 20px;
}

.controls {
  margin-bottom: 20px;

  .input-group {
    display: flex;
    align-items: center;
    margin-bottom: 15px;

    label {
      width: 70px;
      font-weight: 500;
      color: @secondary-color;
    }

    input {
      flex: 1;
      padding: 10px 15px;
      border: 1px solid @border-color;
      border-radius: 6px;
      font-size: 1rem;
      transition: border-color 0.3s;

      &:focus {
        outline: none;
        border-color: @primary-color;
        box-shadow: 0 0 0 2px rgba(@primary-color, 0.2);
      }
    }
  }
}

.control-buttons {
  display: flex;
  gap: 15px;
  align-items: center;

  button {
    padding: 10px 20px;
    border: none;
    border-radius: 6px;
    background: @primary-color;
    color: white;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 1rem;

    &:hover {
      background: darken(@primary-color, 8%);
      transform: translateY(-2px);
    }

    &:disabled {
      background: #b0b0b0;
      cursor: not-allowed;
      transform: none;
    }
  }

  .speed-control {
    margin-left: auto;
    display: flex;
    align-items: center;
    gap: 10px;

    label {
      color: @secondary-color;
    }

    input {
      width: 150px;
    }
  }
}

.canvas-container {
  display: flex;
  justify-content: center;
  margin: 20px 0;
  padding: 15px;
  background: white;
  border: 1px solid #eee;
  border-radius: 8px;
}

.status {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
  background: #f5f7fa;
  border-radius: 8px;
  padding: 15px;
  margin-top: 15px;

  .status-item {
    display: flex;
    gap: 10px;

    .status-label {
      font-weight: 500;
      color: #666;
    }

    .status-value {
      font-weight: 600;
    }
  }
}

.status-waiting {
  color: #666;
}

.status-running {
  color: @primary-color;
}

.status-paused {
  color: @warning-color;
}

.status-success {
  color: @success-color;
}

.status-failed {
  color: @error-color;
}

.rules-explanation {
  background: white;
  border-radius: 8px;
  padding: 20px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);

  h3 {
    margin-top: 0;
    color: @primary-color;
    font-size: 1.2rem;
    padding-bottom: 10px;
    border-bottom: 1px solid #e0e0e0;
  }
}

.rule-detail {
  margin-top: 15px;

  .rule-title {
    font-weight: 600;
    margin-bottom: 8px;
    color: #333;
  }

  .rule-description {
    color: #555;
    line-height: 1.6;

    .char-highlight {
      background: #fff9c4;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: 600;
    }
  }
}

.code-section {
  background: @background-light;
  border-radius: 12px;
  padding: 25px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
}

.tabs {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;

  .tab {
    padding: 8px 20px;
    border: none;
    border-radius: 6px;
    background: #e0e0e0;
    color: #666;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;

    &.active {
      background: @primary-color;
      color: white;
    }

    &:hover:not(.active) {
      background: #d0d0d0;
    }
  }
}

.code-block {
  background: #2d2d2d;
  color: #f8f8f2;
  padding: 20px;
  border-radius: 8px;
  overflow-x: auto;
  font-family: 'Fira Code', monospace;
  font-size: 0.95rem;
  line-height: 1.5;
  margin-top: 15px;
}

.applications {
  background: @background-light;
  border-radius: 12px;
  padding: 30px;
  margin-bottom: 30px;

  .section-title {
    color: @primary-color;
    margin-top: 0;
    margin-bottom: 25px;
    text-align: center;
    font-size: 1.8rem;
  }
}

.app-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
  gap: 20px;
}

.app-card {
  background: white;
  border-radius: 10px;
  padding: 30px 20px;
  text-align: center;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
  transition: transform 0.3s ease;

  &:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
  }

  .app-icon {
    font-size: 2.5rem;
    margin-bottom: 15px;
  }

  h3 {
    margin: 0 0 10px;
    color: #333;
  }

  p {
    margin: 0;
    color: #666;
    font-size: 0.95rem;
  }
}

.footer {
  text-align: center;
  padding: 30px;
  margin-top: 20px;
  background: @background-light;
  border-radius: 12px;
  font-style: italic;
  color: #666;
  font-size: 1.1rem;
  border-top: 2px solid #e0e0e0;
}

.highlight {
  background: #fff9c4;
  padding: 0 4px;
  border-radius: 4px;
  font-weight: 600;
}

@media (max-width: 768px) {
  .header {
    flex-direction: column;
    align-items: flex-start;
    gap: 15px;
  }

  .algorithm-info {
    width: 100%;
    justify-content: space-between;
  }
}
</style>
