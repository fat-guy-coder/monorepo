<template>
  <div class="red-black-tree-container">
    <header class="page-header">
      <h1>çº¢é»‘æ ‘(Red-Black Tree)</h1>
      <p class="subtitle">è‡ªå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘çš„é«˜æ•ˆå®ç°</p>
    </header>

    <main class="content">
      <section class="intro-section">
        <div class="card">
          <h2>ä»€ä¹ˆæ˜¯çº¢é»‘æ ‘?</h2>
          <p>çº¢é»‘æ ‘æ˜¯ä¸€ç§è‡ªå¹³è¡¡çš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œå®ƒåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šå¢åŠ äº†ä¸€ä¸ªå­˜å‚¨ä½è¡¨ç¤ºèŠ‚ç‚¹çš„é¢œè‰²ï¼ˆçº¢è‰²æˆ–é»‘è‰²ï¼‰ã€‚é€šè¿‡å¯¹ä»»ä½•ä¸€æ¡ä»æ ¹åˆ°å¶å­çš„è·¯å¾„ä¸Šå„ä¸ªèŠ‚ç‚¹ç€è‰²æ–¹å¼çš„é™åˆ¶ï¼Œçº¢é»‘æ ‘ç¡®ä¿æ²¡æœ‰ä¸€æ¡è·¯å¾„ä¼šæ¯”å…¶ä»–è·¯å¾„é•¿å‡ºä¸¤å€ï¼Œå› è€Œæ˜¯è¿‘ä¼¼å¹³è¡¡çš„ã€‚</p>
        </div>
      </section>

      <div class="two-column-layout">
        <section class="structure-section">
          <div class="card">
            <h2>çº¢é»‘æ ‘æ€§è´¨</h2>
            <ul class="properties-list">
              <li class="property-item">
                <div class="property-icon color-rule"></div>
                <div class="property-content">
                  <h3>é¢œè‰²è§„åˆ™</h3>
                  <p>æ¯ä¸ªèŠ‚ç‚¹è¦ä¹ˆæ˜¯çº¢è‰²ï¼Œè¦ä¹ˆæ˜¯é»‘è‰²</p>
                </div>
              </li>
              <li class="property-item">
                <div class="property-icon root-rule"></div>
                <div class="property-content">
                  <h3>æ ¹èŠ‚ç‚¹è§„åˆ™</h3>
                  <p>æ ¹èŠ‚ç‚¹æ°¸è¿œæ˜¯é»‘è‰²çš„</p>
                </div>
              </li>
              <li class="property-item">
                <div class="property-icon red-rule"></div>
                <div class="property-content">
                  <h3>çº¢è‰²èŠ‚ç‚¹è§„åˆ™</h3>
                  <p>çº¢è‰²èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å¿…é¡»æ˜¯é»‘è‰²çš„ï¼ˆä¸èƒ½æœ‰ä¸¤ä¸ªè¿ç»­çš„çº¢è‰²èŠ‚ç‚¹ï¼‰</p>
                </div>
              </li>
              <li class="property-item">
                <div class="property-icon path-rule"></div>
                <div class="property-content">
                  <h3>è·¯å¾„è§„åˆ™</h3>
                  <p>ä»ä»»ä¸€èŠ‚ç‚¹åˆ°å…¶æ¯ä¸ªå¶å­èŠ‚ç‚¹çš„æ‰€æœ‰è·¯å¾„éƒ½åŒ…å«ç›¸åŒæ•°é‡çš„é»‘è‰²èŠ‚ç‚¹</p>
                </div>
              </li>
            </ul>
          </div>

          <div class="card">
            <h2>ä¼˜ç¼ºç‚¹åˆ†æ</h2>
            <div class="pros-cons">
              <div class="pros">
                <h3>ä¼˜ç‚¹</h3>
                <ul>
                  <li>æŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤çš„æœ€åæ—¶é—´å¤æ‚åº¦å‡ä¸ºO(log n)</li>
                  <li>ç›¸å¯¹äºAVLæ ‘ï¼Œæ’å…¥å’Œåˆ é™¤æ“ä½œéœ€è¦æ›´å°‘çš„æ—‹è½¬</li>
                  <li>åœ¨å®è·µä¸­æ€§èƒ½ä¼˜ç§€ï¼Œè¢«å¹¿æ³›ç”¨äºç³»ç»Ÿç¼–ç¨‹</li>
                  <li>ä¿è¯æ ‘çš„é«˜åº¦æœ€å¤šä¸º2log(n+1)</li>
                </ul>
              </div>
              <div class="cons">
                <h3>ç¼ºç‚¹</h3>
                <ul>
                  <li>å®ç°ç›¸å¯¹å¤æ‚ï¼Œéœ€è¦è€ƒè™‘å¤šç§æƒ…å†µ</li>
                  <li>ç›¸æ¯”æ™®é€šäºŒå‰æœç´¢æ ‘æœ‰é¢å¤–çš„å­˜å‚¨å¼€é”€ï¼ˆé¢œè‰²ä½ï¼‰</li>
                  <li>æ—‹è½¬å’Œé‡æ–°ç€è‰²æ“ä½œå¯èƒ½å½±å“æ€§èƒ½</li>
                </ul>
              </div>
            </div>
          </div>
        </section>

        <section class="visualization-section">
          <div class="card">
            <h2>çº¢é»‘æ ‘æ¼”ç¤º</h2>
            <div class="visualization-controls">
              <div class="control-group">
                <button @click="insertRandomNode" class="btn primary">æ’å…¥éšæœºèŠ‚ç‚¹</button>
                <button @click="deleteSelectedNode" class="btn secondary" :disabled="!selectedNode">åˆ é™¤é€‰ä¸­èŠ‚ç‚¹</button>
                <button @click="resetTree" class="btn outline">é‡ç½®</button>
              </div>
              <div class="control-group">
                <input
                  v-model.number="customValue"
                  type="number"
                  placeholder="è¾“å…¥èŠ‚ç‚¹å€¼"
                  class="input"
                >
                <button @click="insertCustomNode" class="btn primary">æ’å…¥</button>
                <button @click="searchNode" class="btn secondary">æœç´¢</button>
              </div>
            </div>

            <div class="tree-container">
              <div class="tree-visual" ref="treeContainer">
                <div class="tree-lines">
                  <svg class="connectors" :width="svgWidth" :height="svgHeight">
                    <path
                      v-for="(connector, index) in connectors"
                      :key="index"
                      :d="connector.path"
                      class="tree-connector"
                      :class="connector.type"
                    />
                  </svg>
                </div>
                <div class="tree-nodes">
                  <div
                    v-for="node in treeNodes"
                    :key="node.id"
                    class="tree-node"
                    :class="{
                      'red': node.color === 'red',
                      'black': node.color === 'black',
                      'selected': selectedNode === node.id,
                      'new': node.isNew,
                      'searched': node.isSearched
                    }"
                    :style="{
                      left: `${node.x}px`,
                      top: `${node.y}px`
                    }"
                    @click="selectNode(node.id)"
                  >
                    <div class="node-content">
                      <span class="node-value">{{ node.value }}</span>
                      <span class="node-color" :class="node.color"></span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="tree-info">
              <div class="info-item">
                <span class="label">æ ‘é«˜åº¦:</span>
                <span class="value">{{ treeStats.height }}</span>
              </div>
              <div class="info-item">
                <span class="label">èŠ‚ç‚¹æ•°é‡:</span>
                <span class="value">{{ treeStats.nodeCount }}</span>
              </div>
              <div class="info-item">
                <span class="label">é»‘è‰²èŠ‚ç‚¹:</span>
                <span class="value">{{ treeStats.blackCount }}</span>
              </div>
              <div class="info-item">
                <span class="label">çº¢è‰²èŠ‚ç‚¹:</span>
                <span class="value">{{ treeStats.redCount }}</span>
              </div>
            </div>
          </div>
        </section>
      </div>

      <section class="operations-section">
        <div class="card">
          <h2>æ“ä½œä¸æ—‹è½¬</h2>
          <div class="operations-grid">
            <div class="operation">
              <h3>å·¦æ—‹è½¬</h3>
              <div class="rotation-diagram">
                <div class="before-rotation">
                  <div class="node-diagram root">P</div>
                  <div class="node-connections">
                    <div class="left-child">
                      <div class="node-diagram">A</div>
                    </div>
                    <div class="right-child">
                      <div class="node-diagram">Q</div>
                      <div class="child-nodes">
                        <div class="node-diagram">B</div>
                        <div class="node-diagram">C</div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="rotation-arrow">â†’</div>
                <div class="after-rotation">
                  <div class="node-diagram root">Q</div>
                  <div class="node-connections">
                    <div class="left-child">
                      <div class="node-diagram">P</div>
                      <div class="child-nodes">
                        <div class="node-diagram">A</div>
                        <div class="node-diagram">B</div>
                      </div>
                    </div>
                    <div class="right-child">
                      <div class="node-diagram">C</div>
                    </div>
                  </div>
                </div>
              </div>
              <p>ä»¥èŠ‚ç‚¹Pä¸ºæ”¯ç‚¹è¿›è¡Œå·¦æ—‹è½¬ï¼Œå°†Pçš„å³å­©å­Qæå‡ä¸ºæ–°çš„æ ¹èŠ‚ç‚¹ï¼ŒPæˆä¸ºQçš„å·¦å­æ ‘ã€‚</p>
            </div>

            <div class="operation">
              <h3>å³æ—‹è½¬</h3>
              <div class="rotation-diagram">
                <div class="before-rotation">
                  <div class="node-diagram root">Q</div>
                  <div class="node-connections">
                    <div class="left-child">
                      <div class="node-diagram">P</div>
                      <div class="child-nodes">
                        <div class="node-diagram">A</div>
                        <div class="node-diagram">B</div>
                      </div>
                    </div>
                    <div class="right-child">
                      <div class="node-diagram">C</div>
                    </div>
                  </div>
                </div>
                <div class="rotation-arrow">â†’</div>
                <div class="after-rotation">
                  <div class="node-diagram root">P</div>
                  <div class="node-connections">
                    <div class="left-child">
                      <div class="node-diagram">A</div>
                    </div>
                    <div class="right-child">
                      <div class="node-diagram">Q</div>
                      <div class="child-nodes">
                        <div class="node-diagram">B</div>
                        <div class="node-diagram">C</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <p>ä»¥èŠ‚ç‚¹Qä¸ºæ”¯ç‚¹è¿›è¡Œå³æ—‹è½¬ï¼Œå°†Qçš„å·¦å­©å­Pæå‡ä¸ºæ–°çš„æ ¹èŠ‚ç‚¹ï¼ŒQæˆä¸ºPçš„å³å­æ ‘ã€‚</p>
            </div>
          </div>
        </div>
      </section>

      <section class="algorithms-section">
        <div class="card">
          <h2>æ ¸å¿ƒç®—æ³•</h2>
          <div class="algorithm-tabs">
            <button
              v-for="(algo, index) in algorithms"
              :key="index"
              @click="activeAlgorithm = index"
              class="tab-btn"
              :class="{ active: activeAlgorithm === index }"
            >
              {{ algo.name }}
            </button>
          </div>
          <div class="algorithm-content">
            <h3>{{ algorithms[activeAlgorithm].name }}</h3>
            <p>{{ algorithms[activeAlgorithm].description }}</p>
            <div class="algorithm-steps">
              <h4>ä¸»è¦æ­¥éª¤:</h4>
              <ul>
                <li v-for="(step, index) in algorithms[activeAlgorithm].steps" :key="index">
                  {{ step }}
                </li>
              </ul>
            </div>
            <pre class="code-block"><code>{{ algorithms[activeAlgorithm].code }}</code></pre>
          </div>
        </div>
      </section>

      <section class="use-cases-section">
        <div class="card">
          <h2>åº”ç”¨åœºæ™¯</h2>
          <div class="use-cases-grid">
            <div class="use-case">
              <div class="use-case-icon">âš™ï¸</div>
              <h3>Javaé›†åˆæ¡†æ¶</h3>
              <p>Javaä¸­çš„TreeMapå’ŒTreeSetä½¿ç”¨çº¢é»‘æ ‘å®ç°ï¼Œæä¾›æœ‰åºçš„é”®å€¼å¯¹å­˜å‚¨ã€‚</p>
            </div>
            <div class="use-case">
              <div class="use-case-icon">ğŸ”§</div>
              <h3>C++ STL</h3>
              <p>C++æ ‡å‡†æ¨¡æ¿åº“ä¸­çš„mapã€multimapã€setå’Œmultiseté€šå¸¸ä½¿ç”¨çº¢é»‘æ ‘å®ç°ã€‚</p>
            </div>
            <div class="use-case">
              <div class="use-case-icon">ğŸ“</div>
              <h3>Linuxå†…æ ¸</h3>
              <p>Linuxå†…æ ¸çš„å®Œå…¨å…¬å¹³è°ƒåº¦å™¨(CFS)ä½¿ç”¨çº¢é»‘æ ‘æ¥ç®¡ç†è¿›ç¨‹è°ƒåº¦ã€‚</p>
            </div>
            <div class="use-case">
              <div class="use-case-icon">ğŸ—ƒï¸</div>
              <h3>æ•°æ®åº“ç³»ç»Ÿ</h3>
              <p>è®¸å¤šæ•°æ®åº“ç³»ç»Ÿä½¿ç”¨çº¢é»‘æ ‘ä½œä¸ºç´¢å¼•ç»“æ„ï¼Œç‰¹åˆ«æ˜¯åœ¨å†…å­˜æ•°æ®åº“ä¸­ã€‚</p>
            </div>
          </div>
        </div>
      </section>

      <section class="comparison-section">
        <div class="card">
          <h2>ä¸å…¶ä»–å¹³è¡¡æ ‘æ¯”è¾ƒ</h2>
          <div class="comparison-table">
            <table>
              <thead>
                <tr>
                  <th>ç‰¹æ€§</th>
                  <th>çº¢é»‘æ ‘</th>
                  <th>AVLæ ‘</th>
                  <th>Bæ ‘</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>å¹³è¡¡ä¸¥æ ¼åº¦</td>
                  <td>å®½æ¾å¹³è¡¡</td>
                  <td>ä¸¥æ ¼å¹³è¡¡</td>
                  <td>å¤šè·¯å¹³è¡¡</td>
                </tr>
                <tr>
                  <td>æŸ¥æ‰¾æ€§èƒ½</td>
                  <td>O(log n)</td>
                  <td>O(log n)</td>
                  <td>O(log n)</td>
                </tr>
                <tr>
                  <td>æ’å…¥/åˆ é™¤æ€§èƒ½</td>
                  <td>O(log n)</td>
                  <td>O(log n)</td>
                  <td>O(log n)</td>
                </tr>
                <tr>
                  <td>æ—‹è½¬æ¬¡æ•°</td>
                  <td>å°‘</td>
                  <td>å¤š</td>
                  <td>N/A</td>
                </tr>
                <tr>
                  <td>é€‚ç”¨åœºæ™¯</td>
                  <td>é¢‘ç¹æ’å…¥åˆ é™¤</td>
                  <td>é¢‘ç¹æŸ¥æ‰¾</td>
                  <td>ç£ç›˜å­˜å‚¨</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>
    </main>
  </div>
</template>

<script setup lang="ts">
import { ref, reactive, onMounted, nextTick } from 'vue'

// æ ‘èŠ‚ç‚¹æ¥å£
interface TreeNode {
  id: number
  value: number
  color: 'red' | 'black'
  x: number
  y: number
  isNew?: boolean
  isSearched?: boolean
}

// è¿æ¥çº¿æ¥å£
interface Connector {
  path: string
  type: 'left' | 'right'
}

// å“åº”å¼æ•°æ®
const treeNodes = reactive<TreeNode[]>([])
const connectors = reactive<Connector[]>([])
const selectedNode = ref<number | null>(null)
const customValue = ref<number | null>(null)
const activeAlgorithm = ref(0)
const treeContainer = ref<HTMLElement | null>(null)
const svgWidth = ref(800)
const svgHeight = ref(400)

// æ ‘ç»Ÿè®¡ä¿¡æ¯
const treeStats = reactive({
  height: 0,
  nodeCount: 0,
  blackCount: 0,
  redCount: 0
})

// åˆå§‹åŒ–æ ‘
const initializeTree = () => {
  treeNodes.length = 0
  connectors.length = 0

  // åˆ›å»ºåˆå§‹çº¢é»‘æ ‘
  const nodes = [
    { id: 1, value: 13, color: 'black', x: 400, y: 50 },
    { id: 2, value: 8, color: 'red', x: 250, y: 150 },
    { id: 3, value: 17, color: 'red', x: 550, y: 150 },
    { id: 4, value: 1, color: 'black', x: 175, y: 250 },
    { id: 5, value: 11, color: 'black', x: 325, y: 250 },
    { id: 6, value: 15, color: 'black', x: 475, y: 250 },
    { id: 7, value: 25, color: 'black', x: 625, y: 250 },
    { id: 8, value: 6, color: 'red', x: 150, y: 350 }
  ]

  treeNodes.push(...nodes as TreeNode[])

  // åˆ›å»ºè¿æ¥çº¿
  const newConnectors = [
    { path: 'M400,70 L275,130', type: 'left' },
    { path: 'M400,70 L525,130', type: 'right' },
    { path: 'M250,170 L190,230', type: 'left' },
    { path: 'M250,170 L310,230', type: 'right' },
    { path: 'M550,170 L490,230', type: 'left' },
    { path: 'M550,170 L610,230', type: 'right' },
    { path: 'M175,270 L160,330', type: 'left' }
  ]

  connectors.push(...newConnectors as Connector[])

  updateTreeStats()
}

// æ›´æ–°æ ‘ç»Ÿè®¡ä¿¡æ¯
const updateTreeStats = () => {
  treeStats.nodeCount = treeNodes.length
  treeStats.blackCount = treeNodes.filter(node => node.color === 'black').length
  treeStats.redCount = treeNodes.filter(node => node.color === 'red').length
  treeStats.height = 4 // ç®€åŒ–è®¡ç®—
}

// æ’å…¥éšæœºèŠ‚ç‚¹
const insertRandomNode = () => {
  const newValue = Math.floor(Math.random() * 50) + 1

  // ç¡®ä¿å€¼ä¸é‡å¤
  if (treeNodes.some(node => node.value === newValue)) {
    insertRandomNode()
    return
  }

  // åˆ›å»ºæ–°èŠ‚ç‚¹
  const newNode: TreeNode = {
    id: Date.now(),
    value: newValue,
    color: Math.random() > 0.5 ? 'red' : 'black',
    x: 300 + Math.random() * 200,
    y: 100 + Math.random() * 300,
    isNew: true
  }

  treeNodes.push(newNode)

  // æ›´æ–°è¿æ¥çº¿ï¼ˆç®€åŒ–å®ç°ï¼‰
  updateConnectors()

  updateTreeStats()

  // 1ç§’åç§»é™¤æ–°èŠ‚ç‚¹æ ‡è®°
  setTimeout(() => {
    const node = treeNodes.find(n => n.id === newNode.id)
    if (node) {
      node.isNew = false
    }
  }, 1000)
}

// æ’å…¥è‡ªå®šä¹‰èŠ‚ç‚¹
const insertCustomNode = () => {
  if (customValue.value === null) return

  const newValue = customValue.value

  // ç¡®ä¿å€¼ä¸é‡å¤
  if (treeNodes.some(node => node.value === newValue)) {
    alert('è¯¥å€¼å·²å­˜åœ¨ï¼')
    return
  }

  // åˆ›å»ºæ–°èŠ‚ç‚¹
  const newNode: TreeNode = {
    id: Date.now(),
    value: newValue,
    color: Math.random() > 0.5 ? 'red' : 'black',
    x: 300 + Math.random() * 200,
    y: 100 + Math.random() * 300,
    isNew: true
  }

  treeNodes.push(newNode)
  customValue.value = null

  // æ›´æ–°è¿æ¥çº¿
  updateConnectors()

  updateTreeStats()

  // 1ç§’åç§»é™¤æ–°èŠ‚ç‚¹æ ‡è®°
  setTimeout(() => {
    const node = treeNodes.find(n => n.id === newNode.id)
    if (node) {
      node.isNew = false
    }
  }, 1000)
}

// æœç´¢èŠ‚ç‚¹
const searchNode = () => {
  if (customValue.value === null) return

  const target = customValue.value
  const node = treeNodes.find(n => n.value === target)

  if (node) {
    // æ¸…é™¤ä¹‹å‰çš„æœç´¢æ ‡è®°
    treeNodes.forEach(n => { n.isSearched = false })

    // æ ‡è®°æœç´¢åˆ°çš„èŠ‚ç‚¹
    node.isSearched = true

    // 3ç§’åæ¸…é™¤æœç´¢æ ‡è®°
    setTimeout(() => {
      node.isSearched = false
    }, 3000)
  } else {
    alert(`æœªæ‰¾åˆ°å€¼ä¸º ${target} çš„èŠ‚ç‚¹`)
  }
}

// é€‰æ‹©èŠ‚ç‚¹
const selectNode = (nodeId: number) => {
  selectedNode.value = nodeId
}

// åˆ é™¤é€‰ä¸­èŠ‚ç‚¹
const deleteSelectedNode = () => {
  if (selectedNode.value === null) return

  const index = treeNodes.findIndex(node => node.id === selectedNode.value)
  if (index !== -1) {
    treeNodes.splice(index, 1)
    selectedNode.value = null

    // æ›´æ–°è¿æ¥çº¿
    updateConnectors()

    updateTreeStats()
  }
}

// æ›´æ–°è¿æ¥çº¿ï¼ˆç®€åŒ–å®ç°ï¼‰
const updateConnectors = () => {
  connectors.length = 0

  // è¿™é‡Œåº”è¯¥æ ¹æ®æ ‘çš„å®é™…ç»“æ„è®¡ç®—è¿æ¥çº¿
  // ç®€åŒ–å®ç°ï¼šéšæœºç”Ÿæˆä¸€äº›è¿æ¥çº¿
  if (treeNodes.length > 1) {
    for (let i = 1; i < Math.min(treeNodes.length, 8); i++) {
      const parentIndex = Math.floor((i - 1) / 2)
      const parent = treeNodes[parentIndex]
      const child = treeNodes[i]

      if (parent && child) {
        connectors.push({
          path: `M${parent.x + 25},${parent.y + 25} L${child.x + 25},${child.y + 25}`,
          type: i % 2 === 0 ? 'right' : 'left'
        })
      }
    }
  }
}

// é‡ç½®æ ‘
const resetTree = () => {
  initializeTree()
  selectedNode.value = null
  customValue.value = null
}

// ç®—æ³•å®šä¹‰
const algorithms = [
  {
    name: 'æ’å…¥æ“ä½œ',
    description: 'çº¢é»‘æ ‘çš„æ’å…¥æ“ä½œé¦–å…ˆåƒæ™®é€šäºŒå‰æœç´¢æ ‘ä¸€æ ·æ’å…¥èŠ‚ç‚¹ï¼Œå¹¶å°†æ–°èŠ‚ç‚¹ç€è‰²ä¸ºçº¢è‰²ï¼Œç„¶åé€šè¿‡æ—‹è½¬å’Œé‡æ–°ç€è‰²æ¥æ¢å¤çº¢é»‘æ ‘çš„æ€§è´¨ã€‚',
    steps: [
      'åƒæ™®é€šBSTä¸€æ ·æ’å…¥æ–°èŠ‚ç‚¹',
      'å°†æ–°èŠ‚ç‚¹ç€è‰²ä¸ºçº¢è‰²',
      'å¦‚æœè¿åçº¢é»‘æ ‘æ€§è´¨ï¼Œè¿›è¡Œä¿®å¤',
      'ä¿®å¤å¯èƒ½æ¶‰åŠé¢œè‰²ç¿»è½¬å’Œæ—‹è½¬æ“ä½œ'
    ],
    code: `function insert(root, value) {
  // æ™®é€šBSTæ’å…¥
  let node = new Node(value);
  node.color = RED;

  // æ’å…¥èŠ‚ç‚¹
  // ... BSTæ’å…¥é€»è¾‘

  // ä¿®å¤çº¢é»‘æ ‘æ€§è´¨
  return insertFixup(root, node);
}

function insertFixup(root, node) {
  while (node.parent && node.parent.color === RED) {
    if (node.parent === node.parent.parent.left) {
      let uncle = node.parent.parent.right;
      if (uncle && uncle.color === RED) {
        // æƒ…å†µ1: å”å”èŠ‚ç‚¹æ˜¯çº¢è‰²
        node.parent.color = BLACK;
        uncle.color = BLACK;
        node.parent.parent.color = RED;
        node = node.parent.parent;
      } else {
        if (node === node.parent.right) {
          // æƒ…å†µ2: èŠ‚ç‚¹æ˜¯å³å­©å­
          node = node.parent;
          root = leftRotate(root, node);
        }
        // æƒ…å†µ3: èŠ‚ç‚¹æ˜¯å·¦å­©å­
        node.parent.color = BLACK;
        node.parent.parent.color = RED;
        root = rightRotate(root, node.parent.parent);
      }
    } else {
      // å¯¹ç§°æƒ…å†µ
      // ... ç±»ä¼¼é€»è¾‘å¤„ç†å³å­æ ‘æƒ…å†µ
    }
  }
  root.color = BLACK;
  return root;
}`
  },
  {
    name: 'åˆ é™¤æ“ä½œ',
    description: 'çº¢é»‘æ ‘çš„åˆ é™¤æ“ä½œæ¯”æ’å…¥æ›´å¤æ‚ï¼Œéœ€è¦å¤„ç†å¤šç§æƒ…å†µä»¥ç¡®ä¿åˆ é™¤åæ ‘ä»ç„¶ä¿æŒå¹³è¡¡ã€‚',
    steps: [
      'åƒæ™®é€šBSTä¸€æ ·åˆ é™¤èŠ‚ç‚¹',
      'å¦‚æœåˆ é™¤çš„èŠ‚ç‚¹æ˜¯é»‘è‰²ï¼Œéœ€è¦è¿›è¡Œä¿®å¤',
      'ä¿®å¤è¿‡ç¨‹æ¶‰åŠå…„å¼ŸèŠ‚ç‚¹çš„é¢œè‰²å’Œæ—‹è½¬',
      'å¯èƒ½éœ€è¦å¤šæ¬¡æ—‹è½¬å’Œé‡æ–°ç€è‰²'
    ],
    code: `function deleteNode(root, value) {
  // æŸ¥æ‰¾è¦åˆ é™¤çš„èŠ‚ç‚¹
  let node = findNode(root, value);
  if (!node) return root;

  let originalColor = node.color;
  let replacement;

  if (!node.left) {
    replacement = node.right;
    transplant(root, node, node.right);
  } else if (!node.right) {
    replacement = node.left;
    transplant(root, node, node.left);
  } else {
    let successor = minimum(node.right);
    originalColor = successor.color;
    replacement = successor.right;

    if (successor.parent === node) {
      if (replacement) replacement.parent = successor;
    } else {
      transplant(root, successor, successor.right);
      successor.right = node.right;
      successor.right.parent = successor;
    }

    transplant(root, node, successor);
    successor.left = node.left;
    successor.left.parent = successor;
    successor.color = node.color;
  }

  if (originalColor === BLACK) {
    root = deleteFixup(root, replacement);
  }

  return root;
}`
  },
  {
    name: 'å·¦æ—‹è½¬',
    description: 'å·¦æ—‹è½¬æ“ä½œç”¨äºè°ƒæ•´æ ‘çš„ç»“æ„ï¼Œä¿æŒæ ‘çš„å¹³è¡¡ã€‚',
    steps: [
      'å°†èŠ‚ç‚¹Pçš„å³å­©å­Qè®¾ç½®ä¸ºæ–°çš„çˆ¶èŠ‚ç‚¹',
      'å°†Qçš„å·¦å­æ ‘è®¾ç½®ä¸ºPçš„å³å­æ ‘',
      'å°†Pè®¾ç½®ä¸ºQçš„å·¦å­æ ‘',
      'æ›´æ–°çˆ¶èŠ‚ç‚¹æŒ‡é’ˆ'
    ],
    code: `function leftRotate(root, node) {
  let rightChild = node.right;
  node.right = rightChild.left;

  if (rightChild.left) {
    rightChild.left.parent = node;
  }

  rightChild.parent = node.parent;

  if (!node.parent) {
    root = rightChild;
  } else if (node === node.parent.left) {
    node.parent.left = rightChild;
  } else {
    node.parent.right = rightChild;
  }

  rightChild.left = node;
  node.parent = rightChild;

  return root;
}`
  },
  {
    name: 'å³æ—‹è½¬',
    description: 'å³æ—‹è½¬æ˜¯å·¦æ—‹è½¬çš„å¯¹ç§°æ“ä½œï¼Œä¹Ÿç”¨äºè°ƒæ•´æ ‘çš„ç»“æ„ã€‚',
    steps: [
      'å°†èŠ‚ç‚¹Qçš„å·¦å­©å­Pè®¾ç½®ä¸ºæ–°çš„çˆ¶èŠ‚ç‚¹',
      'å°†Pçš„å³å­æ ‘è®¾ç½®ä¸ºQçš„å·¦å­æ ‘',
      'å°†Qè®¾ç½®ä¸ºPçš„å³å­æ ‘',
      'æ›´æ–°çˆ¶èŠ‚ç‚¹æŒ‡é’ˆ'
    ],
    code: `function rightRotate(root, node) {
  let leftChild = node.left;
  node.left = leftChild.right;

  if (leftChild.right) {
    leftChild.right.parent = node;
  }

  leftChild.parent = node.parent;

  if (!node.parent) {
    root = leftChild;
  } else if (node === node.parent.right) {
    node.parent.right = leftChild;
  } else {
    node.parent.left = leftChild;
  }

  leftChild.right = node;
  node.parent = leftChild;

  return root;
}`
  }
]

// ç»„ä»¶æŒ‚è½½æ—¶åˆå§‹åŒ–æ ‘
onMounted(() => {
  initializeTree()

  // è®¾ç½®SVGå°ºå¯¸
  nextTick(() => {
    if (treeContainer.value) {
      svgWidth.value = treeContainer.value.offsetWidth
      svgHeight.value = treeContainer.value.offsetHeight
    }
  })
})
</script>

<style lang="less" scoped>
.red-black-tree-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  color: #333;
  background-color: #f8f9fa;
  min-height: 100vh;
}

.page-header {
  text-align: center;
  margin-bottom: 30px;
  padding: 20px;
  background: linear-gradient(135deg, #c0392b 0%, #e74c3c 100%);
  border-radius: 10px;
  color: white;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);

  h1 {
    margin: 0 0 10px;
    font-size: 2.5rem;
    font-weight: 700;
  }

  .subtitle {
    margin: 0;
    font-size: 1.2rem;
    opacity: 0.9;
  }
}

.content {
  display: flex;
  flex-direction: column;
  gap: 24px;
}

.card {
  background: white;
  border-radius: 10px;
  padding: 24px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
  transition: transform 0.2s, box-shadow 0.2s;

  &:hover {
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  }

  h2 {
    margin-top: 0;
    margin-bottom: 20px;
    color: #2c3e50;
    border-bottom: 2px solid #eaecef;
    padding-bottom: 10px;
    font-size: 1.5rem;
  }
}

.intro-section {
  .card {
    p {
      font-size: 1.1rem;
      line-height: 1.6;
      color: #555;
    }
  }
}

.two-column-layout {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 24px;

  @media (max-width: 900px) {
    grid-template-columns: 1fr;
  }
}

.properties-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.property-item {
  display: flex;
  align-items: flex-start;
  margin-bottom: 20px;
  padding-bottom: 15px;
  border-bottom: 1px solid #f0f0f0;

  &:last-child {
    margin-bottom: 0;
    border-bottom: none;
  }
}

.property-icon {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 15px;
  flex-shrink: 0;

  &.color-rule {
    background: linear-gradient(135deg, #c0392b 0%, #2c3e50 100%);
  }

  &.root-rule {
    background: #2c3e50;
  }

  &.red-rule {
    background: #c0392b;
  }

  &.path-rule {
    background: #3498db;
  }

  &::before {
    color: white;
    font-weight: bold;
  }

  &.color-rule::before {
    content: 'C';
  }

  &.root-rule::before {
    content: 'R';
  }

  &.red-rule::before {
    content: 'X';
  }

  &.path-rule::before {
    content: 'P';
  }
}

.property-content {
  h3 {
    margin: 0 0 8px;
    color: #2c3e50;
    font-size: 1.2rem;
  }

  p {
    margin: 0;
    line-height: 1.5;
    color: #666;
  }
}

.pros-cons {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;

  @media (max-width: 600px) {
    grid-template-columns: 1fr;
  }

  h3 {
    margin-top: 0;
    padding-bottom: 8px;
    border-bottom: 1px solid #eaecef;
  }

  ul {
    padding-left: 20px;
    margin: 0;

    li {
      margin-bottom: 8px;
      line-height: 1.5;
    }
  }

  .pros {
    h3 {
      color: #27ae60;
    }

    li {
      color: #2ecc71;
    }
  }

  .cons {
    h3 {
      color: #e74c3c;
    }

    li {
      color: #e74c3c;
    }
  }
}

.visualization-controls {
  display: flex;
  flex-direction: column;
  gap: 15px;
  margin-bottom: 20px;

  .control-group {
    display: flex;
    gap: 10px;
    align-items: center;

    @media (max-width: 600px) {
      flex-wrap: wrap;
    }
  }
}

.btn {
  padding: 8px 16px;
  border: none;
  border-radius: 4px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;

  &.primary {
    background-color: #c0392b;
    color: white;

    &:hover {
      background-color: #a93226;
    }
  }

  &.secondary {
    background-color: #3498db;
    color: white;

    &:hover:not(:disabled) {
      background-color: #2980b9;
    }

    &:disabled {
      background-color: #bdc3c7;
      cursor: not-allowed;
    }
  }

  &.outline {
    background-color: transparent;
    border: 1px solid #bdc3c7;
    color: #7f8c8d;

    &:hover {
      background-color: #ecf0f1;
    }
  }
}

.input {
  padding: 8px 12px;
  border: 1px solid #ddd;
  border-radius: 4px;
  width: 120px;
}

.tree-container {
  position: relative;
  margin: 20px 0;
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  overflow: hidden;
  background: #f8f9fa;
  min-height: 400px;
}

.tree-visual {
  position: relative;
  width: 100%;
  height: 400px;
}

.tree-lines {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
}

.connectors {
  position: absolute;
  top: 0;
  left: 0;
}

.tree-connector {
  fill: none;
  stroke: #95a5a6;
  stroke-width: 2;

  &.left {
    stroke-dasharray: 5, 5;
  }
}

.tree-nodes {
  position: relative;
  width: 100%;
  height: 100%;
}

.tree-node {
  position: absolute;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s;
  transform: translate(-50%, -50%);
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);

  &.red {
    background: #e74c3c;
    color: white;
  }

  &.black {
    background: #2c3e50;
    color: white;
  }

  &.selected {
    box-shadow: 0 0 0 3px #f39c12;
  }

  &.new {
    animation: pulse 1.5s infinite;
  }

  &.searched {
    animation: highlight 1.5s infinite;
  }

  .node-content {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .node-value {
    font-weight: bold;
    font-size: 14px;
  }

  .node-color {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    margin-top: 2px;

    &.red {
      background: #e74c3c;
    }

    &.black {
      background: #2c3e50;
    }
  }
}

.tree-info {
  display: flex;
  justify-content: space-around;
  background: #ecf0f1;
  padding: 10px;
  border-radius: 4px;
  margin-top: 15px;

  .info-item {
    display: flex;
    flex-direction: column;
    align-items: center;

    .label {
      font-size: 0.8rem;
      color: #7f8c8d;
    }

    .value {
      font-weight: bold;
      font-size: 1.2rem;
      color: #2c3e50;
    }
  }
}

.operations-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 30px;

  @media (max-width: 900px) {
    grid-template-columns: 1fr;
  }
}

.operation {
  h3 {
    color: #2c3e50;
    margin-top: 0;
  }

  p {
    line-height: 1.5;
    color: #555;
  }
}

.rotation-diagram {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin: 20px 0;

  .before-rotation, .after-rotation {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .rotation-arrow {
    font-size: 2rem;
    color: #3498db;
    margin: 0 20px;
  }
}

.node-diagram {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: #3498db;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  margin: 5px;

  &.root {
    background: #2c3e50;
  }
}

.node-connections {
  display: flex;
  justify-content: space-around;
  width: 100%;
  margin-top: 20px;
  position: relative;

  &::before {
    content: '';
    position: absolute;
    top: -10px;
    left: 50%;
    width: 2px;
    height: 10px;
    background: #95a5a6;
  }
}

.left-child, .right-child {
  display: flex;
  flex-direction: column;
  align-items: center;
  position: relative;

  &::before {
    content: '';
    position: absolute;
    top: -10px;
    width: 2px;
    height: 10px;
    background: #95a5a6;
  }
}

.left-child::before {
  right: 50%;
}

.right-child::before {
  left: 50%;
}

.child-nodes {
  display: flex;
  justify-content: space-around;
  width: 120px;
  margin-top: 20px;
  position: relative;

  &::before {
    content: '';
    position: absolute;
    top: -10px;
    left: 50%;
    transform: translateX(-50%);
    width: 120px;
    height: 2px;
    background: #95a5a6;
  }
}

.algorithm-tabs {
  display: flex;
  border-bottom: 1px solid #eaecef;
  margin-bottom: 20px;

  .tab-btn {
    padding: 10px 20px;
    background: none;
    border: none;
    border-bottom: 2px solid transparent;
    cursor: pointer;
    font-weight: 500;
    color: #7f8c8d;
    transition: all 0.2s;

    &:hover {
      color: #c0392b;
    }

    &.active {
      color: #c0392b;
      border-bottom-color: #c0392b;
    }
  }
}

.algorithm-content {
  h3 {
    margin-top: 0;
    color: #2c3e50;
  }

  p {
    line-height: 1.6;
    margin-bottom: 20px;
  }
}

.algorithm-steps {
  margin-bottom: 20px;

  h4 {
    color: #2c3e50;
    margin-bottom: 10px;
  }

  ul {
    padding-left: 20px;

    li {
      margin-bottom: 8px;
      line-height: 1.5;
      color: #555;
    }
  }
}

.code-block {
  background: #2d3748;
  color: #e2e8f0;
  padding: 20px;
  border-radius: 8px;
  overflow-x: auto;
  font-family: 'Courier New', monospace;
  line-height: 1.4;
  font-size: 0.9rem;
}

.use-cases-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
}

.use-case {
  padding: 20px;
  background: #f8f9fa;
  border-radius: 8px;
  border-left: 4px solid #c0392b;
  transition: transform 0.2s;

  &:hover {
    transform: translateY(-5px);
  }

  .use-case-icon {
    font-size: 2rem;
    margin-bottom: 10px;
  }

  h3 {
    margin-top: 0;
    color: #2c3e50;
  }

  p {
    margin-bottom: 0;
    line-height: 1.5;
    color: #555;
  }
}

.comparison-table {
  overflow-x: auto;

  table {
    width: 100%;
    border-collapse: collapse;

    th, td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #e0e0e0;
    }

    th {
      background: #f8f9fa;
      font-weight: 600;
      color: #2c3e50;
    }

    tr:hover {
      background: #f8f9fa;
    }
  }
}

@keyframes pulse {
  0% {
    box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7);
  }
  70% {
    box-shadow: 0 0 0 10px rgba(231, 76, 60, 0);
  }
  100% {
    box-shadow: 0 0 0 0 rgba(231, 76, 60, 0);
  }
}

@keyframes highlight {
  0% {
    box-shadow: 0 0 0 0 rgba(243, 156, 18, 0.7);
  }
  70% {
    box-shadow: 0 0 0 10px rgba(243, 156, 18, 0);
  }
  100% {
    box-shadow: 0 0 0 0 rgba(243, 156, 18, 0);
  }
}
</style>
