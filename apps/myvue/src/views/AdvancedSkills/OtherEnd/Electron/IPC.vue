<template>
  <div class="electron-ipc-container">
    <header class="header">
      <div class="logo-container">
        <div class="electron-logo"></div>
        <h1>Electron IPC è¿›ç¨‹é—´é€šä¿¡</h1>
      </div>
      <p class="subtitle">è¿æ¥ä¸»è¿›ç¨‹ä¸æ¸²æŸ“è¿›ç¨‹çš„æ¡¥æ¢</p>
    </header>

    <div class="content-wrapper">
      <main class="main-content">
        <section class="content-section">
          <div class="section-header">
            <h2><span class="icon">ğŸ“¡</span> IPC åŸºç¡€æ¦‚å¿µ</h2>
            <div class="section-badge">æ ¸å¿ƒæœºåˆ¶</div>
          </div>

          <div class="concept-grid">
            <div class="concept-card">
              <div class="concept-icon">ğŸ’»</div>
              <h3>ä¸»è¿›ç¨‹ (Main Process)</h3>
              <p>æ‹¥æœ‰å®Œæ•´çš„ Node.js ç¯å¢ƒï¼Œè´Ÿè´£åˆ›å»ºçª—å£ã€ç®¡ç†åº”ç”¨ç”Ÿå‘½å‘¨æœŸå’Œè®¿é—®ç³»ç»Ÿèµ„æºã€‚</p>
            </div>

            <div class="concept-card">
              <div class="concept-icon">ğŸŒ</div>
              <h3>æ¸²æŸ“è¿›ç¨‹ (Renderer Process)</h3>
              <p>è¿è¡Œåœ¨ Chromium ä¸­ï¼Œè´Ÿè´£å‘ˆç° Web å†…å®¹ï¼Œæ¯ä¸ªçª—å£ä¸€ä¸ªç‹¬ç«‹è¿›ç¨‹ã€‚</p>
            </div>

            <div class="concept-card">
              <div class="concept-icon">ğŸ”Œ</div>
              <h3>IPC é€šä¿¡ (Inter-Process Communication)</h3>
              <p>å…è®¸ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹ä¹‹é—´å®‰å…¨åœ°ä¼ é€’æ¶ˆæ¯å’Œæ•°æ®ã€‚</p>
            </div>
          </div>

          <div class="ipc-flow-diagram">
            <div class="process main-process">
              <div class="process-header">ä¸»è¿›ç¨‹</div>
              <div class="ipc-method">
                <div class="method-name">ipcMain.on()</div>
                <div class="method-desc">ç›‘å¬æ¸²æŸ“è¿›ç¨‹æ¶ˆæ¯</div>
              </div>
              <div class="ipc-method">
                <div class="method-name">ipcMain.handle()</div>
                <div class="method-desc">å¤„ç†æ¸²æŸ“è¿›ç¨‹è¯·æ±‚</div>
              </div>
              <div class="ipc-method">
                <div class="method-name">webContents.send()</div>
                <div class="method-desc">å‘æ¸²æŸ“è¿›ç¨‹å‘é€æ¶ˆæ¯</div>
              </div>
            </div>

            <div class="communication">
              <div class="arrow right">â‡¨</div>
              <div class="arrow left">â‡¦</div>
              <div class="ipc-protocol">IPC é€šé“</div>
            </div>

            <div class="process renderer-process">
              <div class="process-header">æ¸²æŸ“è¿›ç¨‹</div>
              <div class="ipc-method">
                <div class="method-name">ipcRenderer.send()</div>
                <div class="method-desc">å‘ä¸»è¿›ç¨‹å‘é€æ¶ˆæ¯</div>
              </div>
              <div class="ipc-method">
                <div class="method-name">ipcRenderer.invoke()</div>
                <div class="method-desc">è°ƒç”¨ä¸»è¿›ç¨‹æ–¹æ³•</div>
              </div>
              <div class="ipc-method">
                <div class="method-name">ipcRenderer.on()</div>
                <div class="method-desc">ç›‘å¬ä¸»è¿›ç¨‹æ¶ˆæ¯</div>
              </div>
            </div>
          </div>
        </section>

        <section class="content-section">
          <div class="section-header">
            <h2><span class="icon">ğŸš€</span> IPC ä½¿ç”¨åœºæ™¯</h2>
            <div class="section-badge">å®é™…åº”ç”¨</div>
          </div>

          <div class="scenario-cards">
            <div class="scenario-card">
              <div class="scenario-icon">ğŸ“</div>
              <h3>æ–‡ä»¶ç³»ç»Ÿæ“ä½œ</h3>
              <p>æ¸²æŸ“è¿›ç¨‹è¯·æ±‚ä¸»è¿›ç¨‹è¯»å†™æ–‡ä»¶</p>
              <div class="code-snippet">
                <pre>ipcRenderer.invoke('read-file', path)</pre>
              </div>
            </div>

            <div class="scenario-card">
              <div class="scenario-icon">âš™ï¸</div>
              <h3>ç³»ç»ŸåŠŸèƒ½è°ƒç”¨</h3>
              <p>è®¿é—®åŸç”Ÿå¯¹è¯æ¡†ã€èœå•ã€æ‰˜ç›˜ç­‰</p>
              <div class="code-snippet">
                <pre>ipcRenderer.send('show-dialog')</pre>
              </div>
            </div>

            <div class="scenario-card">
              <div class="scenario-icon">ğŸ””</div>
              <h3>åº”ç”¨çŠ¶æ€åŒæ­¥</h3>
              <p>çª—å£çŠ¶æ€ã€åº”ç”¨è®¾ç½®åŒæ­¥æ›´æ–°</p>
              <div class="code-snippet">
                <pre>ipcRenderer.on('window-maximized', ...)</pre>
              </div>
            </div>

            <div class="scenario-card">
              <div class="scenario-icon">ğŸ”</div>
              <h3>å®‰å…¨æ•æ„Ÿæ“ä½œ</h3>
              <p>æ‰§è¡Œéœ€è¦ç‰¹æƒçš„æ“ä½œï¼ˆå¦‚åŠ å¯†ï¼‰</p>
              <div class="code-snippet">
                <pre>ipcRenderer.invoke('encrypt-data', data)</pre>
              </div>
            </div>
          </div>
        </section>

        <section class="content-section">
          <div class="section-header">
            <h2><span class="icon">ğŸ’»</span> IPC ç¤ºä¾‹ä»£ç </h2>
            <div class="section-badge">å®æˆ˜æ¼”ç¤º</div>
          </div>

          <div class="ipc-demo">
            <div class="demo-tabs">
              <div v-for="(tab, index) in tabs" :key="index" :class="['demo-tab', { active: activeTab === index }]"
                @click="activeTab = index">
                {{ tab.title }}
              </div>
            </div>

            <div class="demo-content">
              <div v-if="activeTab === 0" class="code-example">
                <div class="code-header">æ¸²æŸ“è¿›ç¨‹ (Renderer Process)</div>
                <pre class="code-block">// å‘ä¸»è¿›ç¨‹å‘é€æ¶ˆæ¯ï¼ˆå•å‘ï¼‰
ipcRenderer.send('perform-action', {
  type: 'save-data',
  data: payload
});

// è°ƒç”¨ä¸»è¿›ç¨‹æ–¹æ³•å¹¶ç­‰å¾…ç»“æœï¼ˆåŒå‘ï¼‰
const result = await ipcRenderer.invoke('read-file', '/path/to/file');

// ç›‘å¬æ¥è‡ªä¸»è¿›ç¨‹çš„æ¶ˆæ¯
ipcRenderer.on('app-status', (event, status) => {
  console.log('App status:', status);
});</pre>

                <div class="code-header">ä¸»è¿›ç¨‹ (Main Process)</div>
                <pre class="code-block">// ç›‘å¬æ¸²æŸ“è¿›ç¨‹æ¶ˆæ¯
ipcMain.on('perform-action', (event, args) => {
  if (args.type === 'save-data') {
    saveDataToFile(args.data);
  }
});

// å¤„ç†æ¸²æŸ“è¿›ç¨‹çš„è°ƒç”¨è¯·æ±‚
ipcMain.handle('read-file', async (event, filePath) => {
  return fs.promises.readFile(filePath, 'utf-8');
});

// å‘æ‰€æœ‰æ¸²æŸ“è¿›ç¨‹å¹¿æ’­æ¶ˆæ¯
mainWindow.webContents.send('app-status', 'ready');</pre>
              </div>

              <div v-if="activeTab === 1" class="code-example">
                <div class="code-header">é¢„åŠ è½½è„šæœ¬ (Preload Script)</div>
                <pre class="code-block">// preload.js
const { contextBridge, ipcRenderer } = require('electron');

// å®‰å…¨åœ°æš´éœ² IPC æ–¹æ³•ç»™æ¸²æŸ“è¿›ç¨‹
contextBridge.exposeInMainWorld('electronAPI', {
  openFile: () => ipcRenderer.invoke('dialog:openFile'),
  saveData: (data) => ipcRenderer.send('data:save', data),
  onUpdate: (callback) => {
    ipcRenderer.on('data:update', (event, data) => callback(data));
  }
});</pre>

                <div class="code-header">æ¸²æŸ“è¿›ç¨‹ (Renderer Process)</div>
                <pre class="code-block">// ä½¿ç”¨æš´éœ²çš„ API
const openFile = async () => {
  const filePath = await window.electronAPI.openFile();
  console.log('Selected file:', filePath);
};

const saveData = () => {
  window.electronAPI.saveData({ key: 'value' });
};

// ç›‘å¬æ›´æ–°
window.electronAPI.onUpdate((data) => {
  console.log('Data updated:', data);
});</pre>
              </div>

              <div v-if="activeTab === 2" class="code-example">
                <div class="code-header">æ¸²æŸ“è¿›ç¨‹ (Renderer Process)</div>
                <pre class="code-block">// å‘é€æ¶ˆæ¯åˆ°ä¸»è¿›ç¨‹
ipcRenderer.send('message:send', {
  text: 'Hello from renderer!',
  timestamp: Date.now()
});

// ç›‘å¬ä¸»è¿›ç¨‹å›å¤
ipcRenderer.once('message:reply', (event, reply) => {
  console.log('Main process reply:', reply);
});</pre>

                <div class="code-header">ä¸»è¿›ç¨‹ (Main Process)</div>
                <pre class="code-block">// ç›‘å¬æ¶ˆæ¯å¹¶å›å¤
ipcMain.on('message:send', (event, message) => {
  console.log('Renderer says:', message.text);

  // å›å¤æ¶ˆæ¯
  event.sender.send('message:reply', {
    status: 'received',
    original: message
  });
});</pre>
              </div>
            </div>
          </div>
        </section>

        <section class="content-section">
          <div class="section-header">
            <h2><span class="icon">ğŸ›¡ï¸</span> IPC å®‰å…¨æœ€ä½³å®è·µ</h2>
            <div class="section-badge">å®‰å…¨æŒ‡å—</div>
          </div>

          <div class="security-grid">
            <div class="security-card">
              <div class="security-icon">ğŸ”’</div>
              <h3>å¯ç”¨ä¸Šä¸‹æ–‡éš”ç¦»</h3>
              <p>éš”ç¦»é¢„åŠ è½½è„šæœ¬å’Œæ¸²æŸ“è¿›ç¨‹</p>
              <pre class="inline-code">contextIsolation: true</pre>
            </div>

            <div class="security-card">
              <div class="security-icon">âš ï¸</div>
              <h3>ç¦ç”¨ Node.js é›†æˆ</h3>
              <p>åœ¨æ¸²æŸ“è¿›ç¨‹ä¸­ç¦ç”¨ Node.js</p>
              <pre class="inline-code">nodeIntegration: false</pre>
            </div>

            <div class="security-card">
              <div class="security-icon">ğŸ›¡ï¸</div>
              <h3>ä½¿ç”¨é¢„åŠ è½½è„šæœ¬</h3>
              <p>å®‰å…¨æš´éœ²æœ‰é™ API ç»™æ¸²æŸ“è¿›ç¨‹</p>
              <pre class="inline-code">contextBridge.exposeInMainWorld</pre>
            </div>

            <div class="security-card">
              <div class="security-icon">ğŸ”</div>
              <h3>éªŒè¯ IPC æ¶ˆæ¯</h3>
              <p>å§‹ç»ˆéªŒè¯å‘é€å’Œæ¥æ”¶çš„æ•°æ®</p>
              <pre class="inline-code">if (typeof data !== 'string') return</pre>
            </div>
          </div>

          <div class="security-tips">
            <h3>å®‰å…¨æ³¨æ„äº‹é¡¹ï¼š</h3>
            <ul>
              <li>æ°¸è¿œä¸è¦æš´éœ²æ•´ä¸ª ipcRenderer ç»™æ¸²æŸ“è¿›ç¨‹</li>
              <li>é™åˆ¶æš´éœ²ç»™æ¸²æŸ“è¿›ç¨‹çš„ API æ•°é‡</li>
              <li>å¯¹ IPC æ¶ˆæ¯è¿›è¡Œä¸¥æ ¼çš„è¾“å…¥éªŒè¯</li>
              <li>ä½¿ç”¨ invoke() è€Œä¸æ˜¯ send() è¿›è¡Œæ•æ„Ÿæ“ä½œ</li>
              <li>å®šæœŸæ›´æ–° Electron ç‰ˆæœ¬</li>
            </ul>
          </div>
        </section>
      </main>
    </div>

    <footer class="footer">
      <p>Electron 26.0.0 | Vue 3 | TypeScript | IPC è¿›ç¨‹é€šä¿¡æŒ‡å—</p>
    </footer>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue';

const activeTab = ref(0);

const tabs = [
  { title: 'åŸºç¡€é€šä¿¡' },
  { title: 'é¢„åŠ è½½è„šæœ¬' },
  { title: 'æ¶ˆæ¯æ¨¡å¼' }
];
</script>

<style lang="less" scoped>


:root {
  --primary-color: #47848f;
  --primary-light: #e6f4f1;
  --secondary-color: #6c757d;
  --background: #f8f9fa;
  --card-bg: #ffffff;
  --border-color: #e0e0e0;
  --text-primary: #212529;
  --text-secondary: #495057;
  --success: #28a745;
  --info: #17a2b8;
  --warning: #ffc107;
  --danger: #dc3545;
  --code-bg: #f5f7fa;
  --shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0, 0, 0, 0.05);
  --radius: 8px;
  --transition: all 0.3s ease;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

.electron-ipc-container {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  background-color: var(--background);
  color: var(--text-primary);
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  line-height: 1.6;
}

.header {
  background: linear-gradient(135deg, var(--primary-color), #2c6e7f);
  color: white;
  padding: 1.5rem 2rem;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);

  .logo-container {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 0.5rem;

    h1 {
      font-weight: 600;
      font-size: 1.75rem;
    }
  }

  .subtitle {
    font-size: 1.1rem;
    opacity: 0.9;
    font-weight: 300;
  }
}

.electron-logo {
  width: 48px;
  height: 48px;
  background: linear-gradient(135deg, #9FEAF9, #2c6e7f);
  border-radius: 50%;
  position: relative;

  &::before,
  &::after {
    content: '';
    position: absolute;
    border-radius: 50%;
  }

  &::before {
    width: 32px;
    height: 32px;
    background: linear-gradient(135deg, #47848f, #1a4d5a);
    top: 8px;
    left: 8px;
  }

  &::after {
    width: 16px;
    height: 16px;
    background: white;
    top: 16px;
    left: 16px;
  }
}

.content-wrapper {
  max-width: 1200px;
  margin: 0 auto;
  width: 100%;
  padding: 1.5rem;
}

.main-content {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.content-section {
  background: var(--card-bg);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding: 2rem;

  .section-header {
    display: flex;
    align-items: center;
    margin-bottom: 1.5rem;
    gap: 1rem;

    h2 {
      font-size: 1.5rem;
      color: var(--primary-color);
      display: flex;
      align-items: center;

      .icon {
        margin-right: 0.75rem;
      }
    }

    .section-badge {
      background: var(--primary-light);
      color: var(--primary-color);
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 500;
    }
  }
}

.concept-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;

  .concept-card {
    background: var(--primary-light);
    border-radius: var(--radius);
    padding: 1.5rem;
    border: 1px solid rgba(71, 132, 143, 0.2);
    text-align: center;

    .concept-icon {
      font-size: 2.5rem;
      margin-bottom: 1rem;
    }

    h3 {
      margin-top: 0;
      color: var(--primary-color);
    }

    p {
      color: var(--text-secondary);
    }
  }
}

.ipc-flow-diagram {
  display: flex;
  background: var(--code-bg);
  border-radius: var(--radius);
  padding: 1.5rem;
  margin: 1.5rem 0;

  .process {
    flex: 1;
    padding: 1rem;
    text-align: center;

    &.main-process {
      background: rgba(71, 132, 143, 0.1);
      border-radius: var(--radius) 0 0 var(--radius);
    }

    &.renderer-process {
      background: rgba(108, 117, 125, 0.1);
      border-radius: 0 var(--radius) var(--radius) 0;
    }

    .process-header {
      font-weight: 600;
      margin-bottom: 1.5rem;
      color: var(--primary-color);
    }

    .ipc-method {
      background: white;
      padding: 0.75rem;
      margin-bottom: 0.75rem;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);

      .method-name {
        font-weight: 500;
        font-family: monospace;
        font-size: 0.9rem;
      }

      .method-desc {
        font-size: 0.85rem;
        color: var(--text-secondary);
        margin-top: 0.25rem;
      }
    }
  }

  .communication {
    width: 120px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;

    .arrow {
      font-size: 1.5rem;
      margin: 0.5rem 0;
      color: var(--primary-color);
    }

    .ipc-protocol {
      font-weight: 500;
      color: var(--primary-color);
      background: rgba(71, 132, 143, 0.1);
      padding: 0.25rem 0.75rem;
      border-radius: 4px;
      margin-top: 0.5rem;
    }
  }
}

.scenario-cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1.5rem;
  margin: 1.5rem 0;

  .scenario-card {
    background: white;
    border-radius: var(--radius);
    padding: 1.5rem;
    box-shadow: var(--shadow);
    transition: var(--transition);
    border: 1px solid var(--border-color);

    &:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.08);
    }

    .scenario-icon {
      font-size: 2rem;
      margin-bottom: 1rem;
      color: var(--primary-color);
    }

    h3 {
      margin-top: 0;
      color: var(--text-primary);
    }

    p {
      color: var(--text-secondary);
      margin: 0.5rem 0 1rem;
      font-size: 0.95rem;
    }

    .code-snippet {
      background: var(--code-bg);
      border-radius: 4px;
      padding: 0.75rem;
      font-family: monospace;
      font-size: 0.9rem;
      overflow: hidden;
      text-overflow: ellipsis;
    }
  }
}

.ipc-demo {
  background: var(--code-bg);
  border-radius: var(--radius);
  overflow: hidden;
  margin: 1.5rem 0;

  .demo-tabs {
    display: flex;
    background: var(--primary-light);
    border-bottom: 1px solid var(--border-color);

    .demo-tab {
      padding: 0.85rem 1.5rem;
      cursor: pointer;
      font-weight: 500;
      color: var(--text-secondary);
      transition: var(--transition);
      border-bottom: 3px solid transparent;

      &:hover {
        color: var(--primary-color);
        background: rgba(255, 255, 255, 0.4);
      }

      &.active {
        color: var(--primary-color);
        border-bottom: 3px solid var(--primary-color);
        background: white;
      }
    }
  }

  .demo-content {
    padding: 1.5rem;

    .code-example {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .code-header {
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--primary-color);
      font-size: 1.1rem;
      display: flex;
      align-items: center;

      &::before {
        content: 'â–¹';
        margin-right: 0.5rem;
        color: var(--primary-color);
      }
    }

    .code-block {
      background: #2c3e50;
      color: #ecf0f1;
      padding: 1.5rem;
      border-radius: var(--radius);
      font-family: 'Fira Code', monospace;
      font-size: 0.95rem;
      line-height: 1.6;
      overflow-x: auto;
      white-space: pre;
      tab-size: 2;
    }
  }
}

.security-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1.5rem;
  margin: 1.5rem 0;

  .security-card {
    background: white;
    border-radius: var(--radius);
    padding: 1.5rem;
    border-left: 4px solid var(--primary-color);
    box-shadow: var(--shadow);

    .security-icon {
      font-size: 2rem;
      margin-bottom: 1rem;
      color: var(--primary-color);
    }

    h3 {
      margin-top: 0;
      color: var(--text-primary);
    }

    p {
      color: var(--text-secondary);
      margin: 0.5rem 0 1rem;
      font-size: 0.95rem;
    }

    .inline-code {
      background: var(--code-bg);
      border-radius: 4px;
      padding: 0.25rem 0.5rem;
      font-family: monospace;
      font-size: 0.9rem;
      display: inline-block;
    }
  }
}

.security-tips {
  background: var(--primary-light);
  border-radius: var(--radius);
  padding: 1.5rem;
  margin-top: 1.5rem;

  h3 {
    margin-top: 0;
    margin-bottom: 1rem;
    color: var(--primary-color);
  }

  ul {
    padding-left: 1.5rem;

    li {
      margin-bottom: 0.75rem;
      position: relative;
      padding-left: 1.5rem;

      &::before {
        content: 'â€¢';
        position: absolute;
        left: 0;
        color: var(--primary-color);
        font-weight: bold;
      }
    }
  }
}

.footer {
  text-align: center;
  padding: 1.5rem;
  color: var(--text-secondary);
  font-size: 0.9rem;
  background: var(--card-bg);
  margin-top: 2rem;
}

@media (max-width: 768px) {
  .header {
    padding: 1rem;

    .logo-container h1 {
      font-size: 1.5rem;
    }

    .subtitle {
      font-size: 1rem;
    }
  }

  .content-section {
    padding: 1.5rem;
  }

  .ipc-flow-diagram {
    flex-direction: column;

    .process {
      &.main-process {
        border-radius: var(--radius) var(--radius) 0 0;
      }

      &.renderer-process {
        border-radius: 0 0 var(--radius) var(--radius);
      }
    }

    .communication {
      width: 100%;
      flex-direction: row;
      padding: 1rem 0;

      .arrow {
        transform: rotate(90deg);
        margin: 0 1rem;
      }
    }
  }

  .demo-tabs {
    overflow-x: auto;

    .demo-tab {
      flex-shrink: 0;
    }
  }
}
</style>
