<template>
  <div class="dependency-container">
    <header class="header">
      <h1>依赖利用 (Dependency Exploitation)</h1>
      <p class="subtitle">保护您的应用免受第三方代码的威胁</p>
    </header>

    <div class="stats-overview">
      <div class="stat-card">
        <div class="stat-value">99%</div>
        <p class="stat-label">的现代应用包含开源依赖</p>
      </div>
      <div class="stat-card">
        <div class="stat-value">700%</div>
        <p class="stat-label">供应链攻击年增长率 (2021)</p>
      </div>
      <div class="stat-card">
        <div class="stat-value">1,500+</div>
        <p class="stat-label">平均每个项目的依赖数量</p>
      </div>
    </div>

    <div class="main-content">
      <div class="left-column">
        <section class="card">
          <div class="card-header">
            <span class="card-icon">❓</span>
            <h2>什么是依赖利用？</h2>
          </div>
          <div class="card-body">
            <p>依赖利用是一种通过应用程序的第三方依赖（例如npm包、开源库）来实施攻击的安全威胁。攻击者可以利用这些依赖中的漏洞，或者直接将恶意代码注入到广泛使用的包中，从而对下游应用造成破坏。</p>
            <div class="analogy">
              <div class="analogy-icon">⛓️</div>
              <div class="analogy-text">
                <strong>类比：</strong>
                就像建筑物的地基或管道系统，如果其中一个组件有缺陷，整栋大楼都可能面临风险。
              </div>
            </div>
          </div>
        </section>

        <section class="card">
          <div class="card-header">
            <span class="card-icon">⚔️</span>
            <h2>常见攻击类型</h2>
          </div>
          <div class="card-body">
            <div class="attack-types-grid">
              <div v-for="attack in attackTypes" :key="attack.name" class="attack-type-card">
                <div class="attack-type-icon">{{ attack.icon }}</div>
                <h3>{{ attack.name }}</h3>
                <p>{{ attack.description }}</p>
              </div>
            </div>
          </div>
        </section>

        <section class="card">
          <div class="card-header">
            <span class="card-icon">📜</span>
            <h2>真实案例: event-stream (2018)</h2>
          </div>
          <div class="card-body">
            <p>这是一个著名的供应链攻击案例。攻击者获得了流行的npm包 <code>event-stream</code> 的发布权限，并注入了专门窃取加密货币钱包的恶意代码。由于数百万项目依赖此包，造成了广泛影响。</p>
            <div class="case-study-details">
              <div><strong>影响范围：</strong>每周数百万次下载</div>
              <div><strong>攻击向量：</strong>社交工程获取包权限</div>
              <div><strong>后果：</strong>用户资金被盗，开发者信任危机</div>
            </div>
          </div>
        </section>
      </div>

      <div class="right-column">
        <section class="card">
          <div class="card-header">
            <span class="card-icon">🛡️</span>
            <h2>核心防御策略</h2>
          </div>
          <div class="card-body">
            <div class="defense-strategy" v-for="strategy in defenseStrategies" :key="strategy.name">
              <h3>{{ strategy.name }}</h3>
              <p>{{ strategy.description }}</p>
              <pre><code>{{ strategy.code }}</code></pre>
            </div>
          </div>
        </section>

        <section class="card">
          <div class="card-header">
            <span class="card-icon">🛠️</span>
            <h2>必备安全工具</h2>
          </div>
          <div class="card-body">
            <div class="tools-grid">
              <div v-for="tool in securityTools" :key="tool.name" class="tool-card">
                <h3>{{ tool.name }}</h3>
                <p>{{ tool.description }}</p>
                <a :href="tool.link" target="_blank" class="tool-link">了解更多</a>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>

    <footer class="footer">
      <p>依赖安全是现代软件开发的基石。保持警惕，定期审查，并使用自动化工具来保护您的项目。</p>
    </footer>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue';

const attackTypes = ref([
  { name: '恶意代码注入', icon: '💉', description: '在看似无害的包中隐藏恶意功能，如数据窃取或挖矿脚本。' },
  { name: '包劫持 (Typosquatting)', icon: '🎭', description: '发布与流行包名称相似的恶意包，利用开发者的拼写错误。' },
  { name: '依赖混淆', icon: '🌀', description: '欺骗构建工具使用内部网络上的同名恶意包，而非公共源的合法包。' },
  { name: '漏洞利用', icon: '🐛', description: '利用已知但未修复的依赖项漏洞来攻击应用程序。' },
]);

const defenseStrategies = ref([
  {
    name: '1. 依赖锁定',
    description: '使用 `package-lock.json` 或 `yarn.lock` 文件来锁定依赖的确切版本，防止未经审查的更新。',
    code: '# npm 会自动生成 package-lock.json\nnpm install',
  },
  {
    name: '2. 定期审计',
    description: '使用包管理器内置的审计功能来扫描已知漏洞。',
    code: 'npm audit\n\n# 修复可自动修复的漏洞\nnpm audit fix',
  },
  {
    name: '3. 自动化扫描',
    description: '将依赖扫描集成到CI/CD流程中，例如使用GitHub的Dependabot或第三方服务Snyk。',
    code: '# .github/dependabot.yml\nversion: 2\nupdates:\n  - package-ecosystem: "npm"\n    directory: "/"\n    schedule:\n      interval: "daily"',
  },
  {
    name: '4. 使用 `.npmrc` 增强安全性',
    description: '配置 `.npmrc` 文件，可以强制使用HTTPS、指定私有仓库、或启用严格的SSL验证，增加包下载过程的安全性。',
    code: `// .npmrc 文件示例
registry=https://registry.npmjs.org/
always-auth=true
strict-ssl=true
`,
  },
]);

const securityTools = ref([
  { name: 'Snyk', description: '强大的开发者安全平台，提供漏洞扫描、代码修复建议等。', link: 'https://snyk.io/' },
  { name: 'Dependabot', description: 'GitHub原生工具，自动创建PR以更新有漏洞的依赖。', link: 'https://github.com/dependabot' },
  { name: 'Socket.dev', description: '深入分析npm包的行为，检测供应链攻击的风险信号。', link: 'https://socket.dev/' },
  { name: 'npm-audit-resolver', description: '帮助解决复杂的npm audit问题，管理漏洞修复决策。', link: 'https://www.npmjs.com/package/npm-audit-resolver' },
]);
</script>

<style scoped lang="less">
.dependency-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background-color: #f9fafb;
  color: #1f2937;
}

.header {
  text-align: center;
  margin-bottom: 2.5rem;

  h1 {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
  }

  .subtitle {
    font-size: 1.2rem;
    color: #6b7280;
  }
}

.stats-overview {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2.5rem;
}

.stat-card {
  background-color: #ffffff;
  padding: 1.5rem;
  border-radius: 12px;
  text-align: center;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
  border: 1px solid #e5e7eb;

  .stat-value {
    font-size: 2.25rem;
    font-weight: 800;
    color: #3b82f6;
  }

  .stat-label {
    margin-top: 0.5rem;
    color: #4b5563;
  }
}

.main-content {
  display: grid;
  grid-template-columns: repeat(12, 1fr);
  gap: 2rem;
}

.left-column {
  grid-column: span 12;
}

.right-column {
  grid-column: span 12;
}

.card {
  background-color: #ffffff;
  border-radius: 12px;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
  margin-bottom: 2rem;
  overflow: hidden;
  border: 1px solid #e5e7eb;

  &-header {
    display: flex;
    align-items: center;
    padding: 1rem 1.5rem;
    background-color: #f3f4f6;
    border-bottom: 1px solid #e5e7eb;

    .card-icon {
      font-size: 1.5rem;
      margin-right: 0.75rem;
    }

    h2 {
      font-size: 1.25rem;
      font-weight: 600;
    }
  }

  &-body {
    padding: 1.5rem;
    line-height: 1.6;

    p {
      margin-bottom: 1rem;
    }
  }
}

.analogy {
  display: flex;
  align-items: center;
  background-color: #eff6ff;
  padding: 1rem;
  border-radius: 8px;
  border: 1px solid #bfdbfe;

  &-icon {
    font-size: 1.8rem;
    margin-right: 1rem;
  }

  &-text strong {
    color: #1e40af;
  }
}

.attack-types-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 1rem;
}

.attack-type-card {
  text-align: center;
  padding: 1.5rem;
  background-color: #f9fafb;
  border-radius: 8px;
  border: 1px solid #e5e7eb;

  .attack-type-icon {
    font-size: 2rem;
    margin-bottom: 0.5rem;
  }

  h3 {
    font-weight: 600;
    margin-bottom: 0.25rem;
  }
}

.case-study-details {
  background-color: #fefce8;
  border: 1px solid #fde047;
  padding: 1rem;
  border-radius: 8px;

  div {
    margin-bottom: 0.5rem;

    strong {
      color: #a16207;
    }
  }
}

.defense-strategy {
  margin-bottom: 1.5rem;

  &:last-child {
    margin-bottom: 0;
  }

  h3 {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
  }
}

pre {
  background-color: #1f2937;
  color: #e5e7eb;
  padding: 1rem;
  border-radius: 8px;
  overflow-x: auto;
  font-family: 'Fira Code', 'JetBrains Mono', monospace;
  font-size: 0.9rem;
  line-height: 1.5;
}

.tools-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
}

.tool-card {
  background-color: #f3f4f6;
  padding: 1.5rem;
  border-radius: 8px;
  border: 1px solid #d1d5db;

  h3 {
    font-weight: 600;
  }

  .tool-link {
    display: inline-block;
    margin-top: 0.75rem;
    color: #3b82f6;
    text-decoration: none;
    font-weight: 500;

    &:hover {
      text-decoration: underline;
    }
  }
}

.footer {
  text-align: center;
  margin-top: 3rem;
  padding-top: 2rem;
  border-top: 1px solid #e5e7eb;
  color: #6b7280;
}

@media (min-width: 768px) {
  .left-column {
    grid-column: span 7;
  }

  .right-column {
    grid-column: span 5;
  }
}
</style>
