<template>
  <div class="chain-container">
    <div class="pattern-hero">
      <div class="hero-content">
        <h1>è´£ä»»é“¾æ¨¡å¼ (Chain of Responsibility)</h1>
        <p class="hero-subtitle">å°†è¯·æ±‚æ²¿ç€å¤„ç†é“¾ä¼ é€’ï¼Œç›´åˆ°æœ‰å¯¹è±¡å¤„ç†å®ƒ</p>

        <div class="chain-visualization">
          <div class="chain-link" v-for="(handler, index) in handlers" :key="index">
            <div class="handler-card">
              <div class="handler-icon">{{ handler.icon }}</div>
              <div class="handler-name">{{ handler.name }}</div>
              <div class="handler-limit">å¤„ç†ä¸Šé™: {{ handler.limit }}</div>
            </div>
            <div class="chain-connector" v-if="index < handlers.length - 1">
              <div class="connector-line"></div>
              <div class="connector-arrow">â†“</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="pattern-tabs">
      <button v-for="tab in tabs" :key="tab.id" :class="{ active: activeTab === tab.id }" @click="activeTab = tab.id"
        class="tab-button">
        <span class="tab-icon">{{ tab.icon }}</span>
        {{ tab.title }}
      </button>
    </div>

    <div class="pattern-content">
      <!-- æ¦‚å¿µä»‹ç» -->
      <section v-if="activeTab === 'concept'" class="content-section">
        <div class="concept-intro">
          <div class="intro-card">
            <div class="intro-icon">ğŸ”—</div>
            <div class="intro-text">
              <h2>è´£ä»»é“¾æ¨¡å¼æ¦‚å¿µ</h2>
              <p>
                <strong>è´£ä»»é“¾æ¨¡å¼</strong>æ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸ä½ å°†è¯·æ±‚æ²¿ç€å¤„ç†è€…é“¾è¿›è¡Œå‘é€ã€‚æ¯ä¸ªå¤„ç†è€…å‡å¯å¯¹è¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œæˆ–å°†å…¶ä¼ é€’ç»™é“¾ä¸Šçš„ä¸‹ä¸€ä¸ªå¤„ç†è€…ã€‚
                è¿™ç§æ¨¡å¼è§£è€¦äº†è¯·æ±‚çš„å‘é€è€…å’Œæ¥æ”¶è€…ï¼Œä½¿å¤šä¸ªå¯¹è±¡éƒ½æœ‰æœºä¼šå¤„ç†è¯·æ±‚ã€‚
              </p>
            </div>
          </div>

          <div class="pattern-principle">
            <h3>æ ¸å¿ƒåŸåˆ™</h3>
            <div class="principles">
              <div class="principle">
                <div class="principle-icon">ğŸ”„</div>
                <h4>è¯·æ±‚ä¼ é€’</h4>
                <p>è¯·æ±‚æ²¿ç€å¤„ç†é“¾ä¼ é€’ç›´åˆ°è¢«å¤„ç†</p>
              </div>
              <div class="principle">
                <div class="principle-icon">ğŸ§©</div>
                <h4>è§£è€¦å‘é€è€…ä¸æ¥æ”¶è€…</h4>
                <p>å‘é€è€…æ— éœ€çŸ¥é“å“ªä¸ªå¯¹è±¡ä¼šå¤„ç†è¯·æ±‚</p>
              </div>
              <div class="principle">
                <div class="principle-icon">âš™ï¸</div>
                <h4>åŠ¨æ€é“¾</h4>
                <p>å¤„ç†é“¾å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€æ”¹å˜</p>
              </div>
            </div>
          </div>
        </div>

        <div class="pattern-structure">
          <h3>æ¨¡å¼ç»“æ„</h3>
          <div class="structure-diagram">
            <div class="structure-item handler">
              <div class="class-header">Handler</div>
              <div class="class-methods">
                <div>+ setNext(handler)</div>
                <div>+ handle(request)</div>
              </div>
            </div>

            <div class="structure-item concrete-handler">
              <div class="class-header">ConcreteHandlerA</div>
              <div class="class-methods">
                <div>+ handle(request)</div>
              </div>
            </div>

            <div class="structure-item concrete-handler">
              <div class="class-header">ConcreteHandlerB</div>
              <div class="class-methods">
                <div>+ handle(request)</div>
              </div>
            </div>

            <div class="relation-arrow handler-to-concrete"></div>
            <div class="relation-arrow concrete-to-concrete"></div>
          </div>

          <div class="structure-explanation">
            <div class="explanation-item">
              <span class="component">Handler</span>
              <span class="desc">- å£°æ˜å¤„ç†è¯·æ±‚çš„æ¥å£ï¼Œå¹¶å®ç°è®¾ç½®åç»§è€…çš„æ–¹æ³•</span>
            </div>
            <div class="explanation-item">
              <span class="component">ConcreteHandler</span>
              <span class="desc">- å¤„ç†å®ƒè´Ÿè´£çš„è¯·æ±‚ï¼Œå¯è®¿é—®åç»§è€…ï¼Œèƒ½å¤„ç†åˆ™å¤„ç†ï¼Œä¸èƒ½åˆ™è½¬å‘</span>
            </div>
            <div class="explanation-item">
              <span class="component">Client</span>
              <span class="desc">- å‘é“¾ä¸Šçš„å…·ä½“å¤„ç†è€…å¯¹è±¡æäº¤è¯·æ±‚</span>
            </div>
          </div>
        </div>
      </section>

      <!-- è®¾è®¡æ€è·¯ -->
      <section v-if="activeTab === 'design'" class="content-section">
        <h2>è´£ä»»é“¾æ¨¡å¼çš„è®¾è®¡æ€è·¯</h2>

        <div class="implementation-steps">
          <div class="step">
            <div class="step-number">1</div>
            <div class="step-content">
              <h3>å®šä¹‰å¤„ç†è€…æ¥å£</h3>
              <p>åˆ›å»ºå¤„ç†è€…æ¥å£ï¼Œå£°æ˜å¤„ç†è¯·æ±‚çš„æ–¹æ³•å’Œè®¾ç½®ä¸‹ä¸€ä¸ªå¤„ç†è€…çš„æ–¹æ³•</p>
              <div class="code-block">
                <pre><code>abstract class Handler {
  protected nextHandler: Handler | null = null;

  public setNext(handler: Handler): Handler {
    this.nextHandler = handler;
    return handler;
  }

  public abstract handle(request: any): string;
}</code></pre>
              </div>
            </div>
          </div>

          <div class="step">
            <div class="step-number">2</div>
            <div class="step-content">
              <h3>å®ç°å…·ä½“å¤„ç†è€…</h3>
              <p>åˆ›å»ºå…·ä½“å¤„ç†è€…ç±»ï¼Œå®ç°å¤„ç†è¯·æ±‚çš„é€»è¾‘</p>
              <div class="code-block">
                <pre><code>class ConcreteHandlerA extends Handler {
  private maxLimit = 100;

  public handle(request: number): string {
    if (request &lt;= this.maxLimit) {
      return `è¯·æ±‚ ${request} è¢«å¤„ç†è€…Aå¤„ç†`;
    } else if (this.nextHandler) {
      return this.nextHandler.handle(request);
    }
    return `è¯·æ±‚ ${request} æ— æ³•è¢«å¤„ç†`;
  }
}

class ConcreteHandlerB extends Handler {
  private maxLimit = 500;

  public handle(request: number): string {
    if (request &lt;= this.maxLimit) {
      return `è¯·æ±‚ ${request} è¢«å¤„ç†è€…Bå¤„ç†`;
    } else if (this.nextHandler) {
      return this.nextHandler.handle(request);
    }
    return `è¯·æ±‚ ${request} æ— æ³•è¢«å¤„ç†`;
  }
}</code></pre>
              </div>
            </div>
          </div>

          <div class="step">
            <div class="step-number">3</div>
            <div class="step-content">
              <h3>æ„å»ºå¤„ç†é“¾</h3>
              <p>å°†å¤„ç†è€…é“¾æ¥æˆä¸€æ¡é“¾</p>
              <div class="code-block">
                <pre><code>// åˆ›å»ºå¤„ç†è€…å®ä¾‹
const handlerA = new ConcreteHandlerA();
const handlerB = new ConcreteHandlerB();

// æ„å»ºè´£ä»»é“¾
handlerA.setNext(handlerB);</code></pre>
              </div>
            </div>
          </div>

          <div class="step">
            <div class="step-number">4</div>
            <div class="step-content">
              <h3>å®¢æˆ·ç«¯æäº¤è¯·æ±‚</h3>
              <p>å®¢æˆ·ç«¯å‘é“¾ä¸Šçš„ç¬¬ä¸€ä¸ªå¤„ç†è€…æäº¤è¯·æ±‚</p>
              <div class="code-block">
                <pre><code>// å¤„ç†è¯·æ±‚
console.log(handlerA.handle(50));   // è¢«Aå¤„ç†
console.log(handlerA.handle(200));  // è¢«Bå¤„ç†
console.log(handlerA.handle(600));  // æ— æ³•å¤„ç†</code></pre>
              </div>
            </div>
          </div>
        </div>

        <div class="pattern-demo">
          <h3>è´£ä»»é“¾æ¨¡å¼æ¼”ç¤º - å®¡æ‰¹ç³»ç»Ÿ</h3>
          <div class="demo-container">
            <div class="demo-controls">
              <div class="request-form">
                <label>å®¡æ‰¹ç±»å‹:</label>
                <Select v-model="requestType">
                  <option value="leave">è¯·å‡ç”³è¯·</option>
                  <option value="expense">æŠ¥é”€ç”³è¯·</option>
                  <option value="purchase">é‡‡è´­ç”³è¯·</option>
                </select>

                <label>ç”³è¯·é‡‘é¢/å¤©æ•°:</label>
                <input type="number" v-model="requestValue" min="1" max="10000">

                <button @click="submitRequest">æäº¤ç”³è¯·</button>
              </div>
            </div>

            <div class="demo-results">
              <div class="request-status">
                <div class="status-title">å¤„ç†ç»“æœ</div>
                <div class="status-content" :class="{
                  'status-pending': result.status === 'pending',
                  'status-approved': result.status === 'approved',
                  'status-rejected': result.status === 'rejected'
                }">
                  {{ result.message || 'ç­‰å¾…æäº¤ç”³è¯·...' }}
                </div>
              </div>

              <div class="chain-process">
                <div class="process-title">å¤„ç†æµç¨‹</div>
                <div class="process-steps">
                  <div v-for="(step, index) in processSteps" :key="index" class="process-step">
                    <div class="step-icon">{{ handlers[index].icon }}</div>
                    <div class="step-info">
                      <div class="step-handler">{{ handlers[index].name }}</div>
                      <div class="step-action" :class="{
                        'action-approve': step.action === 'approved',
                        'action-reject': step.action === 'rejected',
                        'action-forward': step.action === 'forwarded'
                      }">
                        {{ getActionText(step.action) }}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ä½¿ç”¨åœºæ™¯ -->
      <section v-if="activeTab === 'usage'" class="content-section">
        <h2>è´£ä»»é“¾æ¨¡å¼çš„ä½¿ç”¨åœºæ™¯</h2>

        <div class="usage-scenarios">
          <div class="scenario-card">
            <div class="scenario-icon">ğŸ“‹</div>
            <div class="scenario-content">
              <h3>å®¡æ‰¹ç³»ç»Ÿ</h3>
              <p>å¤šçº§å®¡æ‰¹æµç¨‹ï¼ˆå‘˜å·¥ â†’ ç»ç† â†’ æ€»ç›‘ï¼‰</p>
              <ul>
                <li>è¯·å‡å®¡æ‰¹</li>
                <li>æŠ¥é”€å®¡æ‰¹</li>
                <li>é‡‡è´­å®¡æ‰¹</li>
              </ul>
            </div>
          </div>

          <div class="scenario-card">
            <div class="scenario-icon">ğŸ›¡ï¸</div>
            <div class="scenario-content">
              <h3>å®‰å…¨ç³»ç»Ÿ</h3>
              <p>å¤šå±‚å®‰å…¨éªŒè¯</p>
              <ul>
                <li>èº«ä»½éªŒè¯é“¾</li>
                <li>æƒé™æ£€æŸ¥é“¾</li>
                <li>å®‰å…¨å®¡è®¡é“¾</li>
              </ul>
            </div>
          </div>

          <div class="scenario-card">
            <div class="scenario-icon">ğŸ›’</div>
            <div class="scenario-content">
              <h3>ç”µå•†ç³»ç»Ÿ</h3>
              <p>è®¢å•å¤„ç†æµç¨‹</p>
              <ul>
                <li>åº“å­˜æ£€æŸ¥</li>
                <li>æ”¯ä»˜å¤„ç†</li>
                <li>ç‰©æµå®‰æ’</li>
              </ul>
            </div>
          </div>

          <div class="scenario-card">
            <div class="scenario-icon">ğŸš¨</div>
            <div class="scenario-content">
              <h3>å¼‚å¸¸å¤„ç†</h3>
              <p>å¤šå±‚å¼‚å¸¸æ•è·æœºåˆ¶</p>
              <ul>
                <li>é”™è¯¯æ—¥å¿—è®°å½•</li>
                <li>é”™è¯¯æ¢å¤å°è¯•</li>
                <li>ç”¨æˆ·é€šçŸ¥</li>
              </ul>
            </div>
          </div>

          <div class="scenario-card">
            <div class="scenario-icon">ğŸ“</div>
            <div class="scenario-content">
              <h3>æ—¥å¿—ç³»ç»Ÿ</h3>
              <p>å¤šçº§æ—¥å¿—å¤„ç†</p>
              <ul>
                <li>æ§åˆ¶å°è¾“å‡º</li>
                <li>æ–‡ä»¶è®°å½•</li>
                <li>è¿œç¨‹æ—¥å¿—æœåŠ¡</li>
              </ul>
            </div>
          </div>

          <div class="scenario-card">
            <div class="scenario-icon">ğŸ®</div>
            <div class="scenario-content">
              <h3>æ¸¸æˆç³»ç»Ÿ</h3>
              <p>æ¸¸æˆäº‹ä»¶å¤„ç†</p>
              <ul>
                <li>ç¢°æ’æ£€æµ‹</li>
                <li>ä¼¤å®³è®¡ç®—</li>
                <li>ç‰¹æ•ˆè§¦å‘</li>
              </ul>
            </div>
          </div>

          <div class="scenario-card">
            <div class="scenario-icon">ğŸ¦</div>
            <div class="scenario-content">
              <h3>é‡‘èç³»ç»Ÿ</h3>
              <p>äº¤æ˜“éªŒè¯æµç¨‹</p>
              <ul>
                <li>ä½™é¢æ£€æŸ¥</li>
                <li>é£æ§æ£€æŸ¥</li>
                <li>åˆè§„æ£€æŸ¥</li>
              </ul>
            </div>
          </div>

          <div class="scenario-card">
            <div class="scenario-icon">ğŸ“§</div>
            <div class="scenario-content">
              <h3>æ¶ˆæ¯å¤„ç†</h3>
              <p>æ¶ˆæ¯è¿‡æ»¤å’Œå¤„ç†é“¾</p>
              <ul>
                <li>åƒåœ¾é‚®ä»¶è¿‡æ»¤</li>
                <li>å†…å®¹åˆ†æ</li>
                <li>è‡ªåŠ¨å›å¤</li>
              </ul>
            </div>
          </div>
        </div>
      </section>

      <!-- ä¼˜ç¼ºç‚¹ -->
      <section v-if="activeTab === 'pros-cons'" class="content-section">
        <h2>è´£ä»»é“¾æ¨¡å¼çš„ä¼˜ç¼ºç‚¹</h2>

        <div class="pros-cons-container">
          <div class="pros-section">
            <div class="section-header">
              <span class="section-icon">âœ…</span>
              <h3>ä¼˜ç‚¹</h3>
            </div>
            <ul class="pros-list">
              <li v-for="(pro, index) in pros" :key="index" class="pro-item">
                <div class="pro-icon">âœ“</div>
                <div class="pro-content">
                  <h4>{{ pro.title }}</h4>
                  <p>{{ pro.description }}</p>
                </div>
              </li>
            </ul>
          </div>

          <div class="cons-section">
            <div class="section-header">
              <span class="section-icon">âš ï¸</span>
              <h3>ç¼ºç‚¹</h3>
            </div>
            <ul class="cons-list">
              <li v-for="(con, index) in cons" :key="index" class="con-item">
                <div class="con-icon">âœ—</div>
                <div class="con-content">
                  <h4>{{ con.title }}</h4>
                  <p>{{ con.description }}</p>
                </div>
              </li>
            </ul>
          </div>
        </div>

        <div class="best-practices">
          <h3>æœ€ä½³å®è·µå»ºè®®</h3>
          <div class="practices-grid">
            <div class="practice-card">
              <div class="practice-icon">ğŸ“</div>
              <h4>æ˜ç¡®å¤„ç†èŒƒå›´</h4>
              <p>æ¯ä¸ªå¤„ç†è€…åº”æœ‰æ˜ç¡®çš„å¤„ç†èŒƒå›´å’ŒèŒè´£</p>
            </div>
            <div class="practice-card">
              <div class="practice-icon">ğŸ”„</div>
              <h4>è®¾ç½®é»˜è®¤å¤„ç†</h4>
              <p>åœ¨é“¾çš„æœ«ç«¯è®¾ç½®é»˜è®¤å¤„ç†è€…å¤„ç†æœªå¤„ç†è¯·æ±‚</p>
            </div>
            <div class="practice-card">
              <div class="practice-icon">âš¡</div>
              <h4>é¿å…é•¿é“¾</h4>
              <p>è¿‡é•¿çš„è´£ä»»é“¾ä¼šå½±å“æ€§èƒ½ï¼Œéœ€åˆç†è®¾è®¡</p>
            </div>
            <div class="practice-card">
              <div class="practice-icon">ğŸ§ª</div>
              <h4>å•å…ƒæµ‹è¯•</h4>
              <p>å¯¹æ¯ä¸ªå¤„ç†è€…å•ç‹¬æµ‹è¯•ï¼Œå¹¶æµ‹è¯•æ•´ä¸ªé“¾</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Vueåº”ç”¨ -->
      <section v-if="activeTab === 'vue'" class="content-section">
        <h2>åœ¨Vueä¸­çš„åº”ç”¨</h2>

        <div class="vue-applications">
          <div class="application-card">
            <div class="app-header">
              <div class="app-icon">ğŸ“‹</div>
              <h3>å®¡æ‰¹æµç¨‹ç³»ç»Ÿ</h3>
            </div>
            <div class="app-content">
              <p>å®ç°å¤šçº§å®¡æ‰¹è´£ä»»é“¾</p>
              <div class="code-block">
                <pre><code>// å®¡æ‰¹å¤„ç†è€…åŸºç±»
abstract class Approver {
  protected nextApprover: Approver | null = null;

  setNext(approver: Approver): Approver {
    this.nextApprover = approver;
    return approver;
  }

  abstract processRequest(request: LeaveRequest): void;
}

// å…·ä½“å¤„ç†è€… - ç»„é•¿
class TeamLeader extends Approver {
  processRequest(request: LeaveRequest) {
    if (request.days &lt;= 2) {
      console.log(`ç»„é•¿æ‰¹å‡†äº†${request.name}çš„${request.days}å¤©è¯·å‡`);
    } else if (this.nextApprover) {
      this.nextApprover.processRequest(request);
    }
  }
}

// å…·ä½“å¤„ç†è€… - ç»ç†
class Manager extends Approver {
  processRequest(request: LeaveRequest) {
    if (request.days &lt;= 5) {
      console.log(`ç»ç†æ‰¹å‡†äº†${request.name}çš„${request.days}å¤©è¯·å‡`);
    } else if (this.nextApprover) {
      this.nextApprover.processRequest(request);
    }
  }
}

// åœ¨Vueç»„ä»¶ä¸­ä½¿ç”¨
const teamLeader = new TeamLeader();
const manager = new Manager();
teamLeader.setNext(manager);

const leaveRequests = [
  { name: 'å¼ ä¸‰', days: 1 },
  { name: 'æå››', days: 3 },
  { name: 'ç‹äº”', days: 7 }
];

leaveRequests.forEach(request => {
  teamLeader.processRequest(request);
});</code></pre>
              </div>
            </div>
          </div>

          <div class="application-card">
            <div class="app-header">
              <div class="app-icon">ğŸ›’</div>
              <h3>è®¢å•å¤„ç†ç³»ç»Ÿ</h3>
            </div>
            <div class="app-content">
              <p>å®ç°è®¢å•å¤„ç†è´£ä»»é“¾</p>
              <div class="code-block">
                <pre><code>// è®¢å•å¤„ç†åŸºç±»
abstract class OrderHandler {
  protected nextHandler: OrderHandler | null = null;

  setNext(handler: OrderHandler): OrderHandler {
    this.nextHandler = handler;
    return handler;
  }

  abstract processOrder(order: Order): void;
}

// åº“å­˜æ£€æŸ¥å¤„ç†è€…
class StockChecker extends OrderHandler {
  processOrder(order: Order) {
    if (this.checkStock(order)) {
      console.log('åº“å­˜æ£€æŸ¥é€šè¿‡');
      if (this.nextHandler) {
        this.nextHandler.processOrder(order);
      }
    } else {
      console.log('åº“å­˜ä¸è¶³ï¼Œè®¢å•å¤„ç†ç»ˆæ­¢');
    }
  }

  private checkStock(order: Order): boolean {
    // åº“å­˜æ£€æŸ¥é€»è¾‘
    return true;
  }
}

// æ”¯ä»˜å¤„ç†è€…
class PaymentProcessor extends OrderHandler {
  processOrder(order: Order) {
    if (this.processPayment(order)) {
      console.log('æ”¯ä»˜å¤„ç†æˆåŠŸ');
      if (this.nextHandler) {
        this.nextHandler.processOrder(order);
      }
    } else {
      console.log('æ”¯ä»˜å¤±è´¥ï¼Œè®¢å•å¤„ç†ç»ˆæ­¢');
    }
  }

  private processPayment(order: Order): boolean {
    // æ”¯ä»˜å¤„ç†é€»è¾‘
    return true;
  }
}

// åœ¨Vueç»„ä»¶ä¸­æ„å»ºè´£ä»»é“¾
const stockChecker = new StockChecker();
const paymentProcessor = new PaymentProcessor();
const shippingHandler = new ShippingHandler();

stockChecker.setNext(paymentProcessor).setNext(shippingHandler);

const processOrder = (order: Order) => {
  stockChecker.processOrder(order);
};</code></pre>
              </div>
            </div>
          </div>

          <div class="application-card">
            <div class="app-header">
              <div class="app-icon">ğŸ›¡ï¸</div>
              <h3>ä¸­é—´ä»¶ç³»ç»Ÿ</h3>
            </div>
            <div class="app-content">
              <p>å®ç°ä¸­é—´ä»¶è´£ä»»é“¾</p>
              <div class="code-block">
                <pre><code>// ä¸­é—´ä»¶æ¥å£
interface Middleware {
  setNext(middleware: Middleware): Middleware;
  handle(request: Request, response: Response): void;
}

// èº«ä»½éªŒè¯ä¸­é—´ä»¶
class AuthMiddleware implements Middleware {
  private next: Middleware | null = null;

  setNext(middleware: Middleware): Middleware {
    this.next = middleware;
    return middleware;
  }

  handle(request: Request, response: Response) {
    if (this.authenticate(request)) {
      console.log('èº«ä»½éªŒè¯é€šè¿‡');
      if (this.next) {
        this.next.handle(request, response);
      }
    } else {
      response.status = 401;
      console.log('èº«ä»½éªŒè¯å¤±è´¥');
    }
  }

  private authenticate(request: Request): boolean {
    // èº«ä»½éªŒè¯é€»è¾‘
    return !!request.headers['Authorization'];
  }
}

// æ—¥å¿—ä¸­é—´ä»¶
class LoggingMiddleware implements Middleware {
  private next: Middleware | null = null;

  setNext(middleware: Middleware): Middleware {
    this.next = middleware;
    return middleware;
  }

  handle(request: Request, response: Response) {
    console.log(`è¯·æ±‚: ${request.method} ${request.url}`);
    if (this.next) {
      this.next.handle(request, response);
    }
    console.log(`å“åº”: ${response.status}`);
  }
}

// åœ¨Vueåº”ç”¨ä¸­æ„å»ºä¸­é—´ä»¶é“¾
const authMiddleware = new AuthMiddleware();
const loggingMiddleware = new LoggingMiddleware();

authMiddleware.setNext(loggingMiddleware);

// å¤„ç†è¯·æ±‚
const request = { method: 'GET', url: '/api/data', headers: {} };
const response = { status: 0 };

authMiddleware.handle(request, response);</code></pre>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, reactive } from 'vue';

const tabs = [
  { id: 'concept', title: 'æ¦‚å¿µä»‹ç»', icon: 'ğŸ“š' },
  { id: 'design', title: 'è®¾è®¡æ€è·¯', icon: 'ğŸ§©' },
  { id: 'usage', title: 'ä½¿ç”¨åœºæ™¯', icon: 'ğŸš€' },
  { id: 'pros-cons', title: 'ä¼˜ç¼ºç‚¹', icon: 'âš–ï¸' },
  { id: 'vue', title: 'Vueåº”ç”¨', icon: 'ğŸ’»' }
];

const activeTab = ref('concept');

// å¤„ç†è€…ä¿¡æ¯
const handlers = [
  { name: 'å‘˜å·¥', icon: 'ğŸ‘¤', limit: '1å¤©' },
  { name: 'ç»„é•¿', icon: 'ğŸ‘”', limit: '2å¤©' },
  { name: 'ç»ç†', icon: 'ğŸ‘“', limit: '5å¤©' },
  { name: 'æ€»ç›‘', icon: 'ğŸ©', limit: '10å¤©' },
  { name: 'CEO', icon: 'ğŸ‘‘', limit: 'æ— é™' }
];

// å®¡æ‰¹æ¼”ç¤ºæ•°æ®
const requestType = ref('leave');
const requestValue = ref(1);
const result = reactive({
  status: 'pending',
  message: ''
});
const processSteps = ref<any[]>(Array(handlers.length).fill({ action: 'pending' }));

function submitRequest() {
  // é‡ç½®çŠ¶æ€
  result.status = 'pending';
  result.message = 'å¤„ç†ä¸­...';
  processSteps.value = Array(handlers.length).fill({ action: 'pending' });

  // æ¨¡æ‹Ÿå¤„ç†å»¶è¿Ÿ
  let currentStep = 0;

  const process = () => {
    if (currentStep >= handlers.length) {
      result.status = 'rejected';
      result.message = 'ç”³è¯·è¢«æ‹’ç»ï¼šæ— äººå¯å¤„ç†æ­¤è¯·æ±‚';
      return;
    }

    // æ›´æ–°å½“å‰æ­¥éª¤çŠ¶æ€
    processSteps.value = processSteps.value.map((step, index) => {
      if (index === currentStep) {
        if (index === handlers.length - 1) {
          // æœ€åä¸€çº§å¤„ç†è€…
          result.status = 'approved';
          result.message = `ç”³è¯·å·²æ‰¹å‡†ï¼š${handlers[index].name}å¤„ç†äº†æ‚¨çš„è¯·æ±‚`;
          return { action: 'approved' };
        } else {
          // æ¨¡æ‹Ÿå¤„ç†é€»è¾‘ï¼šæ ¹æ®è¯·æ±‚å€¼å†³å®šæ˜¯å¦å¤„ç†
          const canHandle = requestValue.value <= (index + 1) * 2;

          if (canHandle) {
            result.status = 'approved';
            result.message = `ç”³è¯·å·²æ‰¹å‡†ï¼š${handlers[index].name}å¤„ç†äº†æ‚¨çš„è¯·æ±‚`;
            return { action: 'approved' };
          } else {
            // è½¬å‘åˆ°ä¸‹ä¸€çº§
            return { action: 'forwarded' };
          }
        }
      }
      return step;
    });

    currentStep++;

    // å¦‚æœå°šæœªå¤„ç†å®Œæˆï¼Œç»§ç»­ä¸‹ä¸€æ­¥
    if (result.status === 'pending' && currentStep < handlers.length) {
      setTimeout(process, 800);
    }
  };

  setTimeout(process, 800);
}

function getActionText(action: string) {
  switch (action) {
    case 'approved': return 'âœ“ å·²æ‰¹å‡†';
    case 'rejected': return 'âœ— å·²æ‹’ç»';
    case 'forwarded': return 'â†’ å·²è½¬å‘';
    default: return 'ç­‰å¾…å¤„ç†';
  }
}

const pros = [
  {
    title: "é™ä½è€¦åˆåº¦",
    description: "å‘é€è€…æ— éœ€çŸ¥é“è¯·æ±‚ç”±å“ªä¸ªå¤„ç†è€…å¤„ç†"
  },
  {
    title: "åŠ¨æ€è°ƒæ•´",
    description: "å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€æ”¹å˜é“¾ä¸­çš„å¤„ç†è€…"
  },
  {
    title: "çµæ´»æ‰©å±•",
    description: "æ–°å¢å¤„ç†è€…åªéœ€æ·»åŠ åˆ°é“¾ä¸­"
  },
  {
    title: "å•ä¸€èŒè´£",
    description: "æ¯ä¸ªå¤„ç†è€…åªéœ€å…³æ³¨è‡ªå·±çš„å¤„ç†é€»è¾‘"
  }
];

const cons = [
  {
    title: "è¯·æ±‚ä¸ä¿è¯è¢«å¤„ç†",
    description: "è¯·æ±‚å¯èƒ½åˆ°è¾¾é“¾å°¾ä»æœªè¢«å¤„ç†"
  },
  {
    title: "æ€§èƒ½å½±å“",
    description: "é•¿é“¾å¯èƒ½å¯¼è‡´å¤„ç†å»¶è¿Ÿ"
  },
  {
    title: "è°ƒè¯•å›°éš¾",
    description: "è¯·æ±‚åœ¨é“¾ä¸­ä¼ é€’ä½¿è°ƒè¯•å¤æ‚"
  },
  {
    title: "å¾ªç¯ä¾èµ–é£é™©",
    description: "å¤„ç†é“¾é…ç½®ä¸å½“å¯èƒ½å¯¼è‡´å¾ªç¯"
  }
];
</script>

<style lang="less" scoped>
.chain-container {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  max-width: 1200px;
  margin: 0 auto;
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
  color: #2c3e50;
}

.pattern-hero {
  background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
  color: white;
  padding: 4rem 2rem;
  text-align: center;
  position: relative;
  overflow: hidden;

  &::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background:
      radial-gradient(circle at 20% 30%, rgba(255, 255, 255, 0.1) 0%, transparent 25%),
      radial-gradient(circle at 80% 70%, rgba(255, 255, 255, 0.1) 0%, transparent 25%);
  }
}

.hero-content {
  position: relative;
  z-index: 2;
  max-width: 1000px;
  margin: 0 auto;

  h1 {
    font-size: 3.2rem;
    font-weight: 700;
    margin-bottom: 1rem;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
  }

  .hero-subtitle {
    font-size: 1.4rem;
    font-weight: 300;
    opacity: 0.9;
    max-width: 600px;
    margin: 0 auto 2rem;
  }
}

.chain-visualization {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 1rem;
  margin-top: 3rem;
  flex-wrap: wrap;
}

.chain-link {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.handler-card {
  background: rgba(255, 255, 255, 0.15);
  border-radius: 10px;
  padding: 1.5rem 1rem;
  min-width: 120px;
  text-align: center;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
  backdrop-filter: blur(5px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: transform 0.3s ease;

  &:hover {
    transform: translateY(-5px);
  }
}

.handler-icon {
  font-size: 2.5rem;
  margin-bottom: 0.8rem;
}

.handler-name {
  font-weight: 600;
  font-size: 1.1rem;
  margin-bottom: 0.3rem;
}

.handler-limit {
  font-size: 0.9rem;
  opacity: 0.8;
}

.chain-connector {
  height: 50px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.connector-line {
  height: 20px;
  width: 2px;
  background: rgba(255, 255, 255, 0.5);
}

.connector-arrow {
  font-size: 1.5rem;
  color: rgba(255, 255, 255, 0.7);
}

.pattern-tabs {
  display: flex;
  justify-content: center;
  background: #2c3e50;
  padding: 0;
  flex-wrap: wrap;
}

.tab-button {
  background: transparent;
  border: none;
  color: rgba(255, 255, 255, 0.7);
  font-size: 1.1rem;
  padding: 18px 25px;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  display: flex;
  align-items: center;
  gap: 10px;

  &:hover {
    color: white;
    background: rgba(255, 255, 255, 0.1);
  }

  &.active {
    color: white;
    font-weight: 600;

    &::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: #3498db;
      border-radius: 4px 4px 0 0;
    }
  }
}

.tab-icon {
  font-size: 1.2rem;
}

.pattern-content {
  padding: 2rem;
}

.content-section {
  animation: fadeIn 0.5s ease;
}

.concept-intro {
  margin-bottom: 3rem;
}

.intro-card {
  display: flex;
  align-items: center;
  gap: 2rem;
  background: white;
  border-radius: 12px;
  padding: 2rem;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
  margin-bottom: 2rem;
  border-left: 5px solid #3498db;

  .intro-icon {
    font-size: 4rem;
    color: #3498db;
    flex-shrink: 0;
  }

  h2 {
    font-size: 1.8rem;
    margin-bottom: 1rem;
    color: #2c3e50;
  }

  p {
    font-size: 1.1rem;
    line-height: 1.7;
    color: #495057;
  }
}

.pattern-principle {
  background: white;
  border-radius: 12px;
  padding: 2rem;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);

  h3 {
    font-size: 1.5rem;
    margin-bottom: 1.5rem;
    color: #2c3e50;
    text-align: center;
  }
}

.principles {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1.5rem;
}

.principle {
  background: #f8f9fa;
  border-radius: 10px;
  padding: 1.5rem;
  text-align: center;
  transition: transform 0.3s ease;

  &:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
  }

  .principle-icon {
    font-size: 2.5rem;
    margin-bottom: 1rem;
    color: #3498db;
  }

  h4 {
    font-size: 1.3rem;
    margin-bottom: 0.8rem;
    color: #2c3e50;
  }

  p {
    font-size: 1rem;
    color: #495057;
  }
}

.pattern-structure {
  background: white;
  border-radius: 12px;
  padding: 2rem;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
  margin-bottom: 2rem;

  h3 {
    font-size: 1.5rem;
    margin-bottom: 1.5rem;
    color: #2c3e50;
    text-align: center;
  }
}

.structure-diagram {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  grid-template-rows: auto auto;
  gap: 3rem;
  position: relative;
  justify-items: center;
  margin-bottom: 2rem;

  .structure-item {
    width: 220px;
    background: #f8f9fa;
    border-radius: 8px;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
    overflow: hidden;
    position: relative;
    z-index: 2;

    &.handler {
      grid-column: 1;
      grid-row: 1;
      border-top: 3px solid #3498db;
    }

    &.concrete-handler {
      grid-row: 2;
      border-top: 3px solid #2ecc71;
    }
  }

  .class-header {
    background: #2c3e50;
    color: white;
    padding: 12px;
    font-weight: bold;
    text-align: center;
  }

  .class-methods {
    padding: 15px;
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;

    div {
      margin-bottom: 8px;
    }
  }
}
</style>
