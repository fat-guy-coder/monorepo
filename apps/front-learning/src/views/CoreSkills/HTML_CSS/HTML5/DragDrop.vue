<template>
  <div class="drag-api-container">
    <header class="guide-header">
      <h1>HTML5 æ‹–æ‹½ API åŸºæœ¬æŒ‡å—</h1>
      <p>æŒæ¡ç°ä»£ Web åº”ç”¨ä¸­çš„æ‹–æ‹½äº¤äº’å®ç°</p>
    </header>

    <div class="content-wrapper">
      <!-- å¯¼èˆª -->
      <nav class="navigation">
        <ul>
          <li v-for="section in sections" :key="section.id" @click="scrollToSection(section.id)">
            {{ section.title }}
          </li>
        </ul>
      </nav>

      <!-- å†…å®¹åŒºåŸŸ -->
      <div class="content">
        <!-- ä»‹ç»éƒ¨åˆ† -->
        <section id="introduction" class="guide-section">
          <h2>HTML5 æ‹–æ‹½ API æ¦‚è¿°</h2>
          <div class="intro-content">
            <div class="intro-text">
              <p>
                HTML5 æ‹–æ‹½ API å…è®¸å¼€å‘è€…åˆ›å»ºä¸°å¯Œçš„æ‹–æ‹½äº¤äº’ä½“éªŒï¼Œæ— éœ€ä¾èµ–å¤–éƒ¨åº“ã€‚
                å®ƒæä¾›äº†ä¸€å¥—å®Œæ•´çš„äº‹ä»¶ç³»ç»Ÿå’Œæ•°æ®ä¼ é€’æœºåˆ¶ï¼Œå¯ä»¥è½»æ¾å®ç°å…ƒç´ æ‹–æ‹½ã€æ–‡ä»¶ä¸Šä¼ å’Œå¤æ‚ç•Œé¢äº¤äº’ã€‚
              </p>
              <div class="feature-grid">
                <div class="feature-card">
                  <div class="feature-icon">ğŸ“¦</div>
                  <h3>åŸç”Ÿæ”¯æŒ</h3>
                  <p>ç°ä»£æµè§ˆå™¨å†…ç½®æ”¯æŒï¼Œæ— éœ€é¢å¤–åº“</p>
                </div>
                <div class="feature-card">
                  <div class="feature-icon">ğŸ”„</div>
                  <h3>æ•°æ®ä¼ é€’</h3>
                  <p>å¯åœ¨æ‹–æ‹½è¿‡ç¨‹ä¸­ä¼ é€’å¤æ‚æ•°æ®</p>
                </div>
                <div class="feature-card">
                  <div class="feature-icon">ğŸ¨</div>
                  <h3>è§†è§‰åé¦ˆ</h3>
                  <p>è‡ªå®šä¹‰æ‹–æ‹½å›¾åƒå’Œæ”¾ç½®åŒºåŸŸæ ·å¼</p>
                </div>
              </div>
            </div>
            <div class="demo-area">
              <div class="drag-demo">
                <div
                  class="draggable-item"
                  draggable="true"
                  @dragstart="handleDragStart"
                  @dragend="handleDragEnd"
                >
                  <div class="drag-handle">â‰¡</div>
                  <div>æ‹–æ‹½æˆ‘</div>
                </div>
                <div
                  class="drop-zone"
                  @dragover="handleDragOver"
                  @dragenter="handleDragEnter"
                  @dragleave="handleDragLeave"
                  @drop="handleDrop"
                >
                  <div v-if="!droppedItem">æ”¾ç½®åŒºåŸŸ</div>
                  <div v-else class="dropped-item">
                    <div class="drag-handle">â‰¡</div>
                    <div>å·²æ”¾ç½®å…ƒç´ </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- æ ¸å¿ƒäº‹ä»¶ -->
        <section id="core-events" class="guide-section">
          <h2>æ ¸å¿ƒäº‹ä»¶ç³»ç»Ÿ</h2>

          <div class="events-grid">
            <div class="event-card">
              <h3>æ‹–æ‹½æºäº‹ä»¶</h3>
              <div class="event-list">
                <div class="event-item">
                  <div class="event-name">dragstart</div>
                  <div class="event-desc">å½“ç”¨æˆ·å¼€å§‹æ‹–åŠ¨å…ƒç´ æ—¶è§¦å‘</div>
                </div>
                <div class="event-item">
                  <div class="event-name">drag</div>
                  <div class="event-desc">åœ¨æ‹–åŠ¨å…ƒç´ è¿‡ç¨‹ä¸­æŒç»­è§¦å‘</div>
                </div>
                <div class="event-item">
                  <div class="event-name">dragend</div>
                  <div class="event-desc">å½“æ‹–åŠ¨æ“ä½œç»“æŸæ—¶è§¦å‘</div>
                </div>
              </div>
            </div>

            <div class="event-card">
              <h3>æ”¾ç½®ç›®æ ‡äº‹ä»¶</h3>
              <div class="event-list">
                <div class="event-item">
                  <div class="event-name">dragenter</div>
                  <div class="event-desc">å½“æ‹–åŠ¨çš„å…ƒç´ è¿›å…¥æœ‰æ•ˆæ”¾ç½®ç›®æ ‡æ—¶è§¦å‘</div>
                </div>
                <div class="event-item">
                  <div class="event-name">dragover</div>
                  <div class="event-desc">å½“æ‹–åŠ¨çš„å…ƒç´ åœ¨æ”¾ç½®ç›®æ ‡ä¸Šç§»åŠ¨æ—¶æŒç»­è§¦å‘</div>
                </div>
                <div class="event-item">
                  <div class="event-name">dragleave</div>
                  <div class="event-desc">å½“æ‹–åŠ¨çš„å…ƒç´ ç¦»å¼€æ”¾ç½®ç›®æ ‡æ—¶è§¦å‘</div>
                </div>
                <div class="event-item">
                  <div class="event-name">drop</div>
                  <div class="event-desc">å½“å…ƒç´ è¢«æ”¾ç½®åˆ°ç›®æ ‡åŒºåŸŸæ—¶è§¦å‘</div>
                </div>
              </div>
            </div>

            <div class="event-card">
              <h3>äº‹ä»¶ç”Ÿå‘½å‘¨æœŸ</h3>
              <div class="event-flow">
                <div class="flow-item">1. dragstart</div>
                <div class="flow-arrow">â†“</div>
                <div class="flow-item">2. dragenter (ç›®æ ‡)</div>
                <div class="flow-arrow">â†“</div>
                <div class="flow-item">3. dragover (ç›®æ ‡)</div>
                <div class="flow-arrow">â†“</div>
                <div class="flow-item">4. drop (ç›®æ ‡) æˆ– dragleave (ç›®æ ‡)</div>
                <div class="flow-arrow">â†“</div>
                <div class="flow-item">5. dragend</div>
              </div>
            </div>
          </div>
        </section>

        <!-- åŸºæœ¬å®ç° -->
        <section id="basic-implementation" class="guide-section">
          <h2>åŸºæœ¬å®ç°</h2>

          <div class="implementation-steps">
            <div class="step-card">
              <div class="step-number">1</div>
              <div class="step-content">
                <h3>ä½¿å…ƒç´ å¯æ‹–æ‹½</h3>
                <p>æ·»åŠ  draggable å±æ€§å¹¶å¤„ç† dragstart äº‹ä»¶</p>
                <pre class="code-block">
&lt;div
  draggable="true"
  @dragstart="handleDragStart"
&gt;
  å¯æ‹–æ‹½å…ƒç´ 
&lt;/div&gt;

// å¤„ç†æ‹–æ‹½å¼€å§‹äº‹ä»¶
const handleDragStart = (e: DragEvent) => {
  // è®¾ç½®æ‹–æ‹½æ•°æ®
  e.dataTransfer?.setData('text/plain', 'è‡ªå®šä¹‰æ•°æ®');

  // è®¾ç½®æ‹–æ‹½å›¾åƒ
  const dragImage = e.target as HTMLElement;
  e.dataTransfer?.setDragImage(dragImage, 0, 0);
};</pre
                >
              </div>
            </div>

            <div class="step-card">
              <div class="step-number">2</div>
              <div class="step-content">
                <h3>åˆ›å»ºæ”¾ç½®åŒºåŸŸ</h3>
                <p>å¤„ç†æ”¾ç½®åŒºåŸŸç›¸å…³äº‹ä»¶</p>
                <pre class="code-block">
&lt;div
  class="drop-zone"
  @dragover="handleDragOver"
  @dragenter="handleDragEnter"
  @dragleave="handleDragLeave"
  @drop="handleDrop"
&gt;
  æ”¾ç½®åŒºåŸŸ
&lt;/div&gt;

// å¤„ç†æ‹–æ‹½æ‚¬åœäº‹ä»¶ - å¿…é¡»é˜»æ­¢é»˜è®¤è¡Œä¸º
const handleDragOver = (e: DragEvent) => {
  e.preventDefault();
};

// å¤„ç†æ”¾ç½®äº‹ä»¶
const handleDrop = (e: DragEvent) => {
  e.preventDefault();
  const data = e.dataTransfer?.getData('text/plain');
  console.log('æ¥æ”¶åˆ°çš„æ•°æ®:', data);
};</pre
                >
              </div>
            </div>

            <div class="step-card">
              <div class="step-number">3</div>
              <div class="step-content">
                <h3>å®Œæ•´ Vue ç»„ä»¶ç¤ºä¾‹</h3>
                <p>ä½¿ç”¨ Composition API å®ç°çš„æ‹–æ‹½ç»„ä»¶</p>
                <pre class="code-block">
&lt;template&gt;
  &lt;div class="drag-container"&gt;
    &lt;div
      v-for="item in items"
      :key="item.id"
      draggable="true"
      @dragstart="dragStart(item.id)"
      @dragend="dragEnd"
      class="draggable-item"
    &gt;
    &#123;&#123; item.content &#125;&#125;
    &lt;/div&gt;

    &lt;div
      class="drop-zone"
      @dragover.prevent
      @dragenter="dragEnter"
      @dragleave="dragLeave"
      @drop="drop"
    &gt;&lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { ref } from 'vue';

const items = ref([
  { id: 1, content: 'é¡¹ç›® 1' },
  { id: 2, content: 'é¡¹ç›® 2' },
  { id: 3, content: 'é¡¹ç›® 3' },
]);

let draggedItemId: number | null = null;

const dragStart = (id: number) => {
  draggedItemId = id;
};

const dragEnd = () => {
  draggedItemId = null;
};

const dragEnter = (e: DragEvent) => {
  (e.target as HTMLElement).classList.add('drag-over');
};

const dragLeave = (e: DragEvent) => {
  (e.target as HTMLElement).classList.remove('drag-over');
};

const drop = () => {
  if (draggedItemId !== null) {
    console.log(`é¡¹ç›® ${draggedItemId} è¢«æ”¾ç½®`);
  }
};
&lt;/script&gt;</pre
                >
              </div>
            </div>
          </div>
        </section>

        <!-- æ‹–æ‹½æ’åº -->
        <section id="drag-sorting" class="guide-section">
          <h2>æ‹–æ‹½æ’åºå®ç°</h2>

          <div class="sorting-content">
            <div class="sorting-demo">
              <div class="sortable-list">
                <div
                  v-for="(item, index) in sortableItems"
                  :key="item.id"
                  draggable="true"
                  class="sortable-item"
                  :class="{ dragging: currentDragIndex === index }"
                  @dragstart="startSorting(index)"
                  @dragover="handleSortOver(index, $event)"
                  @dragenter.prevent
                  @dragend="endSorting"
                  @drop="handleDrop"
                >
                  <div class="item-handle">â‰¡</div>
                  <div class="item-content">{{ item.content }}</div>
                  <div class="item-index">#{{ index + 1 }}</div>
                </div>
              </div>
            </div>

            <div class="sorting-code">
              <h3>æ‹–æ‹½æ’åºæ ¸å¿ƒé€»è¾‘</h3>
              <pre class="code-block">
const sortableItems = ref([
  { id: 1, content: 'ä»»åŠ¡ 1' },
  { id: 2, content: 'ä»»åŠ¡ 2' },
  { id: 3, content: 'ä»»åŠ¡ 3' },
  { id: 4, content: 'ä»»åŠ¡ 4' },
]);

let currentDragIndex = ref(-1);
let draggedItem: any = null;

const startSorting = (index: number) => {
  currentDragIndex.value = index;
  draggedItem = sortableItems.value[index];
  event.dataTransfer?.setData('text/plain', index.toString());
  event.dataTransfer.effectAllowed = 'move';
};

const handleSortOver = (index: number, event: DragEvent) => {
  event.preventDefault();

  // åªå¤„ç†ä¸åŒä½ç½®çš„æ‹–æ‹½
  if (currentDragIndex.value !== index) {
    const items = [...sortableItems.value];
    const dragged = items[currentDragIndex.value];

    // ç§»é™¤è¢«æ‹–æ‹½çš„å…ƒç´ 
    items.splice(currentDragIndex.value, 1);
    // æ’å…¥åˆ°æ–°ä½ç½®
    items.splice(index, 0, dragged);

    sortableItems.value = items;
    currentDragIndex.value = index;
  }
};

const endSorting = () => {
  currentDragIndex.value = -1;
};</pre
              >
            </div>
          </div>
        </section>

        <!-- æ–‡ä»¶æ‹–æ‹½ä¸Šä¼  -->
        <section id="file-upload" class="guide-section">
          <h2>æ–‡ä»¶æ‹–æ‹½ä¸Šä¼ </h2>

          <div class="file-upload-demo">
            <div
              class="upload-zone"
              :class="{ active: isUploadZoneActive }"
              @dragover.prevent="activateUploadZone"
              @dragenter.prevent="activateUploadZone"
              @dragleave="deactivateUploadZone"
              @drop="handleFileDrop"
            >
              <div class="upload-icon">ğŸ“¤</div>
              <div class="upload-text">
                <p>æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„ä¸Šä¼ </p>
                <p class="hint">æ”¯æŒå¤šä¸ªæ–‡ä»¶åŒæ—¶ä¸Šä¼ </p>
              </div>
            </div>

            <div class="file-list" v-if="uploadedFiles.length > 0">
              <div class="file-item" v-for="(file, index) in uploadedFiles" :key="index">
                <div class="file-icon">
                  <span v-if="file.type.startsWith('image/')">ğŸ–¼ï¸</span>
                  <span v-else>ğŸ“„</span>
                </div>
                <div class="file-info">
                  <div class="file-name">{{ file.name }}</div>
                  <div class="file-size">{{ formatFileSize(file.size) }}</div>
                </div>
                <div class="file-actions">
                  <button @click="removeFile(index)">åˆ é™¤</button>
                </div>
              </div>
            </div>
          </div>

          <div class="file-upload-code">
            <pre class="code-block">
&lt;div
  class="upload-zone"
  @dragover.prevent="isUploadZoneActive = true"
  @dragenter.prevent="isUploadZoneActive = true"
  @dragleave="isUploadZoneActive = false"
  @drop="handleFileDrop"
&gt;
  æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„
&lt;/div&gt;

const isUploadZoneActive = ref(false);
const uploadedFiles = ref&lt;File[]&gt;([]);

const handleFileDrop = (e: DragEvent) => {
  e.preventDefault();
  isUploadZoneActive.value = false;

  if (e.dataTransfer?.files) {
    const files = Array.from(e.dataTransfer.files);

    // è¿‡æ»¤æ–‡ä»¶ç±»å‹
    const validFiles = files.filter(file =>
      file.type.startsWith('image/') ||
      file.type === 'application/pdf'
    );

    uploadedFiles.value = [...uploadedFiles.value, ...validFiles];
  }
};

const formatFileSize = (bytes: number) => {
  if (bytes === 0) return '0 Bytes';
  const k = 1024;
  const sizes = ['Bytes', 'KB', 'MB', 'GB'];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2) + ' ' + sizes[i];
};</pre
            >
          </div>
        </section>

        <!-- æ€§èƒ½ä¼˜åŒ– -->
        <section id="optimization" class="guide-section">
          <h2>æ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ</h2>

          <div class="optimization-grid">
            <div class="optimization-card">
              <h3>âš¡ å‡å°‘é‡æ’é‡ç»˜</h3>
              <ul>
                <li>ä½¿ç”¨ transform ä»£æ›¿ top/left å®šä½</li>
                <li>é¿å…åœ¨ dragover ä¸­ä¿®æ”¹ DOM ç»“æ„</li>
                <li>ä½¿ç”¨è™šæ‹Ÿåˆ—è¡¨å¤„ç†å¤§é‡å¯æ‹–æ‹½å…ƒç´ </li>
              </ul>
            </div>

            <div class="optimization-card">
              <h3>ğŸ¯ äº‹ä»¶å¤„ç†ä¼˜åŒ–</h3>
              <ul>
                <li>ä½¿ç”¨äº‹ä»¶å§”æ‰˜å‡å°‘äº‹ä»¶ç›‘å¬å™¨</li>
                <li>èŠ‚æµ dragover äº‹ä»¶å¤„ç†</li>
                <li>é¿å…åœ¨é¢‘ç¹äº‹ä»¶ä¸­æ‰§è¡Œå¤æ‚æ“ä½œ</li>
              </ul>
            </div>

            <div class="optimization-card">
              <h3>âœ¨ ç”¨æˆ·ä½“éªŒå¢å¼º</h3>
              <ul>
                <li>æä¾›æ¸…æ™°çš„æ‹–æ‹½è§†è§‰åé¦ˆ</li>
                <li>æ·»åŠ æ”¾ç½®åŒºåŸŸé«˜äº®æ•ˆæœ</li>
                <li>å®ç°å¹³æ»‘çš„åŠ¨ç”»è¿‡æ¸¡</li>
                <li>æä¾›è§¦æ‘¸è®¾å¤‡æ”¯æŒ</li>
              </ul>
            </div>
          </div>

          <div class="advanced-optimization">
            <h3>é«˜çº§ä¼˜åŒ–æŠ€å·§</h3>
            <pre class="code-block">
// ä½¿ç”¨ CSS contain å±æ€§ä¼˜åŒ–æ€§èƒ½
.draggable-item {
  contain: strict;
}

// ä½¿ç”¨ requestAnimationFrame ä¼˜åŒ–æ‹–æ‹½åŠ¨ç”»
let lastTime = 0;
const handleDrag = (e: DragEvent) => {
  const now = Date.now();
  if (now - lastTime > 16) { // çº¦60fps
    updatePosition(e);
    lastTime = now;
  }
};

// ä½¿ç”¨ Web Workers å¤„ç†å¤æ‚æ•°æ®
if (window.Worker) {
  const worker = new Worker('drag-worker.js');
  worker.postMessage({ action: 'processDragData', data: largeDataSet });
}</pre
            >
          </div>
        </section>

        <!-- æµè§ˆå™¨å…¼å®¹æ€§ -->
        <section id="compatibility" class="guide-section">
          <h2>æµè§ˆå™¨å…¼å®¹æ€§ä¸æ³¨æ„äº‹é¡¹</h2>

          <div class="compatibility-content">
            <div class="browser-support">
              <h3>æµè§ˆå™¨æ”¯æŒæƒ…å†µ</h3>
              <div class="support-table">
                <div class="support-row">
                  <div class="browser">Chrome</div>
                  <div class="version">4+</div>
                  <div class="status full">å®Œå…¨æ”¯æŒ</div>
                </div>
                <div class="support-row">
                  <div class="browser">Firefox</div>
                  <div class="version">3.5+</div>
                  <div class="status full">å®Œå…¨æ”¯æŒ</div>
                </div>
                <div class="support-row">
                  <div class="browser">Safari</div>
                  <div class="version">6+</div>
                  <div class="status partial">éƒ¨åˆ†æ”¯æŒ</div>
                </div>
                <div class="support-row">
                  <div class="browser">Edge</div>
                  <div class="version">12+</div>
                  <div class="status full">å®Œå…¨æ”¯æŒ</div>
                </div>
                <div class="support-row">
                  <div class="browser">IE</div>
                  <div class="version">10+</div>
                  <div class="status partial">éƒ¨åˆ†æ”¯æŒ</div>
                </div>
              </div>
            </div>

            <div class="considerations">
              <h3>é‡è¦æ³¨æ„äº‹é¡¹</h3>
              <ul>
                <li>åœ¨ dragover äº‹ä»¶ä¸­å¿…é¡»è°ƒç”¨ preventDefault() æ‰èƒ½è§¦å‘ drop äº‹ä»¶</li>
                <li>ç§»åŠ¨è®¾å¤‡æ”¯æŒæœ‰é™ï¼Œéœ€æ·»åŠ è§¦æ‘¸äº‹ä»¶å¤„ç†</li>
                <li>æŸäº›æµè§ˆå™¨å¯¹æ‹–æ‹½æ–‡ä»¶æœ‰é™åˆ¶ï¼ˆå¦‚ Safariï¼‰</li>
                <li>å®‰å…¨é™åˆ¶ï¼šè·¨åŸŸæ‹–æ‹½æ•°æ®è®¿é—®å—é™</li>
                <li>ä½¿ç”¨ dataTransfer ä¼ é€’å¤æ‚æ•°æ®éœ€åºåˆ—åŒ–/ååºåˆ—åŒ–</li>
              </ul>
            </div>
          </div>
        </section>

        <!-- æ€»ç»“ -->
        <section id="conclusion" class="guide-section">
          <h2>æ€»ç»“</h2>

          <div class="conclusion-content">
            <div class="key-points">
              <h3>æ ¸å¿ƒè¦ç‚¹</h3>
              <ul>
                <li>HTML5 æ‹–æ‹½ API æä¾›å¼ºå¤§çš„åŸç”Ÿæ‹–æ‹½åŠŸèƒ½</li>
                <li>ç†è§£æ‹–æ‹½ç”Ÿå‘½å‘¨æœŸå’Œäº‹ä»¶æµæ˜¯æˆåŠŸå®ç°çš„å…³é”®</li>
                <li>åˆç†ä½¿ç”¨ dataTransfer å¯¹è±¡ä¼ é€’æ•°æ®</li>
                <li>æä¾›è§†è§‰åé¦ˆå¢å¼ºç”¨æˆ·ä½“éªŒ</li>
                <li>é’ˆå¯¹æ€§èƒ½å…³é”®ç‚¹è¿›è¡Œä¼˜åŒ–</li>
              </ul>
            </div>

            <div class="resources">
              <h3>å­¦ä¹ èµ„æº</h3>
              <ul>
                <li>
                  <a
                    href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTML_Drag_and_Drop_API"
                    target="_blank"
                    >MDN æ‹–æ‹½ API æ–‡æ¡£</a
                  >
                </li>
                <li>
                  <a href="https://html.spec.whatwg.org/multipage/dnd.html" target="_blank"
                    >HTML æ‹–æ‹½è§„èŒƒ</a
                  >
                </li>
                <li>
                  <a href="https://www.w3schools.com/html/html5_draganddrop.asp" target="_blank"
                    >W3Schools æ‹–æ‹½æ•™ç¨‹</a
                  >
                </li>
              </ul>
            </div>
          </div>

          <div class="final-note">
            <p>
              HTML5 æ‹–æ‹½ API ä¸ºç°ä»£ Web
              åº”ç”¨æä¾›äº†å¼ºå¤§çš„äº¤äº’èƒ½åŠ›ã€‚é€šè¿‡åˆç†ä½¿ç”¨äº‹ä»¶ç³»ç»Ÿå’Œæ€§èƒ½ä¼˜åŒ–æŠ€å·§ï¼Œ
              å¼€å‘è€…å¯ä»¥åˆ›å»ºæµç•…ã€ç›´è§‚çš„æ‹–æ‹½ä½“éªŒã€‚è™½ç„¶åœ¨æŸäº›å¤æ‚åœºæ™¯ä¸‹å¯èƒ½éœ€è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ï¼Œ ä½†åŸç”Ÿ
              API åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å·²ç»è¶³å¤Ÿå¼ºå¤§ä¸”é«˜æ•ˆã€‚
            </p>
          </div>
        </section>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue'

// å¯¼èˆªéƒ¨åˆ†
const sections = ref([
  { id: 'introduction', title: 'ä»‹ç»' },
  { id: 'core-events', title: 'æ ¸å¿ƒäº‹ä»¶' },
  { id: 'basic-implementation', title: 'åŸºæœ¬å®ç°' },
  { id: 'drag-sorting', title: 'æ‹–æ‹½æ’åº' },
  { id: 'file-upload', title: 'æ–‡ä»¶ä¸Šä¼ ' },
  { id: 'optimization', title: 'æ€§èƒ½ä¼˜åŒ–' },
  { id: 'compatibility', title: 'å…¼å®¹æ€§' },
  { id: 'conclusion', title: 'æ€»ç»“' },
])

// æ‹–æ‹½çŠ¶æ€
const droppedItem = ref(false)
const isUploadZoneActive = ref(false)
const uploadedFiles = ref<File[]>([])

// æ‹–æ‹½æ’åºç¤ºä¾‹æ•°æ®
const sortableItems = ref([
  { id: 1, content: 'è®¾è®¡é¦–é¡µå¸ƒå±€' },
  { id: 2, content: 'å®ç°ç”¨æˆ·è®¤è¯' },
  { id: 3, content: 'å¼€å‘è´­ç‰©è½¦åŠŸèƒ½' },
  { id: 4, content: 'ç¼–å†™å•å…ƒæµ‹è¯•' },
])
const currentDragIndex = ref(-1)

// æ»šåŠ¨åˆ°æŒ‡å®šéƒ¨åˆ†
const scrollToSection = (id: string) => {
  const element = document.getElementById(id)
  if (element) {
    element.scrollIntoView({ behavior: 'smooth' })
  }
}

// åŸºæœ¬æ‹–æ‹½å¤„ç†å‡½æ•°
const handleDragStart = (e: DragEvent) => {
  e.dataTransfer?.setData('text/plain', 'demo-item')
  ;(e.target as HTMLElement).classList.add('dragging')
}

const handleDragEnd = (e: DragEvent) => {
  ;(e.target as HTMLElement).classList.remove('dragging')
}

const handleDragOver = (e: DragEvent) => {
  e.preventDefault()
}

const handleDragEnter = (e: DragEvent) => {
  ;(e.target as HTMLElement).classList.add('drag-over')
}

const handleDragLeave = (e: DragEvent) => {
  ;(e.target as HTMLElement).classList.remove('drag-over')
}

const handleDrop = (e: DragEvent) => {
  e.preventDefault()
  ;(e.target as HTMLElement).classList.remove('drag-over')
  droppedItem.value = true
}

// æ‹–æ‹½æ’åºå¤„ç†å‡½æ•°
const startSorting = (index: number) => {
  currentDragIndex.value = index
}

const handleSortOver = (index: number, e: DragEvent) => {
  e.preventDefault()

  if (currentDragIndex.value !== index) {
    const items = [...sortableItems.value]
    const [dragged] = items.splice(currentDragIndex.value, 1)
    items.splice(index, 0, dragged)

    sortableItems.value = items
    currentDragIndex.value = index
  }
}

const endSorting = () => {
  currentDragIndex.value = -1
}

// æ–‡ä»¶ä¸Šä¼ å¤„ç†å‡½æ•°
const activateUploadZone = (e: DragEvent) => {
  e.preventDefault()
  isUploadZoneActive.value = true
}

const deactivateUploadZone = () => {
  isUploadZoneActive.value = false
}

const handleFileDrop = (e: DragEvent) => {
  e.preventDefault()
  isUploadZoneActive.value = false

  if (e.dataTransfer?.files && e.dataTransfer.files.length > 0) {
    const files = Array.from(e.dataTransfer.files)
    uploadedFiles.value = [...uploadedFiles.value, ...files.slice(0, 3)]
  }
}

const formatFileSize = (bytes: number): string => {
  if (bytes === 0) return '0 Bytes'
  const k = 1024
  const sizes = ['Bytes', 'KB', 'MB', 'GB']
  const i = Math.floor(Math.log(bytes) / Math.log(k))
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]
}

const removeFile = (index: number) => {
  uploadedFiles.value.splice(index, 1)
}
</script>

<style scoped lang="less">
@primary-color: #4a7bf7;
@secondary-color: #6c5ce7;
@text-color: #2d3436;
@light-bg: #f8f9fa;
@border-color: #e0e0e0;
@card-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
@code-bg: #f5f7fa;
@code-border: #e0e0e0;
@success-color: #2ecc71;
@warning-color: #f39c12;
@error-color: #e74c3c;

.drag-api-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  color: @text-color;
  background-color: #fff;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
  border-radius: 8px;
}

.guide-header {
  text-align: center;
  margin-bottom: 2.5rem;
  padding-bottom: 1.5rem;
  border-bottom: 1px solid @border-color;

  h1 {
    color: @primary-color;
    font-size: 2.5rem;
    margin-bottom: 0.5rem;
  }

  p {
    font-size: 1.1rem;
    color: lighten(@text-color, 20%);
  }
}

.content-wrapper {
  display: flex;
  gap: 2rem;
}

.navigation {
  flex: 0 0 200px;
  position: sticky;
  top: 2rem;
  height: fit-content;
  background: @light-bg;
  border-radius: 8px;
  padding: 1.5rem;
  box-shadow: @card-shadow;

  ul {
    list-style: none;
    padding: 0;
    margin: 0;

    li {
      padding: 0.8rem 1rem;
      margin-bottom: 0.5rem;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;

      &:hover {
        background: lighten(@primary-color, 40%);
        color: @primary-color;
      }

      &:active {
        transform: translateY(1px);
      }
    }
  }
}

.content {
  flex: 1;
}

.guide-section {
  margin-bottom: 3rem;

  h2 {
    color: @secondary-color;
    font-size: 1.8rem;
    margin-top: 0;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid lighten(@secondary-color, 40%);
  }
}

.intro-content {
  display: flex;
  gap: 2rem;
  margin-top: 1.5rem;

  .intro-text {
    flex: 1;

    p {
      line-height: 1.6;
      margin-bottom: 1.5rem;
    }
  }

  .demo-area {
    flex: 0 0 300px;
  }
}

.feature-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
  margin-top: 1.5rem;
}

.feature-card {
  background: white;
  border-radius: 8px;
  padding: 1.5rem;
  text-align: center;
  box-shadow: @card-shadow;

  .feature-icon {
    font-size: 2.5rem;
    margin-bottom: 1rem;
  }

  h3 {
    margin: 0.5rem 0;
    font-size: 1.1rem;
  }

  p {
    font-size: 0.9rem;
    color: lighten(@text-color, 20%);
    margin: 0;
  }
}

.drag-demo {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  padding: 1.5rem;
  background: white;
  border-radius: 8px;
  box-shadow: @card-shadow;

  .draggable-item,
  .dropped-item {
    padding: 1rem;
    background: @primary-color;
    color: white;
    border-radius: 6px;
    cursor: grab;
    display: flex;
    align-items: center;
    transition: all 0.3s ease;

    &:active {
      cursor: grabbing;
    }

    &.dragging {
      opacity: 0.6;
    }

    .drag-handle {
      margin-right: 0.8rem;
      font-size: 1.2rem;
      cursor: move;
    }
  }

  .drop-zone {
    min-height: 120px;
    border: 2px dashed @border-color;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;

    &.drag-over {
      border-color: @primary-color;
      background: lighten(@primary-color, 45%);
    }

    .dropped-item {
      background: @success-color;
    }
  }
}

.events-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 1.5rem;
  margin-top: 1.5rem;
}

.event-card {
  background: white;
  border-radius: 8px;
  padding: 1.5rem;
  box-shadow: @card-shadow;

  h3 {
    margin-top: 0;
    color: @primary-color;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid @border-color;
  }
}

.event-list {
  .event-item {
    padding: 1rem 0;
    border-bottom: 1px solid @light-bg;

    &:last-child {
      border-bottom: none;
    }

    .event-name {
      font-weight: 600;
      color: @secondary-color;
    }

    .event-desc {
      font-size: 0.9rem;
      color: lighten(@text-color, 20%);
    }
  }
}

.event-flow {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.5rem;
  padding: 1rem 0;

  .flow-item {
    background: @light-bg;
    padding: 0.8rem;
    border-radius: 6px;
    width: 100%;
    text-align: center;
  }

  .flow-arrow {
    font-size: 1.2rem;
    color: @primary-color;
  }
}

.implementation-steps {
  margin-top: 1.5rem;
}

.step-card {
  display: flex;
  gap: 1.5rem;
  margin-bottom: 2rem;
  background: white;
  border-radius: 8px;
  padding: 1.5rem;
  box-shadow: @card-shadow;

  .step-number {
    flex: 0 0 40px;
    height: 40px;
    background: @primary-color;
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    font-weight: bold;
  }

  .step-content {
    flex: 1;

    h3 {
      margin-top: 0;
      color: @primary-color;
    }
  }
}

.code-block {
  display: block;
  background: @code-bg;
  color: @text-color;
  border-radius: 6px;
  padding: 1.2rem;
  font-family: 'Fira Code', 'Consolas', monospace;
  font-size: 0.95rem;
  overflow-x: auto;
  margin: 1rem 0 0;
  line-height: 1.5;
  border: 1px solid @code-border;
  border-left: 3px solid @primary-color;
}

.sorting-content {
  display: flex;
  gap: 2rem;
  margin-top: 1.5rem;

  .sorting-demo {
    flex: 1;
  }

  .sorting-code {
    flex: 1;
  }
}

.sortable-list {
  background: white;
  border-radius: 8px;
  padding: 1.5rem;
  box-shadow: @card-shadow;
}

.sortable-item {
  display: flex;
  align-items: center;
  padding: 0.8rem 1rem;
  margin-bottom: 0.8rem;
  background: @light-bg;
  border-radius: 6px;
  transition: all 0.3s ease;
  cursor: grab;

  &:last-child {
    margin-bottom: 0;
  }

  &.dragging {
    background: lighten(@primary-color, 40%);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  }

  .item-handle {
    margin-right: 0.8rem;
    font-size: 1.2rem;
    cursor: move;
    color: #777;
  }

  .item-content {
    flex: 1;
  }

  .item-index {
    background: @primary-color;
    color: white;
    border-radius: 12px;
    padding: 0.2rem 0.6rem;
    font-size: 0.8rem;
  }
}

.file-upload-demo {
  margin-top: 1.5rem;
  background: white;
  border-radius: 8px;
  padding: 1.5rem;
  box-shadow: @card-shadow;
}

.upload-zone {
  border: 2px dashed @border-color;
  border-radius: 8px;
  padding: 3rem 2rem;
  text-align: center;
  transition: all 0.3s ease;
  cursor: pointer;

  &.active {
    border-color: @primary-color;
    background: lighten(@primary-color, 45%);
  }

  .upload-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
  }

  .upload-text {
    font-size: 1.1rem;

    .hint {
      font-size: 0.9rem;
      color: #777;
      margin-top: 0.5rem;
    }
  }
}

.file-list {
  margin-top: 1.5rem;

  .file-item {
    display: flex;
    align-items: center;
    padding: 0.8rem;
    border-bottom: 1px solid @light-bg;

    &:last-child {
      border-bottom: none;
    }

    .file-icon {
      font-size: 1.5rem;
      margin-right: 1rem;
    }

    .file-info {
      flex: 1;

      .file-name {
        font-weight: 500;
      }

      .file-size {
        font-size: 0.8rem;
        color: #777;
      }
    }

    .file-actions button {
      background: @error-color;
      color: white;
      border: none;
      padding: 0.3rem 0.8rem;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.8rem;
    }
  }
}

.file-upload-code {
  margin-top: 1.5rem;
}

.optimization-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 1.5rem;
  margin-top: 1.5rem;
}

.optimization-card {
  background: white;
  border-radius: 8px;
  padding: 1.5rem;
  box-shadow: @card-shadow;

  h3 {
    margin-top: 0;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  ul {
    padding-left: 1.5rem;

    li {
      margin-bottom: 0.5rem;
    }
  }
}

.advanced-optimization {
  background: white;
  border-radius: 8px;
  padding: 1.5rem;
  margin-top: 1.5rem;
  box-shadow: @card-shadow;

  h3 {
    margin-top: 0;
    color: @primary-color;
  }
}

.compatibility-content {
  display: flex;
  gap: 2rem;
  margin-top: 1.5rem;

  .browser-support,
  .considerations {
    flex: 1;
    background: white;
    border-radius: 8px;
    padding: 1.5rem;
    box-shadow: @card-shadow;
  }
}

.support-table {
  .support-row {
    display: flex;
    padding: 0.8rem 0;
    border-bottom: 1px solid @light-bg;

    &:last-child {
      border-bottom: none;
    }

    .browser {
      flex: 1;
      font-weight: 500;
    }

    .version {
      flex: 0 0 80px;
      text-align: right;
    }

    .status {
      flex: 0 0 120px;
      text-align: right;
      font-weight: 500;

      &.full {
        color: @success-color;
      }

      &.partial {
        color: @warning-color;
      }
    }
  }
}

.considerations {
  ul {
    padding-left: 1.5rem;

    li {
      margin-bottom: 0.8rem;
      line-height: 1.5;
    }
  }
}

.conclusion-content {
  display: flex;
  gap: 2rem;
  margin-top: 1.5rem;

  .key-points,
  .resources {
    flex: 1;
    background: white;
    border-radius: 8px;
    padding: 1.5rem;
    box-shadow: @card-shadow;

    h3 {
      margin-top: 0;
      color: @primary-color;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid @light-bg;
    }
  }
}

.final-note {
  background: lighten(@primary-color, 48%);
  border-radius: 8px;
  padding: 1.5rem;
  margin-top: 1.5rem;
  border-left: 4px solid @primary-color;

  p {
    line-height: 1.6;
    margin: 0;
  }
}

@media (max-width: 768px) {
  .content-wrapper {
    flex-direction: column;
  }

  .navigation {
    position: static;
    margin-bottom: 1.5rem;
  }

  .intro-content,
  .sorting-content,
  .compatibility-content {
    flex-direction: column;
  }
}
</style>
