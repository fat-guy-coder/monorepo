<template>
  <div class="closure-container">
    <header class="header">
      <h1>JavaScripté—­åŒ…ä»‹ç»</h1>
      <p class="subtitle">ç†è§£é—­åŒ…çš„æ¦‚å¿µã€åŸç†ã€åº”ç”¨åœºæ™¯åŠæ³¨æ„äº‹é¡¹</p>
    </header>

    <div class="content-wrapper">
      <section class="definition">
        <h2><span class="icon">ğŸ“š</span> é—­åŒ…å®šä¹‰</h2>
        <div class="card">
          <p>
            é—­åŒ…(Closure)æ˜¯æŒ‡é‚£äº›èƒ½å¤Ÿè®¿é—®è‡ªç”±å˜é‡çš„å‡½æ•°ã€‚è‡ªç”±å˜é‡æ˜¯æŒ‡åœ¨å‡½æ•°ä¸­ä½¿ç”¨çš„ï¼Œæ—¢ä¸æ˜¯å‡½æ•°å‚æ•°ä¹Ÿä¸æ˜¯å‡½æ•°å±€éƒ¨å˜é‡çš„å˜é‡ã€‚
          </p>
          <p>
            ç®€å•æ¥è¯´ï¼šé—­åŒ…æ˜¯ç”±å‡½æ•°ä»¥åŠåˆ›å»ºè¯¥å‡½æ•°çš„è¯æ³•ç¯å¢ƒç»„åˆè€Œæˆï¼Œè¿™ä¸ªç¯å¢ƒåŒ…å«äº†è¿™ä¸ªé—­åŒ…åˆ›å»ºæ—¶æ‰€èƒ½è®¿é—®çš„æ‰€æœ‰å±€éƒ¨å˜é‡ã€‚
          </p>
          <div class="code-block">
            <pre><code>function outer() {
  let outerVar = 'å¤–éƒ¨å˜é‡';

  function inner() {
    console.log(outerVar); // è®¿é—®å¤–éƒ¨å‡½æ•°çš„å˜é‡
  }

  return inner;
}

const closureFunc = outer();
closureFunc(); // è¾“å‡º: "å¤–éƒ¨å˜é‡"</code></pre>
          </div>
        </div>
      </section>

      <div class="columns">
        <section class="principle">
          <h2><span class="icon">ğŸ”¬</span> é—­åŒ…åŸç†</h2>
          <div class="card">
            <h3>ä½œç”¨åŸŸé“¾</h3>
            <p>JavaScripté‡‡ç”¨è¯æ³•ä½œç”¨åŸŸï¼ˆé™æ€ä½œç”¨åŸŸï¼‰ï¼Œå‡½æ•°çš„ä½œç”¨åŸŸåœ¨å‡½æ•°å®šä¹‰æ—¶å°±ç¡®å®šäº†ã€‚</p>

            <h3>å†…å­˜ç®¡ç†</h3>
            <p>
              å½“å‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼Œå…¶æ‰§è¡Œä¸Šä¸‹æ–‡ä¼šè¢«é”€æ¯ï¼Œä½†å¦‚æœå‡½æ•°å†…éƒ¨å®šä¹‰äº†å†…éƒ¨å‡½æ•°ï¼Œä¸”å†…éƒ¨å‡½æ•°å¼•ç”¨äº†å¤–éƒ¨å‡½æ•°çš„å˜é‡ï¼Œè¿™äº›å˜é‡ä¸ä¼šè¢«é”€æ¯ï¼Œå½¢æˆé—­åŒ…ã€‚
            </p>

            <div class="illustration">
              <div class="scope-chain">
                <div class="global-scope">
                  <div class="scope-label">å…¨å±€ä½œç”¨åŸŸ</div>
                  <div class="variable">outerFunc</div>
                </div>
                <div class="arrow">â†“</div>
                <div class="outer-scope">
                  <div class="scope-label">outerå‡½æ•°ä½œç”¨åŸŸ</div>
                  <div class="variable">outerVar</div>
                  <div class="variable">innerFunc</div>
                </div>
                <div class="arrow">â†“</div>
                <div class="inner-scope">
                  <div class="scope-label">innerå‡½æ•°ä½œç”¨åŸŸ</div>
                </div>
              </div>
              <div class="closure-note">innerå‡½æ•°é€šè¿‡ä½œç”¨åŸŸé“¾è®¿é—®outerVar</div>
            </div>
          </div>
        </section>

        <section class="usage">
          <h2><span class="icon">ğŸ› ï¸</span> åˆ›å»ºé—­åŒ…çš„æ–¹å¼</h2>
          <div class="card">
            <div class="method">
              <h3>1. å‡½æ•°è¿”å›å‡½æ•°</h3>
              <div class="code-block">
                <pre><code>function createCounter() {
  let count = 0;
  return function() {
    count++;
    return count;
  };
}

const counter = createCounter();
console.log(counter()); // 1
console.log(counter()); // 2</code></pre>
              </div>
            </div>

            <div class="method">
              <h3>2. ç«‹å³æ‰§è¡Œå‡½æ•°(IIFE)</h3>
              <div class="code-block">
                <pre><code>const uniqueId = (function() {
  let id = 0;
  return function() {
    return id++;
  };
})();

console.log(uniqueId()); // 0
console.log(uniqueId()); // 1</code></pre>
              </div>
            </div>

            <div class="method">
              <h3>3. äº‹ä»¶å¤„ç†å‡½æ•°</h3>
              <div class="code-block">
                <pre><code>function setupButtons() {
  const buttons = document.querySelectorAll('button');

  for (var i = 0; i < buttons.length; i++) {
    (function(index) {
      buttons[index].addEventListener('click', function() {
        console.log('æŒ‰é’® ' + index + ' è¢«ç‚¹å‡»');
      });
    })(i);
  }
}</code></pre>
              </div>
            </div>

            <div class="method">
              <h3>4. æ¨å…¥æ•°ç»„ä¸­</h3>
              <div class="code-block">
                <pre><code>const arr = [];
 function createCounter() {
  let count = 0;
   arr.push(function() {
    count++;
    console.log(count)
  })
}
createCounter();
arr[0](); // 1
arr[0](); // 2
arr[0](); // 3

</code></pre>
              </div>
            </div>
            <div class="method">
              <h3>5. æ”¾è¿›å¯¹è±¡ä¸­</h3>
              <div class="code-block">
                <pre><code>const obj = {};
 function createCounter() {
  let count = 0;
   obj.count = function() {
    count++;
    console.log(count)
  }
}
createCounter();
obj.count(); // 1
obj.count(); // 2
obj.count(); // 3

</code></pre>
              </div>
            </div>
          </div>
        </section>
      </div>

      <section class="scenarios">
        <h2><span class="icon">ğŸ’¼</span> é—­åŒ…çš„ä½¿ç”¨åœºæ™¯</h2>
        <div class="card-grid">
          <div class="scenario-card">
            <h3>1. æ•°æ®å°è£…ä¸ç§æœ‰å˜é‡</h3>
            <p>å®ç°ç±»ä¼¼ç§æœ‰æˆå‘˜çš„åŠŸèƒ½ï¼Œéšè—å®ç°ç»†èŠ‚</p>
            <div class="code-block">
              <pre><code>function createPerson(name) {
  let _name = name;

  return {
    getName: () => _name,
    setName: (newName) => { _name = newName; }
  };
}

const person = createPerson('Alice');
console.log(person.getName()); // Alice
person.setName('Bob');
console.log(person.getName()); // Bob</code></pre>
            </div>
          </div>

          <div class="scenario-card">
            <h3>2. å‡½æ•°æŸ¯é‡ŒåŒ–</h3>
            <p>å°†å¤šå‚æ•°å‡½æ•°è½¬æ¢ä¸ºä¸€ç³»åˆ—å•å‚æ•°å‡½æ•°</p>
            <div class="code-block">
              <pre><code>function multiply(a) {
  return function(b) {
    return a * b;
  };
}

const double = multiply(2);
console.log(double(5)); // 10</code></pre>
            </div>
          </div>

          <div class="scenario-card">
            <h3>3. æ¨¡å—æ¨¡å¼</h3>
            <p>åˆ›å»ºç‹¬ç«‹çš„ä½œç”¨åŸŸï¼Œé¿å…å…¨å±€æ±¡æŸ“</p>
            <div class="code-block">
              <pre><code>const Calculator = (function() {
  let memory = 0;

  function add(x) { memory += x; }
  function subtract(x) { memory -= x; }
  function getResult() { return memory; }
  function clear() { memory = 0; }

  return { add, subtract, getResult, clear };
})();

Calculator.add(5);
Calculator.subtract(2);
console.log(Calculator.getResult()); // 3</code></pre>
            </div>
          </div>

          <div class="scenario-card">
            <h3>4. ç¼“å­˜ç»“æœ</h3>
            <p>å­˜å‚¨è®¡ç®—ç»“æœé¿å…é‡å¤è®¡ç®—</p>
            <div class="code-block">
              <pre><code>function memoize(fn) {
  const cache = {};
  return function(arg) {
    if (cache[arg] === undefined) {
      cache[arg] = fn(arg);
    }
    return cache[arg];
  };
}

const factorial = memoize(n => {
  return n <= 1 ? 1 : n * factorial(n - 1);
});

console.log(factorial(5)); // 120 (è®¡ç®—)
console.log(factorial(5)); // 120 (ä»ç¼“å­˜è¯»å–)</code></pre>
            </div>
          </div>
        </div>
      </section>

      <section class="pros-cons">
        <h2><span class="icon">âš–ï¸</span> é—­åŒ…çš„ä¼˜ç¼ºç‚¹</h2>
        <div class="comparison">
          <div class="pros">
            <h3>ä¼˜ç‚¹</h3>
            <ul>
              <li><strong>æ•°æ®å°è£…ï¼š</strong>åˆ›å»ºç§æœ‰å˜é‡ï¼Œé¿å…å…¨å±€æ±¡æŸ“</li>
              <li><strong>çŠ¶æ€ä¿æŒï¼š</strong>å‡½æ•°æ‰§è¡Œåä»èƒ½ä¿æŒå†…éƒ¨çŠ¶æ€</li>
              <li><strong>æ¨¡å—åŒ–å¼€å‘ï¼š</strong>å®ç°æ¨¡å—æ¨¡å¼ï¼Œç»„ç»‡ä»£ç ç»“æ„</li>
              <li><strong>å‡½æ•°å·¥å‚ï¼š</strong>åŠ¨æ€ç”Ÿæˆå…·æœ‰ç‰¹å®šè¡Œä¸ºçš„å‡½æ•°</li>
              <li><strong>å®ç°é«˜é˜¶å‡½æ•°ï¼š</strong>å¦‚æŸ¯é‡ŒåŒ–ã€å‡½æ•°ç»„åˆç­‰</li>
            </ul>
          </div>

          <div class="cons">
            <h3>ç¼ºç‚¹ä¸æ³¨æ„äº‹é¡¹</h3>
            <ul>
              <li><strong>å†…å­˜æ¶ˆè€—ï¼š</strong>é—­åŒ…ä¼šä¿æŒå¤–éƒ¨å‡½æ•°å˜é‡çš„å¼•ç”¨ï¼Œå¯¼è‡´å†…å­˜æ— æ³•é‡Šæ”¾</li>
              <li><strong>å†…å­˜æ³„æ¼ï¼š</strong>ä¸å½“ä½¿ç”¨å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ï¼Œå°¤å…¶æ˜¯åœ¨DOMç¯å¢ƒä¸­</li>
              <li><strong>æ€§èƒ½é—®é¢˜ï¼š</strong>è¿‡åº¦ä½¿ç”¨é—­åŒ…å¯èƒ½å½±å“æ€§èƒ½ï¼ˆä½œç”¨åŸŸé“¾æŸ¥æ‰¾ï¼‰</li>
              <li><strong>è°ƒè¯•å›°éš¾ï¼š</strong>é—­åŒ…ä¸­çš„å˜é‡å€¼å¯èƒ½ä¸å¦‚é¢„æœŸï¼Œå¢åŠ è°ƒè¯•éš¾åº¦</li>
              <li><strong>å¾ªç¯å¼•ç”¨ï¼š</strong>åœ¨æ—§ç‰ˆIEä¸­å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼é—®é¢˜</li>
            </ul>
          </div>
        </div>

        <div class="optimization">
          <h3>ä¼˜åŒ–å»ºè®®</h3>
          <ul>
            <li>é¿å…åœ¨é—­åŒ…ä¸­å¼•ç”¨å¤§å¯¹è±¡æˆ–ä¸å¿…è¦çš„å˜é‡</li>
            <li>åœ¨ä¸éœ€è¦æ—¶æ‰‹åŠ¨è§£é™¤å¼•ç”¨ï¼ˆå¦‚å°†é—­åŒ…èµ‹å€¼ä¸ºnullï¼‰</li>
            <li>ä½¿ç”¨äº‹ä»¶å§”æ‰˜å‡å°‘äº‹ä»¶å¤„ç†å‡½æ•°çš„æ•°é‡</li>
            <li>è°¨æ…åœ¨å¾ªç¯ä¸­åˆ›å»ºé—­åŒ…ï¼Œä½¿ç”¨å—çº§ä½œç”¨åŸŸå˜é‡(let)</li>
            <li>ä½¿ç”¨å¼€å‘è€…å·¥å…·ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ</li>
          </ul>
        </div>
      </section>
    </div>

    <footer class="footer">
      <p>
        é—­åŒ…æ˜¯JavaScriptä¸­å¼ºå¤§ä¸”å¸¸ç”¨çš„ç‰¹æ€§ï¼Œç†è§£å…¶åŸç†å’Œæ­£ç¡®ä½¿ç”¨æ–¹å¼å¯¹äºç¼–å†™é«˜è´¨é‡ä»£ç è‡³å…³é‡è¦ã€‚
      </p>
    </footer>
  </div>
</template>

<script setup lang="ts">
// æ­¤ç»„ä»¶ä¸éœ€è¦é¢å¤–çš„é€»è¾‘ï¼Œä»…ç”¨äºå±•ç¤ºé—­åŒ…ç›¸å…³ä¿¡æ¯
</script>

<style lang="less" scoped>
// é¢œè‰²å˜é‡
@primary-color: #3498db;
@secondary-color: #2c3e50;
@accent-color: #e74c3c;
@light-bg: #f8f9fa;
@card-bg: #ffffff;
@text-color: #333333;
@border-color: #e0e0e0;
@code-bg: #f5f7fa;
@success-color: #2ecc71;
@warning-color: #f39c12;
@danger-color: #e74c3c;

// åŸºç¡€æ ·å¼
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

.closure-container {
  font-family: 'Roboto', sans-serif;
  line-height: 1.6;
  color: @text-color;
  background-color: @light-bg;
  padding: 20px;
  max-width: 1200px;
  margin: 0 auto;
}

.header {
  text-align: center;
  margin-bottom: 30px;
  padding: 20px;
  background: linear-gradient(135deg, @primary-color, #1a5276);
  color: white;
  border-radius: 10px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);

  h1 {
    font-size: 2.5rem;
    margin-bottom: 10px;
  }

  .subtitle {
    font-size: 1.2rem;
    opacity: 0.9;
  }
}

.content-wrapper {
  background-color: @card-bg;
  border-radius: 10px;
  box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
  padding: 25px;
  margin-bottom: 30px;
}

h2 {
  font-size: 1.8rem;
  color: @secondary-color;
  margin-bottom: 20px;
  padding-bottom: 10px;
  border-bottom: 2px solid @primary-color;
  display: flex;
  align-items: center;

  .icon {
    margin-right: 10px;
  }
}

h3 {
  font-size: 1.4rem;
  color: @primary-color;
  margin: 15px 0 10px;
}

.card {
  background-color: @card-bg;
  border-radius: 8px;
  padding: 20px;
  margin-bottom: 25px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  border-left: 4px solid @primary-color;
}

.columns {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 25px;
  margin-bottom: 25px;

  @media (max-width: 768px) {
    grid-template-columns: 1fr;
  }
}

// ä»£ç å—æ ·å¼
.code-block {
  background-color: @code-bg;
  border-radius: 6px;
  padding: 15px;
  margin: 15px 0;
  overflow-x: auto;
  font-family: 'Source Code Pro', monospace;
  font-size: 0.95rem;
  border: 1px solid @border-color;

  pre {
    margin: 0;
  }

  code {
    color: #2c3e50;
    line-height: 1.4;
  }
}

// ä½œç”¨åŸŸé“¾å›¾ç¤º
.illustration {
  background-color: #f0f7ff;
  border-radius: 8px;
  padding: 20px;
  margin: 20px 0;
  text-align: center;
  border: 1px dashed @primary-color;

  .scope-chain {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-wrap: wrap;
    margin: 20px 0;

    .global-scope,
    .outer-scope,
    .inner-scope {
      background-color: #e3f2fd;
      border: 2px solid @primary-color;
      border-radius: 8px;
      padding: 15px;
      min-width: 180px;
      position: relative;
    }

    .outer-scope {
      background-color: #bbdefb;
    }

    .inner-scope {
      background-color: #90caf9;
    }

    .scope-label {
      font-weight: bold;
      margin-bottom: 10px;
      color: @secondary-color;
    }

    .variable {
      background-color: #fff;
      padding: 5px 10px;
      margin: 5px 0;
      border-radius: 4px;
      font-family: 'Source Code Pro', monospace;
      font-size: 0.9rem;
      border: 1px solid #ddd;
    }

    .arrow {
      margin: 0 20px;
      font-size: 1.5rem;
      color: @primary-color;
      font-weight: bold;
    }
  }

  .closure-note {
    font-style: italic;
    color: @secondary-color;
    margin-top: 10px;
  }
}

// ä½¿ç”¨åœºæ™¯ç½‘æ ¼
.card-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
  margin-top: 20px;

  .scenario-card {
    background-color: @card-bg;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    border-top: 3px solid @primary-color;
    transition: transform 0.3s ease;

    &:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
    }

    h3 {
      color: @secondary-color;
      margin-top: 0;
    }
  }
}

// ä¼˜ç¼ºç‚¹æ¯”è¾ƒ
.pros-cons {
  .comparison {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 25px;
    margin-bottom: 25px;

    @media (max-width: 768px) {
      grid-template-columns: 1fr;
    }

    .pros,
    .cons {
      background-color: @card-bg;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .pros {
      border-left: 4px solid @success-color;
    }

    .cons {
      border-left: 4px solid @warning-color;
    }

    ul {
      padding-left: 20px;

      li {
        margin-bottom: 10px;
        position: relative;

        &::before {
          content: 'â€¢';
          position: absolute;
          left: -15px;
          color: @primary-color;
          font-weight: bold;
        }
      }
    }
  }

  .optimization {
    background-color: #e8f5e9;
    border-left: 4px solid @success-color;
    border-radius: 8px;
    padding: 20px;

    h3 {
      color: @success-color;
    }
  }
}

.footer {
  text-align: center;
  padding: 20px;
  font-style: italic;
  color: #666;
  margin-top: 20px;
  border-top: 1px solid @border-color;
}

// å“åº”å¼è°ƒæ•´
@media (max-width: 768px) {
  .header h1 {
    font-size: 2rem;
  }

  h2 {
    font-size: 1.5rem;
  }

  .content-wrapper {
    padding: 15px;
  }
}
</style>
