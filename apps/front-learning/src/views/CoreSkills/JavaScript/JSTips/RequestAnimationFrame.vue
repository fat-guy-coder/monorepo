<template>
  <div class="raf-container">
    <!-- æ ‡é¢˜éƒ¨åˆ† -->
    <header class="header">
      <h1>ğŸ¬ requestAnimationFrame</h1>
      <p class="subtitle">æµè§ˆå™¨åŠ¨ç”»æ¸²æŸ“çš„æœ€ä½³å®è·µ</p>
    </header>

    <!-- requestAnimationFrame ä»‹ç» -->
    <section class="raf-introduction">
      <h2 class="section-title">
        <span class="icon">ğŸ“–</span>
        requestAnimationFrame ä»‹ç»
      </h2>
      <p>
        <strong>requestAnimationFrame</strong>
        æ˜¯ä¸€ä¸ªæµè§ˆå™¨æä¾›çš„APIï¼Œç”¨äºåœ¨ä¸‹æ¬¡é‡ç»˜ä¹‹å‰æ‰§è¡ŒåŠ¨ç”»ã€‚å®ƒå¯ä»¥å¸®åŠ©å¼€å‘è€…åˆ›å»ºæµç•…çš„åŠ¨ç”»æ•ˆæœï¼Œå¹¶ä¸”èƒ½å¤Ÿè‡ªåŠ¨ä¼˜åŒ–æ€§èƒ½ï¼Œé¿å…åœ¨åå°æ ‡ç­¾é¡µä¸­æ¶ˆè€—ä¸å¿…è¦çš„èµ„æºã€‚
      </p>
      <p>
        ä½¿ç”¨ <code>requestAnimationFrame</code> çš„ä¸»è¦å¥½å¤„åŒ…æ‹¬ï¼š
      </p>
      <ul>
        <li><b>ä¸æµè§ˆå™¨çš„åˆ·æ–°ç‡åŒæ­¥ï¼Œé€šå¸¸ä¸º60fpsã€‚</b></li>
        <li><b>åœ¨é¡µé¢ä¸å¯è§æ—¶è‡ªåŠ¨æš‚åœåŠ¨ç”»ï¼ŒèŠ‚çœèµ„æºã€‚</b></li>
        <li><b>æä¾›é«˜ç²¾åº¦çš„æ—¶é—´æˆ³ï¼Œä¾¿äºè®¡ç®—åŠ¨ç”»è¿›åº¦ã€‚</b></li>
      </ul>
      <p>requestAnimationFrameçš„ç¼ºç‚¹ï¼š</p>
      <ul>
        <li>
          <b>
            åœ¨ä½æ€§èƒ½è®¾å¤‡ä¸Šï¼ŒrequestAnimationFrameçš„å¸§ç‡å¯èƒ½ä½äº60fpsï¼Œå¯¼è‡´åŠ¨ç”»å¡é¡¿ã€‚
          </b>
        </li>
        <li>
          <b>
            requestAnimationFrameå› ä¸ºæ˜¯åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œçš„ï¼Œå½“ä¸»çº¿ç¨‹éå¸¸ç¹å¿™æ—¶ï¼ŒrequestAnimationFrameçš„æ•ˆæœä¹Ÿå¤§æ‰“æŠ˜æ‰£ï¼Œå¯¼è‡´åŠ¨ç”»å¡é¡¿ã€‚
          </b>
        </li>
      </ul>
      <p>

        é€šè¿‡ä½¿ç”¨ <code>requestAnimationFrame</code>ï¼Œå¼€å‘è€…å¯ä»¥ç¡®ä¿åŠ¨ç”»åœ¨ä¸åŒè®¾å¤‡å’Œæµè§ˆå™¨ä¸Šçš„è¡¨ç°ä¸€è‡´ã€‚
      </p>
      <h3>requestAnimationFrame(callback(timestamp)) å‚æ•°</h3>
      <ul>
        <li><strong>callback</strong>: ä¸€ä¸ªå‡½æ•°ï¼Œæµè§ˆå™¨åœ¨ä¸‹æ¬¡é‡ç»˜ä¹‹å‰è°ƒç”¨è¯¥å‡½æ•°ã€‚</li>
        <li><strong>timestamp</strong>: ä¸€ä¸ª DOMHighResTimeStampï¼Œè¡¨ç¤ºè°ƒç”¨æ—¶çš„æ—¶é—´æˆ³ã€‚</li>
      </ul>
      <h3>cancelAnimationFrame(animationId)å–æ¶ˆåŠ¨ç”»</h3>
      <pre><code>const animationId = requestAnimationFrame(callback(timestamp));
cancelAnimationFrame(animationId)
      </code></pre>
      <div><b>æ³¨æ„:å¾®ä»»åŠ¡è¿‡é•¿ä¼šå¯¼è‡´å»¶è¿Ÿæ‰§è¡ŒrequestAnimationFrame</b> </div>
    </section>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="main-content">
      <!-- æ ¸å¿ƒç‰¹æ€§ -->
      <section class="feature-section">
        <h2 class="section-title">
          <span class="icon">ğŸŒŸ</span>
          æ ¸å¿ƒç‰¹æ€§
        </h2>
        <div class="feature-grid">
          <div v-for="(feature, index) in features" :key="index" class="feature-card">
            <div class="feature-header">
              <span class="feature-icon">{{ feature.icon }}</span>
              <h3>{{ feature.title }}</h3>
            </div>
            <p class="feature-desc">{{ feature.description }}</p>
            <pre class="code-sample">{{ feature.code }}</pre>
          </div>
        </div>
      </section>

      <!-- ä½¿ç”¨æ¨¡å¼ -->
      <section class="pattern-section">
        <h2 class="section-title">
          <span class="icon">âš™ï¸</span>
          æ ‡å‡†ä½¿ç”¨æ¨¡å¼
        </h2>
        <div class="pattern-steps">
          <div v-for="(step, index) in usagePatterns" :key="index" class="step-card">
            <div class="step-header">
              <span class="step-number">#{{ index + 1 }}</span>
              <h4>{{ step.title }}</h4>
            </div>
            <pre class="code-sample">{{ step.code }}</pre>
          </div>
        </div>
      </section>

      <!-- åº”ç”¨åœºæ™¯ -->
      <section class="scenario-section">
        <h2 class="section-title">
          <span class="icon">ğŸ¯</span>
          å…¸å‹åº”ç”¨åœºæ™¯
        </h2>
        <div class="scenario-grid">
          <div v-for="(scene, index) in scenarios" :key="index" class="scene-card">
            <div class="scene-icon">{{ scene.icon }}</div>
            <h4>{{ scene.title }}</h4>
            <ul class="scene-points">
              <li v-for="(point, pIndex) in scene.points" :key="pIndex">{{ point }}</li>
            </ul>
          </div>
        </div>
      </section>
    </main>
  </div>
</template>

<script setup lang="ts">
import { ref, onUnmounted, onMounted } from 'vue';

interface Feature {
  icon: string;
  title: string;
  description: string;
  code: string;
}

interface UsagePattern {
  title: string;
  code: string;
}

interface Scenario {
  icon: string;
  title: string;
  points: string[];
}

const animationId: number = 0





onMounted(() => {

})

// æ ¸å¿ƒç‰¹æ€§æ•°æ®
const features = ref<Feature[]>([
  {
    icon: "ğŸ”„",
    title: "å¸§ç‡åŒæ­¥",
    description: "ä¸æµè§ˆå™¨åˆ·æ–°ç‡åŒæ­¥(é€šå¸¸60fps)",
    code: `function animate() {
  // åŠ¨ç”»é€»è¾‘
  requestAnimationFrame(animate);
}`
  },
  {
    icon: "âš¡",
    title: "æ€§èƒ½ä¼˜åŒ–",
    description: "åå°æ ‡ç­¾é¡µè‡ªåŠ¨æš‚åœæ‰§è¡Œ",
    code: `// é¡µé¢ä¸å¯è§æ—¶è‡ªåŠ¨æš‚åœ
const animationId = requestAnimationFrame(callback);`
  },
  {
    icon: "ğŸ¯",
    title: "ç²¾ç¡®æ—¶åº",
    description: "æ¥æ”¶é«˜ç²¾åº¦æ—¶é—´æˆ³å‚æ•°",
    code: `function animationStep(timestamp) {
  // ä½¿ç”¨æ—¶é—´æˆ³è®¡ç®—è¿›åº¦
}`
  }
]);

// ä½¿ç”¨æ¨¡å¼æ•°æ®
const usagePatterns = ref<UsagePattern[]>([
  {
    title: "å¯åŠ¨åŠ¨ç”»å¾ªç¯",
    code: `let animationId: number;

function startAnimation() {
  let startTime: number;

  function animate(timestamp: number) {
    if (!startTime) startTime = timestamp;
    const progress = timestamp - startTime;

    // åŠ¨ç”»é€»è¾‘
    element.style.transform = \`translateX(\${progress}px)\`;

    animationId = requestAnimationFrame(animate);
  }

  animationId = requestAnimationFrame(animate);
}`
  },
  {
    title: "åœæ­¢åŠ¨ç”»",
    code: `function stopAnimation() {
  cancelAnimationFrame(animationId);
}`
  },
  {
    title: "èŠ‚æµä¼˜åŒ–",
    code: `let lastTime = 0;
const interval = 1000 / 30; // 30fps

function throttledUpdate(timestamp) {
  if (timestamp - lastTime >= interval) {
    // æ›´æ–°é€»è¾‘
    lastTime = timestamp;
  }
  requestAnimationFrame(throttledUpdate);
}`
  }
]);

// åº”ç”¨åœºæ™¯æ•°æ®
const scenarios = ref<Scenario[]>([
  {
    icon: "ğŸ®",
    title: "åŠ¨ç”»ç³»ç»Ÿ",
    points: [
      "CSSåŠ¨ç”»åå¤‡æ–¹æ¡ˆ",
      "å¤æ‚è·¯å¾„åŠ¨ç”»",
      "ç‰©ç†æ•ˆæœæ¨¡æ‹Ÿ"
    ]
  },
  {
    icon: "ğŸ“Š",
    title: "æ•°æ®å¯è§†åŒ–",
    points: [
      "å®æ—¶å›¾è¡¨æ›´æ–°",
      "å¤§æ•°æ®é‡æ¸²æŸ“",
      "äº¤äº’å¼å¯è§†åŒ–"
    ]
  },
  {
    icon: "ğŸ•¹ï¸",
    title: "æ¸¸æˆå¼€å‘",
    points: [
      "æ¸¸æˆä¸»å¾ªç¯",
      "ç‰©ç†å¼•æ“æ›´æ–°",
      "é€å¸§æ¸²æŸ“æ§åˆ¶"
    ]
  }
]);


onUnmounted(() => {
  if (animationId) {
    cancelAnimationFrame(animationId);
  }
});
</script>

<style lang="less" scoped>
@primary-color: #2196f3;
@text-color: #2c3e50;
@code-bg: #2c3e50;

.raf-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
  background: linear-gradient(145deg, #f8f9fa, #e9ecef);

  .header {
    text-align: center;
    margin-bottom: 3rem;

    h1 {
      font-size: 2.5rem;
      color: @text-color;
      margin-bottom: 0.5rem;
    }

    .subtitle {
      color: lighten(@text-color, 30%);
      font-size: 1.1rem;
    }
  }

  .feature-section,
  .pattern-section,
  .scenario-section {
    margin-bottom: 3rem;

    .section-title {
      font-size: 1.8rem;
      color: @text-color;
      margin-bottom: 2rem;
      display: flex;
      align-items: center;
      gap: 1rem;

      .icon {
        font-size: 1.5em;
      }
    }
  }

  .feature-grid,
  .pattern-steps,
  .scenario-grid {
    display: grid;
    gap: 2rem;
  }

  .feature-grid {
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  }

  .pattern-steps {
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
  }

  .feature-card,
  .step-card,
  .scene-card {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);

    .feature-header,
    .step-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;

      .feature-icon {
        font-size: 1.8rem;
      }

      .step-number {
        background: @primary-color;
        color: white;
        padding: 0.5rem 0.8rem;
        border-radius: 4px;
      }
    }

    .code-sample {
      background: @code-bg;
      color: white;
      padding: 1rem;
      border-radius: 8px;
      font-family: 'Fira Code', monospace;
      white-space: pre-wrap;
      margin-top: 1rem;
    }
  }

  .scenario-grid {
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));

    .scene-card {
      text-align: center;

      .scene-icon {
        font-size: 2rem;
        margin-bottom: 1rem;
      }

      .scene-points {
        list-style: none;
        padding-left: 0;

        li {
          padding: 0.3rem 0;
          position: relative;

          &::before {
            content: "â€¢";
            color: @primary-color;
            position: absolute;
            left: -1rem;
          }
        }
      }
    }
  }
}
</style>
