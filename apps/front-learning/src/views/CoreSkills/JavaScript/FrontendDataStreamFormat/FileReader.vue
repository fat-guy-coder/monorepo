<template>
  <div class="filereader-container">
    <header class="header">
      <h1 class="title">JavaScript FileReader API</h1>
      <p class="subtitle">æµè§ˆå™¨æ–‡ä»¶è¯»å–åŠŸèƒ½ä»‹ç»</p>
    </header>

    <div class="content-section">
      <h2 class="section-title">ğŸ” åŸºæœ¬æ¦‚å¿µ</h2>
      <div class="concept-grid">
        <div class="concept-card">
          <h3>FileReader æ˜¯ä»€ä¹ˆ</h3>
          <p>
            FileReader æ˜¯æµè§ˆå™¨æä¾›çš„ APIï¼Œå…è®¸ Web
            åº”ç”¨ç¨‹åº<strong>å¼‚æ­¥è¯»å–</strong>ç”¨æˆ·è®¡ç®—æœºä¸Šçš„æ–‡ä»¶å†…å®¹ã€‚
          </p>
          <div class="feature-list">
            <div class="feature"><span class="icon">ğŸ”„</span> å¼‚æ­¥è¯»å–æ–‡ä»¶</div>
            <div class="feature"><span class="icon">ğŸ“</span> æ”¯æŒå¤šç§æ–‡ä»¶ç±»å‹</div>
            <div class="icon"><span class="icon">âš¡</span> äº‹ä»¶é©±åŠ¨API</div>
          </div>
        </div>
        <div class="concept-card">
          <h3>æ ¸å¿ƒåŠŸèƒ½</h3>
          <p>FileReader å¯ä»¥å°†æ–‡ä»¶è¯»å–ä¸ºï¼š</p>
          <ul class="read-as-list">
            <li><strong>ArrayBuffer</strong> - åŸå§‹äºŒè¿›åˆ¶æ•°æ®</li>
            <li><strong>BinaryString</strong> - äºŒè¿›åˆ¶å­—ç¬¦ä¸²</li>
            <li><strong>DataURL</strong> - base64ç¼–ç çš„URL</li>
            <li><strong>Text</strong> - æ–‡æœ¬å†…å®¹(å¯æŒ‡å®šç¼–ç )</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="content-section">
      <h2 class="section-title">ğŸ› ï¸ åŸºæœ¬ç”¨æ³•</h2>
      <div class="usage-example">
        <div class="code-tabs">
          <div
            v-for="(tab, index) in tabs"
            :key="index"
            :class="['tab', { active: activeTab === index }]"
            @click="activeTab = index"
          >
            {{ tab.label }}
          </div>
        </div>
        <div class="code-content">
          <CodeBlock :code="tabs[activeTab].code" language="js" />
        </div>
      </div>
    </div>

    <div class="content-section">
      <h2 class="section-title">ğŸ“Š å·¥ä½œåŸç†</h2>
      <div class="workflow">
        <div class="step">
          <div class="step-number">1</div>
          <div class="step-content">ç”¨æˆ·é€šè¿‡ input[type="file"] é€‰æ‹©æ–‡ä»¶</div>
        </div>
        <div class="arrow">â†’</div>
        <div class="step">
          <div class="step-number">2</div>
          <div class="step-content">åˆ›å»º FileReader å®ä¾‹</div>
        </div>
        <div class="arrow">â†’</div>
        <div class="step">
          <div class="step-number">3</div>
          <div class="step-content">è°ƒç”¨è¯»å–æ–¹æ³•(readAsTextç­‰)</div>
        </div>
        <div class="arrow">â†’</div>
        <div class="step">
          <div class="step-number">4</div>
          <div class="step-content">ç›‘å¬äº‹ä»¶å¤„ç†ç»“æœ(onloadç­‰)</div>
        </div>
        <div class="arrow">â†’</div>
        <div class="step">
          <div class="step-number">5</div>
          <div class="step-content">åœ¨å›è°ƒä¸­è·å–ç»“æœ(resultå±æ€§)</div>
        </div>
      </div>
      <div class="event-table">
        <table>
          <thead>
            <tr>
              <th>äº‹ä»¶</th>
              <th>è§¦å‘æ—¶æœº</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="event in events" :key="event.name">
              <td>
                <code>{{ event.name }}</code>
              </td>
              <td>{{ event.desc }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="content-section">
      <h2 class="section-title">ğŸŒ ä½¿ç”¨åœºæ™¯</h2>
      <div class="scenario-grid">
        <div class="scenario-card">
          <div class="scenario-icon">ğŸ–¼ï¸</div>
          <h3>å›¾ç‰‡é¢„è§ˆ</h3>
          <p>è¯»å–å›¾ç‰‡æ–‡ä»¶å¹¶æ˜¾ç¤ºç¼©ç•¥å›¾é¢„è§ˆ</p>
          <div class="code-example">
            <pre><code>reader.readAsDataURL(file);
// ç»“æœå¯ç”¨äºimg.src</code></pre>
          </div>
        </div>
        <div class="scenario-card">
          <div class="scenario-icon">ğŸ“„</div>
          <h3>æ–‡ä»¶è§£æ</h3>
          <p>è§£æCSVã€JSONç­‰æ–‡æœ¬æ–‡ä»¶å†…å®¹</p>
          <div class="code-example">
            <pre><code>reader.readAsText(file);
// è§£ææ–‡æœ¬å†…å®¹</code></pre>
          </div>
        </div>
        <div class="scenario-card">
          <div class="scenario-icon">ğŸ”’</div>
          <h3>æ–‡ä»¶æ ¡éªŒ</h3>
          <p>éªŒè¯æ–‡ä»¶å¤§å°ã€ç±»å‹æˆ–å†…å®¹</p>
          <div class="code-example">
            <pre><code>if(file.size > 1024*1024) {
  alert('æ–‡ä»¶å¤ªå¤§');
}</code></pre>
          </div>
        </div>
        <div class="scenario-card">
          <div class="scenario-icon">ğŸ“¤</div>
          <h3>åˆ†å—ä¸Šä¼ </h3>
          <p>è¯»å–æ–‡ä»¶åˆ†ç‰‡å®ç°å¤§æ–‡ä»¶ä¸Šä¼ </p>
          <div class="code-example">
            <pre><code>const chunk = file.slice(start, end);
reader.readAsArrayBuffer(chunk);</code></pre>
          </div>
        </div>
      </div>
    </div>

    <div class="content-section">
      <h2 class="section-title">âš–ï¸ ä¼˜ç¼ºç‚¹åˆ†æ</h2>
      <div class="pros-cons">
        <div class="pros">
          <h3>ä¼˜ç‚¹</h3>
          <ul>
            <li><strong>æµè§ˆå™¨åŸç”Ÿæ”¯æŒ</strong> - æ— éœ€é¢å¤–åº“</li>
            <li><strong>å¼‚æ­¥å¤„ç†</strong> - ä¸é˜»å¡ä¸»çº¿ç¨‹</li>
            <li><strong>å¤šç§æ ¼å¼</strong> - æ”¯æŒå¤šç§è¯»å–æ–¹å¼</li>
            <li><strong>å®‰å…¨</strong> - åªèƒ½è¯»å–ç”¨æˆ·æ˜¾å¼é€‰æ‹©çš„æ–‡ä»¶</li>
          </ul>
        </div>
        <div class="cons">
          <h3>ç¼ºç‚¹</h3>
          <ul>
            <li><strong>å…¼å®¹æ€§</strong> - IE10+æ”¯æŒ</li>
            <li><strong>å¤§æ–‡ä»¶å¤„ç†</strong> - å¯èƒ½å†…å­˜ä¸è¶³</li>
            <li><strong>äº‹ä»¶é©±åŠ¨</strong> - ä»£ç ç»“æ„å¯èƒ½å¤æ‚</li>
            <li><strong>æ— è¿›åº¦æ§åˆ¶</strong> - æ— æ³•æš‚åœ/ç»§ç»­</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="content-section">
      <h2 class="section-title">âš ï¸ æ³¨æ„äº‹é¡¹</h2>
      <div class="note-grid">
        <div class="note-card">
          <h3>å†…å­˜ç®¡ç†</h3>
          <p>å¤§æ–‡ä»¶å¯èƒ½å¯¼è‡´å†…å­˜é—®é¢˜ï¼Œè€ƒè™‘ä½¿ç”¨File.slice()åˆ†å—è¯»å–</p>
        </div>
        <div class="note-card">
          <h3>é”™è¯¯å¤„ç†</h3>
          <p>åŠ¡å¿…ç›‘å¬onerroräº‹ä»¶å¤„ç†è¯»å–é”™è¯¯</p>
        </div>
        <div class="note-card">
          <h3>å®‰å…¨é™åˆ¶</h3>
          <p>åªèƒ½è¯»å–ç”¨æˆ·ä¸»åŠ¨é€‰æ‹©çš„æ–‡ä»¶ï¼Œä¸èƒ½è®¿é—®ä»»æ„æ–‡ä»¶ç³»ç»Ÿ</p>
        </div>
        <div class="note-card">
          <h3>ç°ä»£æ›¿ä»£æ–¹æ¡ˆ</h3>
          <p>è€ƒè™‘ä½¿ç”¨æ›´ç°ä»£çš„Streams APIå¤„ç†å¤§æ–‡ä»¶</p>
        </div>
      </div>
    </div>

    <footer class="footer">
      <p>FileReaderæ˜¯å‰ç«¯æ–‡ä»¶å¤„ç†çš„åŸºçŸ³APIï¼Œåˆç†ä½¿ç”¨å¯ä»¥æ„å»ºä¸°å¯Œçš„æ–‡ä»¶äº¤äº’ä½“éªŒ</p>
    </footer>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue'
import CodeBlock from '@/components/Code/index.vue'

const activeTab = ref(0)

const tabs = [
  {
    label: 'è¯»å–æ–‡æœ¬',
    code: `// è¯»å–æ–‡æœ¬æ–‡ä»¶
const reader = new FileReader();
reader.onload = (e) => {
  const content = e.target.result;
  console.log('æ–‡ä»¶å†…å®¹:', content);
};
reader.readAsText(file, 'UTF-8');`,
  },
  {
    label: 'è¯»å–DataURL',
    code: `// è¯»å–å›¾ç‰‡ä¸ºDataURL
const reader = new FileReader();
reader.onload = (e) => {
  const dataUrl = e.target.result;
  imgElement.src = dataUrl;
};
reader.readAsDataURL(file);`,
  },
  {
    label: 'è¯»å–äºŒè¿›åˆ¶',
    code: `// è¯»å–äºŒè¿›åˆ¶æ•°æ®
const reader = new FileReader();
reader.onload = (e) => {
  const arrayBuffer = e.target.result;
  // å¤„ç†äºŒè¿›åˆ¶æ•°æ®...
};
reader.readAsArrayBuffer(file);`,
  },
  {
    label: 'äº‹ä»¶ç›‘å¬',
    code: `// å®Œæ•´äº‹ä»¶ç›‘å¬
const reader = new FileReader();

reader.onloadstart = () => console.log('å¼€å§‹è¯»å–');
reader.onprogress = (e) => {
  if(e.lengthComputable) {
    const percent = (e.loaded / e.total) * 100;
    console.log(\`è¿›åº¦: \${percent}%\`);
  }
};
reader.onload = (e) => console.log('è¯»å–å®Œæˆ');
reader.onerror = () => console.error('è¯»å–é”™è¯¯');
reader.onloadend = () => console.log('è¯»å–ç»“æŸ');

reader.readAsText(file);`,
  },
]

const events = [
  { name: 'onloadstart', desc: 'å¼€å§‹è¯»å–æ—¶è§¦å‘' },
  { name: 'onprogress', desc: 'è¯»å–è¿‡ç¨‹ä¸­å®šæœŸè§¦å‘' },
  { name: 'onload', desc: 'è¯»å–æˆåŠŸå®Œæˆæ—¶è§¦å‘' },
  { name: 'onabort', desc: 'è¯»å–è¢«ä¸­æ­¢æ—¶è§¦å‘' },
  { name: 'onerror', desc: 'è¯»å–å‘ç”Ÿé”™è¯¯æ—¶è§¦å‘' },
  { name: 'onloadend', desc: 'è¯»å–ç»“æŸæ—¶è§¦å‘(æ— è®ºæˆåŠŸæˆ–å¤±è´¥)' },
]
</script>

<style lang="less" scoped>
.filereader-container {
  max-width: 1000px;
  margin: 0 auto;
  padding: 2rem;
  font-family:
    'Inter',
    -apple-system,
    BlinkMacSystemFont,
    sans-serif;
  color: #2c3e50;
  background-color: #fff;
  line-height: 1.6;
}

.header {
  text-align: center;
  margin-bottom: 2rem;
  padding-bottom: 1.5rem;
  border-bottom: 1px solid #eaecef;

  .title {
    font-size: 2.2rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: #2c3e50;
    background: linear-gradient(90deg, #3498db, #9b59b6);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
  }

  .subtitle {
    font-size: 1.1rem;
    color: #7f8c8d;
    font-weight: 400;
  }
}

.content-section {
  margin-bottom: 2.5rem;

  .section-title {
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 1.2rem;
    color: #2c3e50;
    border-left: 4px solid #9b59b6;
    padding-left: 0.8rem;
  }
}

.concept-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1.5rem;

  @media (max-width: 768px) {
    grid-template-columns: 1fr;
  }
}

.concept-card {
  background-color: #fff;
  border-radius: 8px;
  padding: 1.5rem;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  border: 1px solid #eaecef;

  h3 {
    font-size: 1.2rem;
    margin-top: 0;
    color: #3498db;
  }

  p {
    font-size: 0.95rem;
    color: #555;
    margin: 0.8rem 0;
  }
}

.feature-list {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 0.8rem;
  margin-top: 1rem;

  .feature {
    display: flex;
    align-items: center;
    font-size: 0.9rem;
    color: #555;

    .icon {
      margin-right: 0.5rem;
      font-size: 1.1rem;
    }
  }
}

.read-as-list {
  padding-left: 1.2rem;
  margin: 0.8rem 0;

  li {
    margin-bottom: 0.5rem;
    font-size: 0.9rem;

    strong {
      color: #e74c3c;
    }
  }
}

.usage-example {
  background-color: #fff;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  border: 1px solid #eaecef;
  overflow: hidden;
  margin: 1.5rem 0;
}

.code-tabs {
  display: flex;
  border-bottom: 1px solid #eaecef;
  background-color: #f8f9fa;

  .tab {
    padding: 0.8rem 1.2rem;
    font-size: 0.9rem;
    cursor: pointer;
    border-bottom: 2px solid transparent;
    transition: all 0.2s;

    &:hover {
      background-color: #f0f0f0;
    }

    &.active {
      border-bottom-color: #3498db;
      color: #3498db;
      font-weight: 500;
    }
  }
}

.code-content {
  pre {
    margin: 0;
    padding: 1rem;
    background-color: #282c34;

    code {
      font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
      color: #abb2bf;
      font-size: 0.9rem;
    }
  }
}

.workflow {
  display: flex;
  align-items: center;
  justify-content: center;
  flex-wrap: wrap;
  margin: 1.5rem 0;

  .step {
    background-color: #fff;
    border-radius: 8px;
    padding: 0.8rem 1.2rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    border: 1px solid #eaecef;
    text-align: center;
    min-width: 120px;

    .step-number {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 1.8rem;
      height: 1.8rem;
      background-color: #9b59b6;
      color: white;
      border-radius: 50%;
      font-weight: 600;
      margin: 0 auto 0.5rem;
    }

    .step-content {
      font-size: 0.9rem;
    }
  }

  .arrow {
    margin: 0 0.5rem;
    color: #7f8c8d;
    font-weight: bold;

    @media (max-width: 768px) {
      transform: rotate(90deg);
      margin: 0.5rem 0;
    }
  }

  @media (max-width: 768px) {
    flex-direction: column;
  }
}

.event-table {
  background-color: #fff;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  border: 1px solid #eaecef;
  margin: 1.5rem 0;
  overflow: hidden;

  table {
    width: 100%;
    border-collapse: collapse;

    th,
    td {
      padding: 0.8rem 1.2rem;
      text-align: left;
      border-bottom: 1px solid #eaecef;
    }

    th {
      background-color: #f8f9fa;
      font-weight: 500;
    }

    td {
      font-size: 0.9rem;
      color: #555;

      code {
        background-color: #f8f9fa;
        padding: 0.2rem 0.4rem;
        border-radius: 3px;
        font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
      }
    }

    tr:last-child td {
      border-bottom: none;
    }
  }
}

.scenario-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 1.2rem;
  margin: 1.5rem 0;
}

.scenario-card {
  background-color: #fff;
  border-radius: 8px;
  padding: 1.2rem;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  border: 1px solid #eaecef;
  text-align: center;

  .scenario-icon {
    font-size: 2rem;
    margin-bottom: 0.8rem;
  }

  h3 {
    font-size: 1.1rem;
    margin: 0.5rem 0;
    color: #2c3e50;
  }

  p {
    font-size: 0.9rem;
    color: #7f8c8d;
    margin: 0.5rem 0;
  }

  .code-example {
    background-color: #f8f9fa;
    padding: 0.8rem;
    border-radius: 4px;
    margin-top: 0.8rem;

    pre {
      margin: 0;

      code {
        font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
        font-size: 0.8rem;
        color: #333;
      }
    }
  }
}

.pros-cons {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1.5rem;
  margin: 1.5rem 0;

  .pros,
  .cons {
    background-color: #fff;
    border-radius: 8px;
    padding: 1.2rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    border: 1px solid #eaecef;

    h3 {
      font-size: 1.2rem;
      margin-top: 0;
      margin-bottom: 0.8rem;
      color: #2c3e50;
      border-bottom: 2px solid;
      padding-bottom: 0.5rem;
    }

    ul {
      padding-left: 1.2rem;
      margin: 0;

      li {
        margin-bottom: 0.5rem;
        font-size: 0.9rem;

        strong {
          color: #e74c3c;
        }
      }
    }
  }

  .pros h3 {
    border-color: #42b983;
  }

  .cons h3 {
    border-color: #e74c3c;
  }

  @media (max-width: 768px) {
    grid-template-columns: 1fr;
  }
}

.note-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 1.2rem;
  margin: 1.5rem 0;
}

.note-card {
  background-color: #fff;
  border-radius: 8px;
  padding: 1.2rem;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  border: 1px solid #eaecef;

  h3 {
    font-size: 1.1rem;
    margin-top: 0;
    color: #3498db;
  }

  p {
    font-size: 0.9rem;
    color: #555;
    margin-bottom: 0;
  }
}

.footer {
  text-align: center;
  margin-top: 2rem;
  padding-top: 1.5rem;
  border-top: 1px solid #eaecef;
  color: #7f8c8d;
  font-size: 0.9rem;
}
</style>
