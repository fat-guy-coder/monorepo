<template>
  <div class="iterator-container">
    <header class="header">
      <h1 class="title">JavaScript è¿­ä»£å™¨ä»‹ç»</h1>
      <div class="subtitle">æŒæ¡éå†æ•°æ®ç»“æ„çš„æ ¸å¿ƒæœºåˆ¶</div>
    </header>

    <div class="content-grid">
      <!-- å·¦ä¾§å†…å®¹åŒºåŸŸ -->
      <main class="main-content">
        <section class="section">
          <div class="concept-card">
            <h2 class="section-title">è¿­ä»£å™¨æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
            <p class="paragraph">
              <span class="highlight">è¿­ä»£å™¨ï¼ˆIteratorï¼‰</span>æ˜¯ ECMAScript 6 å¼•å…¥çš„ä¸€ç§<span
                class="highlight"
                >éå†æœºåˆ¶</span
              >ï¼Œå®ƒæä¾›äº†ä¸€ç§ç»Ÿä¸€çš„æ–¹å¼æ¥è®¿é—®å„ç§æ•°æ®ç»“æ„ä¸­çš„å…ƒç´ ã€‚è¿­ä»£å™¨æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒå®ç°äº†<strong>è¿­ä»£å™¨åè®®</strong>ï¼Œå³åŒ…å«ä¸€ä¸ªè¿”å›è¿­ä»£å™¨å¯¹è±¡çš„
              <code>next()</code> æ–¹æ³•ã€‚
            </p>
            <div class="illustration">
              <div class="iterator-flow">
                <div class="data">æ•°æ®ç»“æ„</div>
                <div class="arrow">â†’</div>
                <div class="iterator">è¿­ä»£å™¨</div>
                <div class="arrow">â†’</div>
                <div class="next">next()</div>
                <div class="arrow">â†’</div>
                <div class="result">{ value: any, done: boolean }</div>
              </div>
            </div>
          </div>
        </section>

        <section class="section">
          <h2 class="section-title">è¿­ä»£å™¨åè®®</h2>
          <div class="protocol-grid">
            <div class="protocol-card">
              <h3><code>next()</code> æ–¹æ³•</h3>
              <p>è¿­ä»£å™¨å¿…é¡»å®ç°ä¸€ä¸ª <code>next()</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå±æ€§çš„å¯¹è±¡ï¼š</p>
              <ul>
                <li><strong>value</strong>: å½“å‰è¿­ä»£çš„å€¼</li>
                <li><strong>done</strong>: å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºè¿­ä»£æ˜¯å¦å®Œæˆ</li>
              </ul>
            </div>
            <div class="protocol-card">
              <h3>è¿­ä»£å™¨ç¤ºä¾‹</h3>
              <pre>
const iterator = {
  data: [1, 2, 3],
  index: 0,
  next() {
    return this.index < this.data.length
      ? { value: this.data[this.index++], done: false }
      : { value: undefined, done: true };
  }
};</pre
              >
            </div>
          </div>
        </section>

        <section class="section">
          <h2 class="section-title">åˆ›å»ºä¸ä½¿ç”¨è¿­ä»£å™¨</h2>
          <div class="usage-container">
            <div class="usage-section">
              <h3>1. æ•°ç»„è¿­ä»£å™¨</h3>
              <pre>
const arr = ['a', 'b', 'c'];
const arrIterator = arr[Symbol.iterator]();

console.log(arrIterator.next()); // { value: 'a', done: false }
console.log(arrIterator.next()); // { value: 'b', done: false }
console.log(arrIterator.next()); // { value: 'c', done: false }
console.log(arrIterator.next()); // { value: undefined, done: true }</pre
              >
            </div>

            <div class="usage-section">
              <h3>2. Map è¿­ä»£å™¨</h3>
              <pre>
const map = new Map();
map.set('name', 'Alice');
map.set('age', 30);

const mapIterator = map[Symbol.iterator]();

console.log(mapIterator.next());
// { value: ['name', 'Alice'], done: false }

console.log(mapIterator.next());
// { value: ['age', 30], done: false }</pre
              >
            </div>

            <div class="usage-section">
              <h3>3. è‡ªå®šä¹‰è¿­ä»£å™¨</h3>
              <pre>
class Range {
  constructor(start, end, step = 1) {
    this.start = start;
    this.end = end;
    this.step = step;
  }

  [Symbol.iterator]() {
    let current = this.start;
    const end = this.end;
    const step = this.step;

    return {
      next() {
        if ((step > 0 && current <= end) ||
            (step < 0 && current >= end)) {
          const value = current;
          current += step;
          return { value, done: false };
        }
        return { done: true };
      }
    };
  }
}

// ä½¿ç”¨è‡ªå®šä¹‰è¿­ä»£å™¨
for (const num of new Range(1, 5)) {
  console.log(num); // 1, 2, 3, 4, 5
}</pre
              >
            </div>
          </div>
        </section>
        <section class="section">
          <h2 class="section-title">è¿­ä»£å™¨ä½¿ç”¨åœºæ™¯</h2>
          <div class="scenario-card">
            <div class="scenario-icon">ğŸ“Š</div>
            <div class="scenario-content">
              <h3>for...of å¾ªç¯</h3>
              <p>éå†å¯è¿­ä»£å¯¹è±¡çš„æ ‡å‡†æ–¹å¼</p>
              <pre>
for (const item of iterable) {
  // å¤„ç†æ¯ä¸ªå…ƒç´ 
}</pre
              >
            </div>
          </div>

          <div class="scenario-card">
            <div class="scenario-icon">ğŸ”€</div>
            <div class="scenario-content">
              <h3>æ‰©å±•è¿ç®—ç¬¦</h3>
              <p>å°†å¯è¿­ä»£å¯¹è±¡è½¬æ¢ä¸ºæ•°ç»„</p>
              <pre>
const set = new Set([1, 2, 3]);
const arr = [...set]; // [1, 2, 3]</pre
              >
            </div>
          </div>

          <div class="scenario-card">
            <div class="scenario-icon">ğŸ¯</div>
            <div class="scenario-content">
              <h3>è§£æ„èµ‹å€¼</h3>
              <p>ä»å¯è¿­ä»£å¯¹è±¡ä¸­æå–å€¼</p>
              <pre>
const [first, second] = 'abc';
// first = 'a', second = 'b'</pre
              >
            </div>
          </div>

          <div class="scenario-card">
            <div class="scenario-icon">ğŸ”„</div>
            <div class="scenario-content">
              <h3>å¼‚æ­¥è¿­ä»£</h3>
              <p>ä½¿ç”¨ async/await å¤„ç†å¼‚æ­¥æ•°æ®æµ</p>
              <pre>
for await (const chunk of asyncIterable) {
  // å¤„ç†å¼‚æ­¥æ•°æ®
}</pre
              >
            </div>
          </div>
        </section>

        <section class="section">
          <h2 class="section-title">å†…ç½®å¯è¿­ä»£å¯¹è±¡</h2>
          <div class="builtin-grid">
            <div class="builtin-card">Array</div>
            <div class="builtin-card">String</div>
            <div class="builtin-card">Map</div>
            <div class="builtin-card">Set</div>
            <div class="builtin-card">TypedArray</div>
            <div class="builtin-card">NodeList</div>
            <div class="builtin-card">Arguments</div>
            <div class="builtin-card">Generator</div>
          </div>
        </section>

        <section class="section">
          <h2 class="section-title">è¿­ä»£å™¨ vs å¯è¿­ä»£å¯¹è±¡</h2>
          <div class="comparison-table">
            <div class="table-row header">
              <div class="table-cell">ç‰¹æ€§</div>
              <div class="table-cell">è¿­ä»£å™¨</div>
              <div class="table-cell">å¯è¿­ä»£å¯¹è±¡</div>
            </div>
            <div class="table-row">
              <div class="table-cell">å®šä¹‰</div>
              <div class="table-cell">å…·æœ‰ next() æ–¹æ³•çš„å¯¹è±¡</div>
              <div class="table-cell">å…·æœ‰ [Symbol.iterator] æ–¹æ³•çš„å¯¹è±¡</div>
            </div>
            <div class="table-row">
              <div class="table-cell">ç›®çš„</div>
              <div class="table-cell">éå†å…ƒç´ </div>
              <div class="table-cell">æä¾›è¿­ä»£å™¨</div>
            </div>
            <div class="table-row">
              <div class="table-cell">ç¤ºä¾‹</div>
              <div class="table-cell">arr[Symbol.iterator]()</div>
              <div class="table-cell">æ•°ç»„ã€é›†åˆ</div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <footer class="footer">
      <div class="benefits">
        <div class="benefit-card">
          <h3>è¿­ä»£å™¨çš„ä¼˜ç‚¹</h3>
          <ul>
            <li>ç»Ÿä¸€çš„éå†æ¥å£</li>
            <li>æ”¯æŒæƒ°æ€§è®¡ç®—</li>
            <li>å¯ä»¥éå†æ— é™åºåˆ—</li>
            <li>èŠ‚çœå†…å­˜ç©ºé—´</li>
          </ul>
        </div>
        <div class="benefit-card">
          <h3>æ³¨æ„äº‹é¡¹</h3>
          <ul>
            <li>è¿­ä»£å™¨æ˜¯å•å‘çš„</li>
            <li>è¿­ä»£å®Œæˆåæ— æ³•å¤ç”¨</li>
            <li>ä¸æ”¯æŒéšæœºè®¿é—®</li>
            <li>åŒæ­¥è¿­ä»£å™¨æ— æ³•å¤„ç†å¼‚æ­¥</li>
          </ul>
        </div>
      </div>
      <p class="footer-summary">
        è¿­ä»£å™¨æ˜¯ JavaScript
        ä¸­å¼ºå¤§çš„æŠ½è±¡æœºåˆ¶ï¼Œå®ƒæä¾›äº†ä¸€ç§ç»Ÿä¸€çš„æ–¹å¼æ¥éå†å„ç§æ•°æ®ç»“æ„ã€‚ç†è§£è¿­ä»£å™¨å¯¹äºç¼–å†™ç°ä»£
        JavaScript ä»£ç è‡³å…³é‡è¦ã€‚
      </p>
    </footer>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue'

// ç¤ºä¾‹è¿­ä»£å™¨çŠ¶æ€
const iteratorExamples = ref([
  { name: 'æ•°ç»„è¿­ä»£å™¨', code: 'arr[Symbol.iterator]()' },
  { name: 'å­—ç¬¦ä¸²è¿­ä»£å™¨', code: 'str[Symbol.iterator]()' },
  { name: 'Map è¿­ä»£å™¨', code: 'map[Symbol.iterator]()' },
  { name: 'Set è¿­ä»£å™¨', code: 'set[Symbol.iterator]()' },
  { name: 'ç”Ÿæˆå™¨å‡½æ•°', code: 'function* generator()' },
])
</script>

<style lang="less" scoped>
// é¢œè‰²å˜é‡
@primary-color: #4a6cf7;
@secondary-color: #6e45e2;
@accent-color: #ff6b6b;
@light-bg: #f8f9ff;
@border-color: #e0e7ff;
@text-color: #2c3e50;
@text-light: #7e8a9a;
@card-shadow: 0 4px 12px rgba(74, 108, 247, 0.08);
@code-bg: #f1f5ff;

// åŸºç¡€æ ·å¼
.iterator-container {
  font-family:
    'Inter',
    -apple-system,
    BlinkMacSystemFont,
    'Segoe UI',
    Roboto,
    sans-serif;
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  color: @text-color;
  background-color: white;
  line-height: 1.6;
}

.header {
  text-align: center;
  margin-bottom: 2.5rem;
  padding-bottom: 1.5rem;
  border-bottom: 1px solid @border-color;

  .title {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    background: linear-gradient(135deg, @primary-color, @secondary-color);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
  }

  .subtitle {
    font-size: 1.2rem;
    color: @text-light;
    font-weight: 400;
  }
}

.content-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 2rem;
}

.section {
  margin-bottom: 2.5rem;
  background: @light-bg;
  border-radius: 12px;
  padding: 1.5rem;
  box-shadow: @card-shadow;

  .section-title {
    font-size: 1.5rem;
    font-weight: 600;
    margin-top: 0;
    margin-bottom: 1.5rem;
    padding-bottom: 0.75rem;
    border-bottom: 2px solid @primary-color;
    color: darken(@primary-color, 15%);
  }
}

.paragraph {
  margin-bottom: 1.5rem;
  font-size: 1.05rem;
}

.highlight {
  background-color: rgba(74, 108, 247, 0.12);
  padding: 0.15rem 0.4rem;
  border-radius: 4px;
  font-weight: 500;
  color: darken(@primary-color, 10%);
}

// æ¦‚å¿µå¡ç‰‡
.concept-card {
  padding: 1.5rem;
  border-radius: 10px;
  background: white;
  box-shadow: @card-shadow;
}

// åè®®ç½‘æ ¼
.protocol-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1.5rem;

  @media (max-width: 768px) {
    grid-template-columns: 1fr;
  }
}

.protocol-card {
  padding: 1.25rem;
  border-radius: 8px;
  background: white;
  box-shadow: @card-shadow;
  transition: transform 0.3s ease;

  &:hover {
    transform: translateY(-3px);
  }

  h3 {
    margin-top: 0;
    font-size: 1.25rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid @border-color;
    color: @primary-color;
  }

  ul {
    padding-left: 1.5rem;

    li {
      margin-bottom: 0.75rem;
    }
  }

  pre {
    background: @code-bg;
    padding: 1rem;
    border-radius: 8px;
    font-size: 0.9rem;
    overflow-x: auto;
    margin-top: 1rem;
  }
}

// ä½¿ç”¨åœºæ™¯å¡ç‰‡
.scenario-card {
  display: flex;
  gap: 1rem;
  padding: 1rem;
  margin-bottom: 1.25rem;
  background: white;
  border-radius: 8px;
  box-shadow: @card-shadow;
  transition: all 0.3s ease;

  &:hover {
    transform: translateX(5px);
    box-shadow: 0 6px 16px rgba(74, 108, 247, 0.15);
  }

  .scenario-icon {
    font-size: 1.8rem;
    min-width: 50px;
    height: 50px;
    background: linear-gradient(135deg, @primary-color, @secondary-color);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .scenario-content {
    flex: 1;

    h3 {
      margin-top: 0;
      margin-bottom: 0.5rem;
      color: @secondary-color;
    }

    p {
      margin: 0.25rem 0 0.75rem;
      color: @text-light;
      font-size: 0.95rem;
    }

    pre {
      background: @code-bg;
      padding: 0.75rem;
      border-radius: 6px;
      font-size: 0.85rem;
      overflow-x: auto;
    }
  }
}

// è¿­ä»£å™¨æµç¨‹å›¾
.illustration {
  background: white;
  border-radius: 8px;
  padding: 1.5rem;
  margin: 1.5rem 0;
  box-shadow: @card-shadow;
  overflow-x: auto;

  .iterator-flow {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;

    > div {
      padding: 0.75rem 1.25rem;
      border-radius: 6px;
      font-weight: 500;
      text-align: center;
      flex-shrink: 0;
    }

    .data {
      background: rgba(74, 108, 247, 0.15);
      color: darken(@primary-color, 15%);
      border: 1px solid rgba(74, 108, 247, 0.3);
    }

    .iterator {
      background: rgba(110, 69, 226, 0.15);
      color: darken(@secondary-color, 15%);
      border: 1px solid rgba(110, 69, 226, 0.3);
    }

    .next {
      background: rgba(255, 107, 107, 0.15);
      color: darken(@accent-color, 15%);
      border: 1px solid rgba(255, 107, 107, 0.3);
    }

    .result {
      background: rgba(76, 184, 135, 0.15);
      color: darken(#4cb887, 25%);
      border: 1px solid rgba(76, 184, 135, 0.3);
    }

    .arrow {
      color: @secondary-color;
      font-weight: bold;
      font-size: 1.2rem;
    }
  }

  @media (max-width: 768px) {
    .iterator-flow {
      flex-direction: column;
      align-items: stretch;

      .arrow {
        text-align: center;
        &::before {
          content: 'â†“';
          display: block;
        }
      }
    }
  }
}

// å†…ç½®å¯è¿­ä»£å¯¹è±¡ç½‘æ ¼
.builtin-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
  gap: 0.75rem;

  .builtin-card {
    background: white;
    border: 1px solid @border-color;
    border-radius: 6px;
    padding: 0.75rem;
    text-align: center;
    font-weight: 500;
    font-size: 0.95rem;
    transition: all 0.2s ease;

    &:hover {
      transform: translateY(-3px);
      background: @primary-color;
      color: white;
      border-color: @primary-color;
      box-shadow: 0 4px 8px rgba(74, 108, 247, 0.2);
    }
  }
}

// æ¯”è¾ƒè¡¨æ ¼
.comparison-table {
  display: table;
  width: 100%;
  border-collapse: collapse;
  margin-top: 1rem;
  font-size: 0.95rem;

  .table-row {
    display: table-row;

    &.header {
      font-weight: 600;
      background: rgba(74, 108, 247, 0.08);
    }

    &:not(.header):hover {
      background: rgba(74, 108, 247, 0.03);
    }
  }

  .table-cell {
    display: table-cell;
    padding: 0.75rem;
    border-bottom: 1px solid @border-color;

    &:first-child {
      font-weight: 500;
      color: @primary-color;
    }
  }
}

// ä½¿ç”¨ç¤ºä¾‹å®¹å™¨
.usage-container {
  .usage-section {
    background: white;
    border-radius: 8px;
    padding: 1.25rem;
    margin-bottom: 1.5rem;
    box-shadow: @card-shadow;

    h3 {
      margin-top: 0;
      margin-bottom: 1rem;
      color: @primary-color;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid @border-color;
    }

    pre {
      background: @code-bg;
      padding: 1rem;
      border-radius: 8px;
      font-size: 0.9rem;
      overflow-x: auto;
      margin: 0;
    }
  }
}

// é¡µè„š
.footer {
  margin-top: 2rem;
  padding-top: 1.5rem;
  border-top: 1px solid @border-color;

  .benefits {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
    margin-bottom: 1.5rem;

    @media (max-width: 768px) {
      grid-template-columns: 1fr;
    }
  }

  .benefit-card {
    background: @light-bg;
    border-radius: 10px;
    padding: 1.25rem;

    h3 {
      margin-top: 0;
      margin-bottom: 1rem;
      color: @primary-color;
      font-size: 1.2rem;
    }

    ul {
      padding-left: 1.25rem;
      margin: 0;

      li {
        margin-bottom: 0.5rem;
        position: relative;
        padding-left: 1.5rem;

        &::before {
          content: 'â€¢';
          position: absolute;
          left: 0;
          color: @primary-color;
          font-weight: bold;
        }
      }
    }
  }

  .footer-summary {
    text-align: center;
    font-size: 1.05rem;
    font-weight: 500;
    margin: 1.5rem 0 0;
    padding: 1.25rem;
    background: linear-gradient(135deg, rgba(74, 108, 247, 0.08), rgba(110, 69, 226, 0.08));
    border-radius: 10px;
  }
}

// å“åº”å¼è®¾è®¡
@media (max-width: 1024px) {
  .content-grid {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 768px) {
  .iterator-container {
    padding: 1rem;
  }

  .header .title {
    font-size: 2rem;
  }

  .protocol-grid {
    grid-template-columns: 1fr;
  }
}

code,
pre {
  font-family: 'Fira Code', Consolas, Monaco, 'Andale Mono', monospace;
}

pre {
  position: relative;

  &::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 4px;
    height: 100%;
    background: linear-gradient(to bottom, @primary-color, @secondary-color);
    border-radius: 4px 0 0 4px;
  }
}
</style>
