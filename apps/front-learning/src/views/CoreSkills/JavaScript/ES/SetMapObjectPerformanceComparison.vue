<template>
  <div class="performance-comparison">
    <header class="docs-header">
      <h1>Setã€Mapã€Object æ€§èƒ½å¯¹æ¯”åˆ†æ</h1>
      <p class="subtitle">æ·±å…¥è§£æä¸‰ç§æ•°æ®ç»“æ„çš„æ€§èƒ½å·®å¼‚</p>
    </header>

    <Nav :list="sections" />

    <div class="content-wrapper">
      <!-- æ¦‚è¿° -->
      <section id="overview" class="method-card">
        <h2>ğŸ” æ¦‚è¿°</h2>
        <div class="info-box">
          <h3>ä¸ºä»€ä¹ˆéœ€è¦æ€§èƒ½æ¯”è¾ƒï¼Ÿ</h3>
          <p>
            åœ¨ JavaScript å¼€å‘ä¸­ï¼ŒSetã€Map å’Œ Object
            éƒ½æ˜¯å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼Œä½†å®ƒä»¬åœ¨ä¸åŒåœºæ™¯ä¸‹çš„æ€§èƒ½è¡¨ç°å·®å¼‚å¾ˆå¤§ã€‚äº†è§£è¿™äº›å·®å¼‚å¯ä»¥å¸®åŠ©æˆ‘ä»¬é€‰æ‹©æœ€é€‚åˆçš„æ•°æ®ç»“æ„ã€‚
          </p>

          <h3>æµ‹è¯•ç»´åº¦</h3>
          <ul>
            <li><strong>æŸ¥è¯¢æ€§èƒ½ï¼š</strong>æŸ¥æ‰¾å…ƒç´ çš„é€Ÿåº¦</li>
            <li><strong>æ·»åŠ æ€§èƒ½ï¼š</strong>æ’å…¥æ–°å…ƒç´ çš„é€Ÿåº¦</li>
            <li><strong>åˆ é™¤æ€§èƒ½ï¼š</strong>ç§»é™¤å…ƒç´ çš„é€Ÿåº¦</li>
            <li><strong>ä¿®æ”¹æ€§èƒ½ï¼š</strong>æ›´æ–°å…ƒç´ çš„é€Ÿåº¦</li>
            <li><strong>å†…å­˜å ç”¨ï¼š</strong>ä¸åŒæ•°æ®é‡ä¸‹çš„å†…å­˜ä½¿ç”¨æƒ…å†µ</li>
          </ul>
        </div>
      </section>

      <!-- æ•°æ®ç»“æ„ç‰¹ç‚¹ -->
      <section id="features" class="method-card">
        <h2>ğŸ¯ æ•°æ®ç»“æ„ç‰¹ç‚¹</h2>
        <div class="features-grid">
          <div class="feature-item">
            <h3>Object</h3>
            <div class="feature-content">
              <h4>ä¼˜ç‚¹</h4>
              <ul>
                <li>é”®å€¼å¯¹å­˜å‚¨ï¼Œæ”¯æŒå¤æ‚é”®</li>
                <li>JSON åºåˆ—åŒ–æ”¯æŒ</li>
                <li>å¹¿æ³›å…¼å®¹æ€§</li>
              </ul>
              <h4>ç¼ºç‚¹</h4>
              <ul>
                <li>é”®åªèƒ½æ˜¯å­—ç¬¦ä¸²æˆ– Symbol</li>
                <li>åŸå‹é“¾æŸ¥æ‰¾å¼€é”€</li>
                <li>å±æ€§éå†é¡ºåºä¸ç¡®å®š</li>
              </ul>
            </div>
          </div>

          <div class="feature-item">
            <h3>Map</h3>
            <div class="feature-content">
              <h4>ä¼˜ç‚¹</h4>
              <ul>
                <li>é”®å¯ä»¥æ˜¯ä»»æ„ç±»å‹</li>
                <li>æ’å…¥é¡ºåºä¿æŒ</li>
                <li>æ›´å¥½çš„æ€§èƒ½</li>
                <li>ä¸“é—¨çš„è¿­ä»£æ–¹æ³•</li>
              </ul>
              <h4>ç¼ºç‚¹</h4>
              <ul>
                <li>ES6+ æ”¯æŒ</li>
                <li>JSON åºåˆ—åŒ–éœ€è¦è½¬æ¢</li>
                <li>å†…å­˜å ç”¨ç›¸å¯¹è¾ƒé«˜</li>
              </ul>
            </div>
          </div>

          <div class="feature-item">
            <h3>Set</h3>
            <div class="feature-content">
              <h4>ä¼˜ç‚¹</h4>
              <ul>
                <li>å”¯ä¸€å€¼é›†åˆ</li>
                <li>æ’å…¥é¡ºåºä¿æŒ</li>
                <li>é«˜æ•ˆçš„æŸ¥æ‰¾å’Œåˆ é™¤</li>
                <li>ä¸“é—¨çš„æ–¹æ³•ï¼ˆhas, add, deleteï¼‰</li>
              </ul>
              <h4>ç¼ºç‚¹</h4>
              <ul>
                <li>åªèƒ½å­˜å‚¨å€¼ï¼Œä¸èƒ½é”®å€¼å¯¹</li>
                <li>ES6+ æ”¯æŒ</li>
                <li>ä¸æ”¯æŒç´¢å¼•è®¿é—®</li>
              </ul>
            </div>
          </div>
        </div>
      </section>

      <!-- æ€§èƒ½æµ‹è¯• -->
      <section id="performance-tests" class="method-card highlight">
        <h2>âš¡ æ€§èƒ½æµ‹è¯•ç»“æœ</h2>

        <div class="performance-results">
          <!-- è·å–æ€§èƒ½ -->
          <div class="performance-section">
            <h3>ğŸ” è·å–æ€§èƒ½å¯¹æ¯”(è€—æ—¶ms)</h3>
            <div class="chart-container">
              <canvas ref="accessChart" id="accessChart" width="800" height="400"></canvas>
            </div>
            <div class="results-table">
              <table>
                <thead>
                  <tr>
                    <th>æ•°æ®é‡</th>
                    <th>Array (ms)</th>
                    <th>Object (ms)</th>
                    <th>Map (ms)</th>
                    <th>Set (ms)</th>
                    <th>æœ€å¿«</th>
                    <th>å¤‡æ³¨</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="(result, size) in testResults.access" :key="size">
                    <td>{{ result.size }}</td>
                    <td>{{ result.arrayRange }}</td>
                    <td>{{ result.objectRange }}</td>
                    <td>{{ result.mapRange }}</td>
                    <td>{{ result.setRange }}</td>
                    <td class="fastest">{{ result.fastest }}</td>
                    <td>{{ result.note }}</td>
                  </tr>
                </tbody>
              </table>
              <p class="note">å¤‡æ³¨ï¼šMapè®¿é—®æœ€å¿«ï¼Œarrayæ¬¡ä¹‹ï¼Œobjectæœ€æ…¢</p>
            </div>
          </div>
          <!-- æŸ¥è¯¢æ€§èƒ½ -->
          <div class="performance-section">
            <h3>ğŸ” æŸ¥è¯¢æ€§èƒ½å¯¹æ¯”(è€—æ—¶ms)</h3>
            <div class="chart-container">
              <canvas ref="queryChart" width="800" height="400"></canvas>
            </div>
            <div class="results-table">
              <table>
                <thead>
                  <tr>
                    <th>æ•°æ®é‡</th>
                    <th>Array (ms)</th>
                    <th>Object (ms)</th>
                    <th>Map (ms)</th>
                    <th>Set (ms)</th>
                    <th>æœ€å¿«</th>
                    <th>å¤‡æ³¨</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="(result, size) in testResults.query" :key="size">
                    <td>{{ result.size }}</td>
                    <td>{{ result.arrayRange }}</td>
                    <td>{{ result.objectRange }}</td>
                    <td>{{ result.mapRange }}</td>
                    <td>{{ result.setRange }}</td>
                    <td class="fastest">{{ result.fastest }}</td>
                    <td>{{ result.note }}</td>
                  </tr>
                </tbody>
              </table>
              <p class="note">å¤‡æ³¨ï¼šMapå’ŒSetæŸ¥è¯¢æœ€å¿«ï¼Œobjectæ¬¡ä¹‹ï¼Œarrayæœ€æ…¢O(n)</p>
            </div>
          </div>

          <!-- æ·»åŠ æ€§èƒ½ -->
          <div class="performance-section">
            <h3>â• æ·»åŠ æ€§èƒ½å¯¹æ¯”(è€—æ—¶ms)</h3>
            <div class="chart-container">
              <canvas ref="addChart" width="800" height="400"></canvas>
            </div>
            <div class="results-table">
              <table>
                <thead>
                  <tr>
                    <th>æ•°æ®é‡</th>
                    <th>Array (ms)</th>
                    <th>Object (ms)</th>
                    <th>Map (ms)</th>
                    <th>Set (ms)</th>
                    <th>æœ€å¿«</th>
                    <th>å¤‡æ³¨</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="(result, size) in testResults.add" :key="size">
                    <td>{{ result.size }}</td>
                    <td>{{ result.arrayRange }}</td>
                    <td>{{ result.objectRange }}</td>
                    <td>{{ result.mapRange }}</td>
                    <td>{{ result.setRange }}</td>
                    <td class="fastest">{{ result.fastest }}</td>
                    <td>{{ result.note }}</td>
                  </tr>
                </tbody>
              </table>
              <p class="note">
                å¤‡æ³¨ï¼šarrayæ·»åŠ æœ€å¿«<b>è¿™æ˜¯pushçš„æ€§èƒ½</b>ï¼ŒMapå’ŒSetæ¬¡ä¹‹ï¼Œobjectæ¬¡ä¹‹ï¼Œ<b
                  >ä¹±åºåŠ å…¥arrayæœ€æ…¢O(n)</b
                >
              </p>
            </div>
          </div>

          <!-- åˆ é™¤æ€§èƒ½ -->
          <div class="performance-section">
            <h3>ğŸ—‘ï¸ åˆ é™¤æ€§èƒ½å¯¹æ¯”(è€—æ—¶ms)</h3>
            <div class="chart-container">
              <canvas ref="deleteChart" width="800" height="400"></canvas>
            </div>
            <div class="results-table">
              <table>
                <thead>
                  <tr>
                    <th>æ•°æ®é‡</th>
                    <th>Array (ms)</th>
                    <th>Object (ms)</th>
                    <th>Map (ms)</th>
                    <th>Set (ms)</th>
                    <th>æœ€å¿«</th>
                    <th>å¤‡æ³¨</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="(result, size) in testResults.delete" :key="size">
                    <td>{{ size }}</td>
                    <td>{{ result.arrayRange }}</td>
                    <td>{{ result.objectRange }}</td>
                    <td>{{ result.mapRange }}</td>
                    <td>{{ result.setRange }}</td>
                    <td class="fastest">{{ result.fastest }}</td>
                    <td>{{ result.note }}</td>
                  </tr>
                </tbody>
              </table>
              <p class="note">å¤‡æ³¨ï¼šMapå’ŒSetæœ€å¿«ï¼Œobjectæ¬¡ä¹‹ï¼Œarrayæœ€æ…¢O(n)</p>
            </div>
          </div>

          <!-- ä¿®æ”¹æ€§èƒ½ -->
          <div class="performance-section">
            <h3>âœï¸ ä¿®æ”¹æ€§èƒ½å¯¹æ¯”(è€—æ—¶ms)</h3>
            <div class="chart-container">
              <canvas ref="updateChart" width="800" height="400"></canvas>
            </div>
            <div class="results-table">
              <table>
                <thead>
                  <tr>
                    <th>æ•°æ®é‡</th>
                    <th>Array (ms)</th>
                    <th>Object (ms)</th>
                    <th>Map (ms)</th>
                    <th>Set (ms)</th>
                    <th>æœ€å¿«</th>
                    <th>å¤‡æ³¨</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="(result, size) in testResults.update" :key="size">
                    <td>{{ size }}</td>
                    <td>{{ result.arrayRange }}</td>
                    <td>{{ result.objectRange }}</td>
                    <td>{{ result.mapRange }}</td>
                    <td>{{ result.setRange }}</td>
                    <td class="fastest">{{ result.fastest }}</td>
                    <td>{{ result.note }}</td>
                  </tr>
                </tbody>
              </table>
              <p class="note">å¤‡æ³¨ï¼šarrayæœ€å¿«ï¼ŒMapå’ŒSetæ¬¡ä¹‹ï¼Œobjectæœ€æ…¢</p>
            </div>
          </div>
        </div>
      </section>

      <!-- æ€§èƒ½åˆ†æ -->
      <section id="analysis" class="method-card">
        <h2>ğŸ“Š æ€§èƒ½åˆ†æ</h2>
        <div class="analysis-grid">
          <div class="analysis-item">
            <h3>ç»¼åˆæ€§èƒ½</h3>
            <ul>
              <li><strong>Arrayï¼š</strong>{{ testResults.summary.Array }}</li>
              <li><strong>Objectï¼š</strong>{{ testResults.summary.Object }}</li>
            </ul>
          </div>
          <div class="analysis-item">
            <h3>ç»¼åˆæ€§èƒ½</h3>
            <ul>
              <li><strong>Mapï¼š</strong>{{ testResults.summary.Map }}</li>
              <li><strong>Setï¼š</strong>{{ testResults.summary.Set }}</li>
            </ul>
          </div>
          <div class="analysis-item">
            <h3>å°æ•°æ®é‡ (10-1000)</h3>
            <ul>
              <li><strong>Arrayï¼š</strong>æ€§èƒ½æœ€ä½³ï¼ŒåŸç”Ÿå®ç°</li>
              <li><strong>Objectï¼š</strong>æ€§èƒ½æœ€ä½³ï¼ŒåŸç”Ÿå®ç°</li>
              <li><strong>Mapï¼š</strong>æ€§èƒ½æ¥è¿‘ Object</li>
              <li><strong>Setï¼š</strong>æŸ¥æ‰¾æ€§èƒ½ä¼˜ç§€</li>
            </ul>
          </div>

          <div class="analysis-item">
            <h3>ä¸­ç­‰æ•°æ®é‡ (1000-10000)</h3>
            <ul>
              <li><strong>Arrayï¼š</strong>æ€§èƒ½æœ€ä½³ï¼ŒåŸç”Ÿå®ç°</li>
              <li><strong>Mapï¼š</strong>å¼€å§‹æ˜¾ç°ä¼˜åŠ¿</li>
              <li><strong>Setï¼š</strong>å”¯ä¸€å€¼åœºæ™¯æœ€ä½³</li>
              <li><strong>Objectï¼š</strong>æ€§èƒ½å¼€å§‹ä¸‹é™</li>
            </ul>
          </div>

          <div class="analysis-item">
            <h3>å¤§æ•°æ®é‡ (10000+)</h3>
            <ul>
              <li><strong>Arrayï¼š</strong>æ€§èƒ½æœ€ä½³ï¼ŒåŸç”Ÿå®ç°</li>
              <li><strong>Mapï¼š</strong>ç»¼åˆæ€§èƒ½æœ€ä½³</li>
              <li><strong>Setï¼š</strong>æŸ¥æ‰¾å’Œåˆ é™¤æœ€å¿«</li>
              <li><strong>Objectï¼š</strong>æ€§èƒ½æ˜æ˜¾ä¸‹é™</li>
            </ul>
          </div>
          <div class="analysis-item">
            <h3>ä½¿ç”¨å»ºè®®</h3>
            <ul>
              <li
                v-for="recommendation in testResults.summary.recommendations"
                :key="recommendation"
              >
                {{ recommendation }}
              </li>
            </ul>
          </div>
        </div>
      </section>

      <!-- ä½¿ç”¨å»ºè®® -->
      <section id="recommendations" class="method-card highlight">
        <h2>ğŸ’¡ ä½¿ç”¨å»ºè®®</h2>
        <div class="recommendations-grid">
          <div class="recommendation-item">
            <h3>é€‰æ‹© Object çš„åœºæ™¯</h3>
            <CodeBlock :code="objectUseCases" language="js" />
            <ul>
              <li>éœ€è¦ JSON åºåˆ—åŒ–</li>
              <li>é”®æ˜¯ç®€å•çš„å­—ç¬¦ä¸²</li>
              <li>æ•°æ®é‡è¾ƒå°ï¼ˆ< 1000ï¼‰</li>
              <li>éœ€è¦å…¼å®¹æ—§æµè§ˆå™¨</li>
            </ul>
          </div>

          <div class="recommendation-item">
            <h3>é€‰æ‹© Map çš„åœºæ™¯</h3>
            <CodeBlock :code="mapUseCases" language="js" />
            <ul>
              <li>é”®æ˜¯å¯¹è±¡æˆ–å…¶ä»–å¤æ‚ç±»å‹</li>
              <li>éœ€è¦ä¿æŒæ’å…¥é¡ºåº</li>
              <li>é¢‘ç¹çš„å¢åˆ æ“ä½œ</li>
              <li>å¤§æ•°æ®é‡åœºæ™¯</li>
            </ul>
          </div>

          <div class="recommendation-item">
            <h3>é€‰æ‹© Set çš„åœºæ™¯</h3>
            <CodeBlock :code="setUseCases" language="js" />
            <ul>
              <li>éœ€è¦å­˜å‚¨å”¯ä¸€å€¼</li>
              <li>é¢‘ç¹çš„æŸ¥æ‰¾æ“ä½œ</li>
              <li>å»é‡åœºæ™¯</li>
              <li>é›†åˆè¿ç®—</li>
            </ul>
          </div>
        </div>
      </section>

      <!-- ä»£ç ç¤ºä¾‹ -->
      <section id="examples" class="method-card">
        <h2>ğŸ’» å®é™…åº”ç”¨ç¤ºä¾‹</h2>
        <div class="examples-grid">
          <div class="example-item">
            <h3>ç¼“å­˜å®ç°</h3>
            <CodeBlock :code="cacheExample" language="js" />
          </div>

          <div class="example-item">
            <h3>äº‹ä»¶ç›‘å¬å™¨ç®¡ç†</h3>
            <CodeBlock :code="eventListenerExample" language="js" />
          </div>

          <div class="example-item">
            <h3>æ•°æ®å»é‡</h3>
            <CodeBlock :code="deduplicationExample" language="js" />
          </div>

          <div class="example-item">
            <h3>é…ç½®ç®¡ç†</h3>
            <CodeBlock :code="configExample" language="js" />
          </div>
        </div>
      </section>

      <!-- å†…å­˜å ç”¨ -->
      <section id="memory" class="method-card">
        <h2>ğŸ’¾ å†…å­˜å ç”¨å¯¹æ¯”</h2>
        <div class="memory-info">
          <div class="memory-item">
            <h3>å†…å­˜å ç”¨ç‰¹ç‚¹</h3>
            <ul>
              <li><strong>Objectï¼š</strong>å†…å­˜å ç”¨æœ€å°ï¼Œä½†åŸå‹é“¾å¼€é”€</li>
              <li><strong>Mapï¼š</strong>å†…å­˜å ç”¨ä¸­ç­‰ï¼Œä½†æ€§èƒ½ç¨³å®š</li>
              <li><strong>Setï¼š</strong>å†…å­˜å ç”¨ç›¸å¯¹è¾ƒé«˜ï¼Œä½†æŸ¥æ‰¾æå¿«</li>
            </ul>
          </div>
          <div class="memory-item">
            <h3>ä¼˜åŒ–å»ºè®®</h3>
            <ul>
              <li>åŠæ—¶æ¸…ç†ä¸éœ€è¦çš„æ•°æ®</li>
              <li>ä½¿ç”¨ WeakMap/WeakSet é¿å…å†…å­˜æ³„æ¼</li>
              <li>è€ƒè™‘æ•°æ®ç»“æ„çš„ç”Ÿå‘½å‘¨æœŸ</li>
              <li>ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ</li>
            </ul>
          </div>
        </div>
      </section>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue'
import CodeBlock from '@/components/Code/index.vue'
import Nav from '@/components/Nav/ScrollNav.vue'
import testResults from '../JSON/dataStructurePerformence.json'

const sections = [
  { id: 'overview', name: 'æ¦‚è¿°' },
  { id: 'features', name: 'æ•°æ®ç»“æ„ç‰¹ç‚¹' },
  { id: 'performance-tests', name: 'æ€§èƒ½æµ‹è¯•' },
  { id: 'analysis', name: 'æ€§èƒ½åˆ†æ' },
  { id: 'recommendations', name: 'ä½¿ç”¨å»ºè®®' },
  { id: 'examples', name: 'å®é™…åº”ç”¨' },
  { id: 'memory', name: 'å†…å­˜å ç”¨' },
]

onMounted(() => {
  drawCharts()
})

type Operation = 'query' | 'add' | 'delete' | 'update'

type TestResults = {
  [index in Operation]: {
    arrayAverage: number
    arrayRange: string
    objectAverage: number
    objectRange: string
    mapAverage: number
    mapRange: string
    setAverage: number
    setRange: string
    size: '1ä¸‡æ¬¡' | '10ä¸‡æ¬¡' | '100ä¸‡æ¬¡' | '1000ä¸‡æ¬¡' | '1äº¿æ¬¡'
    fastest: 'Object' | 'Map' | 'Set' | 'array'
    note: string
  }[]

  // totalTests: number
}

const accessChart = ref<HTMLCanvasElement>()
const queryChart = ref<HTMLCanvasElement>()
const addChart = ref<HTMLCanvasElement>()
const deleteChart = ref<HTMLCanvasElement>()
const updateChart = ref<HTMLCanvasElement>()

interface OperationResult {
  arrayAverage: number
  arrayRange: string
  objectAverage: number
  objectRange: string
  mapAverage: number
  mapRange: string
  setAverage: number
  setRange: string
  size: '1ä¸‡æ¬¡' | '10ä¸‡æ¬¡' | '100ä¸‡æ¬¡' | '1000ä¸‡æ¬¡' | '1äº¿æ¬¡'
  fastest: 'Object' | 'Map' | 'Set' | 'array'
  note: string
}

// ç»˜åˆ¶å›¾è¡¨
const drawCharts = () => {
  // è·å–æ€§èƒ½å›¾è¡¨
  drawChart(accessChart.value!, testResults.access as OperationResult[])
  // æŸ¥è¯¢æ€§èƒ½å›¾è¡¨
  drawChart(queryChart.value!, testResults.query as OperationResult[])

  // æ·»åŠ æ€§èƒ½å›¾è¡¨
  drawChart(addChart.value!, testResults.add as OperationResult[])

  // åˆ é™¤æ€§èƒ½å›¾è¡¨
  drawChart(deleteChart.value!, testResults.delete as OperationResult[])

  // ä¿®æ”¹æ€§èƒ½å›¾è¡¨
  drawChart(updateChart.value!, testResults.update as OperationResult[])
}

const colors = {
  object: '#ef4444',
  map: '#3b82f6',
  set: '#10b981',
  array: '#8b5cf6',
}

// ç»˜åˆ¶å•ä¸ªå›¾è¡¨
const drawChart = (canvas: HTMLCanvasElement, data: TestResults[Operation]) => {
  const ctx = canvas.getContext('2d')!

  // æ¸…ç©ºç”»å¸ƒ
  ctx.clearRect(0, 0, canvas.width, canvas.height)

  // ç»˜åˆ¶æ ‡é¢˜

  // ç»˜åˆ¶å›¾ä¾‹
  // const legendY = 50
  // ctx.font = '12px Arial'
  // ctx.fillStyle = colors.object
  // ctx.fillText('Object', 100, legendY)
  // ctx.fillStyle = colors.map
  // ctx.fillText('Map', 200, legendY)
  // ctx.fillStyle = colors.set
  // ctx.fillText('Set', 300, legendY)

  const length = data.length

  // ç»˜åˆ¶æ•°æ®
  const chartWidth = canvas.width
  const chartHeight = canvas.height
  const gap = 80

  const barWidth = (chartWidth - gap * 3) / (length * 4)

  data.forEach((item, index) => {
    const currentGap = index === 0 ? 0 : index === 1 ? gap : index === 2 ? gap * 2 : gap * 3
    const x = index * ((chartWidth - gap * 3) / length) + currentGap
    const maxValue = Math.max(
      item.objectAverage,
      item.mapAverage,
      item.setAverage,
      item.arrayAverage,
    )

    drawBar()

    function drawBar() {
      // Array
      const arrayHeight = (item.arrayAverage / maxValue) * chartHeight || 2
      ctx.fillStyle = colors.array
      ctx.fillRect(x, canvas.height - 50 - arrayHeight, barWidth, arrayHeight)

      // Object
      const objHeight = (item.objectAverage / maxValue) * chartHeight || 2
      ctx.fillStyle = colors.object
      ctx.fillRect(x + barWidth, canvas.height - 50 - objHeight, barWidth, objHeight)

      // Map
      const mapHeight = (item.mapAverage / maxValue) * chartHeight || 2
      ctx.fillStyle = colors.map
      ctx.fillRect(x + barWidth * 2, canvas.height - 50 - mapHeight, barWidth, mapHeight)

      // Set
      const setHeight = (item.setAverage / maxValue) * chartHeight || 2
      ctx.fillStyle = colors.set
      ctx.fillRect(x + barWidth * 3, canvas.height - 50 - setHeight, barWidth, setHeight)
    }

    // æ ‡ç­¾
    ctx.fillStyle = '#6b7280'
    ctx.fillText(item.size.toString(), x + barWidth * 1.5, canvas.height - 30)

    //é¢œè‰²å°æ–¹å—
    ctx.fillStyle =
      index === 0
        ? colors.array
        : index === 1
          ? colors.object
          : index === 2
            ? colors.map
            : colors.set
    ctx.fillRect(x + barWidth * 1.5, canvas.height - 25, 50, 30)

    // æ ‡ç­¾
    ctx.fillStyle = '#fff'
    ctx.font = '12px Arial'
    ctx.fillText(
      index === 0 ? 'Array' : index === 1 ? 'Object' : index === 2 ? 'Map' : 'Set',
      x + barWidth * 1.5,
      canvas.height - 10,
    )
  })
}

// ä»£ç ç¤ºä¾‹
const objectUseCases = `
// é…ç½®å¯¹è±¡
const config = {
  apiUrl: 'https://api.example.com',
  timeout: 5000,
  retries: 3
};

// ç”¨æˆ·ä¿¡æ¯
const user = {
  id: 1,
  name: 'John',
  email: 'john@example.com'
};

// ç¼“å­˜
const cache = {};
cache['user:1'] = userData;
`.trim()

const mapUseCases = `
// äº‹ä»¶ç›‘å¬å™¨ç®¡ç†
const eventListeners = new Map();
eventListeners.set(button, handler);

// å¯¹è±¡ä½œä¸ºé”®
const userSessions = new Map();
userSessions.set(userObject, sessionData);

// å¤æ‚æ•°æ®ç»“æ„
const metadata = new Map();
metadata.set(document, { scrollPosition: 100 });
`.trim()

const setUseCases = `
// å»é‡
const uniqueIds = new Set([1, 2, 2, 3, 3, 4]);

// æƒé™æ£€æŸ¥
const allowedRoles = new Set(['admin', 'moderator']);

// é›†åˆè¿ç®—
const set1 = new Set([1, 2, 3]);
const set2 = new Set([2, 3, 4]);
const intersection = new Set([...set1].filter(x => set2.has(x)));
`.trim()

const cacheExample = `
// é«˜æ€§èƒ½ç¼“å­˜å®ç°
class Cache {
  constructor() {
    this.map = new Map();
    this.maxSize = 1000;
  }

  set(key, value) {
    if (this.map.size >= this.maxSize) {
      const firstKey = this.map.keys().next().value;
      this.map.delete(firstKey);
    }
    this.map.set(key, value);
  }

  get(key) {
    return this.map.get(key);
  }

  has(key) {
    return this.map.has(key);
  }
}
`.trim()

const eventListenerExample = `
// äº‹ä»¶ç›‘å¬å™¨ç®¡ç†
class EventManager {
  constructor() {
    this.listeners = new Map();
  }

  addListener(element, event, handler) {
    if (!this.listeners.has(element)) {
      this.listeners.set(element, new Map());
    }

    const elementListeners = this.listeners.get(element);
    if (!elementListeners.has(event)) {
      elementListeners.set(event, new Set());
    }

    elementListeners.get(event).add(handler);
    element.addEventListener(event, handler);
  }

  removeListener(element, event, handler) {
    const elementListeners = this.listeners.get(element);
    if (elementListeners) {
      const eventHandlers = elementListeners.get(event);
      if (eventHandlers) {
        eventHandlers.delete(handler);
        element.removeEventListener(event, handler);
      }
    }
  }
}
`.trim()

const deduplicationExample = `
// æ•°ç»„å»é‡
function deduplicateArray(arr) {
  return [...new Set(arr)];
}

// å¯¹è±¡æ•°ç»„å»é‡
function deduplicateObjects(arr, key) {
  const seen = new Set();
  return arr.filter(item => {
    const value = item[key];
    if (seen.has(value)) {
      return false;
    }
    seen.add(value);
    return true;
  });
}

// é«˜æ€§èƒ½å»é‡
const uniqueValues = new Set();
data.forEach(item => {
  if (!uniqueValues.has(item.id)) {
    uniqueValues.add(item.id);
    // å¤„ç†å”¯ä¸€é¡¹
  }
});
`.trim()

const configExample = `
// é…ç½®ç®¡ç†
class ConfigManager {
  constructor() {
    this.config = new Map();
    this.defaults = new Map();
  }

  set(key, value) {
    this.config.set(key, value);
  }

  get(key) {
    return this.config.has(key)
      ? this.config.get(key)
      : this.defaults.get(key);
  }

  setDefault(key, value) {
    this.defaults.set(key, value);
  }

  has(key) {
    return this.config.has(key) || this.defaults.has(key);
  }

  delete(key) {
    this.config.delete(key);
  }
}
`.trim()
</script>

<style scoped lang="less">
.canvas2 {
  transform-style: preserve-3d;
  transform: rotateZ(180deg) rotateY(180deg);
}
.performance-comparison {
  max-width: 1000px;
  margin: 0 auto;
  padding: 1rem;
  font-family:
    'Inter',
    -apple-system,
    BlinkMacSystemFont,
    'Segoe UI',
    sans-serif;
  line-height: 1.5;
  color: #2c3e50;
  background: #f8f9fa;
  min-height: 100vh;
  position: relative;
}

.docs-header {
  text-align: center;
  margin-bottom: 1.5rem;
  padding: 1.5rem;
  background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
  border-radius: 8px;
  color: white;
  box-shadow: 0 2px 10px rgba(79, 70, 229, 0.2);

  h1 {
    font-size: 2rem;
    font-weight: 700;
    margin: 0 0 0.25rem 0;
    color: white;
  }

  .subtitle {
    font-size: 1rem;
    opacity: 0.9;
    margin: 0;
    font-weight: 400;
  }
}

.content-wrapper {
  display: grid;
  gap: 1rem;
}

.method-card {
  background: white;
  border-radius: 8px;
  padding: 1.5rem;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  border: 1px solid #e5e7eb;
  transition: all 0.2s ease;

  &:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  }

  &.highlight {
    border: 2px solid #4f46e5;
    background: linear-gradient(135deg, #f8faff 0%, #f0f4ff 100%);
  }

  h2 {
    color: #1f2937;
    font-size: 1.5rem;
    font-weight: 600;
    margin: 0 0 1rem 0;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid #e5e7eb;
  }

  h3 {
    color: #374151;
    font-size: 1.1rem;
    font-weight: 600;
    margin: 1rem 0 0.5rem 0;
  }

  h4 {
    color: #6b7280;
    font-size: 1rem;
    font-weight: 500;
    margin: 0.75rem 0 0.25rem 0;
  }
}

.info-box {
  background: linear-gradient(135deg, #f8faff 0%, #f0f4ff 100%);
  padding: 1rem;
  border-radius: 6px;
  border-left: 3px solid #4f46e5;
  margin-bottom: 1rem;

  h3 {
    color: #1f2937;
    margin-top: 0;
    font-size: 1.1rem;
  }

  ul {
    margin: 0.75rem 0;
    padding-left: 1.25rem;

    li {
      margin-bottom: 0.25rem;
      line-height: 1.5;
      font-size: 0.95rem;
    }
  }
}

.features-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 1rem;
}

.note {
  color: #6b7280;
  font-size: 1.5rem;
  margin-top: 1rem;
}

.feature-item {
  background: #f9fafb;
  padding: 1rem;
  border-radius: 6px;
  border: 1px solid #e5e7eb;

  h3 {
    color: #1f2937;
    margin-top: 0;
    font-size: 1.2rem;
    text-align: center;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid #e5e7eb;
  }

  .feature-content {
    h4 {
      color: #374151;
      margin: 0.75rem 0 0.25rem 0;
      font-size: 0.95rem;
    }

    ul {
      margin: 0.5rem 0;
      padding-left: 1rem;
      font-size: 0.9rem;

      li {
        margin-bottom: 0.25rem;
        color: #6b7280;
      }
    }
  }
}

.test-controls {
  text-align: center;
  margin-bottom: 1.5rem;

  .test-btn {
    background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 6px;
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;

    &:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(79, 70, 229, 0.3);
    }

    &:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
  }

  .test-summary {
    margin-top: 1rem;
    color: #6b7280;
    font-size: 0.9rem;
  }
}

.performance-section {
  margin-bottom: 2rem;

  h3 {
    color: #1f2937;
    margin-bottom: 1rem;
  }

  .chart-container {
    margin: 1rem 0;
    background: white;
    border-radius: 6px;
    padding: 1rem;
    border: 1px solid #e5e7eb;
    overflow-x: auto;
    display: flex;
    justify-content: center;
    flex-direction: column;
    .chart-canvas {
      margin: 0 auto;
    }
    .chart-button {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 1rem;
      gap: 10px;
      .chart-button-item {
        width: 100px;
        height: 30px;
        border-radius: 5px;
        display: flex;
        color: white;
        font-size: 12px;
        font-weight: 500;
        justify-content: center;
        align-items: center;
        &:nth-child(1) {
          background: #ef4444;
        }
        &:nth-child(2) {
          background: #3b82f6;
        }
        &:nth-child(3) {
          background: #10b981;
        }
      }
    }
  }

  .results-table {
    margin-top: 1rem;

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 6px;
      overflow: hidden;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);

      th,
      td {
        padding: 0.75rem;
        text-align: left;
        border-bottom: 1px solid #e5e7eb;
        font-size: 0.9rem;
      }

      th {
        background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
        color: white;
        font-weight: 600;
      }

      tr:hover {
        background: #f8faff;
      }

      .fastest {
        font-weight: 600;
        color: #10b981;
      }
    }
  }
}

.analysis-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 1rem;

  .analysis-item {
    background: #f9fafb;
    padding: 1rem;
    border-radius: 6px;
    border: 1px solid #e5e7eb;

    h3 {
      color: #1f2937;
      margin-top: 0;
      font-size: 1.1rem;
    }

    ul {
      margin: 0.5rem 0;
      padding-left: 1.25rem;

      li {
        margin-bottom: 0.25rem;
        color: #6b7280;
        font-size: 0.9rem;
      }
    }
  }
}

.recommendations-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 1.5rem;

  .recommendation-item {
    background: white;
    padding: 1rem;
    border-radius: 6px;
    border: 1px solid #e5e7eb;

    h3 {
      color: #1f2937;
      margin-top: 0;
      font-size: 1.1rem;
    }

    ul {
      margin: 0.75rem 0;
      padding-left: 1.25rem;

      li {
        margin-bottom: 0.25rem;
        color: #6b7280;
        font-size: 0.9rem;
      }
    }
  }
}

.examples-grid {


  .example-item {
    background: #f9fafb;
    padding: 1rem;
    border-radius: 6px;
    border: 1px solid #e5e7eb;

    h3 {
      color: #1f2937;
      margin-top: 0;
      font-size: 1.1rem;
    }
  }
}

.memory-info {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 1rem;

  .memory-item {
    background: #f9fafb;
    padding: 1rem;
    border-radius: 6px;
    border: 1px solid #e5e7eb;

    h3 {
      color: #1f2937;
      margin-top: 0;
      font-size: 1.1rem;
    }

    ul {
      margin: 0.5rem 0;
      padding-left: 1.25rem;

      li {
        margin-bottom: 0.25rem;
        color: #6b7280;
        font-size: 0.9rem;
      }
    }
  }
}

// å“åº”å¼è®¾è®¡
@media (max-width: 768px) {
  .performance-comparison {
    padding: 0.75rem;
  }

  .docs-header {
    padding: 1rem;

    h1 {
      font-size: 1.75rem;
    }
  }

  .method-card {
    padding: 1rem;
  }

  .features-grid,
  .analysis-grid,
  .recommendations-grid,
  .examples-grid {
    grid-template-columns: 1fr;
  }

  .chart-container {
    canvas {
      max-width: 100%;
      height: auto;
    }
  }
}

// ä»£ç å—æ ·å¼ä¼˜åŒ–
:deep(.code-block) {
  margin: 0.75rem 0;
  border-radius: 6px;
  overflow: hidden;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  font-size: 0.85rem;
}

// å¯¼èˆªæ ·å¼
.toc {
  position: sticky;
  top: 20px;
  right: 20px;
  z-index: 10;
  margin-bottom: 1.5rem;
}

// ç´§å‡‘çš„é—´è·
p {
  margin: 0.5rem 0;
  font-size: 0.95rem;
}

// æ›´å¥½çš„è§†è§‰å±‚æ¬¡
strong {
  color: #1f2937;
  font-weight: 600;
}

// ä»£ç é«˜äº®
code {
  background: #f1f5f9;
  padding: 2px 4px;
  border-radius: 3px;
  font-family: 'Fira Code', 'Consolas', monospace;
  font-size: 0.85rem;
  color: #dc2626;
}
</style>
