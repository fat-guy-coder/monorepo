<template>
  <div class="webgl-intro-container">
    <h1 class="main-title">WebGLæŠ€æœ¯åŸºç¡€ä»‹ç»</h1>
    <div class="intro-card">
      <h2 class="section-title">ğŸ¤” ä»€ä¹ˆæ˜¯WebGL?</h2>
      <p class="content-text">
        WebGL(Web Graphics Library)æ˜¯ä¸€ç§JavaScript APIï¼Œç”¨äºåœ¨ä»»ä½•å…¼å®¹çš„Webæµè§ˆå™¨ä¸­å‘ˆç°äº¤äº’å¼2Då’Œ3Då›¾å½¢ï¼Œè€Œæ— éœ€ä½¿ç”¨æ’ä»¶ã€‚
      </p>
      <div class="feature-grid">
        <div class="feature-card">
          <div class="feature-icon">ğŸ”§</div>
          <h3>åŸºäºOpenGL ES</h3>
          <p>WebGLåŸºäºOpenGL ES 2.0æ ‡å‡†ï¼Œæ˜¯OpenGLçš„å­é›†</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">âš¡</div>
          <h3>ç¡¬ä»¶åŠ é€Ÿ</h3>
          <p>åˆ©ç”¨GPUç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“ï¼Œæé«˜å›¾å½¢å¤„ç†æ€§èƒ½</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">ğŸŒ</div>
          <h3>è·¨å¹³å°</h3>
          <p>æ”¯æŒæ‰€æœ‰ç°ä»£æµè§ˆå™¨ï¼Œæ— éœ€é¢å¤–æ’ä»¶</p>
        </div>
      </div>
    </div>

    <div class="intro-card">
      <h2 class="section-title">ğŸ“ WebGLæ ¸å¿ƒæ¦‚å¿µ</h2>
      <div class="concept-container">
        <div class="concept-section">
          <h3 class="concept-title">é¡¶ç‚¹ç€è‰²å™¨</h3>
          <div class="concept-detail">
            <p>è´Ÿè´£å¤„ç†æ¯ä¸ªé¡¶ç‚¹çš„ä½ç½®è®¡ç®—</p>
            <ul>
              <li>å°†é¡¶ç‚¹ä½ç½®ä»æ¨¡å‹åæ ‡è½¬æ¢åˆ°å±å¹•åæ ‡</li>
              <li>è®¡ç®—é¡¶ç‚¹å…‰ç…§ã€é¢œè‰²ç­‰å±æ€§</li>
              <li>æ¯ä¸ªé¡¶ç‚¹æ‰§è¡Œä¸€æ¬¡</li>
            </ul>
          </div>
        </div>

        <div class="concept-section">
          <h3 class="concept-title">ç‰‡å…ƒç€è‰²å™¨</h3>
          <div class="concept-detail">
            <p>è´Ÿè´£å¤„ç†æ¯ä¸ªåƒç´ çš„é¢œè‰²è®¡ç®—</p>
            <ul>
              <li>è®¡ç®—æœ€ç»ˆæ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„åƒç´ é¢œè‰²</li>
              <li>å¯ä»¥åº”ç”¨çº¹ç†ã€å…‰ç…§ã€é›¾åŒ–ç­‰æ•ˆæœ</li>
              <li>æ¯ä¸ªåƒç´ æ‰§è¡Œä¸€æ¬¡</li>
            </ul>
          </div>
        </div>

        <div class="concept-diagram">
          <div class="graphics-pipeline">
            <div class="pipeline-step">é¡¶ç‚¹æ•°æ®</div>
            <div class="arrow">â†’</div>
            <div class="pipeline-step">é¡¶ç‚¹ç€è‰²å™¨</div>
            <div class="arrow">â†’</div>
            <div class="pipeline-step">å›¾å…ƒè£…é…</div>
            <div class="arrow">â†’</div>
            <div class="pipeline-step">å…‰æ …åŒ–</div>
            <div class="arrow">â†’</div>
            <div class="pipeline-step">ç‰‡å…ƒç€è‰²å™¨</div>
          </div>
        </div>
      </div>
    </div>

    <div class="demo-card">
      <h2 class="section-title">ğŸ’» WebGLåŸºç¡€ç¤ºä¾‹ - ç»˜åˆ¶ä¸‰è§’å½¢</h2>
      <div class="demo-container">
        <div class="code-editor">
          <div class="editor-title">ä»£ç å®ç°</div>
          <pre class="code-block"><code>// 1. åˆå§‹åŒ–WebGLä¸Šä¸‹æ–‡
const canvas = document.getElementById('webgl-canvas');
const gl = canvas.getContext('webgl');

// 2. å®šä¹‰é¡¶ç‚¹æ•°æ®
const vertices = new Float32Array([
   0.0,  0.5,   // é¡¶ç‚¹1
  -0.5, -0.5,   // é¡¶ç‚¹2
   0.5, -0.5    // é¡¶ç‚¹3
]);

// 3. åˆ›å»ºé¡¶ç‚¹ç€è‰²å™¨
const vsSource = `
  attribute vec2 aPosition;
  void main() {
    gl_Position = vec4(aPosition, 0.0, 1.0);
  }`;

// 4. åˆ›å»ºç‰‡å…ƒç€è‰²å™¨
const fsSource = `
  void main() {
    gl_FragColor = vec4(0.3, 0.6, 1.0, 1.0); // è“è‰²
  }`;

// 5. åˆå§‹åŒ–ç€è‰²å™¨ç¨‹åº
const program = initShaderProgram(gl, vsSource, fsSource);

// 6. è®¾ç½®é¡¶ç‚¹ç¼“å†²åŒº
const vertexBuffer = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);
gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);

// 7. ç»‘å®šé¡¶ç‚¹å±æ€§
const positionAttrib = gl.getAttribLocation(program, 'aPosition');
gl.vertexAttribPointer(positionAttrib, 2, gl.FLOAT, false, 0, 0);
gl.enableVertexAttribArray(positionAttrib);

// 8. æ¸²æŸ“ä¸‰è§’å½¢
gl.clearColor(0.1, 0.1, 0.1, 1.0); // è®¾ç½®èƒŒæ™¯è‰²
gl.clear(gl.COLOR_BUFFER_BIT);
gl.drawArrays(gl.TRIANGLES, 0, 3);</code></pre>
        </div>

        <div class="canvas-container">
          <div class="canvas-title">æ¸²æŸ“ç»“æœ</div>
          <canvas ref="canvasRef" width="300" height="300"></canvas>
        </div>
      </div>
    </div>

    <div class="usage-card">
      <h2 class="section-title">ğŸš€ WebGLåº”ç”¨åœºæ™¯</h2>
      <div class="usage-grid">
        <div class="usage-item">
          <div class="usage-icon">ğŸ®</div>
          <h3>3Dæ¸¸æˆ</h3>
          <p>æµè§ˆå™¨å†…é«˜æ€§èƒ½3Dæ¸¸æˆ</p>
        </div>
        <div class="usage-item">
          <div class="usage-icon">ğŸ¢</div>
          <h3>æ•°æ®å¯è§†åŒ–</h3>
          <p>å¤æ‚3Dæ•°æ®å›¾è¡¨å±•ç¤º</p>
        </div>
        <div class="usage-item">
          <div class="usage-icon">ğŸ–¼ï¸</div>
          <h3>è‰ºæœ¯åˆ›ä½œ</h3>
          <p>äº¤äº’å¼æ•°å­—è‰ºæœ¯è£…ç½®</p>
        </div>
        <div class="usage-item">
          <div class="usage-icon">ğŸŒ</div>
          <h3>åœ°ç†ä¿¡æ¯ç³»ç»Ÿ</h3>
          <p>3Dåœ°å›¾å’Œåœ°çƒä»ªæ¸²æŸ“</p>
        </div>
      </div>
    </div>
  </div>
</template>

<script lang="ts" setup>
import { onMounted, ref } from 'vue';

const canvasRef = ref<HTMLCanvasElement | null>(null);

onMounted(() => {
  if (!canvasRef.value) return;

  const canvas = canvasRef.value;
  const gl = canvas.getContext('webgl');

  if (!gl) {
    console.error('WebGL not supported in this browser');
    return;
  }

  // é¡¶ç‚¹æ•°æ®
  const vertices = new Float32Array([
    0.0, 0.5,   // é¡¶ç‚¹1
    -0.5, -0.5,   // é¡¶ç‚¹2
    0.5, -0.5    // é¡¶ç‚¹3
  ]);

  // é¡¶ç‚¹ç€è‰²å™¨æºç 
  const vsSource = `
    attribute vec2 aPosition;
    void main() {
      gl_Position = vec4(aPosition, 0.0, 1.0);
    }`;

  // ç‰‡å…ƒç€è‰²å™¨æºç 
  const fsSource = `
    void main() {
      gl_FragColor = vec4(0.3, 0.6, 1.0, 1.0); // è“è‰²
    }`;

  // åˆå§‹åŒ–ç€è‰²å™¨ç¨‹åº
  const shaderProgram = initShaderProgram(gl, vsSource, fsSource);

  if (!shaderProgram) {
    console.error('Failed to initialize shader program');
    return;
  }

  // åˆ›å»ºé¡¶ç‚¹ç¼“å†²åŒº
  const vertexBuffer = gl.createBuffer();
  gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);
  gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);

  // è·å–é¡¶ç‚¹å±æ€§ä½ç½®å¹¶å¯ç”¨
  const positionAttrib = gl.getAttribLocation(shaderProgram, 'aPosition');
  gl.vertexAttribPointer(positionAttrib, 2, gl.FLOAT, false, 0, 0);
  gl.enableVertexAttribArray(positionAttrib);

  // è®¾ç½®èƒŒæ™¯è‰²å¹¶æ¸…é™¤ç”»å¸ƒ
  gl.clearColor(0.1, 0.1, 0.1, 1.0);
  gl.clear(gl.COLOR_BUFFER_BIT);

  // ç»˜åˆ¶ä¸‰è§’å½¢
  gl.drawArrays(gl.TRIANGLES, 0, 3);
});

// åˆå§‹åŒ–ç€è‰²å™¨ç¨‹åºçš„å·¥å…·å‡½æ•°
function initShaderProgram(gl: WebGLRenderingContext, vsSource: string, fsSource: string): WebGLProgram | null {
  const vertexShader = loadShader(gl, gl.VERTEX_SHADER, vsSource);
  const fragmentShader = loadShader(gl, gl.FRAGMENT_SHADER, fsSource);

  if (!vertexShader || !fragmentShader) return null;

  const shaderProgram = gl.createProgram();
  if (!shaderProgram) return null;

  gl.attachShader(shaderProgram, vertexShader);
  gl.attachShader(shaderProgram, fragmentShader);
  gl.linkProgram(shaderProgram);

  if (!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {
    console.error('Unable to initialize the shader program: ' + gl.getProgramInfoLog(shaderProgram));
    return null;
  }

  gl.useProgram(shaderProgram);
  return shaderProgram;
}

// åŠ è½½ç€è‰²å™¨çš„å·¥å…·å‡½æ•°
function loadShader(gl: WebGLRenderingContext, type: number, source: string): WebGLShader | null {
  const shader = gl.createShader(type);
  if (!shader) return null;

  gl.shaderSource(shader, source);
  gl.compileShader(shader);

  if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
    console.error('An error occurred compiling the shaders: ' + gl.getShaderInfoLog(shader));
    gl.deleteShader(shader);
    return null;
  }

  return shader;
}
</script>

<style lang="less" scoped>


.webgl-intro-container {
  max-width: 1000px;
  margin: 0 auto;
  padding: 2rem;
  font-family: 'Inter', sans-serif;
  background-color: #f8fafc;
  color: #334155;
  line-height: 1.6;
}

.main-title {
  text-align: center;
  font-size: 2.5rem;
  margin-bottom: 2rem;
  color: #1e293b;
  font-weight: 700;
  background: linear-gradient(90deg, #6366f1, #3b82f6);
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
}

.section-title {
  font-size: 1.8rem;
  margin: 1.5rem 0 1rem;
  color: #1e40af;
  padding-bottom: 0.5rem;
  border-bottom: 2px solid #dbeafe;
}

.intro-card,
.demo-card,
.usage-card {
  background: white;
  border-radius: 12px;
  padding: 1.75rem;
  margin-bottom: 2rem;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
  border: 1px solid #e2e8f0;
  transition: transform 0.2s ease, box-shadow 0.2s ease;

  &:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.08);
  }
}

.content-text {
  font-size: 1.1rem;
  margin-bottom: 1.5rem;
}

.feature-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1.5rem;
  margin-top: 1.5rem;
}

.feature-card {
  background: #eff6ff;
  border-radius: 10px;
  padding: 1.5rem;
  text-align: center;
  border-left: 4px solid #3b82f6;

  h3 {
    margin: 0.8rem 0;
    font-size: 1.3rem;
    color: #1d4ed8;
  }

  p {
    margin: 0;
    font-size: 0.95rem;
  }
}

.feature-icon {
  font-size: 2rem;
  margin-bottom: 0.5rem;
}

.concept-container {
  display: flex;
  flex-wrap: wrap;
  gap: 1.5rem;
}

.concept-section {
  flex: 1;
  min-width: 300px;
  background: #f0f9ff;
  padding: 1.5rem;
  border-radius: 10px;
  border-left: 4px solid #60a5fa;
}

.concept-title {
  font-size: 1.4rem;
  color: #1d4ed8;
  margin-top: 0;
  display: flex;
  align-items: center;

  &::before {
    content: "â–¶";
    margin-right: 0.5rem;
    color: #3b82f6;
    font-size: 0.8rem;
  }
}

.concept-detail {
  ul {
    padding-left: 1.5rem;

    li {
      margin-bottom: 0.5rem;
      position: relative;

      &::before {
        content: "â€¢";
        color: #3b82f6;
        font-weight: bold;
        position: absolute;
        left: -1.2rem;
      }
    }
  }
}

.concept-diagram {
  flex: 2;
  min-width: 350px;
  display: flex;
  justify-content: center;
  align-items: center;
}

.graphics-pipeline {
  display: flex;
  justify-content: space-around;
  align-items: center;
  background: linear-gradient(135deg, #e0f2fe, #dbeafe);
  padding: 1.2rem;
  border-radius: 10px;
  width: 100%;
}

.pipeline-step {
  background: #3b82f6;
  color: white;
  padding: 0.8rem 1.2rem;
  border-radius: 6px;
  font-weight: 500;
  text-align: center;
  min-width: 100px;
}

.arrow {
  font-size: 1.5rem;
  color: #1e40af;
}

.demo-container {
  display: flex;
  flex-wrap: wrap;
  gap: 1.5rem;
}

.code-editor {
  flex: 1;
  min-width: 300px;
  background: #1e293b;
  border-radius: 8px;
  overflow: hidden;
}

.editor-title {
  background: #334155;
  color: #e2e8f0;
  padding: 0.7rem 1rem;
  font-weight: 500;
  font-size: 1.1rem;
}

.code-block {
  margin: 0;
  padding: 1.2rem;
  overflow-x: auto;
  font-family: 'Fira Code', monospace;
  font-size: 0.9rem;
  line-height: 1.5;

  code {
    color: #cbd5e1;
    display: block;

    .hljs-comment {
      color: #94a3b8;
    }

    .hljs-keyword {
      color: #f472b6;
    }

    .hljs-built_in {
      color: #60a5fa;
    }

    .hljs-string {
      color: #34d399;
    }

    .hljs-number {
      color: #fbbf24;
    }
  }
}

.canvas-container {
  flex: 1;
  min-width: 300px;
  background: white;
  border-radius: 8px;
  padding: 1rem;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
  display: flex;
  flex-direction: column;
}

.canvas-title {
  font-weight: 500;
  margin-bottom: 1rem;
  text-align: center;
  color: #1e293b;
}

canvas {
  width: 100%;
  height: 280px;
  background: #1e293b;
  border-radius: 6px;
  display: block;
  margin: 0 auto;
}

.usage-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1.5rem;
  margin-top: 1rem;
}

.usage-item {
  text-align: center;
  padding: 1.2rem;
  background: #f0fdfa;
  border-radius: 10px;
  border: 1px solid #ccfbf1;

  h3 {
    margin: 0.7rem 0 0.5rem;
    color: #0f766e;
  }

  p {
    margin: 0;
    font-size: 0.9rem;
  }
}

.usage-icon {
  font-size: 2rem;
  color: #0d9488;
}

@media (max-width: 768px) {

  .concept-diagram,
  .graphics-pipeline {
    min-width: 100%;
  }

  .graphics-pipeline {
    flex-direction: column;

    .pipeline-step {
      margin: 0.5rem 0;
    }

    .arrow {
      transform: rotate(90deg);
    }
  }
}
</style>
