<template>
  <div class="scene-container">
    <header class="page-header">
      <h1 class="title">Three.js åœºæ™¯ç³»ç»Ÿ</h1>
      <p class="subtitle">æ„å»º3Dä¸–ç•Œçš„æ ¸å¿ƒå®¹å™¨</p>
    </header>

    <main class="content">
      <!-- æ¦‚è¿° -->
      <section class="overview-section">
        <div class="card">
          <h2 class="card-title">åœºæ™¯æ¦‚è¿°</h2>
          <div class="card-content">
            <div class="overview-content">
              <p class="intro-text">
                åœºæ™¯(Scene)æ˜¯Three.jsä¸­æ‰€æœ‰3Då¯¹è±¡çš„å®¹å™¨ï¼Œå®ƒå®šä¹‰äº†3Dä¸–ç•Œçš„ç©ºé—´ç»“æ„ã€ç¯å¢ƒè®¾ç½®å’Œæ¸²æŸ“ä¸Šä¸‹æ–‡ã€‚
              </p>
              <div class="scene-basics">
                <h3>åœºæ™¯æ ¸å¿ƒæ¦‚å¿µ</h3>
                <div class="concept-grid">
                  <div class="concept-item">
                    <div class="concept-icon">ğŸŒ</div>
                    <div class="concept-text">
                      <h4>3Dç©ºé—´å®¹å™¨</h4>
                      <p>å®¹çº³æ‰€æœ‰3Då¯¹è±¡ã€å…‰æºå’Œç›¸æœºçš„è™šæ‹Ÿç©ºé—´</p>
                    </div>
                  </div>
                  <div class="concept-item">
                    <div class="concept-icon">ğŸ­</div>
                    <div class="concept-text">
                      <h4>åœºæ™¯å›¾ç»“æ„</h4>
                      <p>æ ‘çŠ¶å±‚çº§ç»“æ„ç®¡ç†å¯¹è±¡å…³ç³»å’Œå˜æ¢</p>
                    </div>
                  </div>
                  <div class="concept-item">
                    <div class="concept-icon">ğŸ’¡</div>
                    <div class="concept-text">
                      <h4>ç¯å¢ƒè®¾ç½®</h4>
                      <p>å®šä¹‰èƒŒæ™¯ã€é›¾æ•ˆã€ç¯å¢ƒå…‰ç…§ç­‰å…¨å±€è®¾ç½®</p>
                    </div>
                  </div>
                  <div class="concept-item">
                    <div class="concept-icon">âš¡</div>
                    <div class="concept-text">
                      <h4>æ¸²æŸ“ä¸Šä¸‹æ–‡</h4>
                      <p>ä¸ºæ¸²æŸ“å™¨æä¾›å®Œæ•´çš„3Dä¸–ç•Œæè¿°</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- åŸºç¡€åœºæ™¯ -->
      <section class="basic-scene-section">
        <div class="card">
          <h2 class="card-title">åŸºç¡€åœºæ™¯åˆ›å»º</h2>
          <div class="card-content">
            <div class="creation-steps">
              <div class="step-item">
                <div class="step-number">1</div>
                <div class="step-content">
                  <h4>åˆ›å»ºåœºæ™¯å®ä¾‹</h4>
                  <p>åˆå§‹åŒ–ä¸€ä¸ªç©ºçš„3Dåœºæ™¯</p>
                  <div class="code-block">
                    <pre><code>import * as THREE from 'three';

// åˆ›å»ºåœºæ™¯
const scene = new THREE.Scene();</code></pre>
                  </div>
                </div>
              </div>
              <div class="step-item">
                <div class="step-number">2</div>
                <div class="step-content">
                  <h4>è®¾ç½®åœºæ™¯å±æ€§</h4>
                  <p>é…ç½®èƒŒæ™¯ã€é›¾æ•ˆç­‰åœºæ™¯å±æ€§</p>
                  <div class="code-block">
                    <pre><code>// è®¾ç½®èƒŒæ™¯é¢œè‰²
scene.background = new THREE.Color(0x87CEEB);

// æˆ–è€…è®¾ç½®èƒŒæ™¯è´´å›¾
const textureLoader = new THREE.TextureLoader();
scene.background = textureLoader.load('skybox.jpg');</code></pre>
                  </div>
                </div>
              </div>
              <div class="step-item">
                <div class="step-number">3</div>
                <div class="step-content">
                  <h4>æ·»åŠ 3Då¯¹è±¡</h4>
                  <p>å°†å‡ ä½•ä½“ã€å…‰æºç­‰å¯¹è±¡æ·»åŠ åˆ°åœºæ™¯ä¸­</p>
                  <div class="code-block">
                    <pre><code>// æ·»åŠ ç«‹æ–¹ä½“
const geometry = new THREE.BoxGeometry(1, 1, 1);
const material = new THREE.MeshStandardMaterial({ color: 0x00ff00 });
const cube = new THREE.Mesh(geometry, material);
scene.add(cube);

// æ·»åŠ å…‰æº
const light = new THREE.DirectionalLight(0xffffff, 1);
light.position.set(5, 5, 5);
scene.add(light);</code></pre>
                  </div>
                </div>
              </div>
              <div class="step-item">
                <div class="step-number">4</div>
                <div class="step-content">
                  <h4>æ¸²æŸ“åœºæ™¯</h4>
                  <p>ä½¿ç”¨æ¸²æŸ“å™¨å°†åœºæ™¯æ¸²æŸ“åˆ°ç”»å¸ƒ</p>
                  <div class="code-block">
                    <pre><code>// åˆ›å»ºæ¸²æŸ“å™¨
const renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// æ¸²æŸ“åœºæ™¯
function animate() {
  requestAnimationFrame(animate);
  renderer.render(scene, camera);
}
animate();</code></pre>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- åœºæ™¯å±æ€§ -->
      <section class="properties-section">
        <div class="card">
          <h2 class="card-title">åœºæ™¯æ ¸å¿ƒå±æ€§</h2>
          <div class="card-content">
            <div class="properties-grid">
              <div class="property-group">
                <h3>èƒŒæ™¯è®¾ç½®</h3>
                <div class="property-list">
                  <div class="property-item">
                    <div class="property-header">
                      <span class="property-name">background</span>
                      <span class="property-type">Color | Texture | null</span>
                    </div>
                    <p class="property-desc">è®¾ç½®åœºæ™¯èƒŒæ™¯ï¼Œå¯ä»¥æ˜¯çº¯è‰²ã€çº¹ç†æˆ–ç«‹æ–¹ä½“è´´å›¾</p>
                    <div class="property-examples">
                      <h5>ç¤ºä¾‹ï¼š</h5>
                      <div class="code-block">
                        <pre><code>// çº¯è‰²èƒŒæ™¯
scene.background = new THREE.Color(0x87CEEB);

// çº¹ç†èƒŒæ™¯
scene.background = textureLoader.load('sky.jpg');

// ç«‹æ–¹ä½“è´´å›¾èƒŒæ™¯
scene.background = new THREE.CubeTextureLoader()
  .load(['px.jpg', 'nx.jpg', 'py.jpg', 'ny.jpg', 'pz.jpg', 'nz.jpg']);</code></pre>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="property-group">
                <h3>ç¯å¢ƒè®¾ç½®</h3>
                <div class="property-list">
                  <div class="property-item">
                    <div class="property-header">
                      <span class="property-name">environment</span>
                      <span class="property-type">Texture | null</span>
                    </div>
                    <p class="property-desc">è®¾ç½®åœºæ™¯ç¯å¢ƒè´´å›¾ï¼Œå½±å“æ‰€æœ‰PBRæè´¨çš„åå°„</p>
                    <div class="property-examples">
                      <h5>ç¤ºä¾‹ï¼š</h5>
                      <div class="code-block">
                        <pre><code>// è®¾ç½®ç¯å¢ƒè´´å›¾
const envMap = new THREE.TextureLoader().load('environment.hdr');
envMap.mapping = THREE.EquirectangularReflectionMapping;
scene.environment = envMap;</code></pre>
                      </div>
                    </div>
                  </div>
                  <div class="property-item">
                    <div class="property-header">
                      <span class="property-name">fog</span>
                      <span class="property-type">Fog | FogExp2 | null</span>
                    </div>
                    <p class="property-desc">è®¾ç½®åœºæ™¯é›¾æ•ˆï¼Œåˆ›å»ºæ·±åº¦æ„Ÿå’Œå¤§æ°”æ•ˆæœ</p>
                    <div class="property-examples">
                      <h5>ç¤ºä¾‹ï¼š</h5>
                      <div class="code-block">
                        <pre><code>// çº¿æ€§é›¾æ•ˆ
scene.fog = new THREE.Fog(0xcccccc, 10, 50);

// æŒ‡æ•°é›¾æ•ˆ
scene.fog = new THREE.FogExp2(0xcccccc, 0.1);</code></pre>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="property-group">
                <h3>é«˜çº§å±æ€§</h3>
                <div class="property-list">
                  <div class="property-item">
                    <div class="property-header">
                      <span class="property-name">overrideMaterial</span>
                      <span class="property-type">Material | null</span>
                    </div>
                    <p class="property-desc">å¼ºåˆ¶åœºæ™¯ä¸­æ‰€æœ‰ç‰©ä½“ä½¿ç”¨ç›¸åŒæè´¨ï¼Œç”¨äºç‰¹æ®Šæ•ˆæœ</p>
                    <div class="property-examples">
                      <h5>ç¤ºä¾‹ï¼š</h5>
                      <div class="code-block">
                        <pre><code>// æ‰€æœ‰ç‰©ä½“ä½¿ç”¨çº¿æ¡†æè´¨
scene.overrideMaterial = new THREE.MeshBasicMaterial({
  wireframe: true,
  color: 0xffffff
});</code></pre>
                      </div>
                    </div>
                  </div>
                  <div class="property-item">
                    <div class="property-header">
                      <span class="property-name">autoUpdate</span>
                      <span class="property-type">boolean</span>
                    </div>
                    <p class="property-desc">è‡ªåŠ¨æ›´æ–°åœºæ™¯çŸ©é˜µå’Œå±‚çº§ç»“æ„ï¼Œé€šå¸¸ä¿æŒä¸ºtrue</p>
                    <div class="property-examples">
                      <h5>ç¤ºä¾‹ï¼š</h5>
                      <div class="code-block">
                        <pre><code>// æ‰‹åŠ¨æ§åˆ¶åœºæ™¯æ›´æ–°ï¼ˆé«˜çº§ç”¨æ³•ï¼‰
scene.autoUpdate = false;
// éœ€è¦æ—¶æ‰‹åŠ¨æ›´æ–°
scene.updateMatrixWorld(true);</code></pre>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- åœºæ™¯å›¾ç»“æ„ -->
      <section class="scene-graph-section">
        <div class="card">
          <h2 class="card-title">åœºæ™¯å›¾ç»“æ„</h2>
          <div class="card-content">
            <div class="graph-explanation">
              <p>Three.jsä½¿ç”¨åœºæ™¯å›¾(Scene Graph)æ¥ç®¡ç†3Då¯¹è±¡çš„å±‚çº§å…³ç³»ï¼Œè¿™æ˜¯ä¸€ä¸ªæ ‘çŠ¶ç»“æ„ï¼š</p>

              <div class="graph-visualization">
                <div class="graph-node main-node">
                  <div class="node-content">
                    <span class="node-icon">ğŸŒ</span>
                    <span class="node-label">Scene</span>
                  </div>
                  <div class="node-children">
                    <div class="graph-node child-node">
                      <div class="node-content">
                        <span class="node-icon">ğŸ“¦</span>
                        <span class="node-label">Group</span>
                      </div>
                      <div class="node-children">
                        <div class="graph-node leaf-node">
                          <div class="node-content">
                            <span class="node-icon">â—»ï¸</span>
                            <span class="node-label">Mesh</span>
                          </div>
                        </div>
                        <div class="graph-node leaf-node">
                          <div class="node-content">
                            <span class="node-icon">ğŸ’¡</span>
                            <span class="node-label">Light</span>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="graph-node child-node">
                      <div class="node-content">
                        <span class="node-icon">ğŸ“·</span>
                        <span class="node-label">Camera</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="graph-code">
                <h3>åœºæ™¯å›¾æ“ä½œä»£ç </h3>
                <div class="code-block">
                  <pre><code>// åˆ›å»ºåœºæ™¯å›¾ç»“æ„
const scene = new THREE.Scene();

// åˆ›å»ºç»„
const group = new THREE.Group();
group.name = 'mainGroup';

// æ·»åŠ ç½‘æ ¼åˆ°ç»„
const geometry = new THREE.BoxGeometry(1, 1, 1);
const material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
const cube = new THREE.Mesh(geometry, material);
cube.name = 'greenCube';
group.add(cube);

// æ·»åŠ å…‰æºåˆ°ç»„
const light = new THREE.PointLight(0xffffff, 1, 100);
light.name = 'pointLight';
group.add(light);

// å°†ç»„æ·»åŠ åˆ°åœºæ™¯
scene.add(group);

// æ·»åŠ ç›¸æœºåˆ°åœºæ™¯
const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
camera.name = 'mainCamera';
scene.add(camera);

// éå†åœºæ™¯å›¾
scene.traverse((object) => {
  console.log(object.name, object.type);
});

// æŸ¥æ‰¾ç‰¹å®šå¯¹è±¡
const foundCube = scene.getObjectByName('greenCube');</code></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- åœºæ™¯ç®¡ç† -->
      <section class="management-section">
        <div class="card">
          <h2 class="card-title">åœºæ™¯ç®¡ç†ä¸æ“ä½œ</h2>
          <div class="card-content">
            <div class="management-grid">
              <div class="management-item">
                <h3>å¯¹è±¡æ“ä½œ</h3>
                <div class="management-content">
                  <div class="code-block">
                    <pre><code>// æ·»åŠ å¯¹è±¡
scene.add(mesh);
scene.add(light);
scene.add(camera);

// ç§»é™¤å¯¹è±¡
scene.remove(mesh);

// æ£€æŸ¥å¯¹è±¡æ˜¯å¦å­˜åœ¨
scene.has(mesh); // true/false

// æ¸…ç©ºåœºæ™¯
scene.clear();

// è·å–å­å¯¹è±¡æ•°é‡
scene.children.length;</code></pre>
                  </div>
                </div>
              </div>

              <div class="management-item">
                <h3>éå†ä¸æŸ¥æ‰¾</h3>
                <div class="management-content">
                  <div class="code-block">
                    <pre><code>// éå†æ‰€æœ‰å¯¹è±¡
scene.traverse((object) => {
  console.log(object.name);
});

// éå†å¯è§å¯¹è±¡
scene.traverseVisible((object) => {
  if (object.isMesh) {
    object.material.color.set(0xff0000);
  }
});

// æŒ‰åç§°æŸ¥æ‰¾
const camera = scene.getObjectByName('mainCamera');

// æŒ‰ç±»å‹æŸ¥æ‰¾
const lights = [];
scene.traverse((object) => {
  if (object.isLight) {
    lights.push(object);
  }
});

// æŒ‰å±æ€§æŸ¥æ‰¾
const redObjects = [];
scene.traverse((object) => {
  if (object.material && object.material.color.getHex() === 0xff0000) {
    redObjects.push(object);
  }
});</code></pre>
                  </div>
                </div>
              </div>

              <div class="management-item">
                <h3>åœºæ™¯åºåˆ—åŒ–</h3>
                <div class="management-content">
                  <div class="code-block">
                    <pre><code>// è½¬æ¢ä¸ºJSON
const sceneData = scene.toJSON();

// ä»JSONæ¢å¤åœºæ™¯
const loader = new THREE.ObjectLoader();
const newScene = loader.parse(sceneData);

// å…‹éš†åœºæ™¯
const clonedScene = scene.clone();

// å¤åˆ¶åœºæ™¯
const copiedScene = new THREE.Scene();
THREE.Object3D.prototype.copy.call(copiedScene, scene, true);</code></pre>
                  </div>
                </div>
              </div>

              <div class="management-item">
                <h3>æ€§èƒ½ä¼˜åŒ–</h3>
                <div class="management-content">
                  <div class="code-block">
                    <pre><code>// ç¦ç”¨è‡ªåŠ¨æ›´æ–°ï¼ˆé«˜çº§ç”¨æ³•ï¼‰
scene.autoUpdate = false;

// æ‰‹åŠ¨æ›´æ–°
function updateScene() {
  scene.updateMatrixWorld(true);
}

// æŒ‰éœ€æ›´æ–°å¯¹è±¡
const objectsToUpdate = [];
scene.traverse((object) => {
  if (object.userData.needsUpdate) {
    objectsToUpdate.push(object);
  }
});

// æ‰¹é‡å¤„ç†
objectsToUpdate.forEach(obj => obj.updateMatrix());</code></pre>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- é«˜çº§åœºæ™¯æŠ€æœ¯ -->
      <section class="advanced-section">
        <div class="card">
          <h2 class="card-title">é«˜çº§åœºæ™¯æŠ€æœ¯</h2>
          <div class="card-content">
            <div class="advanced-grid">
              <div class="advanced-item">
                <h3>å¤šåœºæ™¯ç®¡ç†</h3>
                <div class="advanced-content">
                  <p>åœ¨å•ä¸ªåº”ç”¨ä¸­ç®¡ç†å¤šä¸ªåœºæ™¯ï¼Œç”¨äºUIåˆ‡æ¢ã€å…³å¡ç³»ç»Ÿç­‰</p>
                  <div class="code-block">
                    <pre><code>class SceneManager {
  constructor() {
    this.scenes = new Map();
    this.currentScene = null;
  }

  addScene(name, scene) {
    this.scenes.set(name, scene);
  }

  switchToScene(name) {
    if (this.scenes.has(name)) {
      this.currentScene = this.scenes.get(name);
    }
  }

  getCurrentScene() {
    return this.currentScene;
  }

  render(renderer, camera) {
    if (this.currentScene) {
      renderer.render(this.currentScene, camera);
    }
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const sceneManager = new SceneManager();
const mainScene = new THREE.Scene();
const uiScene = new THREE.Scene();

sceneManager.addScene('main', mainScene);
sceneManager.addScene('ui', uiScene);
sceneManager.switchToScene('main');</code></pre>
                  </div>
                </div>
              </div>

              <div class="advanced-item">
                <h3>åœºæ™¯åˆ†å±‚æ¸²æŸ“</h3>
                <div class="advanced-content">
                  <p>å°†åœºæ™¯åˆ†ä¸ºä¸åŒå±‚çº§åˆ†åˆ«æ¸²æŸ“ï¼Œç”¨äºåæœŸå¤„ç†ã€UIå åŠ ç­‰</p>
                  <div class="code-block">
                    <pre><code>// åˆ›å»ºå¤šä¸ªæ¸²æŸ“ç›®æ ‡
const mainRenderTarget = new THREE.WebGLRenderTarget(window.innerWidth, window.innerHeight);
const uiRenderTarget = new THREE.WebGLRenderTarget(window.innerWidth, window.innerHeight);

// åˆ†å±‚æ¸²æŸ“
function renderLayers() {
  // æ¸²æŸ“ä¸»åœºæ™¯
  renderer.setRenderTarget(mainRenderTarget);
  renderer.render(mainScene, mainCamera);

  // æ¸²æŸ“UIåœºæ™¯
  renderer.setRenderTarget(uiRenderTarget);
  renderer.render(uiScene, uiCamera);

  // å›åˆ°é»˜è®¤å¸§ç¼“å†²åŒº
  renderer.setRenderTarget(null);

  // åˆæˆæœ€ç»ˆå›¾åƒï¼ˆä¼ªä»£ç ï¼‰
  // composeLayers(mainRenderTarget.texture, uiRenderTarget.texture);
}</code></pre>
                  </div>
                </div>
              </div>

              <div class="advanced-item">
                <h3>åŠ¨æ€åœºæ™¯åŠ è½½</h3>
                <div class="advanced-content">
                  <p>åŠ¨æ€åŠ è½½å’Œå¸è½½åœºæ™¯å†…å®¹ï¼Œä¼˜åŒ–å†…å­˜ä½¿ç”¨</p>
                  <div class="code-block">
                    <pre><code>class DynamicScene {
  constructor() {
    this.scene = new THREE.Scene();
    this.loadedSections = new Map();
  }

  async loadSection(sectionId, url) {
    if (this.loadedSections.has(sectionId)) {
      return; // å·²ç»åŠ è½½
    }

    const loader = new THREE.ObjectLoader();
    try {
      const sceneData = await fetch(url).then(r => r.json());
      const section = loader.parse(sceneData);
      this.scene.add(section);
      this.loadedSections.set(sectionId, section);
    } catch (error) {
      console.error(`Failed to load section ${sectionId}:`, error);
    }
  }

  unloadSection(sectionId) {
    if (this.loadedSections.has(sectionId)) {
      const section = this.loadedSections.get(sectionId);
      this.scene.remove(section);
      // é‡Šæ”¾èµ„æº
      section.traverse((obj) => {
        if (obj.geometry) obj.geometry.dispose();
        if (obj.material) {
          if (Array.isArray(obj.material)) {
            obj.material.forEach(m => m.dispose());
          } else {
            obj.material.dispose();
          }
        }
      });
      this.loadedSections.delete(sectionId);
    }
  }
}</code></pre>
                  </div>
                </div>
              </div>

              <div class="advanced-item">
                <h3>åœºæ™¯çŠ¶æ€ç®¡ç†</h3>
                <div class="advanced-content">
                  <p>ä¿å­˜å’Œæ¢å¤åœºæ™¯çŠ¶æ€ï¼Œå®ç°æ’¤é”€/é‡åšåŠŸèƒ½</p>
                  <div class="code-block">
                    <pre><code>class SceneStateManager {
  constructor(scene) {
    this.scene = scene;
    this.history = [];
    this.currentStateIndex = -1;
  }

  saveState() {
    const state = this.serializeScene();
    // ç§»é™¤å½“å‰çŠ¶æ€ä¹‹åçš„æ‰€æœ‰çŠ¶æ€ï¼ˆå¦‚æœæœ‰é‡åšåæ–°å»ºæ“ä½œï¼‰
    this.history = this.history.slice(0, this.currentStateIndex + 1);
    this.history.push(state);
    this.currentStateIndex++;

    // é™åˆ¶å†å²è®°å½•é•¿åº¦
    if (this.history.length > 50) {
      this.history.shift();
      this.currentStateIndex--;
    }
  }

  serializeScene() {
    const state = {
      children: []
    };

    this.scene.children.forEach(child => {
      state.children.push(this.serializeObject(child));
    });

    return state;
  }

  serializeObject(object) {
    return {
      uuid: object.uuid,
      type: object.type,
      name: object.name,
      position: object.position.toArray(),
      rotation: object.rotation.toArray(),
      scale: object.scale.toArray(),
      userData: JSON.parse(JSON.stringify(object.userData)),
      children: object.children.map(child => this.serializeObject(child))
    };
  }

  undo() {
    if (this.currentStateIndex > 0) {
      this.currentStateIndex--;
      this.restoreState(this.history[this.currentStateIndex]);
    }
  }

  redo() {
    if (this.currentStateIndex < this.history.length - 1) {
      this.currentStateIndex++;
      this.restoreState(this.history[this.currentStateIndex]);
    }
  }

  restoreState(state) {
    this.scene.clear();

    state.children.forEach(childData => {
      const child = this.deserializeObject(childData);
      this.scene.add(child);
    });
  }

  deserializeObject(data) {
    let object;

    switch (data.type) {
      case 'Mesh':
        const geometry = new THREE.BoxGeometry(1, 1, 1); // ç®€åŒ–ç¤ºä¾‹
        const material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
        object = new THREE.Mesh(geometry, material);
        break;
      // å¤„ç†å…¶ä»–ç±»å‹...
      default:
        object = new THREE.Object3D();
    }

    object.uuid = data.uuid;
    object.name = data.name;
    object.position.fromArray(data.position);
    object.rotation.fromArray(data.rotation);
    object.scale.fromArray(data.scale);
    object.userData = data.userData;

    data.children.forEach(childData => {
      const child = this.deserializeObject(childData);
      object.add(child);
    });

    return object;
  }
}</code></pre>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- å®Œæ•´ç¤ºä¾‹ -->
      <section class="complete-example-section">
        <div class="card">
          <h2 class="card-title">å®Œæ•´åœºæ™¯ç¤ºä¾‹</h2>
          <div class="card-content">
            <div class="example-content">
              <div class="code-example">
                <h3>å®Œæ•´çš„3Dåœºæ™¯æ­å»º</h3>
                <pre><code>import * as THREE from 'three';
import { OrbitControls } from 'three/examples/jsm/controls/OrbitControls';

class CompleteSceneExample {
  constructor() {
    this.init();
    this.createScene();
    this.addObjects();
    this.setupControls();
    this.animate();
  }

  init() {
    // åˆ›å»ºæ¸²æŸ“å™¨
    this.renderer = new THREE.WebGLRenderer({ antialias: true });
    this.renderer.setSize(window.innerWidth, window.innerHeight);
    this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    this.renderer.shadowMap.enabled = true;
    this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;
    document.body.appendChild(this.renderer.domElement);

    // åˆ›å»ºç›¸æœº
    this.camera = new THREE.PerspectiveCamera(
      75,
      window.innerWidth / window.innerHeight,
      0.1,
      1000
    );
    this.camera.position.set(5, 5, 5);
    this.camera.lookAt(0, 0, 0);
  }

  createScene() {
    // åˆ›å»ºä¸»åœºæ™¯
    this.scene = new THREE.Scene();

    // è®¾ç½®åœºæ™¯èƒŒæ™¯
    this.scene.background = new THREE.Color(0x87CEEB);

    // è®¾ç½®ç¯å¢ƒè´´å›¾
    const envTexture = new THREE.TextureLoader().load('environment.jpg');
    envTexture.mapping = THREE.EquirectangularReflectionMapping;
    this.scene.environment = envTexture;

    // æ·»åŠ é›¾æ•ˆ
    this.scene.fog = new THREE.Fog(0x87CEEB, 10, 50);
  }

  addObjects() {
    // åˆ›å»ºåœ°é¢
    const groundGeometry = new THREE.PlaneGeometry(20, 20);
    const groundMaterial = new THREE.MeshStandardMaterial({
      color: 0x7CFC00,
      roughness: 0.8,
      metalness: 0.2
    });
    this.ground = new THREE.Mesh(groundGeometry, groundMaterial);
    this.ground.rotation.x = -Math.PI / 2;
    this.ground.receiveShadow = true;
    this.scene.add(this.ground);

    // åˆ›å»ºç«‹æ–¹ä½“ç»„
    this.cubeGroup = new THREE.Group();
    this.cubeGroup.name = 'cubeGroup';

    for (let i = 0; i < 5; i++) {
      const geometry = new THREE.BoxGeometry(1, 1, 1);
      const material = new THREE.MeshStandardMaterial({
        color: new THREE.Color().setHSL(Math.random(), 0.7, 0.5)
      });
      const cube = new THREE.Mesh(geometry, material);
      cube.position.set(
        (Math.random() - 0.5) * 10,
        0.5,
        (Math.random() - 0.5) * 10
      );
      cube.castShadow = true;
      cube.receiveShadow = true;
      cube.name = `cube_${i}`;
      this.cubeGroup.add(cube);
    }

    this.scene.add(this.cubeGroup);

    // æ·»åŠ å…‰æº
    this.setupLighting();
  }

  setupLighting() {
    // ç¯å¢ƒå…‰
    const ambientLight = new THREE.AmbientLight(0x404040, 0.4);
    this.scene.add(ambientLight);

    // æ–¹å‘å…‰
    this.directionalLight = new THREE.DirectionalLight(0xffffff, 1);
    this.directionalLight.position.set(10, 10, 5);
    this.directionalLight.castShadow = true;
    this.directionalLight.shadow.mapSize.width = 2048;
    this.directionalLight.shadow.mapSize.height = 2048;
    this.scene.add(this.directionalLight);

    // ç‚¹å…‰æº
    this.pointLight = new THREE.PointLight(0xff4000, 1, 100);
    this.pointLight.position.set(0, 3, 0);
    this.pointLight.castShadow = true;
    this.scene.add(this.pointLight);
  }

  setupControls() {
    // è½¨é“æ§åˆ¶å™¨
    this.controls = new OrbitControls(this.camera, this.renderer.domElement);
    this.controls.enableDamping = true;
    this.controls.dampingFactor = 0.05;

    // çª—å£å¤§å°è°ƒæ•´
    window.addEventListener('resize', () => this.onWindowResize());
  }

  onWindowResize() {
    this.camera.aspect = window.innerWidth / window.innerHeight;
    this.camera.updateProjectionMatrix();
    this.renderer.setSize(window.innerWidth, window.innerHeight);
  }

  animate() {
    requestAnimationFrame(() => this.animate());

    // æ›´æ–°æ§åˆ¶å™¨
    this.controls.update();

    // åŠ¨ç”»æ•ˆæœ
    const time = Date.now() * 0.001;

    // æ—‹è½¬ç«‹æ–¹ä½“ç»„
    this.cubeGroup.rotation.y = time * 0.5;

    // ç‚¹å…‰æºåŠ¨ç”»
    this.pointLight.position.x = Math.sin(time) * 3;
    this.pointLight.position.z = Math.cos(time) * 3;

    // æ¸²æŸ“åœºæ™¯
    this.renderer.render(this.scene, this.camera);
  }

  // åœºæ™¯ç®¡ç†æ–¹æ³•
  addNewCube() {
    const geometry = new THREE.BoxGeometry(1, 1, 1);
    const material = new THREE.MeshStandardMaterial({
      color: new THREE.Color().setHSL(Math.random(), 0.7, 0.5)
    });
    const cube = new THREE.Mesh(geometry, material);
    cube.position.set(
      (Math.random() - 0.5) * 8,
      0.5,
      (Math.random() - 0.5) * 8
    );
    cube.castShadow = true;
    cube.receiveShadow = true;
    cube.name = `cube_${Date.now()}`;
    this.cubeGroup.add(cube);
  }

  removeAllCubes() {
    const cubes = [];
    this.cubeGroup.traverse((child) => {
      if (child.isMesh && child.name.startsWith('cube_')) {
        cubes.push(child);
      }
    });

    cubes.forEach(cube => this.cubeGroup.remove(cube));
  }

  exportScene() {
    return this.scene.toJSON();
  }
}

// åˆå§‹åŒ–åœºæ™¯
const sceneExample = new CompleteSceneExample();</code></pre>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>
</template>

<script setup lang="ts">
// è¿™é‡Œå¯ä»¥æ·»åŠ å“åº”å¼æ•°æ®æˆ–æ–¹æ³•
</script>

<style lang="less" scoped>
.scene-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 24px;
  font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
  line-height: 1.6;
  color: #333;
  background: linear-gradient(135deg, #f5f7fa 0%, #e4eaf7 100%);
  min-height: 100vh;
}

.page-header {
  text-align: center;
  margin-bottom: 32px;
  padding: 32px 0;

  .title {
    font-size: 2.5rem;
    font-weight: 700;
    color: #2c3e50;
    margin: 0 0 8px 0;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .subtitle {
    font-size: 1.2rem;
    color: #7f8c8d;
    margin: 0;
    font-weight: 300;
  }
}

.content {
  display: flex;
  flex-direction: column;
  gap: 24px;
}

.card {
  background: white;
  border-radius: 12px;
  padding: 24px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
  transition: all 0.3s ease;
  border: 1px solid #e1e8ed;

  &:hover {
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    transform: translateY(-2px);
  }

  .card-title {
    font-size: 1.5rem;
    font-weight: 600;
    color: #2c3e50;
    margin: 0 0 16px 0;
    padding-bottom: 12px;
    border-bottom: 2px solid #e9ecef;
  }
}

.overview-content {
  .intro-text {
    font-size: 1.1rem;
    color: #555;
    margin-bottom: 24px;
    text-align: center;
  }
}

.concept-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
}

.concept-item {
  display: flex;
  align-items: center;
  padding: 20px;
  background: #f8f9fa;
  border-radius: 8px;
  transition: all 0.3s ease;

  &:hover {
    background: #e9ecef;
    transform: translateY(-2px);
  }

  .concept-icon {
    font-size: 2rem;
    margin-right: 16px;
  }

  .concept-text {
    h4 {
      margin: 0 0 4px 0;
      color: #2c3e50;
      font-size: 1.1rem;
    }

    p {
      margin: 0;
      color: #666;
      font-size: 0.9rem;
    }
  }
}

.creation-steps {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.step-item {
  display: flex;
  align-items: flex-start;
  padding: 20px;
  background: #f8f9fa;
  border-radius: 8px;
  border-left: 4px solid #667eea;

  .step-number {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    background: #667eea;
    color: white;
    border-radius: 50%;
    font-weight: 600;
    margin-right: 16px;
    flex-shrink: 0;
  }

  .step-content {
    flex: 1;

    h4 {
      margin: 0 0 8px 0;
      color: #2c3e50;
      font-size: 1.1rem;
    }

    p {
      margin: 0 0 12px 0;
      color: #666;
    }
  }
}

.code-block {
  background: #2d3748;
  border-radius: 6px;
  overflow: hidden;

  pre {
    margin: 0;
    padding: 16px;
    overflow-x: auto;

    code {
      font-family: 'Monaco', 'Consolas', monospace;
      font-size: 0.85rem;
      color: #e2e8f0;
      line-height: 1.4;
    }
  }
}

.properties-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 24px;
}

.property-group {
  h3 {
    margin: 0 0 16px 0;
    color: #2c3e50;
    font-size: 1.2rem;
    padding-bottom: 8px;
    border-bottom: 2px solid #e9ecef;
  }
}

.property-list {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.property-item {
  background: #f8f9fa;
  padding: 16px;
  border-radius: 8px;
  border-left: 4px solid #667eea;

  .property-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;

    .property-name {
      font-family: 'Monaco', 'Consolas', monospace;
      font-weight: 600;
      color: #2c3e50;
    }

    .property-type {
      font-size: 0.8rem;
      color: #666;
      background: #e9ecef;
      padding: 2px 8px;
      border-radius: 4px;
    }
  }

  .property-desc {
    margin: 0 0 12px 0;
    color: #666;
    font-size: 0.9rem;
  }

  .property-examples {
    h5 {
      margin: 0 0 8px 0;
      color: #2c3e50;
      font-size: 0.9rem;
    }
  }
}

.graph-explanation {
  p {
    margin: 0 0 24px 0;
    color: #666;
    text-align: center;
  }
}

.graph-visualization {
  display: flex;
  justify-content: center;
  margin-bottom: 32px;
  padding: 20px;
  background: #f8f9fa;
  border-radius: 8px;
}

.graph-node {
  display: flex;
  flex-direction: column;
  align-items: center;
  position: relative;

  &.main-node {
    .node-content {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      padding: 16px 24px;
    }
  }

  &.child-node {
    margin-top: 40px;

    .node-content {
      background: #4CAF50;
      color: white;
      padding: 12px 20px;
    }

    &::before {
      content: '';
      position: absolute;
      top: -20px;
      left: 50%;
      width: 2px;
      height: 20px;
      background: #ccc;
      transform: translateX(-50%);
    }
  }

  &.leaf-node {
    margin-top: 20px;

    .node-content {
      background: #2196F3;
      color: white;
      padding: 8px 16px;
    }

    &::before {
      content: '';
      position: absolute;
      top: -10px;
      left: 50%;
      width: 2px;
      height: 10px;
      background: #ccc;
      transform: translateX(-50%);
    }
  }
}

.node-content {
  display: flex;
  align-items: center;
  gap: 8px;
  border-radius: 6px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);

  .node-icon {
    font-size: 1.2rem;
  }

  .node-label {
    font-weight: 600;
    font-size: 0.9rem;
  }
}

.node-children {
  display: flex;
  gap: 40px;
  margin-top: 20px;
  position: relative;

  &::before {
    content: '';
    position: absolute;
    top: -20px;
    left: 50%;
    width: calc(100% - 80px);
    height: 2px;
    background: #ccc;
    transform: translateX(-50%);
  }
}

.graph-code {
  h3 {
    margin: 0 0 16px 0;
    color: #2c3e50;
    font-size: 1.2rem;
  }
}

.management-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 24px;
}

.management-item {
  background: #f8f9fa;
  padding: 20px;
  border-radius: 8px;

  h3 {
    margin: 0 0 12px 0;
    color: #2c3e50;
    font-size: 1.1rem;
  }

  .management-content {
    .code-block {
      background: #2d3748;
    }
  }
}

.advanced-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 24px;
}

.advanced-item {
  background: #f8f9fa;
  padding: 20px;
  border-radius: 8px;

  h3 {
    margin: 0 0 12px 0;
    color: #2c3e50;
    font-size: 1.1rem;
  }

  .advanced-content {
    p {
      margin: 0 0 12px 0;
      color: #666;
      font-size: 0.9rem;
    }
  }
}

.example-content {
  .code-example {
    h3 {
      margin: 0 0 16px 0;
      color: #2c3e50;
      font-size: 1.2rem;
    }
  }
}

// å“åº”å¼è®¾è®¡
@media (max-width: 768px) {
  .scene-container {
    padding: 16px;
  }

  .page-header .title {
    font-size: 2rem;
  }

  .card {
    padding: 20px;
  }

  .concept-grid,
  .properties-grid,
  .management-grid,
  .advanced-grid {
    grid-template-columns: 1fr;
  }

  .step-item {
    flex-direction: column;
    align-items: flex-start;

    .step-number {
      margin-bottom: 12px;
    }
  }

  .node-children {
    flex-direction: column;
    gap: 20px;

    &::before {
      width: 2px;
      height: calc(100% - 40px);
      top: -20px;
      left: 50%;
    }
  }
}
</style>
